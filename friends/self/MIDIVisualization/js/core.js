((t,e)=>{"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Tone=e():t.Tone=e()})("undefined"!=typeof self?self:this,function(){return n=[function(t,e,n){function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function o(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}}function a(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}}function u(t,e){return{startTime:e,type:"setValue",value:t}}function c(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}}function h(t,e,n){var i=n.startTime,s=n.target;return s+(e-s)*Math.exp((i-t)/n.timeConstant)}function l(t){return"exponentialRampToValue"===t.type}function p(t){return"linearRampToValue"===t.type}function d(t){return l(t)||p(t)}function f(t){return"setValue"===t.type}function m(t){return"setValueCurve"===t.type}function g(t,e,n,i){var s=t[e];return void 0===s?i:d(s)||f(s)?s.value:m(s)?s.values[s.values.length-1]:h(n,g(t,e-1,s.startTime,i),s)}function _(t,e,n,i,s){return void 0===n?[i.insertTime,s]:d(n)?[n.endTime,n.value]:f(n)?[n.startTime,n.value]:m(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,g(t,e-1,n.startTime,s)]}function y(t){return"cancelAndHold"===t.type}function v(t){return"cancelScheduledValues"===t.type}function b(t){return y(t)||v(t)?t.cancelTime:l(t)||p(t)?t.endTime:t.startTime}function S(t,e,n,i){var s=i.endTime;return n===(i=i.value)?i:0<n&&0<i||n<0&&i<0?n*Math.pow(i/n,(t-e)/(s-e)):0}function w(t,e,n,i){return n+(t-e)/(i.endTime-e)*(i.value-n)}function x(t){return"setTarget"===t.type}function s(t){k.default(this,s),this._automationEvents=[],this._currenTime=0,this._defaultValue=t}var r,T,A,k;e=e,r=n(1),T=n(7),n=n(8),A=i(r),k=i(T),(r=i(n)).default(s,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(e){var n=b(e);if(y(e)||v(e)){var t=this._automationEvents.findIndex(function(t){return v(e)&&m(t)?t.startTime+t.duration>=n:b(t)>=n}),i=this._automationEvents[t];if(-1!==t&&(this._automationEvents=this._automationEvents.slice(0,t)),y(e)){t=this._automationEvents[this._automationEvents.length-1];if(void 0!==i&&d(i)){if(x(t))throw new Error("The internal list is malformed.");var s=m(t)?t.startTime+t.duration:b(t),r=m(t)?t.values[t.values.length-1]:t.value,s=(l(i)?S:w)(n,s,r,i),r=(l(i)?o:a)(s,n,this._currenTime);this._automationEvents.push(r)}void 0!==t&&x(t)&&this._automationEvents.push(u(this.getValue(n),n)),void 0!==t&&m(t)&&t.startTime+t.duration>n&&(this._automationEvents[this._automationEvents.length-1]=c(new Float32Array([6,7]),t.startTime,n-t.startTime))}}else{i=this._automationEvents.findIndex(function(t){return b(t)>n}),s=-1===i?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[i-1];if(void 0!==s&&m(s)&&b(s)+s.duration>n)return!1;r=l(e)?o(e.value,e.endTime,this._currenTime):p(e)?a(e.value,n,this._currenTime):e;if(-1===i)this._automationEvents.push(r);else{if(m(e)&&n+e.duration>b(this._automationEvents[i]))return!1;this._automationEvents.splice(i,0,r)}}return!0}},{key:"flush",value:function(e){var t,n,i=this._automationEvents.findIndex(function(t){return b(t)>e});1<i&&(n=(t=this._automationEvents.slice(i-1))[0],x(n)&&t.unshift(u(g(this._automationEvents,i-2,n.startTime,this._defaultValue),n.startTime)),this._automationEvents=t)}},{key:"getValue",value:function(e){var t,n,i,s,r,o,a,u;return 0===this._automationEvents.length?this._defaultValue:(n=this._automationEvents[this._automationEvents.length-1],a=this._automationEvents.findIndex(function(t){return b(t)>e}),t=this._automationEvents[a],void 0!==(n=b(n)<=e?n:this._automationEvents[a-1])&&x(n)&&(void 0===t||!d(t)||t.insertTime>e)?h(e,g(this._automationEvents,a-2,n.startTime,this._defaultValue),n):void 0===n||!f(n)||void 0!==t&&d(t)?void 0!==n&&m(n)&&(void 0===t||!d(t)||n.startTime+n.duration>e)?e<n.startTime+n.duration?(r=e,i=(s=n).duration,o=s.values,s=(r-s.startTime)/i*((r=o).length-1),i=Math.floor(s),o=Math.ceil(s),i===o?r[i]:(1-(s-i))*r[i]+(1-(o-s))*r[o]):n.values[n.values.length-1]:void 0===n||!d(n)||void 0!==t&&d(t)?void 0!==t&&l(t)?(i=_(this._automationEvents,a-1,n,t,this._defaultValue),r=(s=A.default(i,2))[0],S(e,r,s[1],t)):void 0!==t&&p(t)?(o=_(this._automationEvents,a-1,n,t,this._defaultValue),u=(a=A.default(o,2))[0],w(e,u,a[1],t)):this._defaultValue:n.value:n.value)}}]),T=s,e.AutomationEventList=T,e.createCancelAndHoldAutomationEvent=function(t){return{cancelTime:t,type:"cancelAndHold"}},e.createCancelScheduledValuesAutomationEvent=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},e.createExponentialRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},e.createLinearRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},e.createSetTargetAutomationEvent=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}},e.createSetValueAutomationEvent=u,e.createSetValueCurveAutomationEvent=c,Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,n){var i=n(2),s=n(3),r=n(4),o=n(6);t.exports=function(t,e){return i(t)||s(t,e)||r(t,e)||o()}},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,s=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){s=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(s)throw r}}return n}}},function(t,e,n){var i=n(5);t.exports=function(t,e){var n;if(t)return"string"==typeof t?i(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}},function(R,t,e){e.r(t),e.d(t,"getContext",function(){return S}),e.d(t,"setContext",function(){return ip}),e.d(t,"Clock",function(){return Cp}),e.d(t,"Context",function(){return Jl}),e.d(t,"BaseContext",function(){return Zl}),e.d(t,"Delay",function(){return Np}),e.d(t,"Gain",function(){return k}),e.d(t,"Offline",function(){return Ip}),e.d(t,"OfflineContext",function(){return tp}),e.d(t,"Param",function(){return T}),e.d(t,"ToneAudioBuffer",function(){return b}),e.d(t,"ToneAudioBuffers",function(){return Ep}),e.d(t,"ToneAudioNode",function(){return A}),e.d(t,"connectSeries",function(){return Sp}),e.d(t,"connect",function(){return wp}),e.d(t,"disconnect",function(){return xp}),e.d(t,"FrequencyClass",function(){return mp}),e.d(t,"Frequency",function(){return yp}),e.d(t,"MidiClass",function(){return qp}),e.d(t,"Midi",function(){return Dp}),e.d(t,"TimeClass",function(){return dp}),e.d(t,"Time",function(){return fp}),e.d(t,"TicksClass",function(){return P}),e.d(t,"Ticks",function(){return Rp}),e.d(t,"TransportTimeClass",function(){return w}),e.d(t,"TransportTime",function(){return vp}),e.d(t,"Emitter",function(){return Xl}),e.d(t,"IntervalTimeline",function(){return Fp}),e.d(t,"StateTimeline",function(){return bp}),e.d(t,"Timeline",function(){return Ql}),e.d(t,"isUndef",function(){return Sl}),e.d(t,"isDefined",function(){return c}),e.d(t,"isFunction",function(){return wl}),e.d(t,"isNumber",function(){return xl}),e.d(t,"isObject",function(){return Tl}),e.d(t,"isBoolean",function(){return Al}),e.d(t,"isArray",function(){return l}),e.d(t,"isString",function(){return kl}),e.d(t,"isNote",function(){return Ol}),e.d(t,"dbToGain",function(){return rp}),e.d(t,"gainToDb",function(){return op}),e.d(t,"intervalToFrequencyRatio",function(){return ap}),e.d(t,"ftom",function(){return cp}),e.d(t,"mtof",function(){return lp}),e.d(t,"optionsFromArguments",function(){return p}),e.d(t,"defaultArg",function(){return Fl}),e.d(t,"Unit",function(){return F}),e.d(t,"debug",function(){return z}),e.d(t,"Noise",function(){return Wp}),e.d(t,"UserMedia",function(){return Xp}),e.d(t,"Oscillator",function(){return N}),e.d(t,"AMOscillator",function(){return nd}),e.d(t,"FMOscillator",function(){return id}),e.d(t,"PulseOscillator",function(){return sd}),e.d(t,"FatOscillator",function(){return rd}),e.d(t,"PWMOscillator",function(){return od}),e.d(t,"OmniOscillator",function(){return ud}),e.d(t,"ToneOscillatorNode",function(){return Jp}),e.d(t,"LFO",function(){return pd}),e.d(t,"ToneBufferSource",function(){return Hp}),e.d(t,"Player",function(){return md}),e.d(t,"Players",function(){return gd}),e.d(t,"GrainPlayer",function(){return _d}),e.d(t,"Add",function(){return cd}),e.d(t,"Abs",function(){return yd}),e.d(t,"AudioToGain",function(){return ed}),e.d(t,"GainToAudio",function(){return vd}),e.d(t,"GreaterThan",function(){return xd}),e.d(t,"GreaterThanZero",function(){return wd}),e.d(t,"Multiply",function(){return I}),e.d(t,"Negate",function(){return bd}),e.d(t,"Pow",function(){return Td}),e.d(t,"Signal",function(){return O}),e.d(t,"connectSignal",function(){return kp}),e.d(t,"Scale",function(){return hd}),e.d(t,"ScaleExp",function(){return Ad}),e.d(t,"Subtract",function(){return Sd}),e.d(t,"SyncedSignal",function(){return kd}),e.d(t,"WaveShaper",function(){return td}),e.d(t,"Zero",function(){return ld}),e.d(t,"AMSynth",function(){return Ed}),e.d(t,"DuoSynth",function(){return Fd}),e.d(t,"FMSynth",function(){return jd}),e.d(t,"MetalSynth",function(){return Ld}),e.d(t,"MembraneSynth",function(){return Bd}),e.d(t,"MonoSynth",function(){return zd}),e.d(t,"NoiseSynth",function(){return Ud}),e.d(t,"PluckSynth",function(){return Zd}),e.d(t,"PolySynth",function(){return Jd}),e.d(t,"Sampler",function(){return Kd}),e.d(t,"Synth",function(){return Nd}),e.d(t,"Loop",function(){return ef}),e.d(t,"Part",function(){return nf}),e.d(t,"Pattern",function(){return df}),e.d(t,"Sequence",function(){return ff}),e.d(t,"ToneEvent",function(){return tf}),e.d(t,"AutoFilter",function(){return _f}),e.d(t,"AutoPanner",function(){return vf}),e.d(t,"AutoWah",function(){return Sf}),e.d(t,"BitCrusher",function(){return wf}),e.d(t,"Chebyshev",function(){return Tf}),e.d(t,"Chorus",function(){return Mf}),e.d(t,"Distortion",function(){return Cf}),e.d(t,"FeedbackDelay",function(){return If}),e.d(t,"FrequencyShifter",function(){return qf}),e.d(t,"Freeverb",function(){return zf}),e.d(t,"JCReverb",function(){return Lf}),e.d(t,"PingPongDelay",function(){return Uf}),e.d(t,"PitchShift",function(){return Gf}),e.d(t,"Phaser",function(){return Qf}),e.d(t,"Reverb",function(){return Hf}),e.d(t,"StereoWidener",function(){return Xf}),e.d(t,"Tremolo",function(){return Zf}),e.d(t,"Vibrato",function(){return Jf}),e.d(t,"Analyser",function(){return Kf}),e.d(t,"Meter",function(){return em}),e.d(t,"FFT",function(){return nm}),e.d(t,"DCMeter",function(){return im}),e.d(t,"Waveform",function(){return sm}),e.d(t,"Follower",function(){return bf}),e.d(t,"Channel",function(){return om}),e.d(t,"CrossFade",function(){return mf}),e.d(t,"Merge",function(){return kf}),e.d(t,"MidSideMerge",function(){return $f}),e.d(t,"MidSideSplit",function(){return Wf}),e.d(t,"MultibandSplit",function(){return am}),e.d(t,"Panner",function(){return yf}),e.d(t,"Panner3D",function(){return cm}),e.d(t,"PanVol",function(){return rm}),e.d(t,"Recorder",function(){return hm}),e.d(t,"Solo",function(){return D}),e.d(t,"Split",function(){return Af}),e.d(t,"Volume",function(){return Vp}),e.d(t,"Compressor",function(){return lm}),e.d(t,"Gate",function(){return pm}),e.d(t,"Limiter",function(){return dm}),e.d(t,"MidSideCompressor",function(){return fm}),e.d(t,"MultibandCompressor",function(){return mm}),e.d(t,"AmplitudeEnvelope",function(){return Cd}),e.d(t,"Envelope",function(){return E}),e.d(t,"FrequencyEnvelope",function(){return Rd}),e.d(t,"EQ3",function(){return gm}),e.d(t,"Filter",function(){return Dd}),e.d(t,"OnePoleFilter",function(){return Yd}),e.d(t,"FeedbackCombFilter",function(){return $d}),e.d(t,"LowpassCombFilter",function(){return Xd}),e.d(t,"Convolver",function(){return _m}),e.d(t,"BiquadFilter",function(){return qd}),e.d(t,"version",function(){return j}),e.d(t,"start",function(){return sp}),e.d(t,"supported",function(){return ml}),e.d(t,"now",function(){return ym}),e.d(t,"immediate",function(){return vm}),e.d(t,"Transport",function(){return bm}),e.d(t,"getTransport",function(){return Sm}),e.d(t,"Destination",function(){return wm}),e.d(t,"Master",function(){return xm}),e.d(t,"getDestination",function(){return Tm}),e.d(t,"Listener",function(){return Am}),e.d(t,"getListener",function(){return km}),e.d(t,"Draw",function(){return Om}),e.d(t,"getDraw",function(){return Pm}),e.d(t,"context",function(){return Mm}),e.d(t,"loaded",function(){return Cm}),e.d(t,"Buffer",function(){return Nm}),e.d(t,"Buffers",function(){return Im}),e.d(t,"BufferSource",function(){return Em});var z={},F=(e.r(z),e.d(z,"assert",function(){return o}),e.d(z,"assertRange",function(){return r}),e.d(z,"assertContextRunning",function(){return gl}),e.d(z,"setLogger",function(){return yl}),e.d(z,"log",function(){return vl}),e.d(z,"warn",function(){return bl}),{});e.r(F);let j="14.7.58";var V,L,B,U,G=e(0);let Q=new WeakSet,H=new WeakMap,W=new WeakMap,$=new WeakMap,Y=new WeakMap,X=new WeakMap,Z=new WeakMap,J=new WeakMap,K=new WeakMap,tt=new WeakMap,et={construct:()=>et},nt=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,it=(t,n)=>{var i=[];let s=t.replace(/^[\s]+/,""),r=s.match(nt);for(;null!==r;){let t=r[1].slice(1,-1),e=r[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,n).toString());i.push(e),s=s.slice(r[0].length).replace(/^[\s]+/,""),r=s.match(nt)}return[i.join(";"),s]},st=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},rt=t=>{if(!(t=>{try{new new Proxy(t,et)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},ot={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},v=(t,e)=>t.context===e,at=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},ut=()=>new DOMException("","IndexSizeError"),ct=e=>{var n;e.getChannelData=(n=e.getChannelData,t=>{try{return n.call(e,t)}catch(t){if(12===t.code)throw ut();throw t}})},ht={numberOfChannels:1},lt=-34028234663852886e22,pt=-lt,dt=t=>Q.has(t),ft=(t,e)=>{t=t.get(e);if(void 0===t)throw new Error("A value with the given key could not be found.");return t},mt=t=>ft(Z,t),gt=t=>{if(Q.has(t))throw new Error("The AudioNode is already stored.");Q.add(t),mt(t).forEach(t=>t(!0))},_t=t=>{if(!Q.has(t))throw new Error("The AudioNode is not stored.");Q.delete(t),mt(t).forEach(t=>t(!1))},yt={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},vt=t=>"port"in t,g=t=>ft(H,t),bt=t=>ft($,t),St=(e,n)=>{let t=g(e).activeInputs;t.forEach(t=>t.forEach(([t])=>{n.includes(e)||St(t,[...n,e])}));var i="playbackRate"in e?[e.playbackRate]:vt(e)?Array.from(e.parameters.values()):"frequency"in(i=e)&&"gain"in i?[e.Q,e.detune,e.frequency,e.gain]:"offset"in e?[e.offset]:!("frequency"in(i=e))&&"gain"in i?[e.gain]:"detune"in(i=e)&&"frequency"in i?[e.detune,e.frequency]:"pan"in e?[e.pan]:[];for(let e of i){let t=bt(e);void 0!==t&&t.activeInputs.forEach(([t])=>St(t,n))}dt(e)&&_t(e)},wt=t=>{St(t.destination,[])},xt=t=>"context"in t,Tt=t=>xt(t[0]),At=t=>"inputs"in t,kt=(t,e,n,i)=>{var s;return At(e)?(s=e.inputs[i],t.connect(s,n,0),[s,n,0]):(t.connect(e,n,i),[e,n,i])},Ot=(t,e)=>{if(!mt(t).delete(e))throw new Error("Missing the expected event listener.")},Pt=(t,e,n,i)=>{At(e)?t.disconnect(e.inputs[i],n,0):t.disconnect(e,n,i)},_=t=>ft(W,t),Mt=t=>ft(Y,t),Ct=(e,t,n,i)=>{for(let t of e)if(n(t)){if(i)return!1;throw Error("The set contains at least one similar element.")}return e.add(t),!0},Nt=t=>J.has(t),It=t=>!Q.has(t),Et=(t,e)=>{e=Array.from(t).filter(e);if(1<e.length)throw Error("More than one element was found.");if(0===e.length)throw Error("No element was found.");var[e]=e;return t.delete(e),e},qt=(t,e)=>{!vt(t)&&e.every(t=>0===t.size)&&_t(t)},Dt=o=>new Promise(e=>{let n=o.createScriptProcessor(256,1,1),t=o.createGain(),i=o.createBuffer(1,2,44100),s=i.getChannelData(0),r=(s[0]=1,s[1]=1,o.createBufferSource());r.buffer=i,r.loop=!0,r.connect(n).connect(o.destination),r.connect(t),r.disconnect(t),n.onaudioprocess=t=>{t=t.inputBuffer.getChannelData(0);Array.prototype.some.call(t,t=>1===t)?e(!0):e(!1),r.stop(),n.onaudioprocess=null,r.disconnect(n),n.disconnect(o.destination)},r.start()}),Rt=(e,n)=>{var i=new Map;for(let t of e)for(let e of t){let t=i.get(e);i.set(e,void 0===t?1:t+1)}i.forEach((t,e)=>n(e,t))},zt=t=>"context"in t,Ft=(t,e,[n,i,s],r)=>{Ct(t[i],[e,n,s],t=>t[0]===e&&t[1]===n,r)},jt=(t,e,[n,i],s)=>{Ct(t,[e,n,i],t=>t[0]===e&&t[1]===n,s)},Vt=(t,e,[n,i,s],r)=>{var o=t.get(n);void 0===o?t.set(n,new Set([[i,e,s]])):Ct(o,[i,e,s],t=>t[0]===i&&t[1]===e,r)},Lt=(t,[e,n,i],s)=>{var r=t.get(e);void 0===r?t.set(e,new Set([[n,i]])):Ct(r,[n,i],t=>t[0]===n,s)},Bt=(t,e,n,i)=>{var s=ft(t,e),r=Et(s,t=>t[0]===n&&t[1]===i);return 0===s.size&&t.delete(e),r},Ut=(t,e,n)=>{var i=ft(t,e),s=Et(i,t=>t[0]===n);return 0===i.size&&t.delete(e),s},Gt=(a,u,c,h,l)=>{let{activeInputs:p,passiveInputs:d}=g(u),t=g(a).outputs,e=mt(a),n=t=>{var e,n,i,s,r=_(u),o=_(a);if(t){let t=Bt(d,a,c,h);Ft(p,a,t,!1),l||Nt(a)||kt(o,r,c,h),It(u)&&gt(u)}else{e=p,n=a,i=c,s=h;let t=Et(e[s],t=>t[0]===n&&t[1]===i);Vt(d,h,t,!1),l||Nt(a)||Pt(o,r,c,h),dt(u)&&qt(u,p)}};return!!Ct(t,[u,c,h],t=>t[0]===u&&t[1]===c&&t[2]===h,!0)&&(e.add(n),dt(a)?Ft(p,a,[c,h,n],!0):Vt(d,h,[a,c,n],!0),!0)},Qt=(o,a,u,c)=>{let{activeInputs:h,passiveInputs:l}=bt(a),t=g(o).outputs,e=mt(o),n=e=>{var n,i,s=_(o),r=Mt(a);if(e){let t=Ut(l,o,u);jt(h,o,t,!1),c||Nt(o)||s.connect(r,u)}else{e=h,n=o,i=u;let t=Et(e,t=>t[0]===n&&t[1]===i);Lt(l,t,!1),c||Nt(o)||s.disconnect(r,u)}};return!!Ct(t,[a,u],t=>t[0]===a&&t[1]===u,!0)&&(e.add(n),dt(o)?jt(h,o,[u,n],!0):Lt(l,[o,u,n],!0),!0)},Ht=(t,e,n)=>{for(var i of t)if(i[0]===e&&i[1]===n)return t.delete(i),i;return null},Wt=(t,e,n,i,s)=>{var[r,o]=((t,e,n,i)=>{var{activeInputs:e,passiveInputs:s}=g(e),e=Ht(e[i],t,n);return null===e?[Bt(s,t,n,i)[2],!1]:[e[2],!0]})(t,n,i,s);if(null!==r&&(Ot(t,r),!o||e||Nt(t)||Pt(_(t),_(n),i,s)),dt(n)){let t=g(n).activeInputs;qt(n,t)}},$t=(t,e,n,i)=>{var[s,r]=((t,e,n)=>{var{activeInputs:e,passiveInputs:i}=bt(e),e=Ht(e,t,n);return null===e?[Ut(i,t,n)[1],!1]:[e[2],!0]})(t,n,i);null!==s&&(Ot(t,s),!r||e||Nt(t)||_(t).disconnect(Mt(n),i))};class Yt{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(n,i=null){return this._map.forEach((t,e)=>n.call(i,t,e,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}let Xt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function Zt(t,e,n,i,s){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],i,s);else{i=t.getChannelData(i);if(0===e[n].byteLength)e[n]=i.slice(s,s+128);else{let t=new Float32Array(i.buffer,s*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}let Jt=(t,e,n,i,s)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],i,s):0!==e[n].byteLength&&t.getChannelData(i).set(e[n],s)},Kt=(e,i)=>{var s=[];for(let t=0;t<e;t+=1){let e=[],n="number"==typeof i?i:i[t];for(let t=0;t<n;t+=1)e.push(new Float32Array(128));s.push(e)}return s},te={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},ee={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},ne={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},ie={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},se={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},re={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},oe=(t,e,n)=>{e=e[n];if(void 0===e)throw t();return e},ae={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},ue={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},a=()=>new DOMException("","InvalidStateError"),ce=()=>new DOMException("","InvalidAccessError"),he={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},le=(i,e,s,r,o,a,u,t,c,h,l)=>{var n=h.length;let p=t;for(let t=0;t<n;t+=1){let n=s[0]*h[t];for(let e=1;e<o;e+=1){let t=p-e&c-1;n=(n+=s[e]*a[t])-i[e]*u[t]}for(let t=o;t<r;t+=1)n+=s[t]*a[p-t&c-1];for(let t=o;t<e;t+=1)n-=i[t]*u[p-t&c-1];a[p]=h[t],u[p]=n,p=p+1&c-1,l[t]=n}return p},pe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},de=t=>{var e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{var n=t.decodeAudioData(e.buffer,()=>{});return void 0!==n&&(n.catch(()=>{}),!0)}catch{}return!1},u=(t,e,n)=>{e=e[n];void 0!==e&&e!==t[n]&&(t[n]=e)},C=(t,e)=>{u(t,e,"channelCount"),u(t,e,"channelCountMode"),u(t,e,"channelInterpretation")},fe=t=>"function"==typeof t.getFloatTimeDomainData,i=(t,e,n)=>{e=e[n];void 0!==e&&e!==t[n].value&&(t[n].value=e)},me=i=>{var s;i.start=(s=i.start,(t=0,e=0,n)=>{if("number"==typeof n&&n<0||e<0||t<0)throw new RangeError("The parameters can't be negative.");s.call(i,t,e,n)})},ge=e=>{var n;e.stop=(n=e.stop,(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");n.call(e,t)})},_e=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),ye=(t,e)=>{t=t.createBiquadFilter();return C(t,e),i(t,e,"Q"),i(t,e,"detune"),i(t,e,"frequency"),i(t,e,"gain"),u(t,e,"type"),t},ve=(t,n)=>{t=t.createChannelSplitter(n.numberOfOutputs);C(t,n);{let e=(n=t).numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw a()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw a()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw a()}})}return t},be=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),Se=(t,e)=>{t=t.createDelay(e.maxDelayTime);return C(t,e),i(t,e,"delayTime"),t},we=(t,e)=>{t=t.createGain();return C(t,e),i(t,e,"gain"),t};function xe(e,n){let i=[0,0];for(let t=e.length-1;0<=t;--t)(i=[(s=i)[0]*n[0]-s[1]*n[1],s[0]*n[1]+s[1]*n[0]])[0]+=e[t];var s;return i}let Te=(t,e,n,i)=>t.createScriptProcessor(e,n,i),Ae=()=>new DOMException("","NotSupportedError"),ke={numberOfChannels:1},Oe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Pe={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Me={disableNormalization:!1},Ce={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Ne=()=>new DOMException("","UnknownError"),Ie={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Ee=t=>{var e;return null!==t&&((e=t.length)%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0)},qe=(t,e,n,i)=>{let s=Object.getPrototypeOf(t);for(;!s.hasOwnProperty(e);)s=Object.getPrototypeOf(s);var{get:r,set:o}=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(t,e,{get:n(r),set:i(o)})},De=t=>{var e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},Re=t=>{var e=t.createBuffer(1,1,44100),t=t.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},ze=t=>{var e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},Fe=()=>{try{new DOMException}catch{return!1}return!0},je=()=>new Promise(e=>{var t=new ArrayBuffer(0),{port1:n,port2:i}=new MessageChannel;n.onmessage=({data:t})=>e(null!==t),i.postMessage(t,[t])}),Ve=(i,t)=>{let s=t.createGain(),e=(i.connect(s),n=i.disconnect,()=>{n.call(i,s),i.removeEventListener("ended",e)});var n;i.addEventListener("ended",e),be(i,s),i.stop=(e=>{let n=!1;return(t=0)=>{if(n)try{e.call(i,t)}catch{s.gain.setValueAtTime(0,t)}else e.call(i,t),n=!0}})(i.stop)},Le=(n,i)=>t=>{var e={value:n};return Object.defineProperties(t,{currentTarget:e,target:e}),("function"==typeof i?i:i.handleEvent).call(n,t)},Be=(V=new Map,L=new WeakMap,(e,n)=>{let t=L.get(e);if(void 0!==t)return t;var i=V.get(e);if(void 0!==i)return i;try{let t=n();return t instanceof Promise?(V.set(e,t),t.catch(()=>!1).then(t=>(V.delete(e),L.set(e,t),t))):(L.set(e,t),t)}catch{return L.set(e,!1),!1}}),Ue="undefined"==typeof window?null:window,Ge=(B=Be,U=ut,(t,e)=>{let n=t.createAnalyser();if(C(n,e),e.maxDecibels>e.minDecibels)return u(n,e,"fftSize"),u(n,e,"maxDecibels"),u(n,e,"minDecibels"),u(n,e,"smoothingTimeConstant"),B(fe,()=>fe(n))||((s=n).getFloatTimeDomainData=e=>{var n=new Uint8Array(e.length),i=(s.getByteTimeDomainData(n),Math.max(n.length,s.fftSize));for(let t=0;t<i;t+=1)e[t]=.0078125*(n[t]-128);return e}),n;throw U();var s});Qe=g;var Qe,He,We,$e,Ye,Xe,Ze,Je,Ke,t=t=>{t=Qe(t);if(null===t.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},e=(He=g,We=t,$e=Nt,async(r,o,a,t)=>{let e=He(r),u=[...t,r];await Promise.all(e.activeInputs.map((t,s)=>Array.from(t).filter(([t])=>!u.includes(t)).map(async([t,e])=>{var n=await We(t).render(t,o,u),i=r.context.destination;$e(t)||r===i&&$e(r)||n.connect(a,e,s)})).reduce((t,e)=>[...t,...e],[]))}),tn=(Ye=Ge,Xe=_,Ze=e,Je=X,t=>{t=Je.get(t);if(void 0===t)throw a();return t});let f=null===(rn=Ue)?null:rn.hasOwnProperty("OfflineAudioContext")?rn.OfflineAudioContext:rn.hasOwnProperty("webkitOfflineAudioContext")?rn.webkitOfflineAudioContext:null,en=(Ke=f,t=>null!==Ke&&t instanceof Ke);var nn,sn,rn=new WeakMap,on=(nn=Le,class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,n,i){if(null!==n){let t=this._listeners.get(n);void 0===t&&(t=nn(this,n),"function"==typeof n)&&this._listeners.set(n,t),this._nativeEventTarget.addEventListener(e,t,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){e=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===e?null:e,n)}});let an=null===(Ni=Ue)?null:Ni.hasOwnProperty("AudioContext")?Ni.AudioContext:Ni.hasOwnProperty("webkitAudioContext")?Ni.webkitAudioContext:null,un=(sn=an,t=>null!==sn&&t instanceof sn);jn=Ue;var cn,hn,ln,pn,dn,fn,mn,gn,_n,yn,vn,bn,Sn,wn,xn,Tn,An,kn,On,Pn,Mn,Cn,Nn,In,En,qn,Dn,Rn,zn,Fn,jn,Vn,Ln,Bn,Un,Gn,Qn,Hn,Wn,$n,Yn,Xn,Zn,Jn,Kn,ti,ei,ni,ii,si,ri,oi,ai,ui,ci,hi,li,pi,di,fi,mi,gi,_i,yi,vi,bi,Si,wi,xi,Ti,Ai,ki,Oi,Pi,Mi,Ci,Ni=t=>null!==jn&&"function"==typeof jn.AudioNode&&t instanceof jn.AudioNode,Ii=(Fn=Ue,t=>null!==Fn&&"function"==typeof Fn.AudioParam&&t instanceof Fn.AudioParam),n=(Vn=H,cn=Be,In=J,En=Pt,qn=g,Dn=_,Rn=Mt,zn=dt,hn=i=>(e,t)=>{var n=In.get(e);if(void 0===n){if(!i&&zn(e)){let n=Dn(e),t=qn(e).outputs;for(let e of t)if(Tt(e)){let t=Dn(e[0]);En(n,t,e[1],e[2])}else{let t=Rn(e[0]);n.disconnect(t,e[1])}}In.set(e,t)}else In.set(e,n+t)},ln=ut,pn=ce,dn=Ae,Tn=kt,An=J,kn=g,On=_,Pn=Mt,Mn=tn,Cn=dt,Nn=en,fn=(e,t)=>{var n=An.get(e);if(void 0===n)throw new Error("Missing the expected cycle count.");var i=Mn(e.context),i=Nn(i);if(n===t){if(An.delete(e),!i&&Cn(e)){let n=On(e),t=kn(e).outputs;for(let e of t)if(Tt(e)){let t=On(e[0]);Tn(n,t,e[1],e[2])}else{let t=Pn(e[0]);n.connect(t,e[1])}}}else An.set(e,n-t)},Sn=rn,wn=g,xn=ft,mn=function e(n,t){let i=xt(t)?t:xn(Sn,t);return"delayTime"in i?[]:n[0]===i?[n]:n.includes(i)?[]:(t=wn(i).outputs,Array.from(t).map(t=>e([...n,i],t[0])).reduce((t,e)=>t.concat(e),[]))},n=on,_n=un,yn=Ni,vn=Ii,class extends n{constructor(t,e,n,i){super(n),this._context=t,this._nativeAudioNode=n;let s=gn(t);if(_n(s)&&!0!==cn(Dt,()=>Dt(s))){var o=n,a,u;let r=new Map;o.connect=(a=o.connect.bind(o),(t,e=0,n=0)=>{var i=zt(t)?a(t,e,n):a(t,e),s=r.get(t);return void 0===s?r.set(t,[{input:n,output:e}]):s.every(t=>t.input!==n||t.output!==e)&&s.push({input:n,output:e}),i}),o.disconnect=(u=o.disconnect,(i,n,s)=>{if(u.apply(o),void 0===i)r.clear();else if("number"==typeof i)for(let[e,n]of r){let t=n.filter(t=>t.output!==i);0===t.length?r.delete(e):r.set(e,t)}else if(r.has(i))if(void 0===n)r.delete(i);else{let e=r.get(i);if(void 0!==e){let t=e.filter(t=>t.output!==n&&(t.input!==s||void 0===s));0===t.length?r.delete(i):r.set(i,t)}}for(let[e,t]of r)t.forEach(t=>{zt(e)?o.connect(e,t.output,t.input):o.connect(e,t.output)})})}W.set(this,n),Z.set(this,new Set),"closed"!==t.state&&e&&gt(this),((t,e,n)=>{const i=[];for(let t=0;t<n.numberOfInputs;t+=1)i.push(new Set);Vn.set(t,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:e})})(this,i,n)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(i,s=0,r=0){if(s<0||s>=this._nativeAudioNode.numberOfOutputs)throw ln();var o=gn(this._context),o=bn(o);if(yn(i)||vn(i))throw pn();if(xt(i)){let n=_(i);try{let t=kt(this._nativeAudioNode,n,s,r),e=It(this);(o||e)&&this._nativeAudioNode.disconnect(...t),"closed"!==this.context.state&&!e&&It(i)&&gt(i)}catch(i){if(12===i.code)throw pn();throw i}if(Gt(this,i,s,r,o)){let t=mn([this],i);Rt(t,hn(o))}return i}r=Mt(i);if("playbackRate"===r.name)throw dn();try{this._nativeAudioNode.connect(r,s),(o||It(this))&&this._nativeAudioNode.disconnect(r,s)}catch(i){if(12===i.code)throw pn();throw i}if(Qt(this,i,s,o)){let t=mn([this],i);Rt(t,hn(o))}}disconnect(t,e,n){let i;var s=gn(this._context),s=bn(s);if(void 0===t)i=((t,e)=>{var n,i=g(t),s=[];for(n of i.outputs)(Tt(n)?Wt:$t)(t,e,...n),s.push(n[0]);return i.outputs.clear(),s})(this,s);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw ln();i=((t,e,n)=>{var i,s=g(t),r=[];for(i of s.outputs)i[1]===n&&((Tt(i)?Wt:$t)(t,e,...i),r.push(i[0]),s.outputs.delete(i));return r})(this,s,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw ln();if(xt(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw ln();if(0===(i=((e,n,i,s,r)=>{let o=g(e);return Array.from(o.outputs).filter(t=>!(t[0]!==i||void 0!==s&&t[1]!==s||void 0!==r&&t[2]!==r)).map(t=>((Tt(t)?Wt:$t)(e,n,...t),o.outputs.delete(t),t[0]))})(this,s,t,e,n)).length)throw pn()}for(let e of i){let t=mn([this],e);Rt(t,fn)}}}),Ei=(Ei=n,Ln=()=>{let s=new WeakMap;return{render(t,e,n){var i=s.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=Xe(t);if(!v(i,e)){let t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,fftSize:i.fftSize,maxDecibels:i.maxDecibels,minDecibels:i.minDecibels,smoothingTimeConstant:i.smoothingTimeConstant};i=Ye(e,t)}return s.set(e,i),await Ze(t,e,i,n),i})(t,e,n)}}},Bn=ut,Un=Ge,Gn=gn=tn,Qn=bn=en,class extends Ei{constructor(t,e){var n=Gn(t),e={...ot,...e},e=Un(n,e);super(t,!1,e,Qn(n)?Ln():null),this._nativeAnalyserNode=e}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){var e=this._nativeAnalyserNode.maxDecibels;if(!((this._nativeAnalyserNode.maxDecibels=t)>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,Bn()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){var e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,Bn()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}}),qi=new WeakSet,Di=null!==(Di=Ue)&&Di.hasOwnProperty("AudioBuffer")?Di.AudioBuffer:null,Ri=(Hn=new Uint32Array(1),t=>(Hn[0]=t,Hn[0])),zi=(Yn=ut,a=>{a.copyFromChannel=(e,t,n=0)=>{var i=$n(n),n=$n(t);if(n>=a.numberOfChannels)throw Yn();var s=a.length,r=a.getChannelData(n),o=e.length;for(let t=i<0?-i:0;t+i<s&&t<o;t+=1)e[t]=r[t+i]},a.copyToChannel=(e,t,n=0)=>{var i=$n(n),n=$n(t);if(n>=a.numberOfChannels)throw Yn();var s=a.length,r=a.getChannelData(n),o=e.length;for(let t=i<0?-i:0;t+i<s&&t<o;t+=1)r[t+i]=e[t]}}),Ri=(Wn=$n=Ri,i=>{var s,r;i.copyFromChannel=(r=i.copyFromChannel,(t,e,n=0)=>{n=Wn(n),e=Wn(e);if(n<i.length)return r.call(i,t,e,n)}),i.copyToChannel=(s=i.copyToChannel,(t,e,n=0)=>{n=Wn(n),e=Wn(e);if(n<i.length)return s.call(i,t,e,n)})}),Di=((s,r,o,a,u,c,h,l)=>{let p=null;return class e{constructor(t){if(null===u)throw new Error("Missing the native OfflineAudioContext constructor.");var{length:t,numberOfChannels:e,sampleRate:n}={...ht,...t};null===p&&(p=new u(1,1,44100));let i=null!==a&&r(c,c)?new a({length:t,numberOfChannels:e,sampleRate:n}):p.createBuffer(e,t,n);if(0===i.numberOfChannels)throw o();return"function"!=typeof i.copyFromChannel?(h(i),ct(i)):r(at,()=>at(i))||l(i),s.add(i),i}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===e.prototype||s.has(t)}}})(qi,Be,Ae,Di,f,(Xn=Di,()=>{if(null===Xn)return!1;try{new Xn({length:1,sampleRate:44100})}catch{return!1}return!0}),zi,Ri),Fi=(Zn=we,(t,e)=>{let n=Zn(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),i=(e.connect(n).connect(t.destination),()=>{e.removeEventListener("ended",i),e.disconnect(n),n.disconnect()});e.addEventListener("ended",i)}),ji=(ui=t,ci=bt,hi=Nt,async(t,i,s,r)=>{t=ci(t);await Promise.all(Array.from(t.activeInputs).map(async([t,e])=>{var n=await ui(t).render(t,i,r);hi(t)||n.connect(s,e)}))}),Vi=(ai=ji,(t,e,n,i)=>ai(e,t,n,i)),Li=(Jn=Fi,Kn=Be,ti=t=>{t=t.createBufferSource();t.start();try{t.start()}catch{return!0}return!1},ei=t=>{var e=t.createBufferSource(),t=t.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},ni=t=>{t=t.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0},ii=De,si=Re,ri=ze,li=qe,oi=Ve,(t,e)=>{var s,r,o,n=t.createBufferSource();return C(n,e),i(n,e,"playbackRate"),u(n,e,"buffer"),u(n,e,"loop"),u(n,e,"loopEnd"),u(n,e,"loopStart"),Kn(ti,()=>ti(t))||((o=n).start=(i=>{let s=!1;return(t=0,e=0,n)=>{if(s)throw a();i.call(o,t,e,n),s=!0}})(o.start)),Kn(ei,()=>ei(t))||((s=n).start=(r=s.start,(t=0,e=0,n)=>{var i=s.buffer,e=null===i?e:Math.min(i.duration,e);null!==i&&e>i.duration-.5/s.context.sampleRate?r.call(s,t,0,0):r.call(s,t,e,n)})),Kn(ni,()=>ni(t))||((n,t)=>{const i=t.createBuffer(1,1,t.sampleRate);null===n.buffer&&(n.buffer=i),li(n,"buffer",e=>()=>{const t=e.call(n);return t===i?null:t},e=>t=>e.call(n,null===t?i:t))})(n,t),Kn(ii,()=>ii(t))||me(n),Kn(si,()=>si(t))||oi(n,t),Kn(ri,()=>ri(t))||ge(n),Jn(t,n),n}),ji=(Mi=bt,Oi=t=>{t=Mi(t);if(null===t.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},Pi=ji,(t,e,n,i)=>(Oi(e).replay(n),Pi(e,t,n,i))),Bi=(wi=Vi,xi=Li,Ti=_,Ai=ji,ki=e,()=>{let r=new WeakMap,o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(t,e,n){var i=r.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=Ti(t);var s=v(i,e);if(!s){let t={buffer:i.buffer,channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,loop:i.loop,loopEnd:i.loopEnd,loopStart:i.loopStart,playbackRate:i.playbackRate.value};i=xi(e,t),null!==o&&i.start(...o),null!==a&&i.stop(a)}return r.set(e,i),s?await wi(e,t.playbackRate,i.playbackRate,n):await Ai(e,t.playbackRate,i.playbackRate,n),await ki(t,e,i,n),i})(t,e,n)}}}),rn=(Ci=$,pi=rn,di=Y,fi=G.createCancelAndHoldAutomationEvent,mi=G.createCancelScheduledValuesAutomationEvent,gi=G.createExponentialRampToValueAutomationEvent,_i=G.createLinearRampToValueAutomationEvent,yi=G.createSetTargetAutomationEvent,vi=G.createSetValueAutomationEvent,bi=G.createSetValueCurveAutomationEvent,Si=an,(d,t,f,e=null,n=null)=>{let m=new G.AutomationEventList(f.defaultValue),g=t?(r=m,{replay(i){for(var s of r)if("exponentialRampToValue"===s.type){let{endTime:t,value:e}=s;i.exponentialRampToValueAtTime(e,t)}else if("linearRampToValue"===s.type){let{endTime:t,value:e}=s;i.linearRampToValueAtTime(e,t)}else if("setTarget"===s.type){let{startTime:t,target:e,timeConstant:n}=s;i.setTargetAtTime(e,t,n)}else if("setValue"===s.type){let{startTime:t,value:e}=s;i.setValueAtTime(e,t)}else{if("setValueCurve"!==s.type)throw new Error("Can't apply an unknown automation.");{let{duration:t,startTime:e,values:n}=s;i.setValueCurveAtTime(n,e,t)}}}}):null,_={get defaultValue(){return f.defaultValue},get maxValue(){return null===e?f.maxValue:e},get minValue(){return null===n?f.minValue:n},get value(){return f.value},set value(t){f.value=t,_.setValueAtTime(t,d.context.currentTime)},cancelAndHoldAtTime(t){var e,n;return"function"==typeof f.cancelAndHoldAtTime?(null===g&&m.flush(d.context.currentTime),m.add(fi(t)),f.cancelAndHoldAtTime(t)):(e=Array.from(m).pop(),null===g&&m.flush(d.context.currentTime),m.add(fi(t)),n=Array.from(m).pop(),f.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?f.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?f.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?f.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&f.setValueCurveAtTime(n.values,n.startTime,n.duration))),_},cancelScheduledValues:t=>(null===g&&m.flush(d.context.currentTime),m.add(mi(t)),f.cancelScheduledValues(t),_),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===g&&m.flush(d.context.currentTime),m.add(gi(t,e)),f.exponentialRampToValueAtTime(t,e),_},linearRampToValueAtTime:(t,e)=>(null===g&&m.flush(d.context.currentTime),m.add(_i(t,e)),f.linearRampToValueAtTime(t,e),_),setTargetAtTime:(t,e,n)=>(null===g&&m.flush(d.context.currentTime),m.add(yi(t,e,n)),f.setTargetAtTime(t,e,n),_),setValueAtTime:(t,e)=>(null===g&&m.flush(d.context.currentTime),m.add(vi(t,e)),f.setValueAtTime(t,e),_),setValueCurveAtTime(t,o,a){var u=t instanceof Float32Array?t:new Float32Array(t);if(null!==Si&&"webkitAudioContext"===Si.name){let t=o+a,e=d.context.sampleRate,n=Math.ceil(o*e),i=Math.floor(t*e),s=i-n,r=new Float32Array(s);for(let t=0;t<s;t+=1){var c=(u.length-1)/a*((n+t)/e-o),h=Math.floor(c),l=Math.ceil(c);r[t]=h===l?u[h]:(1-(c-h))*u[h]+(1-(l-c))*u[l]}null===g&&m.flush(d.context.currentTime),m.add(bi(r,o,a)),f.setValueCurveAtTime(r,o,a);var p=i/e;p<t&&_.setValueAtTime(r[r.length-1],p),_.setValueAtTime(u[u.length-1],t)}else null===g&&m.flush(d.context.currentTime),m.add(bi(u,o,a)),f.setValueCurveAtTime(u,o,a);return _}};var r,i;return di.set(_,f),pi.set(_,d),t=_,i=g,Ci.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:i}),_}),Bi=(s=n,ns=Bi,ss=a,rs=Li,us=Le,class extends s{constructor(t,e){var n=os(t),e={...yt,...e},i=rs(n,e),n=as(n),s=n?ns():null;super(t,!1,i,s),this._audioBufferSourceNodeRenderer=s,this._isBufferNullified=!1,this._isBufferSet=null!==e.buffer,this._nativeAudioBufferSourceNode=i,this._onended=null,this._playbackRate=is(this,n,i.playbackRate,pt,lt)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(null!==(this._nativeAudioBufferSourceNode.buffer=t)){if(this._isBufferSet)throw ss();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){var e="function"==typeof t?us(this,t):null,n=(this._nativeAudioBufferSourceNode.onended=e,this._nativeAudioBufferSourceNode.onended);this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){gt(this);let t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),setTimeout(()=>{dt(this)&&_t(this)},1e3)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}}),s=(s=n,$i=ut,Yi=a,ts=we,es=qe,Xi=(t,e,n)=>{let i=t.destination;if(i.channelCount!==e)try{i.channelCount=e}catch{}n&&"explicit"!==i.channelCountMode&&(i.channelCountMode="explicit"),0===i.maxChannelCount&&Object.defineProperty(i,"maxChannelCount",{value:e});let s=ts(t,{channelCount:e,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return es(s,"channelCount",t=>()=>t.call(s),t=>e=>{t.call(s,e);try{i.channelCount=e}catch(t){if(e>i.maxChannelCount)throw t}}),es(s,"channelCountMode",t=>()=>t.call(s),e=>t=>{e.call(s,t),i.channelCountMode=t}),es(s,"channelInterpretation",t=>()=>t.call(s),e=>t=>{e.call(s,t),i.channelInterpretation=t}),Object.defineProperty(s,"maxChannelCount",{get:()=>i.maxChannelCount}),s.connect(i),s},class extends s{constructor(t,e){var n=Zi(t),i=Ji(n),n=Xi(n,e,i);super(t,!1,n,i?(s=>{let i=null;return{render:(t,e,n)=>(null===i&&(i=(async(t,e,n)=>{const i=e.destination;return await s(t,e,i,n),i})(t,e,n)),i)}})(Ki):null),this._isNodeOfNativeOfflineAudioContext=i,this._nativeAudioDestinationNode=n}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw Yi();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw $i();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw Yi();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}});Ui=Vi,Qi=_,Hi=ji,Wi=Ki=e;vs=n,cs=is=rn,hs=()=>{let r=new WeakMap;return{render(t,e,n){var i=r.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=Qi(t);var s=v(i,e);if(!s){let t={Q:i.Q.value,channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,detune:i.detune.value,frequency:i.frequency.value,gain:i.gain.value,type:i.type};i=Gi(e,t)}return r.set(e,i),s?(await Ui(e,t.Q,i.Q,n),await Ui(e,t.detune,i.detune,n),await Ui(e,t.frequency,i.frequency,n),await Ui(e,t.gain,i.gain,n)):(await Hi(e,t.Q,i.Q,n),await Hi(e,t.detune,i.detune,n),await Hi(e,t.frequency,i.frequency,n),await Hi(e,t.gain,i.gain,n)),await Wi(t,e,i,n),i})(t,e,n)}}},ls=ce,ps=Gi=ye,ds=Zi=os=tn,fs=Ji=as=en;var Ui,Gi,Qi,Hi,Wi,$i,Yi,Xi,Zi,Ji,Ki,ts,es,ns,is,ss,rs,os,as,us,cs,hs,ls,ps,ds,fs,ms,gs,_s,ys,vs=class extends vs{constructor(t,e){var n=ds(t),e={...te,...e},e=ps(n,e),n=fs(n);super(t,!1,e,n?hs():null),this._Q=cs(this,n,e.Q,pt,lt),this._detune=cs(this,n,e.detune,1200*Math.log2(pt),-1200*Math.log2(pt)),this._frequency=cs(this,n,e.frequency,t.sampleRate/2,0),this._gain=cs(this,n,e.gain,40*Math.log10(pt),lt),this._nativeBiquadFilterNode=e}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){if(this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n),t.length!==e.length||e.length!==n.length)throw ls()}},bs=(ms=Ct,gs=Ni,(r,s,o)=>{let a=new Set;var u,c;return r.connect=(u=r.connect,(e,n=0,i=0)=>{var t=0===a.size;if(gs(e))return u.call(r,e,n,i),ms(a,[e,n,i],t=>t[0]===e&&t[1]===n&&t[2]===i,!0),t&&s(),e;u.call(r,e,n),ms(a,[e,n],t=>t[0]===e&&t[1]===n,!0),t&&s()}),r.disconnect=(c=r.disconnect,(e,n,i)=>{var t=0<a.size;if(void 0===e)c.apply(r),a.clear();else if("number"==typeof e){c.call(r,e);for(let t of a)t[1]===e&&a.delete(t)}else{gs(e)?c.call(r,e,n,i):c.call(r,e,n);for(let t of a)t[0]!==e||void 0!==n&&t[1]!==n||void 0!==i&&t[2]!==i||a.delete(t)}var s=0===a.size;t&&s&&o()}),r}),Ss=(_s=a,xr=an,Tr=(t,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw _s()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw _s()}});let i=t.createBufferSource();ys(n,()=>{var e=n.numberOfInputs;for(let t=0;t<e;t+=1)i.connect(n,0,t)},()=>i.disconnect(n))},(t,e)=>{var n=t.createChannelMerger(e.numberOfInputs);return null!==xr&&"webkitAudioContext"===xr.name&&Tr(t,n),C(n,e),n}),ws=(ws=n,Sr=_,gr=()=>{let s=new WeakMap;return{render(t,e,n){var i=s.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=Sr(t);if(!v(i,e)){let t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,numberOfInputs:i.numberOfInputs};i=br(e,t)}return s.set(e,i),await wr(t,e,i,n),i})(t,e,n)}}},class extends ws{constructor(t,e){var n=yr(t),e={...ee,...e};super(t,!1,_r(n,e),vr(n)?gr():null)}}),xs=(xs=n,fr=_,cr=()=>{let s=new WeakMap;return{render(t,e,n){var i=s.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=fr(t);if(!v(i,e)){let t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,numberOfOutputs:i.numberOfOutputs};i=dr(e,t)}return s.set(e,i),await mr(t,e,i,n),i})(t,e,n)}}},hr=dr=ve,class extends xs{constructor(t,e){var n=lr(t),e={...e={...ne,...e},channelCount:e.numberOfOutputs};super(t,!1,hr(n,e),pr(n)?cr():null)}});ur=ys=bs;tr=rr=Fi,er=Be,nr=(t,{offset:e,...n})=>{let i=t.createBuffer(1,2,t.sampleRate),s=or(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=ar(t,{...n,gain:e}),o=i.getChannelData(0);o[0]=1,o[1]=1,s.buffer=i,s.loop=!0;n={get bufferSize(){},get channelCount(){return r.channelCount},set channelCount(t){r.channelCount=t},get channelCountMode(){return r.channelCountMode},set channelCountMode(t){r.channelCountMode=t},get channelInterpretation(){return r.channelInterpretation},set channelInterpretation(t){r.channelInterpretation=t},get context(){return r.context},get inputs(){return[]},get numberOfInputs(){return s.numberOfInputs},get numberOfOutputs(){return r.numberOfOutputs},get offset(){return r.gain},get onended(){return s.onended},set onended(t){s.onended=t},addEventListener:(...t)=>s.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>s.dispatchEvent(t[0]),removeEventListener:(...t)=>s.removeEventListener(t[0],t[1],t[2]),start(t=0){s.start.call(s,t)},stop(t=0){s.stop.call(s,t)}};return rr(t,s),ur(be(n,r),()=>s.connect(r),()=>s.disconnect(r))},ir=De,sr=ze;var Ts,As,ks,Os,Ps,Ms,Cs,Ns,Is,Es,qs,Ds,Rs,zs,Fs,js,Vs,Ls,Bs,Us,Gs,Qs,Hs,Ws,$s,Ys,Xs,Zs,Js,Ks,tr,er,nr,ir,sr,rr,or,ar,ur,xs,cr,hr,lr,pr,dr,fr,mr,gr,_r,yr,vr,br,Sr,wr,xr,Tr,Ar,kr,Or,Pr,Mr,Cr,Nr,Ir,Er,qr,Dr,Rr,zr,Fr,jr,Vr,Lr,Br,Ur,Gr,Qr,Hr,Wr,$r,Yr,Xr,Zr,Jr,Kr,to,eo,no,io,so,ro,oo,ao,uo,co,ho,lo,po,fo,mo,go,_o,yo,vo,bo,So,wo,xo,To,Ao,ko,Oo,Po,Mo,Co,No,Io,Eo,qo,Do,Ro,zo,Fo,jo,Vo,Lo=(t,e)=>{var n;return void 0===t.createConstantSource?nr(t,e):(n=t.createConstantSource(),C(n,e),i(n,e,"offset"),er(ir,()=>ir(t))||me(n),er(sr,()=>sr(t))||ge(n),tr(t,n),n)},Bo=(Bo=n,Zs=_,Gs=()=>{let r=new WeakMap,o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(t,e,n){var i=r.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=Zs(t);var s=v(i,e);if(!s){let t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,offset:i.offset.value};i=Xs(e,t),null!==o&&i.start(o),null!==a&&i.stop(a)}return r.set(e,i),s?await Ys(e,t.offset,i.offset,n):await Js(e,t.offset,i.offset,n),await Ks(t,e,i,n),i})(t,e,n)}}},$s=Le,class extends Bo{constructor(t,e){var n=Hs(t),e={...ie,...e},e=Qs(n,e),n=Ws(n),i=n?Gs():null;super(t,!1,e,i),this._constantSourceNodeRenderer=i,this._nativeConstantSourceNode=e,this._offset=Us(this,n,e.offset,pt,lt),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){var e="function"==typeof t?$s(this,t):null,n=(this._nativeConstantSourceNode.onended=e,this._nativeConstantSourceNode.onended);this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){gt(this);let t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),setTimeout(()=>{dt(this)&&_t(this)},1e3)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}}),Uo=(Bs=qe,(t,e)=>{let n=t.createConvolver();if(C(n,e),e.disableNormalization===n.normalize&&(n.normalize=!e.disableNormalization),u(n,e,"buffer"),2<e.channelCount)throw Ls();if(Bs(n,"channelCount",t=>()=>t.call(n),e=>t=>{if(2<t)throw Ls();return e.call(n,t)}),"max"===e.channelCountMode)throw Ls();return Bs(n,"channelCountMode",t=>()=>t.call(n),e=>t=>{if("max"===t)throw Ls();return e.call(n,t)}),n}),Uo=(Go=n,js=_,qs=()=>{let s=new WeakMap;return{render(t,e,n){var i=s.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=js(t);if(!v(i,e)){let t={buffer:i.buffer,channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,disableNormalization:!i.normalize};i=Fs(e,t)}return s.set(e,i),At(i)?await Vs(t,e,i.inputs[0],n):await Vs(t,e,i,n),i})(t,e,n)}}},Ds=Fs=Uo,class extends Go{constructor(t,e){var n=Rs(t),e={...se,...e},e=Ds(n,e);super(t,!1,e,zs(n)?qs():null),this._isBufferNullified=!1,this._nativeConvolverNode=e}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(null===(this._nativeConvolverNode.buffer=t)&&null!==this._nativeConvolverNode.buffer){let t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,t.sampleRate),this._isBufferNullified=!0}else this._isBufferNullified=!1}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}}),Go=(Go=n,Ns=_,As=r=>{let o=new WeakMap;return{render(t,e,n){var i=o.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=Ns(t);var s=v(i,e);if(!s){let t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,delayTime:i.delayTime.value,maxDelayTime:r};i=Cs(e,t)}return o.set(e,i),s?await Ms(e,t.delayTime,i.delayTime,n):await Is(e,t.delayTime,i.delayTime,n),await Es(t,e,i,n),i})(t,e,n)}}},ks=Cs=Se,class extends Go{constructor(t,e){var n=Os(t),e={...re,...e},i=ks(n,e),n=Ps(n);super(t,!1,i,n?As(e.maxDelayTime):null),this._delayTime=Ts(this,n,i.delayTime)}get delayTime(){return this._delayTime}}),Qo=(t,e)=>{t=t.createDynamicsCompressor();if(C(t,e),2<e.channelCount)throw Ar();if("max"===e.channelCountMode)throw Ar();return i(t,e,"attack"),i(t,e,"knee"),i(t,e,"ratio"),i(t,e,"release"),i(t,e,"threshold"),t},Qo=(Ho=n,ro=_,Jr=()=>{let r=new WeakMap;return{render(t,e,n){var i=r.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=ro(t);var s=v(i,e);if(!s){let t={attack:i.attack.value,channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,knee:i.knee.value,ratio:i.ratio.value,release:i.release.value,threshold:i.threshold.value};i=so(e,t)}return r.set(e,i),s?(await io(e,t.attack,i.attack,n),await io(e,t.knee,i.knee,n),await io(e,t.ratio,i.ratio,n),await io(e,t.release,i.release,n),await io(e,t.threshold,i.threshold,n)):(await oo(e,t.attack,i.attack,n),await oo(e,t.knee,i.knee,n),await oo(e,t.ratio,i.ratio,n),await oo(e,t.release,i.release,n),await oo(e,t.threshold,i.threshold,n)),await ao(t,e,i,n),i})(t,e,n)}}},Kr=so=Qo,class extends Ho{constructor(t,e){var n=eo(t),e={...ae,...e},e=Kr(n,e),n=no(n);super(t,!1,e,n?Jr():null),this._attack=Zr(this,n,e.attack),this._knee=Zr(this,n,e.knee),this._nativeDynamicsCompressorNode=e,this._ratio=Zr(this,n,e.ratio),this._release=Zr(this,n,e.release),this._threshold=Zr(this,n,e.threshold)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){var e=this._nativeDynamicsCompressorNode.channelCount;if(2<(this._nativeDynamicsCompressorNode.channelCount=t))throw this._nativeDynamicsCompressorNode.channelCount=e,to()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){var e=this._nativeDynamicsCompressorNode.channelCountMode;if("max"===(this._nativeDynamicsCompressorNode.channelCountMode=t))throw this._nativeDynamicsCompressorNode.channelCountMode=e,to()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}}),Ho=(Ho=n,Hr=io=Ms=Ys=Vi,$r=_,Yr=oo=Is=Js=ji,Br=()=>{let r=new WeakMap;return{render(t,e,n){var i=r.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=$r(t);var s=v(i,e);if(!s){let t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:i.gain.value};i=Wr(e,t)}return r.set(e,i),s?await Hr(e,t.gain,i.gain,n):await Yr(e,t.gain,i.gain,n),await Xr(t,e,i,n),i})(t,e,n)}}},class extends Ho{constructor(t,e){var n=Gr(t),e={...ue,...e},e=Ur(n,e),n=Qr(n);super(t,!1,e,n?Br():null),this._gain=Lr(this,n,e.gain,pt,lt)}get gain(){return this._gain}}),Wo=(zr=ce,Fr=a,Vr=to=Ar=Ls=Ae,(t,e,{channelCount:n,channelCountMode:i,channelInterpretation:s,feedback:r,feedforward:o})=>{let a=_e(e,t.sampleRate),h=r instanceof Float64Array?r:new Float64Array(r),l=o instanceof Float64Array?o:new Float64Array(o),u=h.length,c=l.length,p=Math.min(u,c);if(0===u||20<u)throw Vr();if(0===h[0])throw Fr();if(0===c||20<c)throw Vr();if(0===l[0])throw Fr();if(1!==h[0]){for(let t=0;t<c;t+=1)l[t]/=h[0];for(let t=1;t<u;t+=1)h[t]/=h[0]}let d=jr(t,a,n,n),f=(d.channelCount=n,d.channelCountMode=i,d.channelInterpretation=s,[]),m=[],g=[];for(let t=0;t<n;t+=1){f.push(0);let t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),m.push(t),g.push(e)}d.onaudioprocess=t=>{let i=t.inputBuffer,s=t.outputBuffer,e=i.numberOfChannels;for(let n=0;n<e;n+=1){let t=i.getChannelData(n),e=s.getChannelData(n);f[n]=le(h,u,l,c,p,m[n],g[n],f[n],32,t,e)}};let _=t.sampleRate/2;return be({get bufferSize(){return a},get channelCount(){return d.channelCount},set channelCount(t){d.channelCount=t},get channelCountMode(){return d.channelCountMode},set channelCountMode(t){d.channelCountMode=t},get channelInterpretation(){return d.channelInterpretation},set channelInterpretation(t){d.channelInterpretation=t},get context(){return d.context},get inputs(){return[d]},get numberOfInputs(){return d.numberOfInputs},get numberOfOutputs(){return d.numberOfOutputs},addEventListener:(...t)=>d.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>d.dispatchEvent(t[0]),getFrequencyResponse(s,r,o){if(s.length!==r.length||r.length!==o.length)throw zr();let t=s.length;for(let i=0;i<t;i+=1){let t=-Math.PI*(s[i]/_),e=[Math.cos(t),Math.sin(t)],n=(a=xe(l,e),u=xe(h,e),c=void 0,c=u[0]*u[0]+u[1]*u[1],[(a[0]*u[0]+a[1]*u[1])/c,(a[1]*u[0]-a[0]*u[1])/c]);r[i]=Math.sqrt(n[0]*n[0]+n[1]*n[1]),o[i]=Math.atan2(n[1],n[0])}var a,u,c},removeEventListener:(...t)=>d.removeEventListener(t[0],t[1],t[2])},d)}),$o=(Nr=Be,Dr=Ir=Ur=Wr=ar=we,Rr=f,qr=()=>{if(null===Rr)return Promise.resolve(!1);let e=new Rr(1,1,44100),n=Dr(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(t=>{e.oncomplete=()=>{n.disconnect(),t(0!==e.currentTime)},e.startRendering()})},i=>Nr(de,()=>de(i))?Promise.resolve(Nr(qr,qr)).then(t=>{if(!t){let t=Er(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()}):new Promise(e=>{let n=Ir(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=t=>{n.disconnect(),e(t.renderedBuffer)},n.connect(i.destination),i.startRendering()})),Yo=(kr=or=Li,Or=_,Pr=f,Mr=Xr=ao=Es=Vs=Ks=mr=wr=e,Cr=$o,(_,y)=>{let s=new WeakMap,i=null,r=async(f,m,g)=>{let e=null,t=Or(f);var n=v(t,m);if(void 0===m.createIIRFilter?e=kr(m,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):n||(t=m.createIIRFilter(y,_)),s.set(m,null===e?t:e),null===e)return await Mr(f,m,t,g),t;{if(null===i){if(null===Pr)throw new Error("Missing the native OfflineAudioContext constructor.");let d=new Pr(f.context.destination.channelCount,f.context.length,m.sampleRate);i=(async()=>{await Mr(f,d,d.destination,g);var i=await Cr(d),t=m,e=_,n=y,s=e instanceof Float64Array?e:new Float64Array(e),r=n instanceof Float64Array?n:new Float64Array(n),o=s.length,a=r.length,u=Math.min(o,a);if(1!==s[0]){for(let t=0;t<o;t+=1)r[t]/=s[0];for(let t=1;t<a;t+=1)s[t]/=s[0]}var c=new Float32Array(32),h=new Float32Array(32),l=t.createBuffer(i.numberOfChannels,i.length,i.sampleRate),p=i.numberOfChannels;for(let n=0;n<p;n+=1){let t=i.getChannelData(n),e=l.getChannelData(n);c.fill(0),h.fill(0),le(s,o,r,a,u,c,h,0,32,t,e)}return l})()}let t=await i;return e.buffer=t,e.start(0),e}};return{render(t,e,n){var i=s.get(e);return void 0!==i?Promise.resolve(i):r(t,e,n)}}}),Wo=(Xo=n,uo=Wo,zo=Yo,Fo=Gr=eo=Os=Rs=Hs=lr=yr=tn,class extends Xo{constructor(t,e){var i,s,n=Fo(t),r=jo(n),e={...he,...e},n=((t,e,n)=>{if(void 0===t.createIIRFilter)return uo(t,e,n);const i=t.createIIRFilter(n.feedforward,n.feedback);return C(i,n),i})(n,r?null:t.baseLatency,e);super(t,!1,n,r?zo(e.feedback,e.feedforward):null),(i=n).getFrequencyResponse=(s=i.getFrequencyResponse,(t,e,n)=>{if(t.length!==e.length||e.length!==n.length)throw ce();return s.call(i,t,e,n)}),this._nativeIIRFilterNode=n}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}}),Yo=(Io=Lr=Zr=Ts=Us=rn,Eo=_r=br=Ss,qo=Qs=Xs=Lo,Do=Er=jr=Te,Ro=jo=Qr=no=Ps=zs=Ws=pr=vr=en,(o,a)=>{let u=a.listener,{forwardX:t,forwardY:e,forwardZ:n,positionX:i,positionY:s,positionZ:r,upX:c,upY:h,upZ:l}=void 0===u.forwardX?(()=>{let i=Eo(a,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),s=Ro(a),t=Do(a,256,9,0),e=(t,e)=>{var n=qo(a,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:e});return n.connect(i,0,t),n.start(),Object.defineProperty(n.offset,"defaultValue",{get:()=>e}),Io({context:o},s,n.offset,pt,lt)},n=[0,0,-1,0,1,0],r=[0,0,0];return t.onaudioprocess=({inputBuffer:t})=>{var e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0],t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]],e=(e.some((t,e)=>t!==n[e])&&(u.setOrientation(...e),n=e),[t.getChannelData(6)[0],t.getChannelData(7)[0],t.getChannelData(8)[0]]);e.some((t,e)=>t!==r[e])&&(u.setPosition(...e),r=e)},i.connect(t),{forwardX:e(0,0),forwardY:e(1,0),forwardZ:e(2,-1),positionX:e(6,0),positionY:e(7,0),positionZ:e(8,0),upX:e(3,0),upY:e(4,1),upZ:e(5,0)}})():u;return{get forwardX(){return t},get forwardY(){return e},get forwardZ(){return n},get positionX(){return i},get positionY(){return s},get positionZ(){return r},get upX(){return c},get upY(){return h},get upZ(){return l}}}),Xo=new WeakMap,Yo=(Oo=s,Po=Yo,s=on,Co=Xo,class extends s{constructor(t,e){super(t),this._nativeContext=t,X.set(this,t),Mo(t)&&Co.set(t,new Set),this._destination=new Oo(this,e),this._listener=Po(this,t),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){var e="function"==typeof t?No(this,t):null,n=(this._nativeContext.onstatechange=e,this._nativeContext.onstatechange);this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}}),on=(So=Fi,wo=Be,xo=De,To=Re,Ao=ze,ko=Ve,(t,e)=>{var n=t.createOscillator();return C(n,e),i(n,e,"detune"),i(n,e,"frequency"),void 0!==e.periodicWave?n.setPeriodicWave(e.periodicWave):u(n,e,"type"),wo(xo,()=>xo(t))||me(n),wo(To,()=>To(t))||ko(n,t),wo(Ao,()=>Ao(t))||ge(n),So(t,n),n}),Fi=(s=n,_o=ho=on,yo=_,lo=()=>{let r=new WeakMap,o=null,a=null,u=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){u=t},render(t,e,n){var i=r.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=yo(t);var s=v(i,e);if(!s){let t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,detune:i.detune.value,frequency:i.frequency.value,periodicWave:null===o?void 0:o,type:i.type};i=_o(e,t),null!==a&&i.start(a),null!==u&&i.stop(u)}return r.set(e,i),s?(await go(e,t.detune,i.detune,n),await go(e,t.frequency,i.frequency,n)):(await vo(e,t.detune,i.detune,n),await vo(e,t.frequency,i.frequency,n)),await bo(t,e,i,n),i})(t,e,n)}}},mo=No=Le,class extends s{constructor(t,e){var n=po(t),e={...Oe,...e},i=ho(n,e),n=fo(n),s=n?lo():null,r=t.sampleRate/2;super(t,!1,i,s),this._detune=co(this,n,i.detune,153600,-153600),this._frequency=co(this,n,i.frequency,r,-r),this._nativeOscillatorNode=i,this._onended=null,this._oscillatorNodeRenderer=s,null!==this._oscillatorNodeRenderer&&void 0!==e.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=e.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){var e="function"==typeof t?mo(this,t):null,n=(this._nativeOscillatorNode.onended=e,this._nativeOscillatorNode.onended);this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){gt(this);let t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),setTimeout(()=>{dt(this)&&_t(this)},1e3)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}}),on=(Vo=Li,(t,e)=>{let n=Vo(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=t.createBuffer(1,2,t.sampleRate);return n.buffer=i,n.loop=!0,n.connect(e),n.start(),()=>{n.stop(),n.disconnect(e)}}),s=(fa=a,(t,{curve:e,oversample:n,...i})=>{let h=t.createWaveShaper(),l=t.createWaveShaper(),s=(C(h,i),C(l,i),ma(t,{...i,gain:1})),r=ma(t,{...i,gain:-1}),o=ma(t,{...i,gain:1}),a=ma(t,{...i,gain:-1}),u=null,p=!1,d=null;i={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(t){s.channelCount=t,r.channelCount=t,h.channelCount=t,o.channelCount=t,l.channelCount=t,a.channelCount=t},get channelCountMode(){return h.channelCountMode},set channelCountMode(t){s.channelCountMode=t,r.channelCountMode=t,h.channelCountMode=t,o.channelCountMode=t,l.channelCountMode=t,a.channelCountMode=t},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(t){s.channelInterpretation=t,r.channelInterpretation=t,h.channelInterpretation=t,o.channelInterpretation=t,l.channelInterpretation=t,a.channelInterpretation=t},get context(){return h.context},get curve(){return d},set curve(c){if(null!==c&&c.length<2)throw fa();if(null===c)h.curve=c,l.curve=c;else{let s=c.length,r=new Float32Array(s+2-s%2),o=new Float32Array(s+2-s%2),a=(r[0]=c[0],o[0]=-c[s-1],Math.ceil((s+1)/2)),u=(s+1)/2-1;for(let i=1;i<a;i+=1){let t=i/a*u,e=Math.floor(t),n=Math.ceil(t);r[i]=e===n?c[e]:(1-(t-e))*c[e]+(1-(n-t))*c[n],o[i]=e===n?-c[s-1-e]:-(1-(t-e))*c[s-1-e]-(1-(n-t))*c[s-1-n]}r[a]=s%2==1?c[a-1]:(c[a-2]+c[a-1])/2,h.curve=r,l.curve=o}d=c,p&&(ga(d)&&null===u?u=da(t,s):null!==u&&(u(),u=null))},get inputs(){return[s]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get oversample(){return h.oversample},set oversample(t){h.oversample=t,l.oversample=t},addEventListener:(...t)=>s.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>s.dispatchEvent(t[0]),removeEventListener:(...t)=>s.removeEventListener(t[0],t[1],t[2])};return null!==e&&(i.curve=e instanceof Float32Array?e:new Float32Array(e)),n!==i.oversample&&(i.oversample=n),_a(be(i,o),()=>{s.connect(h).connect(o),s.connect(r).connect(l).connect(a).connect(o),p=!0,ga(d)&&(u=da(t,s))},()=>{s.disconnect(h),h.disconnect(o),s.disconnect(r),r.disconnect(l),l.disconnect(a),a.disconnect(o),p=!1,null!==u&&(u(),u=null)})}),on=(oa=da=on,aa=a,ua=s,ca=ga=Ee,la=an,pa=qe,(n,t)=>{let i=n.createWaveShaper();if(null!==la&&"webkitAudioContext"===la.name)return ua(n,t);C(i,t);var e=null===t.curve||t.curve instanceof Float32Array?t.curve:new Float32Array(t.curve);if(null!==e&&e.length<2)throw aa();u(i,{curve:e},"curve"),u(i,t,"oversample");let s=null,r=!1;return pa(i,"curve",t=>()=>t.call(i),e=>t=>(e.call(i,t),r&&(ca(t)&&null===s?s=oa(n,i):ca(t)||null===s||(s(),s=null)),t)),ha(i,()=>{r=!0,ca(i.curve)&&(s=oa(n,i))},()=>{r=!1,null!==s&&(s(),s=null)})});Zo=kt,Jo=a,ea=Te,na=on,ia=Ae,sa=Pt,ra=ha=_a=bs;ya=(t,{coneInnerAngle:e,coneOuterAngle:n,coneOuterGain:i,distanceModel:s,maxDistance:r,orientationX:o,orientationY:a,orientationZ:u,panningModel:c,positionX:h,positionY:l,positionZ:p,refDistance:d,rolloffFactor:f,...m})=>{let g=t.createPanner();if(2<m.channelCount)throw ia();if("max"===m.channelCountMode)throw ia();C(g,m);let _={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},y=Ko(t,{..._,channelInterpretation:"speakers",numberOfInputs:6}),v=ta(t,{...m,gain:1}),b=ta(t,{..._,gain:1}),S=ta(t,{..._,gain:0}),w=ta(t,{..._,gain:0}),x=ta(t,{..._,gain:0}),T=ta(t,{..._,gain:0}),A=ta(t,{..._,gain:0}),k=ea(t,256,6,1),O=na(t,{..._,curve:new Float32Array([1,1]),oversample:"none"}),P=[o,a,u],M=[h,l,p];k.onaudioprocess=({inputBuffer:t})=>{var e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0]],e=(e.some((t,e)=>t!==P[e])&&(g.setOrientation(...e),P=e),[t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]]);e.some((t,e)=>t!==M[e])&&(g.setPosition(...e),M=e)},Object.defineProperty(S.gain,"defaultValue",{get:()=>0}),Object.defineProperty(w.gain,"defaultValue",{get:()=>0}),Object.defineProperty(x.gain,"defaultValue",{get:()=>0}),Object.defineProperty(T.gain,"defaultValue",{get:()=>0}),Object.defineProperty(A.gain,"defaultValue",{get:()=>0});m={get bufferSize(){},get channelCount(){return g.channelCount},set channelCount(t){if(2<t)throw ia();v.channelCount=t,g.channelCount=t},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){if("max"===t)throw ia();v.channelCountMode=t,g.channelCountMode=t},get channelInterpretation(){return g.channelInterpretation},set channelInterpretation(t){v.channelInterpretation=t,g.channelInterpretation=t},get coneInnerAngle(){return g.coneInnerAngle},set coneInnerAngle(t){g.coneInnerAngle=t},get coneOuterAngle(){return g.coneOuterAngle},set coneOuterAngle(t){g.coneOuterAngle=t},get coneOuterGain(){return g.coneOuterGain},set coneOuterGain(t){if(t<0||1<t)throw Jo();g.coneOuterGain=t},get context(){return g.context},get distanceModel(){return g.distanceModel},set distanceModel(t){g.distanceModel=t},get inputs(){return[v]},get maxDistance(){return g.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;g.maxDistance=t},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get orientationX(){return b.gain},get orientationY(){return S.gain},get orientationZ(){return w.gain},get panningModel(){return g.panningModel},set panningModel(t){g.panningModel=t},get positionX(){return x.gain},get positionY(){return T.gain},get positionZ(){return A.gain},get refDistance(){return g.refDistance},set refDistance(t){if(t<0)throw new RangeError;g.refDistance=t},get rolloffFactor(){return g.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;g.rolloffFactor=t},addEventListener:(...t)=>v.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>v.dispatchEvent(t[0]),removeEventListener:(...t)=>v.removeEventListener(t[0],t[1],t[2])};return e!==m.coneInnerAngle&&(m.coneInnerAngle=e),n!==m.coneOuterAngle&&(m.coneOuterAngle=n),i!==m.coneOuterGain&&(m.coneOuterGain=i),s!==m.distanceModel&&(m.distanceModel=s),r!==m.maxDistance&&(m.maxDistance=r),o!==m.orientationX.value&&(m.orientationX.value=o),a!==m.orientationY.value&&(m.orientationY.value=a),u!==m.orientationZ.value&&(m.orientationZ.value=u),c!==m.panningModel&&(m.panningModel=c),h!==m.positionX.value&&(m.positionX.value=h),l!==m.positionY.value&&(m.positionY.value=l),p!==m.positionZ.value&&(m.positionZ.value=p),d!==m.refDistance&&(m.refDistance=d),f!==m.rolloffFactor&&(m.rolloffFactor=f),1===P[0]&&0===P[1]&&0===P[2]||g.setOrientation(...P),0===M[0]&&0===M[1]&&0===M[2]||g.setPosition(...M),ra(be(m,g),()=>{v.connect(g),Zo(v,O,0,0),O.connect(b).connect(y,0,0),O.connect(S).connect(y,0,1),O.connect(w).connect(y,0,2),O.connect(x).connect(y,0,3),O.connect(T).connect(y,0,4),O.connect(A).connect(y,0,5),y.connect(k).connect(t.destination)},()=>{v.disconnect(g),sa(v,O,0,0),O.disconnect(b),b.disconnect(y),O.disconnect(S),S.disconnect(y),O.disconnect(w),w.disconnect(y),O.disconnect(x),x.disconnect(y),O.disconnect(T),T.disconnect(y),O.disconnect(A),A.disconnect(y),y.disconnect(k),k.disconnect(t.destination)})};var Zo,Jo,Ko,ta,ea,na,ia,sa,ra,oa,aa,ua,ca,ha,la,pa,da,fa,ma,ga,_a,ya,va,ba,Sa,wa,xa,Ta,Aa,ka,Oa,Pa,Ma,Ca,Na,Ia,Ea,qa,Da,Ra,za,Fa,ja,Va,La,Ba,Ua,Ga,Qa,Ha,Wa,$a,Ya,Xa,Za,Ja,Ka,tu,eu,nu,iu,su,ru,ou,au,uu,cu,hu,lu,pu,du,fu,mu,gu,_u,yu,vu,bu,Su,wu,xu,Tu,Au,ku,Ou,Pu,Mu,Cu,Nu,Iu,Eu,qu,Du,Ru,zu,Fu,ju,Vu,Lu,Bu,Uu,Gu,Qu,Hu,Wu,$u,Yu,Xu,Zu,Ju,Ku,tc,ec,nc,ic,sc,rc,oc,ac,uc,cc,hc,lc,pc,dc,fc,mc,gc,_c,s=(t,e)=>{var n=t.createPanner();return void 0===n.orientationX?ya(t,e):(C(n,e),i(n,e,"orientationX"),i(n,e,"orientationY"),i(n,e,"orientationZ"),i(n,e,"positionX"),i(n,e,"positionY"),i(n,e,"positionZ"),u(n,e,"coneInnerAngle"),u(n,e,"coneOuterAngle"),u(n,e,"coneOuterGain"),u(n,e,"distanceModel"),u(n,e,"maxDistance"),u(n,e,"panningModel"),u(n,e,"refDistance"),u(n,e,"rolloffFactor"),n)};ec=n,nc=co=rn,ac=go=Vi,uc=Ko=Ss,cc=Lo,hc=ta=ma=we,lc=ic=s,pc=_,dc=f,fc=vo=ji,mc=bo=e,gc=$o,sc=()=>{let s=new WeakMap,m=null;return{render(t,e,n){var i=s.get(e);return void 0!==i?Promise.resolve(i):(async(t,h,l)=>{let p=null,e=pc(t);var d={channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation},f={...d,coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,panningModel:e.panningModel,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor},n=v(e,h);if("bufferSize"in e)p=hc(h,{...d,gain:1});else if(!n){let t={...f,orientationX:e.orientationX.value,orientationY:e.orientationY.value,orientationZ:e.orientationZ.value,positionX:e.positionX.value,positionY:e.positionY.value,positionZ:e.positionZ.value};e=lc(h,t)}if(s.set(h,null===p?e:p),null===p)return n?(await ac(h,t.orientationX,e.orientationX,l),await ac(h,t.orientationY,e.orientationY,l),await ac(h,t.orientationZ,e.orientationZ,l),await ac(h,t.positionX,e.positionX,l),await ac(h,t.positionY,e.positionY,l),await ac(h,t.positionZ,e.positionZ,l)):(await fc(h,t.orientationX,e.orientationX,l),await fc(h,t.orientationY,e.orientationY,l),await fc(h,t.orientationZ,e.orientationZ,l),await fc(h,t.positionX,e.positionX,l),await fc(h,t.positionY,e.positionY,l),await fc(h,t.positionZ,e.positionZ,l)),At(e)?await mc(t,h,e.inputs[0],l):await mc(t,h,e,l),e;{if(null===m){if(null===dc)throw new Error("Missing the native OfflineAudioContext constructor.");let n=new dc(6,t.context.length,h.sampleRate),i=uc(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});i.connect(n.destination),m=(async()=>{var e=await Promise.all([t.orientationX,t.orientationY,t.orientationZ,t.positionX,t.positionY,t.positionZ].map(async(t,e)=>{e=cc(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===e?1:0});return await fc(n,t,e.offset,l),e}));for(let t=0;t<6;t+=1)e[t].connect(i,0,t),e[t].start(0);return gc(n)})()}let e=await m,s=hc(h,{...d,gain:1}),r=(await mc(t,h,s,l),[]);for(let t=0;t<e.numberOfChannels;t+=1)r.push(e.getChannelData(t));let o=[r[0][0],r[1][0],r[2][0]],a=[r[3][0],r[4][0],r[5][0]],u=hc(h,{...d,gain:1}),c=lc(h,{...f,orientationX:o[0],orientationY:o[1],orientationZ:o[2],positionX:a[0],positionY:a[1],positionZ:a[2]});s.connect(u).connect(c.inputs[0]),c.connect(p);for(let i=128;i<e.length;i+=128){let e=[r[0][i],r[1][i],r[2][i]],n=[r[3][i],r[4][i],r[5][i]];if(e.some((t,e)=>t!==o[e])||n.some((t,e)=>t!==a[e])){o=e,a=n;let t=i/h.sampleRate;u.gain.setValueAtTime(0,t),u=hc(h,{...d,gain:0}),c=lc(h,{...f,orientationX:o[0],orientationY:o[1],orientationZ:o[2],positionX:a[0],positionY:a[1],positionZ:a[2]}),u.gain.setValueAtTime(1,t),s.connect(u).connect(c.inputs[0]),c.connect(p)}}return p}})(t,e,n)}}},oc=fo=Mo=en;let yc=class extends ec{constructor(t,e){var n=rc(t),e={...Pe,...e},e=ic(n,e),n=oc(n);super(t,!1,e,n?sc():null),this._nativePannerNode=e,this._orientationX=nc(this,n,e.orientationX,pt,lt),this._orientationY=nc(this,n,e.orientationY,pt,lt),this._orientationZ=nc(this,n,e.orientationZ,pt,lt),this._positionX=nc(this,n,e.positionX,pt,lt),this._positionY=nc(this,n,e.positionY,pt,lt),this._positionZ=nc(this,n,e.positionZ,pt,lt)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}},vc=(tc=ut,Zu=(t,{disableNormalization:e,imag:n,real:i})=>{var s=n instanceof Float32Array?n:new Float32Array(n),i=i instanceof Float32Array?i:new Float32Array(i),t=t.createPeriodicWave(i,s,{disableNormalization:e});if(Array.from(n).length<2)throw tc();return t},Ju=rc=po=tn,Ku=new WeakSet,class qm{constructor(t,e){t=Ju(t),e=(t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,()=>0),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:n}})({...Me,...e}),t=Zu(t,e);return Ku.add(t),t}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===qm.prototype||Ku.has(t)}}),bc=(Yu=((l,x,T,A,k,p)=>{let O=new Float32Array([1,1]),P=Math.PI/2,M={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},C={...M,oversample:"none"},d=(h,t,l,p,d)=>{if(1===t){var f=h,r=l,o=p,a=d,u=new Float32Array(16385),c=new Float32Array(16385);for(let e=0;e<16385;e+=1){let t=e/16384*P;u[e]=Math.cos(t),c[e]=Math.sin(t)}let t=T(f,{...M,gain:0}),e=A(f,{...C,curve:u}),n=A(f,{...C,curve:O}),i=T(f,{...M,gain:0}),s=A(f,{...C,curve:c});return{connectGraph(){r.connect(t),r.connect(n.inputs[0]),r.connect(i),n.connect(o),o.connect(e.inputs[0]),o.connect(s.inputs[0]),e.connect(t.gain),s.connect(i.gain),t.connect(a,0,0),i.connect(a,0,1)},disconnectGraph(){r.disconnect(t),r.disconnect(n.inputs[0]),r.disconnect(i),n.disconnect(o),o.disconnect(e.inputs[0]),o.disconnect(s.inputs[0]),e.disconnect(t.gain),s.disconnect(i.gain),t.disconnect(a,0,0),i.disconnect(a,0,1)}}}if(2!==t)throw k();{var f=h,m=l,g=p,_=d,y=new Float32Array(16385),v=new Float32Array(16385),b=new Float32Array(16385),S=new Float32Array(16385),w=Math.floor(8192.5);for(let e=0;e<16385;e+=1)if(e>w){let t=(e-w)/(16384-w)*P;y[e]=Math.cos(t),v[e]=Math.sin(t),b[e]=0,S[e]=1}else{let t=e/(16384-w)*P;y[e]=1,v[e]=0,b[e]=Math.cos(t),S[e]=Math.sin(t)}let t=x(f,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),e=T(f,{...M,gain:0}),n=A(f,{...C,curve:y}),i=T(f,{...M,gain:0}),s=A(f,{...C,curve:v}),r=A(f,{...C,curve:O}),o=T(f,{...M,gain:0}),a=A(f,{...C,curve:b}),u=T(f,{...M,gain:0}),c=A(f,{...C,curve:S});return{connectGraph(){m.connect(t),m.connect(r.inputs[0]),t.connect(e,0),t.connect(i,0),t.connect(o,1),t.connect(u,1),r.connect(g),g.connect(n.inputs[0]),g.connect(s.inputs[0]),g.connect(a.inputs[0]),g.connect(c.inputs[0]),n.connect(e.gain),s.connect(i.gain),a.connect(o.gain),c.connect(u.gain),e.connect(_,0,0),o.connect(_,0,0),i.connect(_,0,1),u.connect(_,0,1)},disconnectGraph(){m.disconnect(t),m.disconnect(r.inputs[0]),t.disconnect(e,0),t.disconnect(i,0),t.disconnect(o,1),t.disconnect(u,1),r.disconnect(g),g.disconnect(n.inputs[0]),g.disconnect(s.inputs[0]),g.disconnect(a.inputs[0]),g.disconnect(c.inputs[0]),n.disconnect(e.gain),s.disconnect(i.gain),a.disconnect(o.gain),c.disconnect(u.gain),e.disconnect(_,0,0),o.disconnect(_,0,0),i.disconnect(_,0,1),u.disconnect(_,0,1)}}}};return(e,{channelCount:t,channelCountMode:n,pan:i,...s})=>{if("max"===n)throw k();let r=l(e,{...s,channelCount:1,channelCountMode:n,numberOfInputs:2}),o=T(e,{...s,channelCount:t,channelCountMode:n,gain:1}),a=T(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:i}),{connectGraph:u,disconnectGraph:c}=d(e,t,o,a,r);Object.defineProperty(a.gain,"defaultValue",{get:()=>0}),Object.defineProperty(a.gain,"minValue",{get:()=>-1});s={get bufferSize(){},get channelCount(){return o.channelCount},set channelCount(t){o.channelCount!==t&&(h&&c(),{connectGraph:u,disconnectGraph:c}=d(e,t,o,a,r),h)&&u(),o.channelCount=t},get channelCountMode(){return o.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw k();o.channelCountMode=t},get channelInterpretation(){return o.channelInterpretation},set channelInterpretation(t){o.channelInterpretation=t},get context(){return o.context},get inputs(){return[o]},get numberOfInputs(){return o.numberOfInputs},get numberOfOutputs(){return o.numberOfOutputs},get pan(){return a.gain},addEventListener:(...t)=>o.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>o.dispatchEvent(t[0]),removeEventListener:(...t)=>o.removeEventListener(t[0],t[1],t[2])};let h=!1;return p(be(s,r),()=>{u(),h=!0},()=>{c(),h=!1})}})(Ss,ve,we,on,Ae,bs),Xu=Ae,(t,e)=>{let n=e.channelCountMode;if("clamped-max"===n)throw Xu();return void 0===t.createStereoPanner?Yu(t,e):(t=t.createStereoPanner(),C(t,e),i(t,e,"pan"),Object.defineProperty(t,"channelCountMode",{get:()=>n,set:t=>{if(t!==n)throw Xu()}}),t)}),Sc=(s=n,ju=rn,Gu=Vi,Qu=Vu=bc,Hu=_,Wu=ji,Lu=()=>{let r=new WeakMap;return{render(t,e,n){var i=r.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=Hu(t);var s=v(i,e);if(!s){let t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,pan:i.pan.value};i=Qu(e,t)}return r.set(e,i),s?await Gu(e,t.pan,i.pan,n):await Wu(e,t.pan,i.pan,n),At(i)?await $u(t,e,i.inputs[0],n):await $u(t,e,i,n),i})(t,e,n)}}},class extends s{constructor(t,e){var n=Bu(t),e={...Ce,...e},e=Vu(n,e),n=Uu(n);super(t,!1,e,n?Lu():null),this._pan=ju(this,n,e.pan)}get pan(){return this._pan}}),wc=(zu=_,Fu=$u=e,()=>{let s=new WeakMap;return{render(t,e,n){var i=s.get(e);return void 0!==i?Promise.resolve(i):(async(t,e,n)=>{let i=zu(t);if(!v(i,e)){let t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,curve:i.curve,oversample:i.oversample};i=Ru(e,t)}return s.set(e,i),At(i)?await Fu(t,e,i.inputs[0],n):await Fu(t,e,i,n),i})(t,e,n)}}}),xc=(ec=n,Nu=a,Iu=Ru=on,Eu=wc,qu=Bu=tn,Du=Uu=en,class extends ec{constructor(t,e){var n=qu(t),e={...Ie,...e},e=Iu(n,e);super(t,!0,e,Du(n)?Eu():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=e}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw Nu();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}}),Tc=null!==(s=Ue)&&s.isSecureContext,Ac=(Cu=Ue,(t,e,n)=>{Object.defineProperties(Cu,{currentFrame:{configurable:!0,get:()=>Math.round(t*e)},currentTime:{configurable:!0,get:()=>t}});try{return n()}finally{null!==Cu&&(delete Cu.currentFrame,delete Cu.currentTime)}}),kc=new WeakMap,Oc=(Pu=kc,Mu=f,t=>{var e=Pu.get(t);if(void 0===e){if(null===Mu)throw new Error("Missing the native OfflineAudioContext constructor.");e=new Mu(1,1,8e3),Pu.set(t,e)}return e}),Pc=null!==(on=Ue)&&on.hasOwnProperty("AudioWorkletNode")?on.AudioWorkletNode:null,Mc=Tc?(du=Be,fu=Ae,Ou=Ue,mu=s=>new Promise((n,u)=>{if(null===Ou)u(new SyntaxError);else{var i=Ou.document.head;if(null===i)u(new SyntaxError);else{let t=Ou.document.createElement("script"),e=new Blob([s],{type:"application/javascript"}),r=URL.createObjectURL(e),o=Ou.onerror,a=()=>{Ou.onerror=o,URL.revokeObjectURL(r)};Ou.onerror=(t,e,n,i,s)=>e===r||e===Ou.location.href&&1===n&&1===i?(a(),u(s),!1):null!==o?o(t,e,n,i,s):void 0,t.onerror=()=>{a(),u(new SyntaxError)},t.onload=()=>{a(),n()},t.src=r,t.type="module",i.appendChild(t)}}}),gu=Ac,_u=async e=>{try{let t=await fetch(e);if(t.ok)return t.text()}catch{}throw new DOMException("","AbortError")},yu=tn,vu=Oc,bu=en,Su=new WeakMap,wu=new WeakMap,Au=Pc,ku=f,xu=async()=>{if(null===Au)return!0;if(null===ku)return!1;let t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new ku(1,128,8e3),i=URL.createObjectURL(t),s=!1,r=!1;try{await n.audioWorklet.addModule(i);let t=new Au(n,"a",{numberOfOutputs:0}),e=n.createOscillator();t.port.onmessage=()=>s=!0,t.onprocessorerror=()=>r=!0,e.connect(t),await n.startRendering()}catch{}finally{URL.revokeObjectURL(i)}return s&&!r},Tu=Ue,(e,n,a={credentials:"omit"})=>{let u=yu(e),c=new URL(n,Tu.location.href).toString();if(void 0!==u.audioWorklet)return Promise.all([_u(n),Promise.resolve(du(xu,xu))]).then(([t,e])=>{let[n,i]=it(t,c),s=e?i:i.replace(/\s+extends\s+AudioWorkletProcessor\s*{/," extends (class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}){"),r=new Blob([n+`;(registerProcessor=>{${s}
})((n,p)=>registerProcessor(n,class extends p{${e?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${e?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}))`],{type:"application/javascript; charset=utf-8"}),o=URL.createObjectURL(r);return u.audioWorklet.addModule(o,a).then(()=>{if(!bu(u))return vu(u).audioWorklet.addModule(o,a)}).finally(()=>URL.revokeObjectURL(o))});var i=wu.get(e);if(void 0!==i&&i.has(n))return Promise.resolve();i=Su.get(e);if(void 0!==i){let t=i.get(n);if(void 0!==t)return t}var t=_u(n).then(t=>{var[t,e]=it(t,c);return mu(t+`;((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${e}
})})(window,'_AWGS')`)}).then(()=>{let t=Tu._AWGS.pop();if(void 0===t)throw new SyntaxError;gu(u.currentTime,u.sampleRate,()=>t(class{},void 0,(t,e)=>{if(""===t.trim())throw fu();var n=K.get(u);if(void 0!==n){if(n.has(t))throw fu();rt(e),st(e.parameterDescriptors),n.set(t,e)}else rt(e),st(e.parameterDescriptors),K.set(u,new Map([[t,e]]))},u.sampleRate,void 0,void 0))});return void 0===i?Su.set(e,new Map([[n,t]])):i.set(n,t),t.then(()=>{var t=wu.get(e);void 0===t?wu.set(e,new Set([n])):t.add(n)}).finally(()=>{var t=Su.get(e);void 0!==t&&t.delete(n)}),t}):void 0,Cc=(lu=un,pu=en,t=>lu(t)||pu(t)),Nc=(za=Mc,Fa=Ei,ja=Di,Va=Bi,La=vs,Ba=ws,Ua=xs,Ga=Bo,Qa=Uo,nu=qi,iu=Be,su=new WeakSet,ou=Cc,au=at,uu=de,cu=zi,hu=Ri,Ha=(t,r)=>{let o=ou(t)?t:ru(t);if(su.has(r)){let t=new DOMException("","DataCloneError");return Promise.reject(t)}try{su.add(r)}catch{}return iu(uu,()=>uu(o))?o.decodeAudioData(r).then(t=>(iu(au,()=>au(t))||hu(t),nu.add(t),t)):new Promise((e,n)=>{let i=()=>{try{t=r,(new MessageChannel).port1.postMessage(t,[t])}catch{}var t},s=t=>{n(t),i()};try{o.decodeAudioData(r,t=>{"function"!=typeof t.copyFromChannel&&(cu(t),ct(t)),nu.add(t),i(),e(t)},t=>{s(null===t?new DOMException("","EncodingError"):t)})}catch(t){s(t)}})},Wa=Go,$a=Qo,Ya=Ho,Xa=Wo,ec=Yo,Za=Fi,Ja=yc,Ka=vc,tu=Sc,eu=xc,class extends ec{constructor(t,e){super(t,e),this._nativeContext=t,this._audioWorklet=void 0===za?void 0:{addModule:(t,e)=>za(this,t,e)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new Fa(this)}createBiquadFilter(){return new La(this)}createBuffer(t,e,n){return new ja({length:e,numberOfChannels:t,sampleRate:n})}createBufferSource(){return new Va(this)}createChannelMerger(t=6){return new Ba(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new Ua(this,{numberOfOutputs:t})}createConstantSource(){return new Ga(this)}createConvolver(){return new Qa(this)}createDelay(t=1){return new Wa(this,{maxDelayTime:t})}createDynamicsCompressor(){return new $a(this)}createGain(){return new Ya(this)}createIIRFilter(t,e){return new Xa(this,{feedback:e,feedforward:t})}createOscillator(){return new Za(this)}createPanner(){return new Ja(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new Ka(this,{...n,imag:e,real:t})}createStereoPanner(){return new tu(this)}createWaveShaper(){return new eu(this)}decodeAudioData(t,e,n){return Ha(this._nativeContext,t).then(t=>("function"==typeof e&&e(t),t)).catch(t=>{throw"function"==typeof n&&n(t),t})}}),Ic=(s=n,class extends s{constructor(t,e){var n=Da(t),e=n.createMediaElementSource(e.mediaElement);if(Ra(n))throw TypeError();super(t,!0,e,null),this._nativeMediaElementAudioSourceNode=e}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}}),Ec=(on=n,class extends on{constructor(t,e){var n=Ea(t);if(qa(n))throw new TypeError;n=((t,e)=>{const n=t.createMediaStreamDestination();return C(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n})(n,{...pe,...e});super(t,!1,n,null),this._nativeMediaStreamAudioDestinationNode=n}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}}),qc=(Ei=n,class extends Ei{constructor(t,e){var n=Na(t),e=((t,{mediaStream:e})=>{const n=e.getAudioTracks(),i=(n.sort((t,e)=>t.id<e.id?-1:t.id>e.id?1:0),n.slice(0,1)),s=t.createMediaStreamSource(new MediaStream(i));return Object.defineProperty(s,"mediaStream",{value:e}),s})(n,e);if(Ia(n))throw new TypeError;super(t,!0,e,null),this._nativeMediaStreamAudioSourceNode=e}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}}),Dc=(Di=n,Ma=a,Ca=Ia=qa=Ra=en,Oa=(t,{mediaStreamTrack:e})=>{if("function"==typeof t.createMediaStreamTrackSource)return t.createMediaStreamTrackSource(e);var n=new MediaStream([e]),n=t.createMediaStreamSource(n);if("audio"!==e.kind)throw Ma();if(Ca(t))throw new TypeError;return n},Pa=Na=Ea=Da=ru=tn,class extends Di{constructor(t,e){var n=Pa(t);super(t,!0,Oa(n,e),null)}}),Rc=(Bi=Nc,va=a,ba=Ae,Sa=Ne,wa=Ic,xa=Ec,Ta=qc,Aa=Dc,ka=an,class extends Bi{constructor(t={}){if(null===ka)throw new Error("Missing the native AudioContext constructor.");let e=new ka(t);if(null===e)throw Sa();if(void 0!==(n=t.latencyHint)&&"number"!=typeof n&&("string"!=typeof n||"balanced"!==n&&"interactive"!==n&&"playback"!==n))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw ba();super(e,2);var n=t.latencyHint,t=e.sampleRate;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===n?512/t:"interactive"===n||void 0===n?256/t:"playback"===n?1024/t:128*Math.max(2,Math.min(128,Math.round(n*t/128)))/t,this._nativeAudioContext=e,"webkitAudioContext"===ka.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";let t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then(()=>{throw va()}):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then(()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),wt(this)}))}createMediaElementSource(t){return new wa(this,{mediaElement:t})}createMediaStreamDestination(){return new xa(this)}createMediaStreamSource(t){return new Ta(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new Aa(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise((t,e)=>{let n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)}):this._nativeAudioContext.resume().catch(t=>{if(void 0===t||15===t.code)throw va();throw t})}suspend(){return this._nativeAudioContext.suspend().catch(t=>{if(void 0===t)throw va();throw t})}}),zc=(_c=Xo,t=>{t=_c.get(t);if(void 0===t)throw new Error("The context has no set of AudioWorkletNodes.");return t});var Fc,jc,Vc,ws,Lc,Bc,Uc,Gc,Qc,Hc,Wc,$c,Yc,Xc,Zc,Jc,Kc,th,eh,nh,ih,sh,rh,oh,ah,uh,ch,hh,lh,ph,dh,fh,mh,gh,_h,yh,vh,bh,Sh,wh,xh,Th,Ah,kh,Oh,Ph,Mh,Ch,Nh,Ih,Eh,qh,Dh,Rh,zh,Fh,jh,Vh,Lh,Bh,Uh,Gh,Qh,Hh,Wh,$h,Yh,Xh;Gh=ut;let Zh=(t,e,n=0,i=0)=>{t=t[n];if(void 0===t)throw Gh();return zt(e)?t.connect(e,0,i):t.connect(e,0)},Jh=(Uh=Fc=zc,(t,e)=>{Uh(t).delete(e)}),Kh=(Bh=ut,(t,e,n,i=0)=>void 0===e?t.forEach(t=>t.disconnect()):"number"==typeof e?oe(Bh,t,e).disconnect():zt(e)?void 0===n?t.forEach(t=>t.disconnect(e)):void 0===i?oe(Bh,t,n).disconnect(e,0):oe(Bh,t,n).disconnect(e,0,i):void 0===n?t.forEach(t=>t.disconnect(e)):oe(Bh,t,n).disconnect(e,0)),tl=new WeakMap,el=(Vh=tl,Lh=ft,t=>Lh(Vh,t)),nl=(Ph=ut,Mh=a,qh=Te,Fh=el,(r,t,o,a)=>{if(0===a.numberOfInputs&&0===a.numberOfOutputs)throw Dh();let u=Array.isArray(a.outputChannelCount)?a.outputChannelCount:Array.from(a.outputChannelCount);if(u.some(t=>t<1))throw Dh();if(u.length!==a.numberOfOutputs)throw Ph();if("explicit"!==a.channelCountMode)throw Dh();let c=a.channelCount*a.numberOfInputs,e=u.reduce((t,e)=>t+e,0),n=void 0===o.parameterDescriptors?0:o.parameterDescriptors.length;if(6<c+n||6<e)throw Dh();let i=new MessageChannel,h=[],l=[];for(let t=0;t<a.numberOfInputs;t+=1)h.push(Eh(r,{channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,gain:1})),l.push(Nh(r,{channelCount:a.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:a.channelCount}));let p=[];if(void 0!==o.parameterDescriptors)for(let{defaultValue:e,maxValue:n,minValue:i,name:s}of o.parameterDescriptors){let t=Ih(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==a.parameterData[s]?a.parameterData[s]:void 0===e?0:e});Object.defineProperties(t.offset,{defaultValue:{get:()=>void 0===e?0:e},maxValue:{get:()=>void 0===n?pt:n},minValue:{get:()=>void 0===i?lt:i}}),p.push(t)}let d=Ch(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,c+n)}),f=_e(t,r.sampleRate),m=qh(r,f,c+n,Math.max(1,e)),s=Nh(r,{channelCount:Math.max(1,e),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,e)}),g=[];for(let t=0;t<a.numberOfOutputs;t+=1)g.push(Ch(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:u[t]}));for(let e=0;e<a.numberOfInputs;e+=1){h[e].connect(l[e]);for(let t=0;t<a.channelCount;t+=1)l[e].connect(d,t,e*a.channelCount+t)}let _=new Yt(void 0===o.parameterDescriptors?[]:o.parameterDescriptors.map(({name:t},e)=>{var n=p[e];return n.connect(d,0,c+e),n.start(0),[t,n.offset]})),y=(d.connect(m),a.channelInterpretation),v=null,b=0===a.numberOfOutputs?[m]:g,S={get bufferSize(){return f},get channelCount(){return a.channelCount},set channelCount(t){throw Mh()},get channelCountMode(){return a.channelCountMode},set channelCountMode(t){throw Mh()},get channelInterpretation(){return y},set channelInterpretation(t){for(var e of h)e.channelInterpretation=t;y=t},get context(){return m.context},get inputs(){return h},get numberOfInputs(){return a.numberOfInputs},get numberOfOutputs(){return a.numberOfOutputs},get onprocessorerror(){return v},set onprocessorerror(t){"function"==typeof v&&S.removeEventListener("processorerror",v),"function"==typeof(v="function"==typeof t?t:null)&&S.addEventListener("processorerror",v)},get parameters(){return _},get port(){return i.port2},addEventListener:(...t)=>m.addEventListener(t[0],t[1],t[2]),connect:Oh.bind(null,b),disconnect:Rh.bind(null,b),dispatchEvent:(...t)=>m.dispatchEvent(t[0]),removeEventListener:(...t)=>m.removeEventListener(t[0],t[1],t[2])},w=new Map;var x,T;i.port1.addEventListener=(x=i.port1.addEventListener,(...t)=>{if("message"===t[0]){let e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;var n;null!==e&&(void 0!==(n=w.get(t[1]))?t[1]=n:(t[1]=t=>{zh(r.currentTime,r.sampleRate,()=>e(t))},w.set(e,t[1])))}return x.call(i.port1,t[0],t[1],t[2])}),i.port1.removeEventListener=(T=i.port1.removeEventListener,(...t)=>{var e;return"message"===t[0]&&void 0!==(e=w.get(t[1]))&&(w.delete(t[1]),t[1]=e),T.call(i.port1,t[0],t[1],t[2])});let A=null,k=(Object.defineProperty(i.port1,"onmessage",{get:()=>A,set:t=>{"function"==typeof A&&i.port1.removeEventListener("message",A),"function"==typeof(A="function"==typeof t?t:null)&&(i.port1.addEventListener("message",A),i.port1.start())}}),o.prototype.port=i.port1,null),O=(((t,e,n,i)=>{let s=tt.get(t);void 0===s&&(s=new WeakMap,tt.set(t,s));t=(async(t,e)=>{return new t((r=e,await new Promise((e,n)=>{let{port1:i,port2:s}=new MessageChannel;i.onmessage=({data:t})=>{i.close(),s.close(),e(t)},i.onmessageerror=({data:t})=>{i.close(),s.close(),n(t)},s.postMessage(r)})));var r})(n,i);return s.set(e,t),t})(r,S,o,a).then(t=>k=t),Kt(a.numberOfInputs,a.channelCount)),P=Kt(a.numberOfOutputs,u),M=void 0===o.parameterDescriptors?[]:o.parameterDescriptors.reduce((t,{name:e})=>({...t,[e]:new Float32Array(128)}),{}),C=!0,N=()=>{0<a.numberOfOutputs&&m.disconnect(s);for(let e=0,n=0;e<a.numberOfOutputs;e+=1){var i=g[e];for(let t=0;t<u[e];t+=1)s.disconnect(i,n+t,t);n+=u[e]}},I=!(m.onaudioprocess=({inputBuffer:n,outputBuffer:s})=>{if(null!==k)for(let i=0;i<f;i+=128){for(let e=0;e<a.numberOfInputs;e+=1)for(let t=0;t<a.channelCount;t+=1)Zt(n,O[e],t,t,i);void 0!==o.parameterDescriptors&&o.parameterDescriptors.forEach(({name:t},e)=>{Zt(n,M,t,c+e,i)});for(let e=0;e<a.numberOfInputs;e+=1)for(let t=0;t<u[e];t+=1)0===P[e][t].byteLength&&(P[e][t]=new Float32Array(128));try{let n=Fh(S),t=O.map((t,e)=>0<n[e].size?t:[]),e=zh(r.currentTime+i/r.sampleRate,r.sampleRate,()=>k.process(t,P,M));C=e;for(let e=0,n=0;e<a.numberOfOutputs;e+=1){for(let t=0;t<u[e];t+=1)Jt(s,P[e],t,n+t,i);n+=u[e]}}catch(n){C=!1,S.dispatchEvent(new ErrorEvent("processorerror",{colno:n.colno,filename:n.filename,lineno:n.lineno,message:n.message}))}if(!C){for(let e=0;e<a.numberOfInputs;e+=1){h[e].disconnect(l[e]);for(let t=0;t<a.channelCount;t+=1)l[i].disconnect(d,t,e*a.channelCount+t)}if(void 0!==o.parameterDescriptors){let t=o.parameterDescriptors.length;for(let e=0;e<t;e+=1){let t=p[e];t.disconnect(d,0,c+e),t.stop()}}d.disconnect(m),m.onaudioprocess=null,(I?N:D)();break}}}),E=Eh(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),q=()=>m.connect(E).connect(r.destination),D=()=>{m.disconnect(E),E.disconnect()};return q(),jh(S,()=>{if(C){D(),0<a.numberOfOutputs&&m.connect(s);for(let e=0,n=0;e<a.numberOfOutputs;e+=1){var i=g[e];for(let t=0;t<u[e];t+=1)s.connect(i,n+t,t);n+=u[e]}}I=!0},()=>{C&&(q(),N()),I=!1})}),il=(wh=a,xh=nl,Ah=Dh=Ae,kh=jh=bs,(n,t,r,o,e,a)=>{if(null!==r)try{let i=new r(n,o,a),s=new Map,e=null;if(Object.defineProperties(i,{channelCount:{get:()=>a.channelCount,set:()=>{throw wh()}},channelCountMode:{get:()=>"explicit",set:()=>{throw wh()}},onprocessorerror:{get:()=>e,set:t=>{"function"==typeof e&&i.removeEventListener("processorerror",e),"function"==typeof(e="function"==typeof t?t:null)&&i.addEventListener("processorerror",e)}}}),i.addEventListener=(c=i.addEventListener,(...n)=>{if("processorerror"===n[0]){let e="function"==typeof n[1]?n[1]:"object"==typeof n[1]&&null!==n[1]&&"function"==typeof n[1].handleEvent?n[1].handleEvent:null;var t;null!==e&&(void 0!==(t=s.get(n[1]))?n[1]=t:(n[1]=t=>{"error"===t.type?(Object.defineProperties(t,{type:{value:"processorerror"}}),e(t)):e(new ErrorEvent(n[0],{...t}))},s.set(e,n[1])))}return c.call(i,"error",n[1],n[2]),c.call(i,...n)}),i.removeEventListener=(u=i.removeEventListener,(...e)=>{if("processorerror"===e[0]){let t=s.get(e[1]);void 0!==t&&(s.delete(e[1]),e[1]=t)}return u.call(i,"error",e[1],e[2]),u.call(i,e[0],e[1],e[2])}),0===a.numberOfOutputs)return i;{let t=Th(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return i.connect(t).connect(n.destination),kh(i,()=>t.disconnect(),()=>t.connect(n.destination))}}catch(t){if(11===t.code)throw Ah();throw t}var u,c;if(void 0===e)throw Ah();r=a,o=(new MessageChannel).port1;try{o.postMessage(r)}finally{o.close()}return xh(n,t,e,a)}),sl=(oh=Vi,ah=Oh=Zh,uh=Li,ch=Ch=Ss,hh=Nh=ve,lh=Ih=Lo,ph=Th=Eh=we,dh=Jh,fh=Rh=Kh,mh=zh=Ac,gh=_,_h=Pc,yh=f,vh=ji,bh=e,Sh=$o,(s,p,d)=>{let r=new WeakMap,f=null;return{render(t,e,n){dh(e,t);var i=r.get(e);return void 0!==i?Promise.resolve(i):(async(u,c,h)=>{let n=gh(u),o=null;var t=v(n,c),l=Array.isArray(p.outputChannelCount)?p.outputChannelCount:Array.from(p.outputChannelCount);if(null===_h){let t=l.reduce((t,e)=>t+e,0),e=hh(c,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),n=[];for(let t=0;t<u.numberOfOutputs;t+=1)n.push(ch(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:l[t]}));let i=ph(c,{channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,gain:1});i.connect=ah.bind(null,n),i.disconnect=fh.bind(null,n),o=[e,n,i]}else t||(n=new _h(c,s));if(r.set(c,null===o?n:o[2]),null!==o){if(null===f){if(void 0===d)throw new Error("Missing the processor constructor.");if(null===yh)throw new Error("Missing the native OfflineAudioContext constructor.");let a=u.channelCount*u.numberOfInputs,t=void 0===d.parameterDescriptors?0:d.parameterDescriptors.length,e=a+t,n=async()=>{let n=new yh(e,128*Math.ceil(u.context.length/128),c.sampleRate),i=[],s=[];for(let t=0;t<p.numberOfInputs;t+=1)i.push(ph(n,{channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,gain:1})),s.push(hh(n,{channelCount:p.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:p.channelCount}));var r=await Promise.all(Array.from(u.parameters.values()).map(async t=>{var e=lh(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await vh(n,t,e.offset,h),e})),o=ch(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,a+t)});for(let e=0;e<p.numberOfInputs;e+=1){i[e].connect(s[e]);for(let t=0;t<p.channelCount;t+=1)s[e].connect(o,t,e*p.channelCount+t)}for(let[t,e]of r.entries())e.connect(o,0,a+t),e.start(0);return o.connect(n.destination),await Promise.all(i.map(t=>bh(u,n,t,h))),Sh(n)};f=(async(t,n,s,r,o,e,a)=>{let u=null===n?128*Math.ceil(t.context.length/128):n.length,c=r.channelCount*r.numberOfInputs,i=o.reduce((t,e)=>t+e,0),h=0===i?null:s.createBuffer(i,u,s.sampleRate);if(void 0===e)throw new Error("Missing the processor constructor.");let l=g(t),p=await((t,e)=>{t=ft(tt,t),e=_(e);return ft(t,e)})(s,t),d=Kt(r.numberOfInputs,r.channelCount),f=Kt(r.numberOfOutputs,o),m=Array.from(t.parameters.keys()).reduce((t,e)=>({...t,[e]:new Float32Array(128)}),{});for(let i=0;i<u;i+=128){if(0<r.numberOfInputs&&null!==n)for(let e=0;e<r.numberOfInputs;e+=1)for(let t=0;t<r.channelCount;t+=1)Zt(n,d[e],t,t,i);void 0!==e.parameterDescriptors&&null!==n&&e.parameterDescriptors.forEach(({name:t},e)=>{Zt(n,m,t,c+e,i)});for(let e=0;e<r.numberOfInputs;e+=1)for(let t=0;t<o[e];t+=1)0===f[e][t].byteLength&&(f[e][t]=new Float32Array(128));try{let t=d.map((t,e)=>0===l.activeInputs[e].size?[]:t),e=a(i/s.sampleRate,s.sampleRate,()=>p.process(t,f,m));if(null!==h)for(let e=0,n=0;e<r.numberOfOutputs;e+=1){for(let t=0;t<o[e];t+=1)Jt(h,f[e],t,n+t,i);n+=o[e]}if(!e)break}catch(n){t.dispatchEvent(new ErrorEvent("processorerror",{colno:n.colno,filename:n.filename,lineno:n.lineno,message:n.message}));break}}return h})(u,0===e?null:await n(),c,p,l,d,mh)}let t=await f,e=uh(c,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[s,r,n]=o;null!==t&&(e.buffer=t,e.start(0)),e.connect(s);for(let n=0,i=0;n<u.numberOfOutputs;n+=1){let e=r[n];for(let t=0;t<l[n];t+=1)s.connect(e,i+t,t);i+=l[n]}return n}if(t)for(let[t,e]of u.parameters.entries())await oh(c,e,n.parameters.get(t),h);else for(let[t,e]of u.parameters.entries())await vh(c,e,n.parameters.get(t),h);return await bh(u,c,n,h),n})(t,e,n)}}}),rl=(rh=kc,t=>rh.get(t)),ol=(sh=tl,(t,e)=>{sh.set(t,e)}),al=Tc?(Wc=(t,e)=>{Fc(t).add(e)},vs=n,$c=rn,Yc=sl,Xc=il,Zc=g,Jc=rl,Kc=tn,th=en,eh=Pc,nh=ol,ih=Le,class extends vs{constructor(t,e,n){let i,s=Kc(t),r=th(s),o={...n={...Xt,...n},outputChannelCount:void 0!==n.outputChannelCount?n.outputChannelCount:1===n.numberOfInputs&&1===n.numberOfOutputs?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)},a=K.get(s),u=null==a?void 0:a.get(e),c=!r&&"closed"===s.state&&null!=(i=Jc(s))?i:s,h=Xc(c,r?null:t.baseLatency,eh,e,u,o);super(t,!0,h,r?Yc(e,o,u):null);let l=[];h.parameters.forEach((t,e)=>{t=$c(this,r,t);l.push([e,t])}),this._nativeAudioWorkletNode=h,this._onprocessorerror=null,this._parameters=new Yt(l),r&&Wc(s,this);n=Zc(this).activeInputs;nh(h,n)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){var e="function"==typeof t?ih(this,t):null,n=(this._nativeAudioWorkletNode.onprocessorerror=e,this._nativeAudioWorkletNode.onprocessorerror);this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}}):void 0,ul=(a,an,Qc=Ae,Hc=f,(t,e,n)=>{if(null===Hc)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new Hc(t,e,n)}catch(t){if("SyntaxError"===t.name)throw Qc();throw t}}),cl=((n,i,s,r,o,a,u,c)=>{let h=[];return(t,e)=>s(t).render(t,e,h).then(()=>Promise.all(Array.from(r(e)).map(t=>s(t).render(t,e,h)))).then(()=>o(e)).then(t=>("function"!=typeof t.copyFromChannel?(u(t),ct(t)):i(a,()=>a(t))||c(t),n.add(t),t))})(qi,Be,t,zc,$o,at,zi,Ri),hl=(Be,a,ws=Nc,Lc=Be,Bc=a,Uc=ul,Gc=cl,class extends ws{constructor(t,e,n){let i;if("number"==typeof t&&void 0!==e&&void 0!==n)i={length:e,numberOfChannels:t,sampleRate:n};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");i=t}let{length:s,numberOfChannels:r,sampleRate:o}={...ke,...i},a=Uc(r,s,o);Lc(de,()=>de(a))||a.addEventListener("statechange",(()=>{let e=0,n=t=>{"running"===this._state&&(0<e?(a.removeEventListener("statechange",n),t.stopImmediatePropagation(),this._waitForThePromiseToSettle(t)):e+=1)};return n})()),super(a,r),this._length=s,this._nativeOfflineAudioContext=a,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(Bc()):(this._state="running",Gc(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,wt(this)}))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout(()=>this._waitForThePromiseToSettle(t))}}),ll=(jc=X,Vc=un,t=>{var e=jc.get(t);return Vc(e)||Vc(t)}),pl=(Qh=W,Hh=Ni,t=>Qh.has(t)||Hh(t)),dl=(Wh=Y,$h=Ii,t=>Wh.has(t)||$h(t)),fl=(Yh=X,Xh=en,t=>{var e=Yh.get(t);return Xh(e)||Xh(t)}),ml=()=>{return(async(t,e,n,i,s,r,o,a,u,c,h,l,p,d,f,m)=>!!(t(e,e)&&t(n,n)&&t(s,s)&&t(r,r)&&t(a,a)&&t(u,u)&&t(c,c)&&t(h,h)&&t(l,l)&&t(p,p)&&t(d,d))&&(await Promise.all([t(i,i),t(o,o),t(f,f),t(m,m)])).every(t=>t))(Be,(d=f,()=>{if(null===d)return!1;var t=new d(1,1,44100).createBuffer(1,1,44100);if(void 0!==t.copyToChannel){var e=new Float32Array(2);try{t.copyFromChannel(e,0,0)}catch{return!1}}return!0}),(p=an,()=>{if(null===p)return!1;if(void 0!==p.prototype&&void 0!==p.prototype.close)return!0;var t=new p,e=void 0!==t.close;try{t.close()}catch{}return e}),(l=f,()=>{if(null===l)return Promise.resolve(!1);let s=new l(1,1,44100);return new Promise(e=>{let n=!0;var t=t=>{n&&(n=!1,s.startRendering(),e(t instanceof TypeError))};let i;try{i=s.decodeAudioData(null,()=>{},t)}catch(e){t(e)}void 0!==i&&i.catch(t)})}),(h=an,()=>{if(null===h)return!1;let t;try{t=new h({latencyHint:"balanced"})}catch{return!1}return t.close(),!0}),(c=f,()=>{var t,e;return null!==c&&(e=(t=new c(1,1,44100).createGain()).connect(t)===t,t.disconnect(t),e)}),(a=Pc,u=f,async()=>{if(null===a)return!0;if(null===u)return!1;let t=new Blob(['class A extends AudioWorkletProcessor{process(){this.port.postMessage(0)}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new u(1,128,8e3),i=URL.createObjectURL(t),s=!1;try{await n.audioWorklet.addModule(i);let t=new a(n,"a",{numberOfOutputs:0}),e=n.createOscillator();t.port.onmessage=()=>s=!0,e.connect(t),e.start(0),await n.startRendering(),s||await new Promise(t=>setTimeout(t,5))}catch{}finally{URL.revokeObjectURL(i)}return s}),(o=f,()=>{if(null!==o){var t=new o(1,1,44100).createChannelMerger();if("max"===t.channelCountMode)return!0;try{t.channelCount=2}catch{return!0}}return!1}),(r=f,()=>{var t;return null!==r&&(void 0===(t=new r(1,1,44100)).createConstantSource||t.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY)}),(s=f,()=>{if(null===s)return!1;var t=new s(1,1,44100),e=t.createConvolver();e.buffer=t.createBuffer(1,1,t.sampleRate);try{e.buffer=t.createBuffer(1,1,t.sampleRate)}catch{return!1}return!0}),(n=f,()=>{if(null===n)return!1;var t=new n(1,1,44100).createConvolver();try{t.channelCount=1}catch{return!1}return!0}),Fe,(t=Ue,()=>null!==t&&t.hasOwnProperty("isSecureContext")),(e=an,()=>{if(null===e)return!1;var t=new e;try{return t.createMediaStreamSource(new MediaStream),!1}catch(t){return!0}}),(i=f,()=>{var t,e,n;return null===i?Promise.resolve(!1):void 0===(t=new i(1,1,44100)).createStereoPanner||void 0===t.createConstantSource?Promise.resolve(!0):(e=t.createConstantSource(),n=t.createStereoPanner(),e.channelCount=1,e.offset.value=1,n.channelCount=1,e.start(),e.connect(n).connect(t.destination),t.startRendering().then(t=>1!==t.getChannelData(0)[0]))}),je);var i,e,t,n,s,r,o,a,u,c,h,l,p,d};function o(t,e){if(!t)throw new Error(e)}function r(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: `+t)}function gl(t){t.isOffline||"running"===t.state||bl('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let _l=console;function yl(t){_l=t}function vl(...t){_l.log(...t)}function bl(...t){_l.warn(...t)}function Sl(t){return void 0===t}function c(t){return!Sl(t)}function wl(t){return"function"==typeof t}function xl(t){return"number"==typeof t}function Tl(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function Al(t){return"boolean"==typeof t}function l(t){return Array.isArray(t)}function kl(t){return"string"==typeof t}function Ol(t){return kl(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}let Pl="object"==typeof self?self:null,Ml=Pl&&(Pl.hasOwnProperty("AudioContext")||Pl.hasOwnProperty("webkitAudioContext"));function Cl(t,e,n,i){var s,r=arguments.length,o=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;0<=a;a--)(s=t[a])&&(o=(r<3?s(o):3<r?s(e,n,o):s(e,n))||o);3<r&&o&&Object.defineProperty(e,n,o)}function h(t,o,a,u){return new(a=a||Promise)(function(n,e){function i(t){try{r(u.next(t))}catch(t){e(t)}}function s(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(i,s)}r((u=u.apply(t,o||[])).next())})}Object.create;class Nl{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){var t=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(t),t=new Worker(t);t.onmessage=this._callback.bind(this),this._worker=t}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function Il(t){return dl(t)}function El(t){return pl(t)}function ql(t){return fl(t)}function Dl(t){return ll(t)}function Rl(t){return t instanceof AudioBuffer}function zl(e,...t){if(!t.length)return e;var n,i,s=t.shift();if(Tl(e)&&Tl(s))for(let t in s)n=t,i=s[t],"value"===n||Il(i)||El(i)||Rl(i)?e[t]=s[t]:Tl(s[t])?(e[t]||Object.assign(e,{[t]:{}}),zl(e[t],s[t])):Object.assign(e,{[t]:s[t]});return zl(e,...t)}function p(e,t,n=[],i){var s={},r=Array.from(t);if(!Tl(r[0])||!i||Reflect.has(r[0],i)||Object.keys(r[0]).some(t=>Reflect.has(e,t))||(zl(s,{[i]:r[0]}),n.splice(n.indexOf(i),1),r.shift()),1===r.length&&Tl(r[0]))zl(s,r[0]);else for(let t=0;t<n.length;t++)c(r[t])&&(s[n[t]]=r[t]);return zl(e,s)}function Fl(t,e){return Sl(t)?e:t}function d(e,t){return t.forEach(t=>{Reflect.has(e,t)&&delete e[t]}),e}class jl{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Pl&&this.toString()===Pl.TONE_DEBUG_CLASS)&&vl(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}function Vl(t,e){return e+1e-6<t}function Ll(t,e){return Vl(t,e)||Ul(t,e)}function Bl(t,e){return t+1e-6<e}function Ul(t,e){return Math.abs(t-e)<1e-6}function Gl(t,e,n){return Math.max(Math.min(t,n),e)}jl.version=j;class Ql extends jl{constructor(){super(),this.name="Timeline",this._timeline=[];var t=p(Ql.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){var e;if(o(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length?(e=this._timeline[this.length-1],o(Ll(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)):(e=this._search(t.time),this._timeline.splice(e+1,0,t)),this.length>this.memory){let t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){t=this._timeline.indexOf(t);return-1!==t&&this._timeline.splice(t,1),this}get(t,e="time"){t=this._search(t,e);return-1!==t?this._timeline[t]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){t=this._search(t,e);return t+1<this._timeline.length?this._timeline[t+1]:null}getBefore(t){var e=this._timeline.length;return 0<e&&this._timeline[e-1].time<t||0<=(e=this._search(t))-1?this._timeline[e-1]:null}cancel(n){if(1<this._timeline.length){let e=this._search(n);if(0<=e)if(Ul(this._timeline[e].time,n)){for(let t=e;0<=t&&Ul(this._timeline[t].time,n);t--)e=t;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&Ll(this._timeline[0].time,n)&&(this._timeline=[]);return this}cancelBefore(t){t=this._search(t);return 0<=t&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(t){t=this._timeline.indexOf(t);return 0<t?this._timeline[t-1]:null}_search(i,s="time"){if(0!==this._timeline.length){let t=0;var e=this._timeline.length;let n=e;if(0<e&&this._timeline[e-1][s]<=i)return e-1;for(;t<n;){let e=Math.floor(t+(n-t)/2);var r=this._timeline[e],o=this._timeline[e+1];if(Ul(r[s],i)){for(let t=e;t<this._timeline.length&&Ul(this._timeline[t][s],i);t++)e=t;return e}if(Bl(r[s],i)&&Vl(o[s],i))return e;Vl(r[s],i)?n=e:t=e+1}}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){t=this._search(t);return-1!==t&&this._iterate(e,0,t),this}forEachAfter(t,e){t=this._search(t);return this._iterate(e,t+1),this}forEachBetween(t,e,n){let i=this._search(t),s=this._search(e);return-1!==i&&-1!==s?(this._timeline[i].time!==t&&(i+=1),this._timeline[s].time===e&&--s,this._iterate(n,i,s)):-1===i&&this._iterate(n,0,s),this}forEachFrom(t,e){let n=this._search(t);for(;0<=n&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(n,i){var s=this._search(n);if(-1!==s&&Ul(this._timeline[s].time,n)){let e=s;for(let t=s;0<=t&&Ul(this._timeline[t].time,n);t--)e=t;this._iterate(t=>{i(t)},e,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}let Hl=[];function Wl(t){Hl.push(t)}let $l=[];function Yl(t){$l.push(t)}class Xl extends jl{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach(t=>{Sl(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)}),this}once(e,n){let i=(...t)=>{n(...t),this.off(e,i)};return this.on(e,i),this}off(n,i){return n.split(/\W+/).forEach(t=>{if(Sl(this._events)&&(this._events={}),this._events.hasOwnProperty(n))if(Sl(i))this._events[n]=[];else{let e=this._events[n];for(let t=e.length-1;0<=t;t--)e[t]===i&&e.splice(t,1)}}),this}emit(t,...n){if(this._events&&this._events.hasOwnProperty(t)){var i=this._events[t].slice(0);for(let t=0,e=i.length;t<e;t++)i[t].apply(this,n)}return this}static mixin(n){["on","once","off","emit"].forEach(t=>{var e=Object.getOwnPropertyDescriptor(Xl.prototype,t);Object.defineProperty(n.prototype,t,e)})}dispose(){return super.dispose(),this._events=void 0,this}}class Zl extends Xl{constructor(){super(...arguments),this.isOffline=!1}}class Jl extends Zl{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Ql,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;var t,e=p(Jl.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=(t={latencyHint:e.latencyHint},new Rc(t)),this._ticker=new Nl(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var e;return this._initialized||(e=this,Hl.forEach(t=>t(e)),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return o(Dl(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaStreamDestination(){return o(Dl(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){o(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){o(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){o(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){o(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return n=this.rawContext,t=t,e=e,o(c(al),"This node only works in a secure context (https or localhost)"),new al(n,t,e);var n}addAudioWorkletModule(t,e){return h(this,void 0,void 0,function*(){o(c(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)})}workletsAreReady(){return h(this,void 0,void 0,function*(){let e=[];this._workletModules.forEach(t=>e.push(t)),yield Promise.all(e)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(kl(this._latencyHint=t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return"suspended"===this._context.state&&Dl(this._context)?this._context.resume():Promise.resolve()}close(){return h(this,void 0,void 0,function*(){var e;Dl(this._context)&&(yield this._context.close()),this._initialized&&(e=this,$l.forEach(t=>t(e)))})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);var t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let t=0;t<n.length;t++)n[t]=e;var i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this}_timeoutLoop(){var t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;var n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(e,n){let i=++this._timeoutIds,s=()=>{var t=this.now();this._timeouts.add({callback:()=>{e(),s()},id:i,time:t+n})};return s(),i}}function m(e,t){l(t)?t.forEach(t=>m(e,t)):Object.defineProperty(e,t,{enumerable:!0,writable:!1})}function Kl(e,t){l(t)?t.forEach(t=>Kl(e,t)):Object.defineProperty(e,t,{writable:!0})}let y=()=>{};class b extends jl{constructor(){super(),this.name="ToneAudioBuffer",this.onload=y;var t=p(b.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&Rl(t.url)||t.url instanceof b?this.set(t.url):kl(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:y,onload:y,reverse:!1}}get sampleRate(){return(this._buffer||S()).sampleRate}set(t){return t instanceof b?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return h(this,void 0,void 0,function*(){var e=b.load(t).then(t=>{this.set(t),this.onload(this)});b.downloads.push(e);try{yield e}finally{let t=b.downloads.indexOf(e);b.downloads.splice(t,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){var e=l(t)&&0<t[0].length,n=e?t.length:1,i=(e?t[0]:t).length,s=S(),r=s.createBuffer(n,i,s.sampleRate),o=e||1!==n?t:[t];for(let t=0;t<n;t++)r.copyToChannel(o[t],t);return this._buffer=r,this}toMono(t){if(xl(t))this.fromArray(this.toArray(t));else{let e=new Float32Array(this.length),n=this.numberOfChannels;for(let t=0;t<n;t++){var i=this.toArray(t);for(let t=0;t<i.length;t++)e[t]+=i[t]}e=e.map(t=>t/n),this.fromArray(e)}return this}toArray(t){if(xl(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{let e=[];for(let t=0;t<this.numberOfChannels;t++)e[t]=this.getChannelData(t);return e}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){var n=Math.floor(t*this.sampleRate),i=Math.floor(e*this.sampleRate),t=(o(n<i,"The start time must be less than the end time"),i-n),s=S().createBuffer(this.numberOfChannels,t,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)s.copyToChannel(this.getChannelData(t).subarray(n,i),t);return new b(s)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return 0<this.length}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new b).fromArray(t)}static fromUrl(t){return h(this,void 0,void 0,function*(){return yield(new b).load(t)})}static load(i){return h(this,void 0,void 0,function*(){var t=i.match(/\[(.+\|?)+\]$/);if(t){let e=t[1].split("|"),n=e[0];for(let t of e)if(b.supportsType(t)){n=t;break}i=i.replace(t[0],n)}let e=""===b.baseUrl||b.baseUrl.endsWith("/")?b.baseUrl:b.baseUrl+"/",n=yield fetch(e+i);if(n.ok)return t=yield n.arrayBuffer(),yield S().decodeAudioData(t);throw new Error("could not load url: "+i)})}static supportsType(t){t=t.split("."),t=t[t.length-1];return""!==document.createElement("audio").canPlayType("audio/"+t)}static loaded(){return h(this,void 0,void 0,function*(){for(yield Promise.resolve();b.downloads.length;)yield b.downloads[0]})}}b.baseUrl="",b.downloads=[];class tp extends Jl{constructor(){var t,e,n;super({clockSource:"offline",context:ql(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new hl(t,e,n)),lookAhead:0,updateInterval:ql(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=ql(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(n){return h(this,void 0,void 0,function*(){let t=0;for(;0<=this._duration-this._currentTime;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;var e=Math.floor(this.sampleRate/128);n&&t%e==0&&(yield new Promise(t=>setTimeout(t,1)))}})}render(e=!0){return h(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);var t=yield this._context.startRendering();return new b(t)})}close(){return Promise.resolve()}}let ep=new class extends Zl{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return h(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}},np=ep;function S(){return np===ep&&Ml&&ip(new Jl),np}function ip(t){np=Dl(t)?new Jl(t):ql(t)?new tp(t):t}function sp(){return np.resume()}if(Pl&&!Pl.TONE_SILENCE_LOGGING){let t="v",e=` * Tone.js ${t="dev"===j?"":t}${j} * `;console.log("%c"+e,"background: #000; color: #fff")}function rp(t){return Math.pow(10,t/20)}function op(t){return Math.log(t)/Math.LN10*20}function ap(t){return Math.pow(2,t/12)}let up=440;function cp(t){return Math.round(hp(t))}function hp(t){return 69+12*Math.log2(t/up)}function lp(t){return up*Math.pow(2,(t-69)/12)}class pp extends jl{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{t=parseInt(t,10),e="."===e?1.5:1;return 1===t?this._beatsToUnits(this._getTimeSignature())*e:this._beatsToUnits(4/t)*e},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{t=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(t)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let i=0;return t&&"0"!==t&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(i+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(i+=this._beatsToUnits(parseFloat(n)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof pp&&this.fromType(this._val),Sl(this._val))return this._noArg();if(kl(this._val)&&Sl(this._units)){for(var t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Tl(this._val)){let t=0;for(var e in this._val){var n;c(this._val[e])&&(n=this._val[e],t+=new this.constructor(this.context,e).valueOf()*n)}return t}var i,s;return c(this._units)?(i=this._expressions[this._units],(s=this._val.toString().trim().match(i.regexp))?i.method.apply(this,s.slice(1)):i.method.call(this,this._val)):kl(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class dp extends pp{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{t=new dp(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(t,e=1){var t=new this.constructor(this.context,t).valueOf(),n=this.valueOf();return n+(Math.round(n/t)*t-n)*e}toNotation(){let n=this.toSeconds(),i=["1m"];for(let e=1;e<9;e++){let t=Math.pow(2,e);i.push(t+"n."),i.push(t+"n"),i.push(t+"t")}i.push("0");let s=i[0],r=new dp(this.context,i[0]).toSeconds();return i.forEach(t=>{var e=new dp(this.context,t).toSeconds();Math.abs(e-n)<Math.abs(r-n)&&(s=t,r=e)}),s}toBarsBeatsSixteenths(){var t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));t=Math.floor(e/this._getTimeSignature());let n=e%1*4;e=Math.floor(e)%this._getTimeSignature();var i=n.toString();return 3<i.length&&(n=parseFloat(parseFloat(i).toFixed(3))),[t,e,n].join(":")}toTicks(){var t=this._beatsToUnits(1),t=this.valueOf()/t;return Math.round(t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return cp(this.toFrequency())}_now(){return this.context.now()}}function fp(t,e){return new dp(S(),t,e)}class mp extends dp{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return up}static set A4(t){t=t,up=t}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:mp.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){t=gp[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?t:mp.mtof(t)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let i=1;return t&&"0"!==t&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(i*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(i*=this._beatsToUnits(parseFloat(n)/4)),i}}})}transpose(t){return new mp(this.context,this.valueOf()*ap(t))}harmonize(t){return t.map(t=>this.transpose(t))}toMidi(){return cp(this.valueOf())}toNote(){var t=this.toFrequency(),t=Math.log2(t/mp.A4);let e=Math.round(12*t)+57;t=Math.floor(e/12);return t<0&&(e+=-12*t),_p[e%12]+t.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){var t=this._beatsToUnits(1),t=this.valueOf()/t;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return lp(t)}static ftom(t){return cp(t)}}let gp={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},_p=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function yp(t,e){return new mp(S(),t,e)}class w extends dp{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function vp(t,e){return new w(S(),t,e)}class x extends jl{constructor(){super();var t=p(x.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:S()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new dp(this.context,t).toSeconds()}toFrequency(t){return new mp(this.context,t).toFrequency()}toTicks(t){return new w(this.context,t).toTicks()}_getPartialProperties(e){let n=this.get();return Object.keys(n).forEach(t=>{Sl(e[t])&&delete n[t]}),n}get(){let n=this.constructor.getDefaults();return Object.keys(n).forEach(t=>{var e;Reflect.has(this,t)&&(c(e=this[t])&&c(e.value)&&c(e.setValueAtTime)?n[t]=e.value:e instanceof x?n[t]=e._getPartialProperties(n[t]):l(e)||xl(e)||kl(e)||Al(e)?n[t]=e:delete n[t])}),n}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&c(this[t])&&(this[t]&&c(this[t].value)&&c(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof x?this[t].set(e[t]):this[t]=e[t])}),this}}class bp extends Ql{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){t=this.get(t);return null!==t?t.state:this._initial}setStateAtTime(t,e,n){return r(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(n,t){for(let e=this._search(t);0<=e;e--){let t=this._timeline[e];if(t.state===n)return t}}getNextState(n,t){let i=this._search(t);if(-1!==i)for(let e=i;e<this._timeline.length;e++){let t=this._timeline[e];if(t.state===n)return t}}}class T extends x{constructor(){super(p(T.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;var t=p(T.getDefaults(),arguments,["param","units","convert"]);for(o(c(t.param)&&(Il(t.param)||t.param instanceof T),"param must be an AudioParam");!Il(t.param);)t.param=t.param._param;this._swappable=!!c(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Ql(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,c(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(x.getDefaults(),{convert:!0,units:"number"})}get value(){var t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return c(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return c(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return c(this.maxValue)&&c(this.minValue)&&r(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?rp(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&"decibels"===this.units?op(t):t}setValueAtTime(t,e){var n=this.toSeconds(e),i=this._fromType(t);return o(isFinite(i)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, `+JSON.stringify(e)),this._assertRange(i),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,n),this}getValueAtTime(t){let n=Math.max(this.toSeconds(t),0),i=this._events.getAfter(n),s=this._events.get(n),r=this._initialValue;if(null===s)r=this._initialValue;else if("setTargetAtTime"!==s.type||null!==i&&"setValueAtTime"!==i.type)if(null===i)r=s.value;else if("linearRampToValueAtTime"===i.type||"exponentialRampToValueAtTime"===i.type){let e=s.value;if("setTargetAtTime"===s.type){let t=this._events.getBefore(s.time);e=null===t?this._initialValue:t.value}r="linearRampToValueAtTime"===i.type?this._linearInterpolate(s.time,e,i.time,i.value,n):this._exponentialInterpolate(s.time,e,i.time,i.value,n)}else r=s.value;else{let t=this._events.getBefore(s.time);var e=null===t?this._initialValue:t.value;"setTargetAtTime"===s.type&&(r=this._exponentialApproach(s.time,e,s.value,s.constant,n))}return this._toType(r)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){var n=this._fromType(t),i=this.toSeconds(e);return o(isFinite(n)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, `+JSON.stringify(e)),this._assertRange(n),this._events.add({time:i,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,i),this._param.linearRampToValueAtTime(n,i),this}exponentialRampToValueAtTime(t,e){var n=this._fromType(t),n=Math.max(this._minOutput,n),i=(this._assertRange(n),this.toSeconds(e));return o(isFinite(n)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, `+JSON.stringify(e)),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,i),this._param.exponentialRampToValueAtTime(n,i),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);var i=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,i),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){var i=this._fromType(t),s=(o(isFinite(n)&&0<n,"timeConstant must be a number greater than 0"),this.toSeconds(e));return this._assertRange(i),o(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, `+JSON.stringify(e)),this._events.add({constant:n,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",t,s,n),this._param.setTargetAtTime(i,s,n),this}setValueCurveAtTime(n,i,t,s=1){t=this.toSeconds(t),i=this.toSeconds(i);let e=this._fromType(n[0])*s;this.setValueAtTime(this._toType(e),i);var r=t/(n.length-1);for(let e=1;e<n.length;e++){let t=this._fromType(n[e])*s;this.linearRampToValueAtTime(this._toType(t),i+e*r)}return this}cancelScheduledValues(t){var e=this.toSeconds(t);return o(isFinite(e),"Invalid argument to cancelScheduledValues: "+JSON.stringify(t)),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){var e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e)),t=(o(isFinite(e),"Invalid argument to cancelAndHoldAtTime: "+JSON.stringify(t)),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n),this._events.get(e)),i=this._events.getAfter(e);return t&&Ul(t.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(e){var n=this.context.currentTime,t=(e.setValueAtTime(this.getValueAtTime(n),n),this._events.get(n));if(t&&"setTargetAtTime"===t.type){var t=this._events.getAfter(t.time),i=t?t.time:n+2,s=(i-n)/10;for(let t=n;t<i;t+=s)e.linearRampToValueAtTime(this.getValueAtTime(t),t)}return this._events.forEachAfter(this.context.currentTime,t=>{"cancelScheduledValues"===t.type?e.cancelScheduledValues(t.time):"setTargetAtTime"===t.type?e.setTargetAtTime(t.value,t.time,t.constant):e[t.type](t.value,t.time)}),this}setParam(t){o(this._swappable,"The Param must be assigned as 'swappable' in the constructor");var e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,i,s){return n+(e-n)*Math.exp(-(s-t)/i)}_linearInterpolate(t,e,n,i,s){return e+(s-t)/(n-t)*(i-e)}_exponentialInterpolate(t,e,n,i,s){return e*Math.pow(i/e,(s-t)/(n-t))}}class A extends x{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return c(this.input)?Il(this.input)||this.input instanceof T?1:this.input.numberOfInputs:0}get numberOfOutputs(){return c(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return c(t)&&(t instanceof A||El(t))}_getInternalNodes(){var t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(e){this._getInternalNodes().forEach(t=>{t.channelCount=e.channelCount,t.channelCountMode=e.channelCountMode,t.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){var t=this._getInternalNodes(),t=(o(0<t.length,"ToneAudioNode does not have any internal nodes"),t[0]);return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){var e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){var e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){var e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return wp(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return bl("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return xp(this,t,e,n),this}chain(...t){return Sp(this,...t),this}fan(...t){return t.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),c(this.input)&&(this.input instanceof A?this.input.dispose():El(this.input)&&this.input.disconnect()),c(this.output)&&(this.output instanceof A?this.output.dispose():El(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Sp(...t){var e=t.shift();t.reduce((t,e)=>(t instanceof A?t.connect(e):El(t)&&wp(t,e),e),e)}function wp(t,e,n=0,i=0){for(o(c(t),"Cannot connect from undefined node"),o(c(e),"Cannot connect to undefined node"),(e instanceof A||El(e))&&o(0<e.numberOfInputs,"Cannot connect to node with no inputs"),o(0<t.numberOfOutputs,"Cannot connect from node with no outputs");e instanceof A||e instanceof T;)c(e.input)&&(e=e.input);for(;t instanceof A;)c(t.output)&&(t=t.output);Il(e)?t.connect(e,n):t.connect(e,n,i)}function xp(t,e,n=0,i=0){if(c(e))for(;e instanceof A;)e=e.input;for(;!El(t);)c(t.output)&&(t=t.output);Il(e)?t.disconnect(e,n):El(e)?t.disconnect(e,n,i):t.disconnect()}class k extends A{constructor(){super(p(k.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;var t=p(k.getDefaults(),arguments,["gain","units"]);this.gain=new T({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),m(this,"gain")}static getDefaults(){return Object.assign(A.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Tp extends A{constructor(t){super(t),this.onended=y,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new k({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){t=this.toSeconds(t);return-1!==this._startTime&&t>=this._startTime&&(-1===this._stopTime||t<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(A.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:y})}_startGain(t,e=1){o(-1===this._startTime,"Source cannot be started more than once");var n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),0<n?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){o(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();let e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),0<e?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{var t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){var t;this.onended===y||(this.onended(this),this.onended=y,this.context.isOffline)||(t=()=>this.dispose(),void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3))}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),o(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Ap extends Tp{constructor(){super(p(Ap.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();var t=p(Ap.getDefaults(),arguments,["offset"]);wp(this._source,this._gainNode),this.offset=new T({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Tp.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){t=this.toSeconds(t);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class O extends A{constructor(){super(p(O.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;var t=p(O.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Ap({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(A.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return kp(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,i){return this._param.setValueCurveAtTime(t,e,n,i),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function kp(t,e,n,i){(e instanceof T||Il(e)||e instanceof O&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof O)&&(e.overridden=!0),wp(t,e,n,i)}class Op extends T{constructor(){super(p(Op.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Ql(1/0),this._multiplier=1;var t=p(Op.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(T.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,i,s){i=this.toSeconds(i),this.setRampPoint(i);let r=this._fromType(t),o=this._events.get(i),e=Math.round(Math.max(1/s,1));for(let n=0;n<=e;n++){let t=s*n+i,e=this._exponentialApproach(o.time,o.value,r,s,t);this.linearRampToValueAtTime(this._toType(e),t)}return this}setValueAtTime(t,e){var n=this.toSeconds(e),t=(super.setValueAtTime(t,e),this._events.get(n)),e=this._events.previousEvent(t),e=this._getTicksUntilEvent(e,n);return t.ticks=Math.max(e,0),this}linearRampToValueAtTime(t,e){var n=this.toSeconds(e),t=(super.linearRampToValueAtTime(t,e),this._events.get(n)),e=this._events.previousEvent(t),e=this._getTicksUntilEvent(e,n);return t.ticks=Math.max(e,0),this}exponentialRampToValueAtTime(t,i){i=this.toSeconds(i);let s=this._fromType(t),r=this._events.get(i),e=Math.round(Math.max(10*(i-r.time),1)),o=(i-r.time)/e;for(let n=0;n<=e;n++){let t=o*n+r.time,e=this._exponentialInterpolate(r.time,r.value,i,s,t);this.linearRampToValueAtTime(this._toType(e),t)}return this}_getTicksUntilEvent(e,t){if(null===e)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Sl(e.ticks)){let t=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(t,e.time)}var n=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));var s=this._events.get(t);return s&&s.time===t&&"setValueAtTime"===s.type&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+i)+e.ticks}getTicksAtTime(t){var t=this.toSeconds(t),e=this._events.get(t);return Math.max(this._getTicksUntilEvent(e,t),0)}getDurationOfTicks(t,e){var n=this.toSeconds(e),e=this.getTicksAtTime(e);return this.getTimeOfTick(e+t)-n}getTimeOfTick(t){var e,n,i,s=this._events.get(t,"ticks"),r=this._events.getAfter(t,"ticks");return s&&s.ticks===t?s.time:s&&r&&"linearRampToValueAtTime"===r.type&&s.value!==r.value?(e=this._fromType(this.getValueAtTime(s.time)),r=(this._fromType(this.getValueAtTime(r.time))-e)/(r.time-s.time),(0<(i=(-e+(n=Math.sqrt(Math.pow(e,2)-2*r*(s.ticks-t))))/r)?i:(-e-n)/r)+s.time):s?0===s.value?1/0:s.time+(t-s.ticks)/s.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){var e=this.toSeconds(e),t=this.toSeconds(t),n=this.getTicksAtTime(e);return this.getTicksAtTime(e+t)-n}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){var e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class Pp extends O{constructor(){super(p(Pp.getDefaults(),arguments,["value"])),this.name="TickSignal";var t=p(Pp.getDefaults(),arguments,["value"]);this.input=this._param=new Op({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(O.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class Mp extends x{constructor(){super(p(Mp.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new bp,this._tickOffset=new Ql;var t=p(Mp.getDefaults(),arguments,["frequency"]);this.frequency=new Pp({context:this.context,units:t.units,value:t.frequency}),m(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},x.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){t=this.toSeconds(t);return"started"!==this._state.getValueAtTime(t)&&(this._state.setStateAtTime("started",t),c(e))&&this.setTicksAtTime(e,t),this}stop(t){var e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){let t=this._state.get(e);t&&0<t.time&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){t=this.toSeconds(t);return"started"===this._state.getValueAtTime(t)&&this._state.setStateAtTime("paused",t),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){var t=this.toSeconds(t),e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let i=e,s=0;return this._state.forEachBetween(e.time,t+this.sampleTime,t=>{let e=i.time;var n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(s=n.ticks,e=n.time),"started"===i.state&&"started"!==t.state&&(s+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),i=t}),this._state.remove(n),s}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){var e=this.now(),t=this.frequency.timeToTicks(t,e);this.setTicksAtTime(t,e)}getSecondsAtTime(t){t=this.toSeconds(t);var e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let i=e,s=0;return this._state.forEachBetween(e.time,t+this.sampleTime,t=>{let e=i.time;var n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(s=n.seconds,e=n.time),"started"===i.state&&"started"!==t.state&&(s+=t.time-e),i=t}),this._state.remove(n),s}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){var n=this._tickOffset.get(e),e=this._state.get(e),e=Math.max(n.time,e.time),e=this.frequency.getTicksAtTime(e)+t-n.ticks;return this.frequency.getTimeOfTick(e)}forEachTickBetween(e,n,i){let s=this._state.get(e),r=(this._state.forEachBetween(e,n,t=>{s&&"started"===s.state&&"started"!==t.state&&this.forEachTickBetween(Math.max(s.time,e),t.time-this.sampleTime,i),s=t}),null);if(s&&"started"===s.state){var o=Math.max(s.time,e),o=this.frequency.getTicksAtTime(o),a=o-this.frequency.getTicksAtTime(s.time),a=Ul(a=Math.ceil(a)-a,1)?0:a;let t=this.frequency.getTimeOfTick(o+a);for(;t<n;){try{i(t,Math.round(this.getTicksAtTime(t)))}catch(e){r=e;break}t+=this.frequency.getDurationOfTicks(1,t)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Cp extends x{constructor(){super(p(Cp.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=y,this._lastUpdate=0,this._state=new bp("stopped"),this._boundLoop=this._loop.bind(this);var t=p(Cp.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new Mp({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,m(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(x.getDefaults(),{callback:y,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){gl(this.context);t=this.toSeconds(t);return this.log("start",t),"started"!==this._state.getValueAtTime(t)&&(this._state.setStateAtTime("started",t),this._tickSource.start(t,e),t<this._lastUpdate)&&this.emit("start",t,e),this}stop(t){t=this.toSeconds(t);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(t){t=this.toSeconds(t);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate)&&this.emit("pause",t),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){var e=this.toSeconds(e),n=this.getTicksAtTime(e);return this._tickSource.getTimeOfTick(n+t,e)}_loop(){var t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,t=>{switch(t.state){case"started":var e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}}),this._tickSource.forEachTickBetween(t,e,(t,e)=>{this.callback(t,e)}))}getStateAtTime(t){t=this.toSeconds(t);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Xl.mixin(Cp);class Np extends A{constructor(){super(p(Np.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";var t=p(Np.getDefaults(),arguments,["delayTime","maxDelay"]),e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new T({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),m(this,"delayTime")}static getDefaults(){return Object.assign(A.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}function Ip(n,i,s=2,r=S().sampleRate){return h(this,void 0,void 0,function*(){var t=S(),e=new tp(s,i,r),e=(ip(e),yield n(e),e.render()),t=(ip(t),yield e);return new b(t)})}class Ep extends jl{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;let n=p(Ep.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=n.baseUrl,Object.keys(n.urls).forEach(t=>{this._loadingCount++;var e=n.urls[t];this.add(t,e,this._bufferLoaded.bind(this,n.onload),n.onerror)})}static getDefaults(){return{baseUrl:"",onerror:y,onload:y,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return o(this.has(t),"ToneAudioBuffers has no buffer named: "+t),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every(([,t])=>t.loaded)}add(t,e,n=y,i=y){return kl(e)?this._buffers.set(t.toString(),new b(this.baseUrl+e,n,i)):this._buffers.set(t.toString(),new b(e,n,i)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}}class qp extends mp{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return cp(super._frequencyToUnits(t))}_ticksToUnits(t){return cp(super._ticksToUnits(t))}_beatsToUnits(t){return cp(super._beatsToUnits(t))}_secondsToUnits(t){return cp(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return lp(this.toMidi())}transpose(t){return new qp(this.context,this.toMidi()+t)}}function Dp(t,e){return new qp(S(),t,e)}class P extends w{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function Rp(t,e){return new P(S(),t,e)}class zp extends x{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Ql,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){for(var t=this.context.currentTime;this._events.length&&this._events.peek().time-this.anticipation<=t;){var e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}0<this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Wl(t=>{t.draw=new zp({context:t})}),Yl(t=>{t.draw.dispose()});class Fp extends jl{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){o(c(t.time),"Events must have a time property"),o(c(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new jp(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){var e,n=[];this._root.search(t.time,n);for(e of n)if(e.event===t){this._removeNode(e),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,t=>this.remove(t)),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(n){if(null===n.left&&null===n.right)this._replaceNodeInParent(n,null);else if(null===n.right)this._replaceNodeInParent(n,n.left);else if(null===n.left)this._replaceNodeInParent(n,n.right);else{let t,e=null;if(0<n.getBalance())if(null===n.left.right)(t=n.left).right=n.right,e=t;else{for(t=n.left.right;null!==t.right;)t=t.right;t.parent&&(t.parent.right=t.left,e=t.parent,t.left=n.left,t.right=n.right)}else if(null===n.right.left)(t=n.right).left=n.left,e=t;else{for(t=n.right.left;null!==t.left;)t=t.left;t.parent&&(t.parent.left=t.right,e=t.parent,t.left=n.left,t.right=n.right)}null!==n.parent?n.isLeftChild()?n.parent.left=t:n.parent.right=t:this._setRoot(t),e&&this._rebalance(e)}n.dispose()}_rotateLeft(t){var e=t.parent,n=t.isLeftChild(),i=t.right;i&&(t.right=i.left,i.left=t),null!==e?n?e.left=i:e.right=i:this._setRoot(i)}_rotateRight(t){var e=t.parent,n=t.isLeftChild(),i=t.left;i&&(t.left=i.right,i.right=t),null!==e?n?e.left=i:e.right=i:this._setRoot(i)}_rebalance(t){var e=t.getBalance();1<e&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(0<t.right.getBalance()?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){var n=[];if(this._root.search(t,n),0<n.length){let e=n[0];for(let t=1;t<n.length;t++)n[t].low>e.low&&(e=n[t]);return e.event}}return null}forEach(n){if(null!==this._root){let e=[];this._root.traverse(t=>e.push(t)),e.forEach(t=>{t.event&&n(t.event)})}return this}forEachAtTime(t,e){return null!==this._root&&(this._root.search(t,t=[]),t.forEach(t=>{t.event&&e(t.event)})),this}forEachFrom(t,e){return null!==this._root&&(this._root.searchAfter(t,t=[]),t.forEach(t=>{t.event&&e(t.event)})),this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse(t=>t.dispose()),this._root=null,this}}class jp{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t)||null!==this.right&&this.right.search(t,e)}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left)&&this.left.searchAfter(t,e),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){null!==(this._left=t)&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){null!==(this._right=t)&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Vp extends A{constructor(){super(p(Vp.getDefaults(),arguments,["volume"])),this.name="Volume";var t=p(Vp.getDefaults(),arguments,["volume"]);this.input=this.output=new k({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,m(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(A.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Lp extends A{constructor(){super(p(Lp.getDefaults(),arguments)),this.name="Destination",this.input=new Vp({context:this.context}),this.output=new k({context:this.context}),this.volume=this.input.volume;var t=p(Lp.getDefaults(),arguments);Sp(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(A.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Sp(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Wl(t=>{t.destination=new Lp({context:t})}),Yl(t=>{t.destination.dispose()});class Bp extends jl{constructor(t){super(),this.name="TimelineValue",this._timeline=new Ql({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){t=this._timeline.get(t);return t?t.value:this._initialValue}}class Up{constructor(t,e){this.id=Up._eventId++;e=Object.assign(Up.getDefaults(),e);this.transport=t,this.callback=e.callback,this._once=e.once,this.time=e.time}static getDefaults(){return{callback:y,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once)&&this.transport.clear(this.id)}dispose(){return this.callback=void 0,this}}Up._eventId=0;class Gp extends Up{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);e=Object.assign(Gp.getDefaults(),e);this.duration=new P(t.context,e.duration).valueOf(),this._interval=new P(t.context,e.interval).valueOf(),this._nextTick=e.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Up.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){t=this.transport.getTicksAtTime(t);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new P(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;t=this.transport.getTicksAtTime(t);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new P(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new P(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Qp extends x{constructor(){super(p(Qp.getDefaults(),arguments)),this.name="Transport",this._loop=new Bp(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Ql,this._repeatedEvents=new Fp,this._syncedSignals=[],this._swingAmount=0;var t=p(Qp.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new Cp({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),m(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(x.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){var n;0<this._swingAmount&&t%this._ppq!=0&&t%(2*this._swingTicks)!=0&&(n=t%(2*this._swingTicks)/(2*this._swingTicks),n=Math.sin(n*Math.PI)*this._swingAmount,e+=new P(this.context,2*this._swingTicks/3).toSeconds()*n),this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._timeline.forEachAtTime(t,t=>t.invoke(e))}schedule(t,e){t=new Up(this,{callback:t,time:new w(this.context,e).toTicks()});return this._addEvent(t,this._timeline)}scheduleRepeat(t,e,n,i=1/0){t=new Gp(this,{callback:t,duration:new dp(this.context,i).toTicks(),interval:new dp(this.context,e).toTicks(),time:new w(this.context,n).toTicks()});return this._addEvent(t,this._repeatedEvents)}scheduleOnce(t,e){t=new Up(this,{callback:t,once:!0,time:new w(this.context,e).toTicks()});return this._addEvent(t,this._timeline)}clear(t){var e;return this._scheduledEvents.hasOwnProperty(t)&&((e=this._scheduledEvents[t.toString()]).timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]),this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){t=this.toTicks(t);return this._timeline.forEachFrom(t,t=>this.clear(t.id)),this._repeatedEvents.forEachFrom(t,t=>this.clear(t.id)),this}_bindClockEvents(){this._clock.on("start",(t,e)=>{e=new P(this.context,e).toSeconds(),this.emit("start",t,e)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return c(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){l(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new dp(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new dp(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new P(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){var t=this.now(),t=this._clock.getTicksAtTime(t);return new P(this.context,t).toBarsBeatsSixteenths()}set position(t){t=this.toTicks(t);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(t){var e=this.now(),t=this._clock.frequency.timeToTicks(t,e);this.ticks=t}get progress(){var t;return this.loop?(t=this.now(),(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)):0}get ticks(){return this._clock.ticks}set ticks(t){var e,n;this._clock.ticks!==t&&(e=this.now(),"started"===this.state?(n=this._clock.getTicksAtTime(e),n=this._clock.getTimeOfTick(Math.ceil(n)),this.emit("stop",n),this._clock.setTicksAtTime(t,n),this.emit("start",n,this._clock.getSecondsAtTime(n))):this._clock.setTicksAtTime(t,e))}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){var e;return t=this.toTicks(t),"started"!==this.state?0:(e=this.now(),t=t-this.getTicksAtTime(e)%t,this._clock.nextTickTime(t,e))}syncSignal(e,n){if(!n){let t=this.now();var i;n=0!==e.getValueAtTime(t)?(i=1/(60/this.bpm.getValueAtTime(t)/this.PPQ),e.getValueAtTime(t)/i):0}let t=new k(n);return this.bpm.connect(t),t.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:t,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;0<=t;t--){var n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Kl(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Xl.mixin(Qp),Wl(t=>{t.transport=new Qp({context:t})}),Yl(t=>{t.transport.dispose()});class M extends A{constructor(t){super(t),this.input=void 0,this._state=new bp("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=y,this._syncedStop=y,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Vp({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,m(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(A.getDefaults(),{mute:!1,onstop:y,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){var i=Sl(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t),i=this._clampToCurrentTime(i);if(this._synced||"started"!==this._state.getValueAtTime(i))if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){let t=this._state.get(i);t&&(t.offset=this.toSeconds(Fl(e,0)),t.duration=n?this.toSeconds(n):void 0);var s=this.context.transport.schedule(t=>{this._start(t,e,n)},i);this._scheduled.push(s),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else gl(this.context),this._start(i,e,n);else o(Vl(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,e,n);return this}stop(t){var e=Sl(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t),e=this._clampToCurrentTime(e);if("started"===this._state.getValueAtTime(e)||c(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){let t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,n)=>{if(0<n){var i=this._state.get(n);if(i&&"started"===i.state&&i.time!==n){n=n-this.toSeconds(i.time);let t;i.duration&&(t=this.toSeconds(i.duration)-n),this._start(e,this.toSeconds(i.offset)+n,t)}}},this._syncedStop=t=>{var e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=y,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Hp extends Tp{constructor(){super(p(Hp.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;var t=p(Hp.getDefaults(),arguments,["url","onload"]);wp(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new T({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new b(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Tp.getDefaults(),{url:new b,loop:!1,loopEnd:0,loopStart:0,onload:y,onerror:y,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,i=1){o(this.buffer.loaded,"buffer is either not set or not loaded");t=this.toSeconds(t);this._startGain(t,i),e=this.loop?Fl(e,this.loopStart):Fl(e,0);let s=Math.max(this.toSeconds(e),0);if(this.loop){let t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;Ul(s=Ll(s,t)?(s-e)%n+e:s,this.buffer.duration)&&(s=0)}return this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Bl(s,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(t,s)),c(n)&&(i=this.toSeconds(n),i=Math.max(i,0),this.stop(t+i)),this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Wp extends M{constructor(){super(p(Wp.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;var t=p(Wp.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(M.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(o(t in Yp,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,"started"===this.state)){let t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){var e=Yp[this._type];this._source=new Hp({url:e,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(e.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}let $p={brown:null,pink:null,white:null},Yp={get brown(){if(!$p.brown){var n=[];for(let t=0;t<2;t++){var i=new Float32Array(220500);n[t]=i;let e=0;for(let t=0;t<220500;t++){var s=2*Math.random()-1;i[t]=(e+.02*s)/1.02,e=i[t],i[t]*=3.5}}$p.brown=(new b).fromArray(n)}return $p.brown},get pink(){if(!$p.pink){var u=[];for(let t=0;t<2;t++){var c=new Float32Array(220500);let e,n,i,s,r,o,a;u[t]=c;for(let t=e=n=i=s=r=o=a=0;t<220500;t++){var h=2*Math.random()-1;e=.99886*e+.0555179*h,n=.99332*n+.0750759*h,i=.969*i+.153852*h,s=.8665*s+.3104856*h,r=.55*r+.5329522*h,o=-.7616*o-.016898*h,c[t]=e+n+i+s+r+o+a+.5362*h,c[t]*=.11,a=.115926*h}}$p.pink=(new b).fromArray(u)}return $p.pink},get white(){if(!$p.white){var e=[];for(let t=0;t<2;t++){var n=new Float32Array(220500);e[t]=n;for(let t=0;t<220500;t++)n[t]=2*Math.random()-1}$p.white=(new b).fromArray(e)}return $p.white}};class Xp extends A{constructor(){super(p(Xp.getDefaults(),arguments,["volume"])),this.name="UserMedia";var t=p(Xp.getDefaults(),arguments,["volume"]);this._volume=this.output=new Vp({context:this.context,volume:t.volume}),this.volume=this._volume.volume,m(this,"volume"),this.mute=t.mute}static getDefaults(){return Object.assign(A.getDefaults(),{mute:!1,volume:0})}open(n){return h(this,void 0,void 0,function*(){o(Xp.supported,"UserMedia is not supported"),"started"===this.state&&this.close();var e=yield Xp.enumerateDevices(),e=(xl(n)?this._device=e[n]:(this._device=e.find(t=>t.label===n||t.deviceId===n),!this._device&&0<e.length&&(this._device=e[0]),o(c(this._device),"No matching device "+n)),{audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}}),e=(this._device&&(e.audio.deviceId=this._device.deviceId),yield navigator.mediaDevices.getUserMedia(e));if(!this._stream){this._stream=e;let t=this.context.createMediaStreamSource(e);wp(t,this.output),this._mediaStream=t}return this})}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach(t=>{t.stop()}),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return h(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(t=>"audioinput"===t.kind)})}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return c(navigator.mediaDevices)&&c(navigator.mediaDevices.getUserMedia)}}function Zp(n,i){return h(this,void 0,void 0,function*(){var t=i/n.context.sampleRate,e=new tp(1,t,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/t,detune:0,context:e})).toDestination().start(0),(yield e.render()).getChannelData(0)})}class Jp extends Tp{constructor(){super(p(Jp.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];var t=p(Jp.getDefaults(),arguments,["frequency","type"]);wp(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new T({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new T({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),m(this,["frequency","detune"])}static getDefaults(){return Object.assign(Tp.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){t=this.toSeconds(t);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class N extends M{constructor(){super(p(N.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;var t=p(N.getDefaults(),arguments,["frequency","type"]);this.frequency=new O({context:this.context,units:"frequency",value:t.frequency}),m(this,"frequency"),this.detune=new O({context:this.context,units:"cents",value:t.detune}),m(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(M.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){var t=this.toSeconds(t),e=new Jp({context:this.context,onended:()=>this.onstop(this)});this._oscillator=e,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(t){t=this.toSeconds(t);this._oscillator&&this._oscillator.stop(t)}_restart(t){t=this.toSeconds(t);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){var t;return"custom"===this._type?N._periodicWaveCache.find(t=>{return t.phase===this._phase&&(t=t.partials,n=this._partials,t.length===n.length)&&t.every((t,e)=>n[e]===t);var n}):(t=N._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase),this._partialCount=t?t.partialCount:this._partialCount,t)}get type(){return this._type}set type(i){this._type=i;let t=-1!==["sine","square","sawtooth","triangle"].indexOf(i);if(0===this._phase&&t)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=i);else{let n=this._getCachedPeriodicWave();if(c(n)){let{partials:t,wave:e}=n;this._wave=e,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{let[t,e]=this._getRealImaginary(i,this._phase),n=this.context.createPeriodicWave(t,e);this._wave=n,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),N._periodicWaveCache.push({imag:e,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:t,type:this._type,wave:this._wave}),100<N._periodicWaveCache.length&&N._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){r(t,0);let e=this._type;var n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{let n=new Float32Array(t);this._partials.forEach((t,e)=>n[e]=t),this._partials=Array.from(n),this.type=this._type}}_getRealImaginary(i,s){let e=2048;var r=new Float32Array(e),o=new Float32Array(e);let a=1;if("custom"===i){if(a=this._partials.length+1,this._partialCount=this._partials.length,e=a,0===this._partials.length)return[r,o]}else{let t=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(i);t?(a=parseInt(t[2],10)+1,this._partialCount=parseInt(t[2],10),i=t[1],a=Math.max(a,2),e=a):this._partialCount=0,this._partials=[]}for(let n=1;n<e;++n){let t=2/(n*Math.PI),e;switch(i){case"sine":e=n<=a?1:0,this._partials[n-1]=e;break;case"square":e=1&n?2*t:0,this._partials[n-1]=e;break;case"sawtooth":e=t*(1&n?1:-1),this._partials[n-1]=e;break;case"triangle":e=1&n?t*t*2*(n-1>>1&1?-1:1):0,this._partials[n-1]=e;break;case"custom":e=this._partials[n-1];break;default:throw new TypeError("Oscillator: invalid type: "+i)}0!==e?(r[n]=-e*Math.sin(s*n),o[n]=e*Math.cos(s*n)):(r[n]=0,o[n]=0)}return[r,o]}_inverseFFT(e,n,i){let s=0;var r=e.length;for(let t=0;t<r;t++)s+=e[t]*Math.cos(t*i)+n[t]*Math.sin(t*i);return s}getInitialValue(){var[e,n]=this._getRealImaginary(this._type,0);let i=0;var s=2*Math.PI;for(let t=0;t<32;t++)i=Math.max(this._inverseFFT(e,n,t/32*s),i);return Gl(-this._inverseFFT(e,n,this._phase)/i,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return h(this,void 0,void 0,function*(){return Zp(this,t)})}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}N._periodicWaveCache=[];class Kp extends A{constructor(){super(Object.assign(p(Kp.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return kp(this,t,e,n),this}}class td extends Kp{constructor(){super(Object.assign(p(td.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;var t=p(td.getDefaults(),arguments,["mapping","length"]);l(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):wl(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(O.getDefaults(),{length:1024})}setMap(i,t=1024){var s=new Float32Array(t);for(let e=0,n=t;e<n;e++){let t=e/(n-1)*2-1;s[e]=i(t,e)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(e){o(["none","2x","4x"].some(t=>t.includes(e)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class ed extends Kp{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new td({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class I extends O{constructor(){super(Object.assign(p(I.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;var t=p(I.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new k({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(O.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class nd extends M{constructor(){super(p(nd.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new ed({context:this.context}),this._modulationNode=new k({context:this.context});var t=p(nd.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new N({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new N({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new I({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),m(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(N.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return h(this,void 0,void 0,function*(){return Zp(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class id extends M{constructor(){super(p(id.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new k({context:this.context,gain:0});var t=p(id.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new N({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new O({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new N({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new I({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new I({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),m(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(N.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return h(this,void 0,void 0,function*(){return Zp(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class sd extends M{constructor(){super(p(sd.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new k({context:this.context,gain:0}),this._thresh=new td({context:this.context,mapping:t=>t<=0?-1:1});var t=p(sd.getDefaults(),arguments,["frequency","width"]);this.width=new O({context:this.context,units:"audioRange",value:t.width}),this._triangle=new N({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),m(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(M.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return h(this,void 0,void 0,function*(){return Zp(this,t)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class rd extends M{constructor(){super(p(rd.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];var t=p(rd.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new O({context:this.context,units:"frequency",value:t.frequency}),this.detune=new O({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,m(this,["frequency","detune"])}static getDefaults(){return Object.assign(N.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(t){if(this._spread=t,1<this._oscillators.length){let n=-t/2,i=t/(this._oscillators.length-1);this._forEach((t,e)=>t.detune.value=n+i*e)}}get count(){return this._oscillators.length}set count(e){if(r(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){var n=new N({context:this.context,volume:-6-1.1*e,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:0===t?()=>this.onstop(this):y});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,"started"===this.state&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((t,e)=>t.phase=this._phase+e/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(t=1024){return h(this,void 0,void 0,function*(){return Zp(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}}class od extends M{constructor(){super(p(od.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new I({context:this.context,value:2});var t=p(od.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new sd({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new N({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),m(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(M.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return h(this,void 0,void 0,function*(){return Zp(this,t)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}let ad={am:nd,fat:rd,fm:id,oscillator:N,pulse:sd,pwm:od};class ud extends M{constructor(){super(p(ud.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";var t=p(ud.getDefaults(),arguments,["frequency","type"]);this.frequency=new O({context:this.context,units:"frequency",value:t.frequency}),this.detune=new O({context:this.context,units:"cents",value:t.detune}),m(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(N.getDefaults(),id.getDefaults(),nd.getDefaults(),rd.getDefaults(),sd.getDefaults(),od.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return(t=["am","fm","fat"].some(t=>this._sourceType===t)?this._sourceType:t)+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;var t=ad[t],e=this.now();if(this._oscillator){let t=this._oscillator;t.stop(e),this.context.setTimeout(()=>t.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(e)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof ad[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&xl(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&xl(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&kl(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return h(this,void 0,void 0,function*(){return Zp(this,t)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class cd extends O{constructor(){super(Object.assign(p(cd.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new k({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Sp(this._constantSource,this._sum)}static getDefaults(){return Object.assign(O.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class hd extends Kp{constructor(){super(Object.assign(p(hd.getDefaults(),arguments,["min","max"]))),this.name="Scale";var t=p(hd.getDefaults(),arguments,["min","max"]);this._mult=this.input=new I({context:this.context,value:t.max-t.min}),this._add=this.output=new cd({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Kp.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class ld extends Kp{constructor(){super(Object.assign(p(ld.getDefaults(),arguments))),this.name="Zero",this._gain=new k({context:this.context}),this.output=this._gain,this.input=void 0,wp(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),xp(this.context.getConstant(0),this._gain),this}}class pd extends A{constructor(){super(p(pd.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=T.prototype._fromType,this._toType=T.prototype._toType,this._is=T.prototype._is,this._clampValue=T.prototype._clampValue;var t=p(pd.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new N({context:this.context,frequency:t.frequency,type:t.type}),this.frequency=this._oscillator.frequency,this._amplitudeGain=new k({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new O({context:this.context,units:"audioRange",value:0}),this._zeros=new ld({context:this.context}),this._a2g=new ed({context:this.context}),this._scaler=this.output=new hd({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._a2g,this._amplitudeGain,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),m(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(A.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,phase:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get units(){return this._units}set units(t){var e=this.min,n=this.max;this._units=t,this.min=e,this.max=n}get state(){return this._oscillator.state}connect(t,e,n){return(t instanceof T||t instanceof O)&&(this.convert=t.convert,this.units=t.units),kp(this,t,e,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function dd(n,i=1/0){let s=new WeakMap;return function(t,e){Reflect.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return s.get(this)},set:function(t){r(t,n,i),s.set(this,t)}})}}function fd(n,i=1/0){let s=new WeakMap;return function(t,e){Reflect.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return s.get(this)},set:function(t){r(this.toSeconds(t),n,i),s.set(this,t)}})}}class md extends M{constructor(){super(p(md.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;var t=p(md.getDefaults(),arguments,["url","onload"]);this._buffer=new b({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(M.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:y,onerror:y,playbackRate:1,reverse:!1})}load(t){return h(this,void 0,void 0,function*(){return yield this._buffer.load(t),this._onload(),this})}_onload(t=y){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?Fl(e,this._loopStart):Fl(e,0);let i=this.toSeconds(e);this._synced&&(i*=this._playbackRate);var e=n,n=(n=Fl(n,Math.max(this._buffer.duration-i,0)),this.toSeconds(n)),s=(n/=this._playbackRate,t=this.toSeconds(t),new Hp({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output));this._loop||this._synced||(this._state.cancel(t+n),this._state.setStateAtTime("stopped",t+n,{implicitEnd:!0})),this._activeSources.add(s),this._loop&&Sl(e)?s.start(t,i):s.start(t,i,n-this.toSeconds(this.fadeOut))}_stop(t){let e=this.toSeconds(t);this._activeSources.forEach(t=>t.stop(e))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(e,t){var n=this.toSeconds(t);if("started"===this._state.getValueAtTime(n)){let t=this.toSeconds(e);this._stop(n),this._start(n,t)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&r(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&r(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){let t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;let n=this.now(),t=this._state.getNextState("stopped",n);t&&t.implicitEnd&&(this._state.cancel(t.time),this._activeSources.forEach(t=>t.cancelStop())),this._activeSources.forEach(t=>{t.playbackRate.setValueAtTime(e,n)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Cl([fd(0)],md.prototype,"fadeIn",void 0),Cl([fd(0)],md.prototype,"fadeOut",void 0);class gd extends A{constructor(){super(p(gd.getDefaults(),arguments,["urls","onload"],"urls")),this.name="Players",this.input=void 0,this._players=new Map;var t=p(gd.getDefaults(),arguments,["urls","onload"],"urls");this._volume=this.output=new Vp({context:this.context,volume:t.volume}),this.volume=this._volume.volume,m(this,"volume"),this._buffers=new Ep({urls:t.urls,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.mute=t.mute,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(M.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:y,onerror:y,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._players.forEach(t=>{t.fadeIn=e})}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._players.forEach(t=>{t.fadeOut=e})}get state(){return Array.from(this._players).some(([,t])=>"started"===t.state)?"started":"stopped"}has(t){return this._buffers.has(t)}player(t){var e;return o(this.has(t),`No Player with the name ${t} exists on this object`),this._players.has(t)||(e=new md({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(t)}).connect(this.output),this._players.set(t,e)),this._players.get(t)}get loaded(){return this._buffers.loaded}add(t,e,n){return o(!this._buffers.has(t),"A buffer with that name already exists on this object"),this._buffers.add(t,e,n),this}stopAll(e){return this._players.forEach(t=>t.stop(e)),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach(t=>t.dispose()),this._buffers.dispose(),this}}class _d extends M{constructor(){super(p(_d.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];var t=p(_d.getDefaults(),arguments,["url","onload"]);this.buffer=new b({onload:t.onload,onerror:t.onerror,reverse:t.reverse,url:t.url}),this._clock=new Cp({context:this.context,callback:this._tick.bind(this),frequency:1/t.grainSize}),this._playbackRate=t.playbackRate,this._grainSize=t.grainSize,this._overlap=t.overlap,this.detune=t.detune,this.overlap=t.overlap,this.loop=t.loop,this.playbackRate=t.playbackRate,this.grainSize=t.grainSize,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.reverse=t.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(M.getDefaults(),{onload:y,onerror:y,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(t,e,n){e=Fl(e,0),e=this.toSeconds(e),t=this.toSeconds(t);var i=1/this._clock.frequency.getValueAtTime(t);this._clock.start(t,e/i),n&&this.stop(t+this.toSeconds(n))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}_stop(t){this._clock.stop(t)}_onstop(e){this._activeSources.forEach(t=>{t.fadeOut=0,t.stop(e)}),this.onstop(this)}_tick(n){var i=this._clock.getTicksAtTime(n),s=i*this._grainSize;if(this.log("offset",s),!this.loop&&s>this.buffer.duration)this.stop(n);else{let t=s<this._overlap?0:this._overlap,e=new Hp({context:this.context,url:this.buffer,fadeIn:t,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:ap(this.detune/100)}).connect(this.output);e.start(n,this._grainSize*i),e.stop(n+this._grainSize/this.playbackRate),this._activeSources.push(e),e.onended=()=>{var t=this._activeSources.indexOf(e);-1!==t&&this._activeSources.splice(t,1)}}}get playbackRate(){return this._playbackRate}set playbackRate(t){r(t,.001),this._playbackRate=t,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(t){this.buffer.loaded&&r(this.toSeconds(t),0,this.buffer.duration),this._loopStart=this.toSeconds(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this.buffer.loaded&&r(this.toSeconds(t),0,this.buffer.duration),this._loopEnd=this.toSeconds(t)}get reverse(){return this.buffer.reverse}set reverse(t){this.buffer.reverse=t}get grainSize(){return this._grainSize}set grainSize(t){this._grainSize=this.toSeconds(t),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(t){t=this.toSeconds(t);r(t,0),this._overlap=t}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach(t=>t.dispose()),this}}class yd extends Kp{constructor(){super(...arguments),this.name="Abs",this._abs=new td({context:this.context,mapping:t=>Math.abs(t)<.001?0:Math.abs(t)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class vd extends Kp{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new td({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class bd extends Kp{constructor(){super(...arguments),this.name="Negate",this._multiply=new I({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class Sd extends O{constructor(){super(Object.assign(p(Sd.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Subtract",this._sum=new k({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new bd({context:this.context}),this.subtrahend=this._param,Sp(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(O.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class wd extends Kp{constructor(){super(Object.assign(p(wd.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new td({context:this.context,length:127,mapping:t=>t<=0?0:1}),this._scale=this.input=new I({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class xd extends O{constructor(){super(Object.assign(p(xd.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;var t=p(xd.getDefaults(),arguments,["value"]);this._subtract=this.input=new Sd({context:this.context,value:t.value}),this._gtz=this.output=new wd({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,m(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(O.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class Td extends Kp{constructor(){super(Object.assign(p(Td.getDefaults(),arguments,["value"]))),this.name="Pow";var t=p(Td.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new td({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(Kp.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Ad extends hd{constructor(){super(Object.assign(p(Ad.getDefaults(),arguments,["min","max","exponent"]))),this.name="ScaleExp";var t=p(Ad.getDefaults(),arguments,["min","max","exponent"]);this.input=this._exp=new Td({context:this.context,value:t.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(hd.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(t){this._exp.value=t}dispose(){return super.dispose(),this._exp.dispose(),this}}class kd extends O{constructor(){super(p(O.getDefaults(),arguments,["value","units"])),this.name="SyncedSignal",this.override=!1;var t=p(O.getDefaults(),arguments,["value","units"]);this._lastVal=t.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new Ap({context:this.context,offset:t.value,units:t.units}).start(0),this.setValueAtTime(t.value,0)}_onTick(t){var e=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==e&&(this._lastVal=e,this._constantSource.offset.setValueAtTime(e,t))}_anchorValue(t){var e=super.getValueAtTime(this.context.transport.seconds);this._lastVal=e,this._constantSource.offset.cancelAndHoldAtTime(t),this._constantSource.offset.setValueAtTime(e,t)}getValueAtTime(t){t=new w(this.context,t).toSeconds();return super.getValueAtTime(t)}setValueAtTime(t,e){e=new w(this.context,e).toSeconds();return super.setValueAtTime(t,e),this}linearRampToValueAtTime(t,e){e=new w(this.context,e).toSeconds();return super.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){e=new w(this.context,e).toSeconds();return super.exponentialRampToValueAtTime(t,e),this}setTargetAtTime(t,e,n){e=new w(this.context,e).toSeconds();return super.setTargetAtTime(t,e,n),this}cancelScheduledValues(t){t=new w(this.context,t).toSeconds();return super.cancelScheduledValues(t),this}setValueCurveAtTime(t,e,n,i){e=new w(this.context,e).toSeconds();return n=this.toSeconds(n),super.setValueCurveAtTime(t,e,n,i),this}cancelAndHoldAtTime(t){t=new w(this.context,t).toSeconds();return super.cancelAndHoldAtTime(t),this}setRampPoint(t){t=new w(this.context,t).toSeconds();return super.setRampPoint(t),this}exponentialRampTo(t,e,n){n=new w(this.context,n).toSeconds();return super.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){n=new w(this.context,n).toSeconds();return super.linearRampTo(t,e,n),this}targetRampTo(t,e,n){n=new w(this.context,n).toSeconds();return super.targetRampTo(t,e,n),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class E extends A{constructor(){super(p(E.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new O({context:this.context,value:0}),this.output=this._sig,this.input=void 0;var t=p(E.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(A.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,n){if(kl(e))return e;{let t;for(t in Od)if(Od[t][n]===e)return t;return e}}_setCurve(t,e,n){if(kl(n)&&Reflect.has(Od,n)){var i=Od[n];Tl(i)?"_decayCurve"!==t&&(this[t]=i[e]):this[t]=i}else{if(!l(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(e){o(["linear","exponential"].some(t=>t===e),"Invalid envelope curve: "+e),this._decayCurve=e}triggerAttack(n,i=1){this.log("triggerAttack",n,i),n=this.toSeconds(n);let s=this.toSeconds(this.attack),r=this.toSeconds(this.decay),o=this.getValueAtTime(n);if((s=0<o?(1-o)/(1/s):s)<this.sampleTime)this._sig.cancelScheduledValues(n),this._sig.setValueAtTime(i,n);else if("linear"===this._attackCurve)this._sig.linearRampTo(i,s,n);else if("exponential"===this._attackCurve)this._sig.targetRampTo(i,s,n);else{this._sig.cancelAndHoldAtTime(n);let e=this._attackCurve;for(let t=1;t<e.length;t++)if(e[t-1]<=o&&o<=e[t]){(e=this._attackCurve.slice(t))[0]=o;break}this._sig.setValueCurveAtTime(e,n,s,i)}if(r&&this.sustain<1){let t=i*this.sustain,e=n+s;this.log("decay",e),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(t,r+e):this._sig.exponentialApproachValueAtTime(t,e,r)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);var e,n=this.getValueAtTime(t);return 0<n&&((e=this.toSeconds(this.release))<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,e,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,e,t):(o(l(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,e,n))),this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return kp(this,t,e,n),this}asArray(o=1024){return h(this,void 0,void 0,function*(){var t=o/this.context.sampleRate,e=new tp(1,t,this.context.sampleRate),n=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=n+this.toSeconds(this.release),s=.1*i,i=i+s,r=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/i,decay:t*this.toSeconds(this.decay)/i,release:t*this.toSeconds(this.release)/i,context:e}));return r._sig.toDestination(),r.triggerAttackRelease(t*(n+s)/i,0),(yield e.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Cl([fd(0)],E.prototype,"attack",void 0),Cl([fd(0)],E.prototype,"decay",void 0),Cl([dd(0,1)],E.prototype,"sustain",void 0),Cl([fd(0)],E.prototype,"release",void 0);let Od=(()=>{let n,i,t=[];for(n=0;n<128;n++)t[n]=Math.sin(n/127*(Math.PI/2));let e=[];for(n=0;n<127;n++){i=n/127;let t=Math.sin(i*(2*Math.PI)*6.4-Math.PI/2)+1;e[n]=t/10+.83*i}e[127]=1;var s=[];for(n=0;n<128;n++)s[n]=Math.ceil(n/127*5)/5;var r=[];for(n=0;n<128;n++)i=n/127,r[n]=.5*(1-Math.cos(Math.PI*i));var o=[];for(n=0;n<128;n++){i=n/127;let t=4*Math.pow(i,3)+.2,e=Math.cos(t*Math.PI*2*i);o[n]=Math.abs(e*(1-i))}function a(e){var n=new Array(e.length);for(let t=0;t<e.length;t++)n[t]=1-e[t];return n}return{bounce:{In:a(o),Out:o},cosine:{In:t,Out:t.slice(0).reverse()},exponential:"exponential",linear:"linear",ripple:{In:e,Out:a(e)},sine:{In:r,Out:a(r)},step:{In:s,Out:a(s)}}})();class Pd extends A{constructor(){super(p(Pd.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;var t=p(Pd.getDefaults(),arguments);this._volume=this.output=new Vp({context:this.context,volume:t.volume}),this.volume=this._volume.volume,m(this,"volume")}static getDefaults(){return Object.assign(A.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,n){let i=this["_original_"+t]=this[t];this[t]=(...e)=>{var t=e[n],t=this.context.transport.schedule(t=>{e[n]=t,i.apply(this,e)},t);this._scheduledEvents.push(t)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,i){n=this.toSeconds(n),e=this.toSeconds(e);return this.triggerAttack(t,n,i),this.triggerRelease(n+e),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Md extends Pd{constructor(){super(p(Md.getDefaults(),arguments));var t=p(Md.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Pd.getDefaults(),{detune:0,onsilence:y,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);e=this.toSeconds(e);return this._triggerEnvelopeAttack(e,n),this.setNote(t,e),this}triggerRelease(t){this.log("triggerRelease",t);t=this.toSeconds(t);return this._triggerEnvelopeRelease(t),this}setNote(t,e){var e=this.toSeconds(e),n=t instanceof mp?t.toFrequency():t;if(0<this.portamento&&.05<this.getLevelAtTime(e)){let t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(n,t,e)}else this.frequency.setValueAtTime(n,e);return this}}Cl([fd(0)],Md.prototype,"portamento",void 0);class Cd extends E{constructor(){super(p(Cd.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new k({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Nd extends Md{constructor(){super(p(Nd.getDefaults(),arguments)),this.name="Synth";var t=p(Nd.getDefaults(),arguments);this.oscillator=new ud(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Cd(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),m(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Md.getDefaults(),{envelope:Object.assign(d(E.getDefaults(),Object.keys(A.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(d(ud.getDefaults(),[...Object.keys(M.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(n,t){if(this.envelope.triggerAttack(n,t),this.oscillator.start(n),0===this.envelope.sustain){let t=this.toSeconds(this.envelope.attack),e=this.toSeconds(this.envelope.decay);this.oscillator.stop(n+t+e)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Id extends Md{constructor(){super(p(Id.getDefaults(),arguments)),this.name="ModulationSynth";var t=p(Id.getDefaults(),arguments);this._carrier=new Nd({context:this.context,oscillator:t.oscillator,envelope:t.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new Nd({context:this.context,oscillator:t.modulation,envelope:t.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new O({context:this.context,units:"frequency"}),this.detune=new O({context:this.context,value:t.detune,units:"cents"}),this.harmonicity=new I({context:this.context,value:t.harmonicity,minValue:0}),this._modulationNode=new k({context:this.context,gain:0}),m(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Md.getDefaults(),{harmonicity:3,oscillator:Object.assign(d(ud.getDefaults(),[...Object.keys(M.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(d(E.getDefaults(),Object.keys(A.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(d(ud.getDefaults(),[...Object.keys(M.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(d(E.getDefaults(),Object.keys(A.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(t,e){this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Ed extends Id{constructor(){super(p(Ed.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new ed({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class qd extends A{constructor(){super(p(qd.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";var t=p(qd.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new T({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new T({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new T({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new T({context:this.context,units:"gain",value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(A.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){o(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),"Invalid filter type: "+t),this._filter.type=t}getFrequencyResponse(n=128){var i=new Float32Array(n);for(let e=0;e<n;e++){let t=19980*Math.pow(e/n,2)+20;i[e]=t}let t=new Float32Array(n),e=new Float32Array(n),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(i,t,e),t}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Dd extends A{constructor(){super(p(Dd.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new k({context:this.context}),this.output=new k({context:this.context}),this._filters=[];var t=p(Dd.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new O({context:this.context,units:"positive",value:t.Q}),this.frequency=new O({context:this.context,units:"frequency",value:t.frequency}),this.detune=new O({context:this.context,units:"cents",value:t.detune}),this.gain=new O({context:this.context,units:"decibels",value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,m(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(A.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){o(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e),"Invalid filter type: "+e),this._type=e,this._filters.forEach(t=>t.type=e)}get rolloff(){return this._rolloff}set rolloff(t){let e=xl(t)?t:parseInt(t,10),n=[-12,-24,-48,-96];var i=n.indexOf(e);o(-1!==i,"rolloff can only be "+n.join(", ")),i+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach(t=>t.disconnect()),this._filters=new Array(i);for(let e=0;e<i;e++){let t=new qd({context:this.context});t.type=this._type,this.frequency.connect(t.frequency),this.detune.connect(t.detune),this.Q.connect(t.Q),this.gain.connect(t.gain),this._filters[e]=t}this._internalChannels=this._filters,Sp(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){let e=new qd({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(t).map(()=>1);return this._filters.forEach(()=>{e.getFrequencyResponse(t).forEach((t,e)=>n[e]*=t)}),e.dispose(),n}dispose(){return super.dispose(),this._filters.forEach(t=>{t.dispose()}),Kl(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Rd extends E{constructor(){super(p(Rd.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";var t=p(Rd.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=t.octaves,this._baseFrequency=this.toFrequency(t.baseFrequency),this._exponent=this.input=new Td({context:this.context,value:t.exponent}),this._scale=this.output=new hd({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(E.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){t=this.toFrequency(t);r(t,0),this._baseFrequency=t,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){r(t,0),this._octaves=t,this._scale.max=this._baseFrequency*Math.pow(2,t)}get exponent(){return this._exponent.value}set exponent(t){this._exponent.value=t}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class zd extends Md{constructor(){super(p(zd.getDefaults(),arguments)),this.name="MonoSynth";var t=p(zd.getDefaults(),arguments);this.oscillator=new ud(Object.assign(t.oscillator,{context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Dd(Object.assign(t.filter,{context:this.context})),this.filterEnvelope=new Rd(Object.assign(t.filterEnvelope,{context:this.context})),this.envelope=new Cd(Object.assign(t.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),m(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(Md.getDefaults(),{envelope:Object.assign(d(E.getDefaults(),Object.keys(A.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(d(Dd.getDefaults(),Object.keys(A.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(d(Rd.getDefaults(),Object.keys(A.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(d(ud.getDefaults(),Object.keys(M.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(n,t=1){if(this.envelope.triggerAttack(n,t),this.filterEnvelope.triggerAttack(n),this.oscillator.start(n),0===this.envelope.sustain){let t=this.toSeconds(this.envelope.attack),e=this.toSeconds(this.envelope.decay);this.oscillator.stop(n+t+e)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class Fd extends Md{constructor(){super(p(Fd.getDefaults(),arguments)),this.name="DuoSynth";var t=p(Fd.getDefaults(),arguments);this.voice0=new zd(Object.assign(t.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new zd(Object.assign(t.voice1,{context:this.context})),this.harmonicity=new I({context:this.context,units:"positive",value:t.harmonicity}),this._vibrato=new pd({frequency:t.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new k({context:this.context,units:"normalRange",gain:t.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new O({context:this.context,units:"frequency",value:440}),this.detune=new O({context:this.context,units:"cents",value:t.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),m(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(t){return t=this.toSeconds(t),this.voice0.envelope.getValueAtTime(t)+this.voice1.envelope.getValueAtTime(t)}static getDefaults(){return zl(Md.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:zl(d(zd.getDefaults(),Object.keys(Md.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:zl(d(zd.getDefaults(),Object.keys(Md.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(t,e){this.voice0._triggerEnvelopeAttack(t,e),this.voice1._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this.voice0._triggerEnvelopeRelease(t),this.voice1._triggerEnvelopeRelease(t),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class jd extends Id{constructor(){super(p(jd.getDefaults(),arguments)),this.name="FMSynth";var t=p(jd.getDefaults(),arguments);this.modulationIndex=new I({context:this.context,value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(Id.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}let Vd=[1,1.483,1.932,2.546,2.63,3.897];class Ld extends Md{constructor(){super(p(Ld.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];var e=p(Ld.getDefaults(),arguments);this.detune=new O({context:this.context,units:"cents",value:e.detune}),this.frequency=new O({context:this.context,units:"frequency"}),this._amplitude=new k({context:this.context,gain:0}).connect(this.output),this._highpass=new Dd({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let t=0;t<Vd.length;t++){var n=new id({context:this.context,harmonicity:e.harmonicity,modulationIndex:e.modulationIndex,modulationType:"square",onstop:0===t?()=>this.onsilence(this):y,type:"square"}),i=(n.connect(this._highpass),this._oscillators[t]=n,new I({context:this.context,value:Vd[t]}));this._freqMultipliers[t]=i,this.frequency.chain(i,n.frequency),this.detune.connect(n.detune)}this._filterFreqScaler=new hd({context:this.context,max:7e3,min:this.toFrequency(e.resonance)}),this.envelope=new E({attack:e.envelope.attack,attackCurve:"linear",context:this.context,decay:e.envelope.decay,release:e.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=e.octaves,this.octaves=e.octaves}static getDefaults(){return zl(Md.getDefaults(),{envelope:Object.assign(d(E.getDefaults(),Object.keys(A.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(e,t=1){return this.envelope.triggerAttack(e,t),this._oscillators.forEach(t=>t.start(e)),0===this.envelope.sustain&&this._oscillators.forEach(t=>{t.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(e){return this.envelope.triggerRelease(e),this._oscillators.forEach(t=>t.stop(e+this.toSeconds(this.envelope.release))),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(e){this._oscillators.forEach(t=>t.modulationIndex.value=e)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(e){this._oscillators.forEach(t=>t.harmonicity.value=e)}get resonance(){return this._filterFreqScaler.min}set resonance(t){this._filterFreqScaler.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}dispose(){return super.dispose(),this._oscillators.forEach(t=>t.dispose()),this._freqMultipliers.forEach(t=>t.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class Bd extends Nd{constructor(){super(p(Bd.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;var t=p(Bd.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,m(this,["oscillator","envelope"])}static getDefaults(){return zl(Md.getDefaults(),Nd.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){var e=this.toSeconds(e),t=this.toFrequency(t instanceof mp?t.toFrequency():t),n=t*this.octaves;return this.oscillator.frequency.setValueAtTime(n,e),this.oscillator.frequency.exponentialRampToValueAtTime(t,e+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Cl([dd(0)],Bd.prototype,"octaves",void 0),Cl([fd(0)],Bd.prototype,"pitchDecay",void 0);class Ud extends Pd{constructor(){super(p(Ud.getDefaults(),arguments)),this.name="NoiseSynth";var t=p(Ud.getDefaults(),arguments);this.noise=new Wp(Object.assign({context:this.context},t.noise)),this.envelope=new Cd(Object.assign({context:this.context},t.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Pd.getDefaults(),{envelope:Object.assign(d(E.getDefaults(),Object.keys(A.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(d(Wp.getDefaults(),Object.keys(M.getDefaults())),{type:"white"})})}triggerAttack(t,e=1){return t=this.toSeconds(t),this.envelope.triggerAttack(t,e),this.noise.start(t),0===this.envelope.sustain&&this.noise.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.noise.stop(t+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,n),this.triggerRelease(e+t),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}let Gd=new Set;function Qd(t){Gd.add(t)}function Hd(t,e){t=`registerProcessor("${t}", ${e})`;Gd.add(t)}class Wd extends A{constructor(t){super(t),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=y;let e=URL.createObjectURL(new Blob([Array.from(Gd).join("\n")],{type:"text/javascript"})),n=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(e,n).then(()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(n,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))})}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}Qd('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n'),Qd("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n"),Qd("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n"),Hd("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class $d extends Wd{constructor(){super(p($d.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";var t=p($d.getDefaults(),arguments,["delayTime","resonance"]);this.input=new k({context:this.context}),this.output=new k({context:this.context}),this.delayTime=new T({context:this.context,value:t.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new T({context:this.context,value:t.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),m(this,["resonance","delayTime"])}_audioWorkletName(){return"feedback-comb-filter"}static getDefaults(){return Object.assign(A.getDefaults(),{delayTime:.1,resonance:.5})}onReady(t){Sp(this.input,t,this.output);var e=t.parameters.get("delayTime"),e=(this.delayTime.setParam(e),t.parameters.get("feedback"));this.resonance.setParam(e)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Yd extends A{constructor(){super(p(Yd.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";var t=p(Yd.getDefaults(),arguments,["frequency","type"]);this._frequency=t.frequency,this._type=t.type,this.input=new k({context:this.context}),this.output=new k({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(A.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){let t=this._filter,e=this.toFrequency(this._frequency),n=1/(2*Math.PI*e);if("lowpass"===this._type){let t=1/(n*this.context.sampleRate),e=t-1;this._filter=this.context.createIIRFilter([t,0],[1,e])}else{let t=1/(n*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,t])}this.input.chain(this._filter,this.output),t&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(t),t.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._createFilter()}get type(){return this._type}set type(t){this._type=t,this._createFilter()}getFrequencyResponse(n=128){var i=new Float32Array(n);for(let e=0;e<n;e++){let t=19980*Math.pow(e/n,2)+20;i[e]=t}let t=new Float32Array(n),e=new Float32Array(n);return this._filter.getFrequencyResponse(i,t,e),t}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class Xd extends A{constructor(){super(p(Xd.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";var t=p(Xd.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new $d({context:this.context,delayTime:t.delayTime,resonance:t.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Yd({context:this.context,frequency:t.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(A.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(t){this._lowpass.frequency=t}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class Zd extends Pd{constructor(){super(p(Zd.getDefaults(),arguments)),this.name="PluckSynth";var t=p(Zd.getDefaults(),arguments);this._noise=new Wp({context:this.context,type:"pink"}),this.attackNoise=t.attackNoise,this._lfcf=new Xd({context:this.context,dampening:t.dampening,resonance:t.resonance}),this.resonance=t.resonance,this.release=t.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return zl(Pd.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(t){this._lfcf.dampening=t}triggerAttack(t,e){t=this.toFrequency(t),e=this.toSeconds(e),t=1/t;return this._lfcf.delayTime.setValueAtTime(t,e),this._noise.start(e),this._noise.stop(e+t*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(e),this._lfcf.resonance.setValueAtTime(this.resonance,e),this}triggerRelease(t){return this._lfcf.resonance.linearRampTo(0,this.release,t),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class Jd extends Pd{constructor(){super(p(Jd.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;var t=p(Jd.getDefaults(),arguments,["voice","options"]),e=(o(!xl(t.voice),"DEPRECATED: The polyphony count is no longer the first argument."),t.voice.getDefaults()),e=(this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice(),this._voices.indexOf(this._dummyVoice));this._voices.splice(e,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Pd.getDefaults(),{maxPolyphony:32,options:{},voice:Nd})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);var t=this._activeVoices.findIndex(t=>t.voice===e);this._activeVoices.splice(t,1)}_getNextAvailableVoice(){var t;return this._availableVoices.length?this._availableVoices.shift():this._voices.length<this.maxPolyphony?((t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}))).connect(this.output),this._voices.push(t),t):void bl("Max polyphony exceeded. Note dropped.")}_collectGarbage(){var t,e;this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)&&(t=this._availableVoices.shift(),e=this._voices.indexOf(t),this._voices.splice(e,1),this.context.isOffline||t.dispose())}_triggerAttack(t,i,s){t.forEach(t=>{var e=new qp(this.context,t).toMidi(),n=this._getNextAvailableVoice();n&&(n.triggerAttack(t,i,s),this._activeVoices.push({midi:e,voice:n,released:!1}),this.log("triggerAttack",t,i))})}_triggerRelease(t,i){t.forEach(t=>{let n=new qp(this.context,t).toMidi(),e=this._activeVoices.find(({midi:t,released:e})=>t===n&&!e);e&&(e.voice.triggerRelease(i),e.released=!0,this.log("triggerRelease",t,i))})}_scheduleEvent(t,e,n,i){o(!this.disposed,"Synth was already disposed"),n<=this.now()?"attack"===t?this._triggerAttack(e,n,i):this._triggerRelease(e,n):this.context.setTimeout(()=>{this._scheduleEvent(t,e,n,i)},n-this.now())}triggerAttack(t,e,n){Array.isArray(t)||(t=[t]);e=this.toSeconds(e);return this._scheduleEvent("attack",t,e,n),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);e=this.toSeconds(e);return this._scheduleEvent("release",t,e),this}triggerAttackRelease(i,s,t,e){var r=this.toSeconds(t);if(this.triggerAttack(i,r,e),l(s)){o(l(i),"If the duration is an array, the notes must also be an array");for(let n=0;n<i.length;n++){let t=s[Math.min(n,s.length-1)],e=this.toSeconds(t);o(0<e,"The duration must be greater than 0"),this.triggerRelease(i[n],r+e)}}else{let t=this.toSeconds(s);o(0<t,"The duration must be greater than 0"),this.triggerRelease(i,r+t)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(t){let e=d(t,["onsilence","context"]);return this.options=zl(this.options,e),this._voices.forEach(t=>t.set(e)),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){let e=this.toSeconds(t);return this._activeVoices.forEach(({voice:t})=>{t.triggerRelease(e)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(t=>t.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Kd extends Pd{constructor(){super(p(Kd.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;let n=p(Kd.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),i={};Object.keys(n.urls).forEach(e=>{let t=parseInt(e,10);if(o(Ol(e)||xl(t)&&isFinite(t),"url key is neither a note or midi pitch: "+e),Ol(e)){let t=new mp(this.context,e).toMidi();i[t]=n.urls[e]}else xl(t)&&isFinite(t)&&(i[t]=n.urls[t])}),this._buffers=new Ep({urls:i,onload:n.onload,baseUrl:n.baseUrl,onerror:n.onerror}),this.attack=n.attack,this.release=n.release,this.curve=n.curve,this._buffers.loaded&&Promise.resolve().then(n.onload)}static getDefaults(){return Object.assign(Pd.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:y,onerror:y,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error("No available buffers for note: "+t)}triggerAttack(t,c,h=1){return this.log("triggerAttack",t,c,h),(t=Array.isArray(t)?t:[t]).forEach(t=>{let e=hp(new mp(this.context,t).toFrequency()),n=Math.round(e),i=e-n,s=this._findClosest(n),r=n-s,o=this._buffers.get(r),a=ap(s+i),u=new Hp({url:o,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:a}).connect(this.output);u.start(c,0,o.duration/a,h),l(this._activeSources.get(n))||this._activeSources.set(n,[]),this._activeSources.get(n).push(u),u.onended=()=>{var t,e;this._activeSources&&this._activeSources.has(n)&&-1!==(e=(t=this._activeSources.get(n)).indexOf(u))&&t.splice(e,1)}}),this}triggerRelease(t,n){return this.log("triggerRelease",t,n),(t=Array.isArray(t)?t:[t]).forEach(t=>{var e=new mp(this.context,t).toMidi();if(this._activeSources.has(e)&&this._activeSources.get(e).length){let t=this._activeSources.get(e);n=this.toSeconds(n),t.forEach(t=>{t.stop(n)}),this._activeSources.set(e,[])}}),this}releaseAll(t){let e=this.toSeconds(t);return this._activeSources.forEach(t=>{for(;t.length;)t.shift().stop(e)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,n,e,i=1){let s=this.toSeconds(e);return this.triggerAttack(t,s,i),l(n)?(o(l(t),"notes must be an array when duration is array"),t.forEach((t,e)=>{e=n[Math.min(e,n.length-1)];this.triggerRelease(t,s+this.toSeconds(e))})):this.triggerRelease(t,s+this.toSeconds(n)),this}add(t,e,n){var i;return o(Ol(t)||isFinite(t),"note must be a pitch or midi: "+t),Ol(t)?(i=new mp(this.context,t).toMidi(),this._buffers.add(i,e,n)):this._buffers.add(t,e,n),this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}Cl([fd(0)],Kd.prototype,"attack",void 0),Cl([fd(0)],Kd.prototype,"release",void 0);class tf extends x{constructor(){super(p(tf.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new bp("stopped"),this._startOffset=0;var t=p(tf.getDefaults(),arguments,["callback","value"]);this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(x.getDefaults(),{callback:y,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,t=>{let e;var n,i;"started"===t.state&&(-1!==t.id&&this.context.transport.clear(t.id),n=t.time+Math.round(this.startOffset/this._playbackRate),!0===this._loop||xl(this._loop)&&1<this._loop?(e=1/0,xl(this._loop)&&(e=this._loop*this._getLoopDuration()),i=this._state.getAfter(n),(e=null!==i?Math.min(e,i.time-n):e)!==1/0&&(this._state.setStateAtTime("stopped",n+e+1,{id:-1}),e=new P(this.context,e)),i=new P(this.context,this._getLoopDuration()),t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),i,new P(this.context,n),e)):t.id=this.context.transport.schedule(this._tick.bind(this),new P(this.context,n)))})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){t=this.toTicks(t);return"stopped"===this._state.getValueAtTime(t)&&(this._state.add({id:-1,state:"started",time:t}),this._rescheduleEvents(t)),this}stop(t){this.cancel(t);var n=this.toTicks(t);if("started"===this._state.getValueAtTime(n)){this._state.setStateAtTime("stopped",n,{id:-1});let t=this._state.getBefore(n),e=n;null!==t&&(e=t.time),this._rescheduleEvents(e)}return this}cancel(t){t=Fl(t,-1/0);t=this.toTicks(t);return this._state.forEachFrom(t,t=>{this.context.transport.clear(t.id)}),this._state.cancel(t),this}_tick(e){var t=this.context.transport.getTicksAtTime(e);if(!(this.mute||"started"!==this._state.getValueAtTime(t)||this.probability<1&&Math.random()>this.probability)){if(this.humanize){let t=.02;Al(this.humanize)||(t=this.toSeconds(this.humanize)),e+=(2*Math.random()-1)*t}this.callback(e,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new P(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new P(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){var t,e,n;return this._loop&&(t=this.context.transport.ticks,null!==(e=this._state.get(t)))&&"started"===e.state?(n=this._getLoopDuration(),(t-e.time)%n/n):0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class ef extends x{constructor(){super(p(ef.getDefaults(),arguments,["callback","interval"])),this.name="Loop";var t=p(ef.getDefaults(),arguments,["callback","interval"]);this._event=new tf({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:t.interval,playbackRate:t.playbackRate,probability:t.probability}),this.callback=t.callback,this.iterations=t.iterations}static getDefaults(){return Object.assign(x.getDefaults(),{interval:"4n",callback:y,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(t){return this._event.start(t),this}stop(t){return this._event.stop(t),this}cancel(t){return this._event.cancel(t),this}_tick(t){this.callback(t)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(t){this._event.loopEnd=t}get playbackRate(){return this._event.playbackRate}set playbackRate(t){this._event.playbackRate=t}get humanize(){return this._event.humanize}set humanize(t){this._event.humanize=t}get probability(){return this._event.probability}set probability(t){this._event.probability=t}get mute(){return this._event.mute}set mute(t){this._event.mute=t}get iterations(){return!0===this._event.loop?1/0:this._event.loop}set iterations(t){this._event.loop=t===1/0||t}dispose(){return super.dispose(),this._event.dispose(),this}}class nf extends tf{constructor(){super(p(nf.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new bp("stopped"),this._events=new Set;var t=p(nf.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,t.events.forEach(t=>{l(t)?this.add(t[0],t[1]):this.add(t)})}static getDefaults(){return Object.assign(tf.getDefaults(),{events:[]})}start(t,n){let i=this.toTicks(t);if("started"!==this._state.getValueAtTime(i)){n=Fl(n,this._loop?this._loopStart:0),n=this._loop?Fl(n,this._loopStart):Fl(n,0);let e=this.toTicks(n);this._state.add({id:-1,offset:e,state:"started",time:i}),this._forEach(t=>{this._startNote(t,i,e)})}return this}_startNote(t,e,n){e-=n,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<n&&(e+=this._getLoopDuration()),t.start(new P(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=n&&(t.loop=!1,t.start(new P(this.context,e))):t.startOffset>=n&&t.start(new P(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach(t=>{t.startOffset+=this._startOffset})}stop(e){var t=this.toTicks(e);return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._forEach(t=>{t.stop(e)}),this}at(t,e){var n=new w(this.context,t).toTicks(),i=new P(this.context,1).toSeconds(),s=this._events.values();let r=s.next();for(;!r.done;){let t=r.value;if(Math.abs(n-t.startOffset)<i)return c(e)&&(t.value=e),t;r=s.next()}return c(e)?(this.add(t,e),this.at(t)):null}add(t,e){t instanceof Object&&Reflect.has(t,"time")&&(t=(e=t).time);t=this.toTicks(t);let n;return e instanceof tf?(n=e).callback=this._tick.bind(this):n=new tf({callback:this._tick.bind(this),context:this.context,value:e}),n.startOffset=t,n.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(n),this._restartEvent(n),this}_restartEvent(e){this._state.forEach(t=>{"started"===t.state?this._startNote(e,t.time,t.offset):e.stop(new P(this.context,t.time))})}remove(e,n){return Tl(e)&&e.hasOwnProperty("time")&&(e=(n=e).time),e=this.toTicks(e),this._events.forEach(t=>{t.startOffset===e&&(Sl(n)||c(n)&&t.value===n)&&(this._events.delete(t),t.dispose())}),this}clear(){return this._forEach(t=>t.dispose()),this._events.clear(),this}cancel(e){return this._forEach(t=>t.cancel(e)),this._state.cancel(this.toTicks(e)),this}_forEach(e){return this._events&&this._events.forEach(t=>{t instanceof nf?t._forEach(e):e(t)}),this}_setAll(e,n){this._forEach(t=>{t[e]=n})}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):"stopped"===t.state&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(e){this._loop=e,this._forEach(t=>{t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.loop=e,this._testLoopBoundries(t)})}get loopEnd(){return new P(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach(t=>{t.loopEnd=e,this._testLoopBoundries(t)})}get loopStart(){return new P(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach(t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*sf(t){let e=0;for(;e<t.length;)yield t[e=af(e,t)],e++}function*rf(t){let e=t.length-1;for(;0<=e;)yield t[e=af(e,t)],e--}function*of(t,e){for(;;)yield*e(t)}function af(t,e){return Gl(t,0,e.length-1)}function*uf(t,e){let n=e?0:t.length-1;for(;;)yield t[n=af(n,t)],e?++n>=t.length-1&&(e=!1):--n<=0&&(e=!0)}function*cf(t){let e=0,n=0;for(;e<t.length;)yield t[e=af(e,t)],n++,e+=n%2?2:-1}function*hf(t){let e=t.length-1,n=0;for(;0<=e;)yield t[e=af(e,t)],n++,e+=n%2?-2:1}function*lf(e){var n=[];for(let t=0;t<e.length;t++)n.push(t);for(;0<n.length;)yield e[af(n.splice(Math.floor(n.length*Math.random()),1)[0],e)]}function*pf(e,t="up"){switch(o(0<e.length,"The array must have more than one value in it"),t){case"up":yield*of(e,sf);case"down":yield*of(e,rf);case"upDown":yield*uf(e,!0);case"downUp":yield*uf(e,!1);case"alternateUp":yield*of(e,cf);case"alternateDown":yield*of(e,hf);case"random":for(var n=e;;)yield n[Math.floor(Math.random()*n.length)];case"randomOnce":yield*of(e,lf);case"randomWalk":{var i=e;let t=Math.floor(Math.random()*i.length);for(;;)0!==t&&(t===i.length-1||Math.random()<.5)?t--:t++,yield i[t];return}}}class df extends ef{constructor(){super(p(df.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";var t=p(df.getDefaults(),arguments,["callback","values","pattern"]);this.callback=t.callback,this._values=t.values,this._pattern=pf(t.values,t.pattern),this._type=t.pattern}static getDefaults(){return Object.assign(ef.getDefaults(),{pattern:"up",values:[],callback:y})}_tick(t){var e=this._pattern.next();this._value=e.value,this.callback(t,this._value)}get values(){return this._values}set values(t){this._values=t,this.pattern=this._type}get value(){return this._value}get pattern(){return this._type}set pattern(t){this._type=t,this._pattern=pf(this._values,this._type)}}class ff extends tf{constructor(){super(p(ff.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new nf({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];var t=p(ff.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}static getDefaults(){return Object.assign(d(tf.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,e){null!==e&&this.callback(t,e)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,e){return this._part.start(t,e&&this._indexTime(e)),this}stop(t){return this._part.stop(t),this}get subdivision(){return new P(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(t,e)=>t[e],set:(t,e,n)=>(kl(e)&&isFinite(parseInt(e,10))&&l(n)?t[e]=this._createSequence(n):t[e]=n,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,i,s){t.forEach((e,n)=>{n=n*i+s;if(l(e))this._rescheduleSequence(e,i/e.length,n);else{let t=new P(this.context,n,"i").toSeconds();this._part.add(t,e)}})}_indexTime(t){return new P(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this._part.loopEnd=0===t?this._indexTime(this._eventsArray.length):this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}}class mf extends A{constructor(){super(Object.assign(p(mf.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new vd({context:this.context}),this.a=new k({context:this.context,gain:0}),this.b=new k({context:this.context,gain:0}),this.output=new k({context:this.context}),this._internalChannels=[this.a,this.b];var t=p(mf.getDefaults(),arguments,["fade"]);this.fade=new O({context:this.context,units:"normalRange",value:t.fade}),m(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",wp(this._split,this.a.gain,0),wp(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(A.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class q extends A{constructor(t){super(t),this.name="Effect",this._dryWet=new mf({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new k({context:this.context}),this.effectReturn=new k({context:this.context}),this.input=new k({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],m(this,"wet")}static getDefaults(){return Object.assign(A.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class gf extends q{constructor(t){super(t),this.name="LFOEffect",this._lfo=new pd({context:this.context,frequency:t.frequency,amplitude:t.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=t.type,m(this,["frequency","depth"])}static getDefaults(){return Object.assign(q.getDefaults(),{frequency:1,type:"sine",depth:1})}start(t){return this._lfo.start(t),this}stop(t){return this._lfo.stop(t),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class _f extends gf{constructor(){super(p(_f.getDefaults(),arguments,["frequency","baseFrequency","octaves"])),this.name="AutoFilter";var t=p(_f.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new Dd(Object.assign(t.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=t.octaves,this.baseFrequency=t.baseFrequency}static getDefaults(){return Object.assign(gf.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(t){this._lfo.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._lfo.max=this._lfo.min*Math.pow(2,t)}dispose(){return super.dispose(),this.filter.dispose(),this}}class yf extends A{constructor(){super(Object.assign(p(yf.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;var t=p(yf.getDefaults(),arguments,["pan"]);this.pan=new T({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",m(this,"pan")}static getDefaults(){return Object.assign(A.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class vf extends gf{constructor(){super(p(vf.getDefaults(),arguments,["frequency"])),this.name="AutoPanner";var t=p(vf.getDefaults(),arguments,["frequency"]);this._panner=new yf({context:this.context,channelCount:t.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(gf.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class bf extends A{constructor(){super(p(bf.getDefaults(),arguments,["smoothing"])),this.name="Follower";var t=p(bf.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new yd({context:this.context}),this._lowpass=this.output=new Yd({context:this.context,frequency:1/this.toSeconds(t.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=t.smoothing}static getDefaults(){return Object.assign(A.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class Sf extends q{constructor(){super(p(Sf.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"])),this.name="AutoWah";var t=p(Sf.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);this._follower=new bf({context:this.context,smoothing:t.follower}),this._sweepRange=new Ad({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this._inputBoost=new k({context:this.context}),this._bandpass=new Dd({context:this.context,rolloff:-48,frequency:0,Q:t.Q}),this._peaking=new Dd({context:this.context,type:"peaking"}),this._peaking.gain.value=t.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=t.sensitivity,m(this,["gain","Q"])}static getDefaults(){return Object.assign(q.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(t){this._follower.smoothing=t}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._setSweepRange()}get sensitivity(){return op(1/this._inputBoost.gain.value)}set sensitivity(t){this._inputBoost.gain.value=1/rp(t)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}Hd("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class wf extends q{constructor(){super(p(wf.getDefaults(),arguments,["bits"])),this.name="BitCrusher";var t=p(wf.getDefaults(),arguments,["bits"]);this._bitCrusherWorklet=new xf({context:this.context,bits:t.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(q.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class xf extends Wd{constructor(){super(p(xf.getDefaults(),arguments)),this.name="BitCrusherWorklet";var t=p(xf.getDefaults(),arguments);this.input=new k({context:this.context}),this.output=new k({context:this.context}),this.bits=new T({context:this.context,value:t.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(Wd.getDefaults(),{bits:12})}_audioWorkletName(){return"bit-crusher"}onReady(t){Sp(this.input,t,this.output);t=t.parameters.get("bits");this.bits.setParam(t)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class Tf extends q{constructor(){super(p(Tf.getDefaults(),arguments,["order"])),this.name="Chebyshev";var t=p(Tf.getDefaults(),arguments,["order"]);this._shaper=new td({context:this.context,length:4096}),this._order=t.order,this.connectEffect(this._shaper),this.order=t.order,this.oversample=t.oversample}static getDefaults(){return Object.assign(q.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(t,e,n){return n.has(e)||(0===e?n.set(e,0):1===e?n.set(e,t):n.set(e,2*t*this._getCoefficient(t,e-1,n)-this._getCoefficient(t,e-2,n))),n.get(e)}get order(){return this._order}set order(e){this._order=e,this._shaper.setMap(t=>this._getCoefficient(t,e,new Map))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Af extends A{constructor(){super(p(Af.getDefaults(),arguments,["channels"])),this.name="Split";var t=p(Af.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(A.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class kf extends A{constructor(){super(p(kf.getDefaults(),arguments,["channels"])),this.name="Merge";var t=p(kf.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(A.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Of extends A{constructor(t){super(t),this.name="StereoEffect",this.input=new k({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new mf({context:this.context,fade:t.wet}),this.wet=this._dryWet.fade,this._split=new Af({context:this.context,channels:2}),this._merge=new kf({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),m(this,["wet"])}connectEffectLeft(...t){this._split.connect(t[0],0,0),Sp(...t),wp(t[t.length-1],this._merge,0,0)}connectEffectRight(...t){this._split.connect(t[0],1,0),Sp(...t),wp(t[t.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(A.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Pf extends Of{constructor(t){super(t),this.feedback=new O({context:this.context,value:t.feedback,units:"normalRange"}),this._feedbackL=new k({context:this.context}),this._feedbackR=new k({context:this.context}),this._feedbackSplit=new Af({context:this.context,channels:2}),this._feedbackMerge=new kf({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),m(this,["feedback"])}static getDefaults(){return Object.assign(Of.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class Mf extends Pf{constructor(){super(p(Mf.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";var t=p(Mf.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=t.depth,this._delayTime=t.delayTime/1e3,this._lfoL=new pd({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new pd({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Np({context:this.context}),this._delayNodeR=new Np({context:this.context}),this.frequency=this._lfoL.frequency,m(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=t.type,this.spread=t.spread}static getDefaults(){return Object.assign(Pf.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(t){this._depth=t;t=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-t,0),this._lfoL.max=this._delayTime+t,this._lfoR.min=Math.max(this._delayTime-t,0),this._lfoR.max=this._delayTime+t}get delayTime(){return 1e3*this._delayTime}set delayTime(t){this._delayTime=t/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class Cf extends q{constructor(){super(p(Cf.getDefaults(),arguments,["distortion"])),this.name="Distortion";var t=p(Cf.getDefaults(),arguments,["distortion"]);this._shaper=new td({context:this.context,length:4096}),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample}static getDefaults(){return Object.assign(q.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(t){let e=100*(this._distortion=t),n=Math.PI/180;this._shaper.setMap(t=>Math.abs(t)<.001?0:(3+e)*t*20*n/(Math.PI+e*Math.abs(t)))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Nf extends q{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new k({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,m(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(q.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class If extends Nf{constructor(){super(p(If.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";var t=p(If.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new Np({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),m(this,"delayTime")}static getDefaults(){return Object.assign(Nf.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class Ef extends A{constructor(t){super(t),this.name="PhaseShiftAllpass",this.input=new k({context:this.context}),this.output=new k({context:this.context}),this.offset90=new k({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),Sp(this.input,...this._bank0,this._oneSampleDelay,this.output),Sp(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(t){return t.map(t=>{t=[[t*t,0,-1],[1,0,-t*t]];return this.context.createIIRFilter(t[0],t[1])})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach(t=>t.disconnect()),this._bank1.forEach(t=>t.disconnect()),this._oneSampleDelay.disconnect(),this}}class qf extends q{constructor(){super(p(qf.getDefaults(),arguments,["frequency"])),this.name="FrequencyShifter";var t=p(qf.getDefaults(),arguments,["frequency"]),t=(this.frequency=new O({context:this.context,units:"frequency",value:t.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new Jp({context:this.context,type:"sine"}),this._cosine=new N({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new I({context:this.context}),this._cosineMultiply=new I({context:this.context}),this._negate=new bd({context:this.context}),this._add=new cd({context:this.context}),this._phaseShifter=new Ef({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn),this.immediate());this._sine.start(t),this._cosine.start(t)}static getDefaults(){return Object.assign(q.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}let Df=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],Rf=[225,556,441,341];class zf extends Of{constructor(){super(p(zf.getDefaults(),arguments,["roomSize","dampening"])),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];let n=p(zf.getDefaults(),arguments,["roomSize","dampening"]);this.roomSize=new O({context:this.context,value:n.roomSize,units:"normalRange"}),this._allpassFiltersL=Rf.map(t=>{var e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e}),this._allpassFiltersR=Rf.map(t=>{var e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e}),this._combFilters=Df.map((t,e)=>{t=new Xd({context:this.context,dampening:n.dampening,delayTime:t});return e<Df.length/2?this.connectEffectLeft(t,...this._allpassFiltersL):this.connectEffectRight(t,...this._allpassFiltersR),this.roomSize.connect(t.resonance),t}),m(this,["roomSize"])}static getDefaults(){return Object.assign(Of.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(e){this._combFilters.forEach(t=>t.dampening=e)}dispose(){return super.dispose(),this._allpassFiltersL.forEach(t=>t.disconnect()),this._allpassFiltersR.forEach(t=>t.disconnect()),this._combFilters.forEach(t=>t.dispose()),this.roomSize.dispose(),this}}let Ff=[.06748,.06404,.08212,.09004],jf=[.773,.802,.753,.733],Vf=[347,113,37];class Lf extends Of{constructor(){super(p(Lf.getDefaults(),arguments,["roomSize"])),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[];var t=p(Lf.getDefaults(),arguments,["roomSize"]);this.roomSize=new O({context:this.context,value:t.roomSize,units:"normalRange"}),this._scaleRoomSize=new hd({context:this.context,min:-.733,max:.197}),this._allpassFilters=Vf.map(t=>{var e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e}),this._feedbackCombFilters=Ff.map((t,e)=>{t=new $d({context:this.context,delayTime:t});return this._scaleRoomSize.connect(t.resonance),t.resonance.value=jf[e],e<Ff.length/2?this.connectEffectLeft(...this._allpassFilters,t):this.connectEffectRight(...this._allpassFilters,t),t}),this.roomSize.connect(this._scaleRoomSize),m(this,["roomSize"])}static getDefaults(){return Object.assign(Of.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach(t=>t.disconnect()),this._feedbackCombFilters.forEach(t=>t.dispose()),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class Bf extends Pf{constructor(t){super(t),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),m(this,["feedback"])}}class Uf extends Bf{constructor(){super(p(Uf.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";var t=p(Uf.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new Np({context:this.context,maxDelay:t.maxDelay}),this._rightDelay=new Np({context:this.context,maxDelay:t.maxDelay}),this._rightPreDelay=new Np({context:this.context,maxDelay:t.maxDelay}),this.delayTime=new O({context:this.context,units:"time",value:t.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),m(this,["delayTime"])}static getDefaults(){return Object.assign(Bf.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class Gf extends Nf{constructor(){super(p(Gf.getDefaults(),arguments,["pitch"])),this.name="PitchShift";var t=p(Gf.getDefaults(),arguments,["pitch"]),t=(this._frequency=new O({context:this.context}),this._delayA=new Np({maxDelay:1,context:this.context}),this._lfoA=new pd({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Np({maxDelay:1,context:this.context}),this._lfoB=new pd({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new mf({context:this.context}),this._crossFadeLFO=new pd({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Np({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,m(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn),this.now());this._lfoA.start(t),this._lfoB.start(t),this._crossFadeLFO.start(t),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(Nf.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let e=0;e=t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,ap(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,ap(t)-1),this._frequency.value=e*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class Qf extends Of{constructor(){super(p(Qf.getDefaults(),arguments,["frequency","octaves","baseFrequency"])),this.name="Phaser";var t=p(Qf.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new pd({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new pd({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this.Q=new O({context:this.context,value:t.Q,units:"positive"}),this._filtersL=this._makeFilters(t.stages,this._lfoL),this._filtersR=this._makeFilters(t.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=t.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=t.baseFrequency,this.octaves=t.octaves,this._lfoL.start(),this._lfoR.start(),m(this,["frequency","Q"])}static getDefaults(){return Object.assign(Of.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(e,n){var i=[];for(let t=0;t<e;t++){let t=this.context.createBiquadFilter();t.type="allpass",this.Q.connect(t.Q),n.connect(t.frequency),i.push(t)}return i}get octaves(){return this._octaves}set octaves(t){this._octaves=t;t=this._baseFrequency*Math.pow(2,t);this._lfoL.max=t,this._lfoR.max=t}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(t=>t.disconnect()),this._filtersR.forEach(t=>t.disconnect()),this.frequency.dispose(),this}}class Hf extends q{constructor(){super(p(Hf.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();var t=p(Hf.getDefaults(),arguments,["decay"]);this._decay=t.decay,this._preDelay=t.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(q.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){r(t=this.toSeconds(t),.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){r(t=this.toSeconds(t),0),this._preDelay=t,this.generate()}generate(){return h(this,void 0,void 0,function*(){var t=this.ready,e=new tp(2,this._decay+this._preDelay,this.context.sampleRate),n=new Wp({context:e}),i=new Wp({context:e}),s=new kf({context:e}),r=(n.connect(s,0,0),i.connect(s,0,1),new k({context:e}).toDestination()),s=(s.connect(r),n.start(0),i.start(0),r.gain.setValueAtTime(0,0),r.gain.setValueAtTime(1,this._preDelay),r.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay),e.render());return this.ready=s.then(y),yield t,this._convolver.buffer=(yield s).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Wf extends A{constructor(){super(p(Wf.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new Af({channels:2,context:this.context}),this._midAdd=new cd({context:this.context}),this.mid=new I({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new Sd({context:this.context}),this.side=new I({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class $f extends A{constructor(){super(p($f.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new k({context:this.context}),this.side=new k({context:this.context}),this._left=new cd({context:this.context}),this._leftMult=new I({context:this.context,value:Math.SQRT1_2}),this._right=new Sd({context:this.context}),this._rightMult=new I({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new kf({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class Yf extends q{constructor(t){super(t),this.name="MidSideEffect",this._midSideMerge=new $f({context:this.context}),this._midSideSplit=new Wf({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...t){this._midSend.chain(...t,this._midReturn)}connectEffectSide(...t){this._sideSend.chain(...t,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class Xf extends Yf{constructor(){super(p(Xf.getDefaults(),arguments,["width"])),this.name="StereoWidener";var t=p(Xf.getDefaults(),arguments,["width"]);this.width=new O({context:this.context,value:t.width,units:"normalRange"}),m(this,["width"]),this._twoTimesWidthMid=new I({context:this.context,value:2}),this._twoTimesWidthSide=new I({context:this.context,value:2}),this._midMult=new I({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new Sd({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),wp(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new I({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(Yf.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class Zf extends Of{constructor(){super(p(Zf.getDefaults(),arguments,["frequency","depth"])),this.name="Tremolo";var t=p(Zf.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new pd({context:this.context,type:t.type,min:1,max:0}),this._lfoR=new pd({context:this.context,type:t.type,min:1,max:0}),this._amplitudeL=new k({context:this.context}),this._amplitudeR=new k({context:this.context}),this.frequency=new O({context:this.context,value:t.frequency,units:"frequency"}),this.depth=new O({context:this.context,value:t.depth,units:"normalRange"}),m(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=t.spread}static getDefaults(){return Object.assign(Of.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Jf extends q{constructor(){super(p(Jf.getDefaults(),arguments,["frequency","depth"])),this.name="Vibrato";var t=p(Jf.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new Np({context:this.context,delayTime:0,maxDelay:t.maxDelay}),this._lfo=new pd({context:this.context,type:t.type,min:0,max:t.maxDelay,frequency:t.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=t.depth,m(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(q.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Kf extends A{constructor(){super(p(Kf.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];var e=p(Kf.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new k({context:this.context}),this._split=new Af({context:this.context,channels:e.channels}),this.input.connect(this._split),r(e.channels,1);for(let t=0;t<e.channels;t++)this._analysers[t]=this.context.createAnalyser(),this._split.connect(this._analysers[t],t,0);this.size=e.size,this.type=e.type}static getDefaults(){return Object.assign(A.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((t,e)=>{e=this._buffers[e];"fft"===this._type?t.getFloatFrequencyData(e):"waveform"===this._type&&t.getFloatTimeDomainData(e)}),1===this.channels?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(n){this._analysers.forEach((t,e)=>{t.fftSize=2*n,this._buffers[e]=new Float32Array(n)})}get channels(){return this._analysers.length}get type(){return this._type}set type(t){o("waveform"===t||"fft"===t,"Analyser: invalid type: "+t),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(e){this._analysers.forEach(t=>t.smoothingTimeConstant=e)}dispose(){return super.dispose(),this._analysers.forEach(t=>t.disconnect()),this._split.dispose(),this._gain.dispose(),this}}class tm extends A{constructor(){super(p(tm.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new Kf({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class em extends tm{constructor(){super(p(em.getDefaults(),arguments,["smoothing"])),this.name="Meter",this._rms=0;var t=p(em.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new Kf({context:this.context,size:256,type:"waveform",channels:t.channels}),this.smoothing=t.smoothing,this.normalRange=t.normalRange}static getDefaults(){return Object.assign(tm.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return bl("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){var t=this._analyser.getValue(),t=(1===this.channels?[t]:t).map(t=>{var e=t.reduce((t,e)=>t+e*e,0),e=Math.sqrt(e/t.length);return this._rms=Math.max(e,this._rms*this.smoothing),this.normalRange?this._rms:op(this._rms)});return 1===this.channels?t[0]:t}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class nm extends tm{constructor(){super(p(nm.getDefaults(),arguments,["size"])),this.name="FFT";var t=p(nm.getDefaults(),arguments,["size"]);this.normalRange=t.normalRange,this._analyser.type="fft",this.size=t.size}static getDefaults(){return Object.assign(A.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map(t=>this.normalRange?rp(t):t)}get size(){return this._analyser.size}set size(t){this._analyser.size=t}get smoothing(){return this._analyser.smoothing}set smoothing(t){this._analyser.smoothing=t}getFrequencyOfIndex(t){return o(0<=t&&t<this.size,"index must be greater than or equal to 0 and less than "+this.size),t*this.context.sampleRate/(2*this.size)}}class im extends tm{constructor(){super(p(im.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class sm extends tm{constructor(){super(p(sm.getDefaults(),arguments,["size"])),this.name="Waveform";var t=p(sm.getDefaults(),arguments,["size"]);this._analyser.type="waveform",this.size=t.size}static getDefaults(){return Object.assign(tm.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(t){this._analyser.size=t}}class D extends A{constructor(){super(p(D.getDefaults(),arguments,["solo"])),this.name="Solo";var t=p(D.getDefaults(),arguments,["solo"]);this.input=this.output=new k({context:this.context}),D._allSolos.has(this.context)||D._allSolos.set(this.context,new Set),D._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(A.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),D._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return 0===this.input.gain.value}_addSolo(){D._soloed.has(this.context)||D._soloed.set(this.context,new Set),D._soloed.get(this.context).add(this)}_removeSolo(){D._soloed.has(this.context)&&D._soloed.get(this.context).delete(this)}_isSoloed(){return D._soloed.has(this.context)&&D._soloed.get(this.context).has(this)}_noSolos(){return!D._soloed.has(this.context)||D._soloed.has(this.context)&&0===D._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),D._allSolos.get(this.context).delete(this),this._removeSolo(),this}}D._allSolos=new Map,D._soloed=new Map;class rm extends A{constructor(){super(p(rm.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";var t=p(rm.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new yf({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Vp({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,m(this,["pan","volume"])}static getDefaults(){return Object.assign(A.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class om extends A{constructor(){super(p(om.getDefaults(),arguments,["volume","pan"])),this.name="Channel";var t=p(om.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new D({solo:t.solo,context:this.context}),this._panVol=this.output=new rm({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),m(this,["pan","volume"])}static getDefaults(){return Object.assign(A.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return om.buses.has(t)||om.buses.set(t,new k({context:this.context})),om.buses.get(t)}send(t,e=0){t=this._getBus(t),e=new k({context:this.context,units:"decibels",gain:e});return this.connect(e),e.connect(t),e}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}om.buses=new Map;class am extends A{constructor(){super(p(am.getDefaults(),arguments,["lowFrequency","highFrequency"])),this.name="MultibandSplit",this.input=new k({context:this.context}),this.output=void 0,this.low=new Dd({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Dd({context:this.context,frequency:0,type:"highpass"}),this.mid=new Dd({context:this.context,frequency:0,type:"lowpass"}),this.high=new Dd({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];var t=p(am.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new O({context:this.context,units:"frequency",value:t.lowFrequency}),this.highFrequency=new O({context:this.context,units:"frequency",value:t.highFrequency}),this.Q=new O({context:this.context,units:"positive",value:t.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),m(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(A.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),Kl(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class um extends A{constructor(){super(...arguments),this.name="Listener",this.positionX=new T({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new T({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new T({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new T({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new T({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new T({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new T({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new T({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new T({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(A.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Wl(t=>{t.listener=new um({context:t})}),Yl(t=>{t.listener.dispose()});class cm extends A{constructor(){super(p(cm.getDefaults(),arguments,["positionX","positionY","positionZ"])),this.name="Panner3D";var t=p(cm.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=t.panningModel,this.maxDistance=t.maxDistance,this.distanceModel=t.distanceModel,this.coneOuterGain=t.coneOuterGain,this.coneOuterAngle=t.coneOuterAngle,this.coneInnerAngle=t.coneInnerAngle,this.refDistance=t.refDistance,this.rolloffFactor=t.rolloffFactor,this.positionX=new T({context:this.context,param:this._panner.positionX,value:t.positionX}),this.positionY=new T({context:this.context,param:this._panner.positionY,value:t.positionY}),this.positionZ=new T({context:this.context,param:this._panner.positionZ,value:t.positionZ}),this.orientationX=new T({context:this.context,param:this._panner.orientationX,value:t.orientationX}),this.orientationY=new T({context:this.context,param:this._panner.orientationY,value:t.orientationY}),this.orientationZ=new T({context:this.context,param:this._panner.orientationZ,value:t.orientationZ})}static getDefaults(){return Object.assign(A.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(t,e,n){return this.positionX.value=t,this.positionY.value=e,this.positionZ.value=n,this}setOrientation(t,e,n){return this.orientationX.value=t,this.orientationY.value=e,this.orientationZ.value=n,this}get panningModel(){return this._panner.panningModel}set panningModel(t){this._panner.panningModel=t}get refDistance(){return this._panner.refDistance}set refDistance(t){this._panner.refDistance=t}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(t){this._panner.rolloffFactor=t}get distanceModel(){return this._panner.distanceModel}set distanceModel(t){this._panner.distanceModel=t}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(t){this._panner.coneInnerAngle=t}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(t){this._panner.coneOuterAngle=t}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(t){this._panner.coneOuterGain=t}get maxDistance(){return this._panner.maxDistance}set maxDistance(t){this._panner.maxDistance=t}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class hm extends A{constructor(){super(p(hm.getDefaults(),arguments)),this.name="Recorder";var t=p(hm.getDefaults(),arguments);this.input=new k({context:this.context}),o(hm.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:t.mimeType})}static getDefaults(){return A.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return null!==Pl&&Reflect.has(Pl,"MediaRecorder")}get state(){return"inactive"===this._recorder.state?"stopped":"paused"===this._recorder.state?"paused":"started"}start(){return h(this,void 0,void 0,function*(){o("started"!==this.state,"Recorder is already started");var t=new Promise(t=>{let e=()=>{this._recorder.removeEventListener("start",e,!1),t()};this._recorder.addEventListener("start",e,!1)});return this._recorder.start(),yield t})}stop(){return h(this,void 0,void 0,function*(){o("stopped"!==this.state,"Recorder is not started");var t=new Promise(e=>{let n=t=>{this._recorder.removeEventListener("dataavailable",n,!1),e(t.data)};this._recorder.addEventListener("dataavailable",n,!1)});return this._recorder.stop(),yield t})}pause(){return o("started"===this.state,"Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class lm extends A{constructor(){super(p(lm.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;var t=p(lm.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new T({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new T({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new T({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new T({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new T({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),m(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(A.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class pm extends A{constructor(){super(Object.assign(p(pm.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";var t=p(pm.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new bf({context:this.context,smoothing:t.smoothing}),this._gt=new xd({context:this.context,value:rp(t.threshold)}),this.input=new k({context:this.context}),this._gate=this.output=new k({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(A.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return op(this._gt.value)}set threshold(t){this._gt.value=rp(t)}get smoothing(){return this._follower.smoothing}set smoothing(t){this._follower.smoothing=t}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class dm extends A{constructor(){super(Object.assign(p(dm.getDefaults(),arguments,["threshold"]))),this.name="Limiter";var t=p(dm.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new lm({context:this.context,ratio:20,attack:0,release:0,threshold:t.threshold}),this.threshold=this._compressor.threshold,m(this,"threshold")}static getDefaults(){return Object.assign(A.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class fm extends A{constructor(){super(Object.assign(p(fm.getDefaults(),arguments))),this.name="MidSideCompressor";var t=p(fm.getDefaults(),arguments);this._midSideSplit=this.input=new Wf({context:this.context}),this._midSideMerge=this.output=new $f({context:this.context}),this.mid=new lm(Object.assign(t.mid,{context:this.context})),this.side=new lm(Object.assign(t.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),m(this,["mid","side"])}static getDefaults(){return Object.assign(A.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class mm extends A{constructor(){super(Object.assign(p(mm.getDefaults(),arguments))),this.name="MultibandCompressor";var t=p(mm.getDefaults(),arguments);this._splitter=this.input=new am({context:this.context,lowFrequency:t.lowFrequency,highFrequency:t.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new k({context:this.context}),this.low=new lm(Object.assign(t.low,{context:this.context})),this.mid=new lm(Object.assign(t.mid,{context:this.context})),this.high=new lm(Object.assign(t.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),m(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(A.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class gm extends A{constructor(){super(p(gm.getDefaults(),arguments,["low","mid","high"])),this.name="EQ3",this.output=new k({context:this.context}),this._internalChannels=[];var t=p(gm.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new am({context:this.context,highFrequency:t.highFrequency,lowFrequency:t.lowFrequency}),this._lowGain=new k({context:this.context,gain:t.low,units:"decibels"}),this._midGain=new k({context:this.context,gain:t.mid,units:"decibels"}),this._highGain=new k({context:this.context,gain:t.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),m(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(A.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),Kl(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class _m extends A{constructor(){super(p(_m.getDefaults(),arguments,["url","onload"])),this.name="Convolver",this._convolver=this.context.createConvolver();let e=p(_m.getDefaults(),arguments,["url","onload"]);this._buffer=new b(e.url,t=>{this.buffer=t,e.onload()}),this.input=new k({context:this.context}),this.output=new k({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=e.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(A.getDefaults(),{normalize:!0,onload:y})}load(t){return h(this,void 0,void 0,function*(){this.buffer=yield this._buffer.load(t)})}get buffer(){return this._buffer.length?this._buffer:null}set buffer(t){t&&this._buffer.set(t),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));t=this._buffer.get();this._convolver.buffer=t||null}get normalize(){return this._convolver.normalize}set normalize(t){this._convolver.normalize=t}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function ym(){return S().now()}function vm(){return S().immediate()}let bm=S().transport;function Sm(){return S().transport}let wm=S().destination,xm=S().destination;function Tm(){return S().destination}let Am=S().listener;function km(){return S().listener}let Om=S().draw;function Pm(){return S().draw}let Mm=S();function Cm(){return b.loaded()}let Nm=b,Im=Ep,Em=Hp}],i={},s.m=n,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=9);function s(t){var e;return(i[t]||(e=i[t]={i:t,l:!1,exports:{}},n[t].call(e.exports,e,e.exports,s),e.l=!0,e)).exports}var n,i}),((t,e)=>{"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@tensorflow/tfjs"),require("tone")):"function"==typeof define&&define.amd?define(["tf","Tone"],e):"object"==typeof exports?exports.core=e(require("@tensorflow/tfjs"),require("tone")):t.core=e(t.tf,t.Tone)})(self,function(__WEBPACK_EXTERNAL_MODULE__2__,__WEBPACK_EXTERNAL_MODULE__9__){return(n=>{var i={};function s(t){var e;return(i[t]||(e=i[t]={i:t,l:!1,exports:{}},n[t].call(e.exports,e,e.exports,s),e.l=!0,e)).exports}return s.m=n,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=73)})([,,function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE__2__},,,,,,function(t,e,n){n.r(e),n.d(e,"DEFAULT_QUARTERS_PER_MINUTE",function(){return i}),n.d(e,"DEFAULT_STEPS_PER_BAR",function(){return s}),n.d(e,"DEFAULT_STEPS_PER_QUARTER",function(){return r}),n.d(e,"DEFAULT_STEPS_PER_SECOND",function(){return o}),n.d(e,"DEFAULT_VELOCITY",function(){return a}),n.d(e,"DEFAULT_PROGRAM",function(){return u}),n.d(e,"DEFAULT_TICKS_PER_QUARTER",function(){return c}),n.d(e,"DEFAULT_CHANNEL",function(){return h}),n.d(e,"DRUM_CHANNEL",function(){return l}),n.d(e,"NON_DRUM_CHANNELS",function(){return p}),n.d(e,"DEFAULT_DRUM_PITCH_CLASSES",function(){return d}),n.d(e,"MIN_MIDI_VELOCITY",function(){return f}),n.d(e,"MAX_MIDI_VELOCITY",function(){return m}),n.d(e,"MIDI_VELOCITIES",function(){return g}),n.d(e,"NO_CHORD",function(){return _}),n.d(e,"NUM_PITCH_CLASSES",function(){return y}),n.d(e,"MIN_MIDI_PITCH",function(){return v}),n.d(e,"MAX_MIDI_PITCH",function(){return b}),n.d(e,"MIDI_PITCHES",function(){return S}),n.d(e,"MIN_PIANO_PITCH",function(){return w}),n.d(e,"MAX_PIANO_PITCH",function(){return x}),n.d(e,"MIN_DRUM_PITCH",function(){return T}),n.d(e,"MAX_DRUM_PITCH",function(){return A}),n.d(e,"MIN_MIDI_PROGRAM",function(){return k}),n.d(e,"MAX_MIDI_PROGRAM",function(){return O}),n.d(e,"LO_CLICK_PITCH",function(){return P}),n.d(e,"HI_CLICK_PITCH",function(){return M}),n.d(e,"LO_CLICK_CLASS",function(){return C}),n.d(e,"HI_CLICK_CLASS",function(){return N});let i=120,s=16,r=4,o=100,a=80,u=0,c=220,h=0,l=9,p=[0,1,2,3,4,5,6,7,8,10,11,12,13,14,15],d=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]],f=0,m=127,g=m-f+1,_="N.C.",y=12,v=0,b=127,S=b-v+1,w=21,x=108,T=35,A=81,k=0,O=127,P=89,M=90,C=9,N=10},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE__9__},function(t,e,n){n.d(e,"a",function(){return i});var i=n(35).tensorflow.magenta.NoteSequence},,function(t,e,n){n.r(e),n.d(e,"Level",function(){return i}),n.d(e,"verbosity",function(){return r}),n.d(e,"setVerbosity",function(){return o}),n.d(e,"log",function(){return a}),n.d(e,"logWithDuration",function(){return u});var i,s=n(15);(e=i=i||{})[e.NONE=0]="NONE",e[e.WARN=5]="WARN",e[e.INFO=10]="INFO",e[e.DEBUG=20]="DEBUG";let r=10;function o(t){}function a(t,e="Magenta.js",n=10){if(0===n)throw Error("Logging level cannot be NONE.");r>=n&&(5===n?console.warn:console.log)(`%c ${e} `,"background:magenta; color:white",t)}function u(t,e,n="Magenta.js",i=10){a(`${t} in ${((s.d.now()-e)/1e3).toPrecision(3)}s`,n,i)}},function(t,e,n){n.r(e),n.d(e,"MultipleTimeSignatureException",function(){return c}),n.d(e,"BadTimeSignatureException",function(){return l}),n.d(e,"NegativeTimeException",function(){return p}),n.d(e,"MultipleTempoException",function(){return i}),n.d(e,"QuantizationStatusException",function(){return s}),n.d(e,"clone",function(){return d}),n.d(e,"stepsPerQuarterToStepsPerSecond",function(){return r}),n.d(e,"quantizeToStep",function(){return f}),n.d(e,"quantizeNoteSequence",function(){return o}),n.d(e,"isQuantizedSequence",function(){return _}),n.d(e,"assertIsQuantizedSequence",function(){return y}),n.d(e,"isRelativeQuantizedSequence",function(){return a}),n.d(e,"assertIsRelativeQuantizedSequence",function(){return v}),n.d(e,"isAbsoluteQuantizedSequence",function(){return b}),n.d(e,"assertIsAbsoluteQuantizedSequence",function(){return S}),n.d(e,"unquantizeSequence",function(){return w}),n.d(e,"createQuantizedNoteSequence",function(){return x}),n.d(e,"mergeInstruments",function(){return T}),n.d(e,"replaceInstruments",function(){return A}),n.d(e,"mergeConsecutiveNotes",function(){return k}),n.d(e,"applySustainControlChanges",function(){return O}),n.d(e,"concatenate",function(){return P}),n.d(e,"trim",function(){return M}),n.d(e,"split",function(){return I});var h=n(10),u=n(8);class c extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class l extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class p extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class i extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class s extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}function d(t){return h.a.decode(h.a.encode(t).finish())}function r(t,e){return t*e/60}function f(t,e,n=.5){return Math.floor(1-n+t*e)}function m(t){return t.controlChanges.concat(t.textAnnotations)}function g(e){if(e.tempos&&0!==e.tempos.length){if(e.tempos.sort((t,e)=>t.time-e.time),0!==e.tempos[0].time&&e.tempos[0].qpm!==u.DEFAULT_QUARTERS_PER_MINUTE)throw new i("NoteSequence has an implicit tempo change from initial "+u.DEFAULT_QUARTERS_PER_MINUTE+" qpm to "+`${e.tempos[0].qpm} qpm at ${e.tempos[0].time} seconds.`);for(let t=1;t<e.tempos.length;t++)if(e.tempos[t].qpm!==e.tempos[0].qpm)throw new i(`NoteSequence has at least one tempo change from ${e.tempos[0].qpm} qpm to ${e.tempos[t].qpm}qpm at ${e.tempos[t].time} seconds.`)}}function o(t,e){var n=d(t);if(n.quantizationInfo=h.a.QuantizationInfo.create({stepsPerQuarter:e}),0<n.timeSignatures.length){if(n.timeSignatures.sort((t,e)=>t.time-e.time),0!==n.timeSignatures[0].time&&(4!==n.timeSignatures[0].numerator||4!==n.timeSignatures[0].denominator))throw new c(`NoteSequence has an implicit change from initial 4/4 time signature to ${n.timeSignatures[0].numerator}/`+n.timeSignatures[0].denominator+" at "+n.timeSignatures[0].time+" seconds.");for(let e=1;e<n.timeSignatures.length;e++){let t=n.timeSignatures[e];if(t.numerator!==n.timeSignatures[0].numerator||t.denominator!==n.timeSignatures[0].denominator)throw new c("NoteSequence has at least one time signature change from "+n.timeSignatures[0].numerator+"/"+n.timeSignatures[0].denominator+" to "+`${t.numerator}/${t.denominator} `+`at ${t.time} seconds`)}n.timeSignatures[0].time=0,n.timeSignatures=[n.timeSignatures[0]]}else{let t=h.a.TimeSignature.create({numerator:4,denominator:4,time:0});n.timeSignatures.push(t)}var i=n.timeSignatures[0];if(!(r=i.denominator)||0!=(r&r-1))throw new l(`Denominator is not a power of 2. Time signature: ${i.numerator}/`+i.denominator);if(0===i.numerator)throw new l(`Numerator is 0. Time signature: ${i.numerator}/`+i.denominator);if(0<n.tempos.length)g(n),n.tempos[0].time=0,n.tempos=[n.tempos[0]];else{let t=h.a.Tempo.create({qpm:u.DEFAULT_QUARTERS_PER_MINUTE,time:0});n.tempos.push(t)}var s,r=e*n.tempos[0].qpm/60,o=(n.totalQuantizedSteps=f(t.totalTime,r),n),a=r;for(s of o.notes){if(s.quantizedStartStep=f(s.startTime,a),s.quantizedEndStep=f(s.endTime,a),s.quantizedEndStep===s.quantizedStartStep&&(s.quantizedEndStep+=1),s.quantizedStartStep<0||s.quantizedEndStep<0)throw new p("Got negative note time: start_step = "+s.quantizedStartStep+", end_step = "+s.quantizedEndStep);s.quantizedEndStep>o.totalQuantizedSteps&&(o.totalQuantizedSteps=s.quantizedEndStep)}return m(o).forEach(t=>{if(t.quantizedStep=f(t.time,a),t.quantizedStep<0)throw new p("Got negative event time: step = "+t.quantizedStep)}),n}function _(t){return t.quantizationInfo&&(0<t.quantizationInfo.stepsPerQuarter||0<t.quantizationInfo.stepsPerSecond)}function y(t){if(!_(t))throw new s(`NoteSequence ${t.id} is not quantized (missing quantizationInfo)`)}function a(t){return t.quantizationInfo&&0<t.quantizationInfo.stepsPerQuarter}function v(t){if(!a(t))throw new s(`NoteSequence ${t.id} is not quantized or is quantized based on absolute timing`)}function b(t){return t.quantizationInfo&&0<t.quantizationInfo.stepsPerSecond}function S(t){if(!b(t))throw new s(`NoteSequence ${t.id} is not quantized or is quantized based on relative timing`)}function w(t,e){v(t),g(t);let n=d(t),i=(e?n.tempos&&0<n.tempos.length?n.tempos[0].qpm=e:n.tempos.push(h.a.Tempo.create({time:0,qpm:e})):e=t.tempos&&0<t.tempos.length?n.tempos[0].qpm:u.DEFAULT_QUARTERS_PER_MINUTE,t=>t/n.quantizationInfo.stepsPerQuarter*(60/e));return n.totalTime=i(n.totalQuantizedSteps),n.notes.forEach(t=>{t.startTime=i(t.quantizedStartStep),t.endTime=i(t.quantizedEndStep),n.totalTime=Math.max(n.totalTime,t.endTime),delete t.quantizedStartStep,delete t.quantizedEndStep}),m(n).forEach(t=>{t.time=i(t.time)}),delete n.totalQuantizedSteps,delete n.quantizationInfo,n}function x(t=u.DEFAULT_STEPS_PER_QUARTER,e=u.DEFAULT_QUARTERS_PER_MINUTE){return h.a.create({quantizationInfo:{stepsPerQuarter:t},tempos:[{qpm:e}]})}function T(t){let e=d(t),n=e.notes.concat(e.pitchBends).concat(e.controlChanges),i=Array.from(new Set(n.filter(t=>!t.isDrum).map(t=>t.program)));return n.forEach(t=>{t.isDrum?(t.program=0,t.instrument=i.length):t.instrument=i.indexOf(t.program)}),e}function A(t,e){let n=new Set(t.notes.map(t=>t.instrument)),i=new Set(e.notes.map(t=>t.instrument)),s=[];t.notes.forEach(t=>{i.has(t.instrument)||s.push(h.a.Note.create(t))}),e.notes.forEach(t=>{n.has(t.instrument)&&s.push(h.a.Note.create(t))});e=d(t);return e.notes=s.sort((t,e)=>t.instrument-e.instrument||t.quantizedStartStep-e.quantizedStartStep),e}function k(t){y(t);var i=d(t);i.notes=[];let s=t.notes.sort((t,e)=>t.instrument-e.instrument||t.quantizedStartStep-e.quantizedStartStep),e=new h.a.Note,r=(e.pitch=s[0].pitch,e.instrument=s[0].instrument,e.quantizedStartStep=s[0].quantizedStartStep,e.quantizedEndStep=s[0].quantizedEndStep,i.notes.push(e),0);for(let n=1;n<s.length;n++){let t=s[n],e=i.notes[r];if(e.instrument===t.instrument&&e.pitch===t.pitch&&t.quantizedStartStep===e.quantizedEndStep&&t.quantizedStartStep%16!=0)i.notes[r].quantizedEndStep+=t.quantizedEndStep-t.quantizedStartStep;else{let t=new h.a.Note;t.pitch=s[n].pitch,t.instrument=s[n].instrument,t.quantizedStartStep=s[n].quantizedStartStep,t.quantizedEndStep=s[n].quantizedEndStep,i.notes.push(t),r++}}return i}function O(t,n=64){let i;var e;if((e=i=i||{})[e.SUSTAIN_ON=0]="SUSTAIN_ON",e[e.SUSTAIN_OFF=1]="SUSTAIN_OFF",e[e.NOTE_ON=2]="NOTE_ON",e[e.NOTE_OFF=3]="NOTE_OFF",_(t))throw new Error("Can only apply sustain to unquantized NoteSequence.");let s=d(t),r=[];for(let t of s.notes)!1===t.isDrum&&(null!==t.startTime&&r.push({time:t.startTime,type:i.NOTE_ON,event:t}),null!==t.endTime)&&r.push({time:t.endTime,type:i.NOTE_OFF,event:t});for(let e of s.controlChanges)if(e.controlNumber===n){let t=e.controlValue;64<=t?r.push({time:e.time,type:i.SUSTAIN_ON,event:e}):t<64&&r.push({time:e.time,type:i.SUSTAIN_OFF,event:e})}r.sort((t,e)=>t.time-e.time);var o={},a={};let u=0;for(let e of r){u=e.time;let t=e.type,n=e.event;if(t===i.SUSTAIN_ON)a[n.instrument]=!0;else if(t===i.SUSTAIN_OFF){a[n.instrument]=!1;let e=[];n.instrument in o||(o[n.instrument]=[]);for(let t of o[n.instrument])t.endTime<u?(t.endTime=u,u>s.totalTime&&(s.totalTime=u)):e.push(t);o[n.instrument]=e}else if(t===i.NOTE_ON){if(!0===a[n.instrument]){let e=[];n.instrument in o||(o[n.instrument]=[]);for(let t of o[n.instrument])t.pitch===n.pitch?(t.endTime=u,t.startTime===t.endTime&&s.notes.push(t)):e.push(t);o[n.instrument]=e}n.instrument in o||(o[n.instrument]=[]),o[n.instrument].push(n)}else if(t===i.NOTE_OFF&&!0!==a[n.instrument]){let t=o[n.instrument].indexOf(n);-1<t&&o[n.instrument].splice(t,1)}}for(let e of Object.values(o))for(let t of e)t.endTime=u,s.totalTime=u;return s}function P(e,t){if(t&&t.length!==e.length)throw new Error("Number of sequences to concatenate and their individual\n durations does not match.");if(_(e[0])){for(let t=0;t<e.length;++t)if(y(e[t]),e[t].quantizationInfo.stepsPerQuarter!==e[0].quantizationInfo.stepsPerQuarter)throw new Error("Not all sequences have the same quantizationInfo");return C(e,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",t)}return C(e,"totalTime","startTime","endTime",t)}function M(t,e,n,i){return _(t)?N(t,e,n,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",i):N(t,e,n,"totalTime","startTime","endTime",i)}function C(e,n,i,s,r){let o,a=0;for(let t=0;t<e.length;++t){var u=r?r[t]:e[t][n];if(0===u)throw Error(`Sequence ${e[t].id} has no ${n}, and no individual duration was provided.`);0===t?o=d(e[0]):Array.prototype.push.apply(o.notes,e[t].notes.map(t=>{t=h.a.Note.create(t);return t[i]+=a,t[s]+=a,t})),a+=u}return o[n]=a,o}function N(t,e,n,i,s,r,o){var a=d(t);a[i]=n,a.notes=a.notes.filter(t=>t[s]>=e&&t[s]<=n&&(o||t[r]<=n)),a[i]-=e;for(let t=0;t<a.notes.length;t++)a.notes[t][s]-=e,a.notes[t][r]-=e,o&&(a.notes[t][r]=Math.min(a.notes[t][r],a[i]));return a}function I(t,e){y(t);var n=d(t),i=n.notes.sort((t,e)=>t.quantizedStartStep-e.quantizedStartStep),s=[];let r=0,o=[];for(let t=0;t<i.length;t++){var a=i[t],u=a.quantizedStartStep,c=a.quantizedEndStep;if(a.quantizedStartStep-=r,a.quantizedEndStep-=r,!(a.quantizedStartStep<0))if(a.quantizedEndStep<=e)o.push(a);else{if(a.quantizedStartStep<e){let t=h.a.Note.create(a);t.quantizedEndStep=e,t.startTime=t.endTime=void 0,o.push(t),a.quantizedStartStep=r+e}else a.quantizedStartStep=u;if(a.quantizedEndStep=c,(a.quantizedEndStep>e||a.quantizedStartStep>e)&&--t,0!==o.length){let t=d(n);t.notes=o,t.totalQuantizedSteps=e,s.push(t)}o=[],r+=e}}if(0!==o.length){let t=d(n);t.notes=o,t.totalQuantizedSteps=e,s.push(t)}return s}},,function(t,a,u){!function(t){u.d(a,"a",function(){return e}),u.d(a,"d",function(){return i}),u.d(a,"c",function(){return s}),u.d(a,"b",function(){return o});let n=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("cannot find the global object")})(),e=n.fetch.bind(n),i=n.performance,s=(n.navigator,!!n.webkitOfflineAudioContext),r=void 0!==n.WorkerGlobalScope;function o(t){if(t=s?44100:t,r)throw new Error("Cannot use offline audio context in a web worker.");var e=n.webkitOfflineAudioContext;return new(s?e:n.OfflineAudioContext)(1,t,t)}}.call(this,u(21))},,,function(t,n,r){!function(t){var i=n;function s(t,e,n){for(var i=Object.keys(e),s=0;s<i.length;++s)void 0!==t[i[s]]&&n||(t[i[s]]=e[i[s]]);return t}function e(t){function n(t,e){if(!(this instanceof n))return new n(t,e);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),e&&s(this,e)}return(n.prototype=Object.create(Error.prototype)).constructor=n,Object.defineProperty(n.prototype,"name",{get:function(){return t}}),n.prototype.toString=function(){return this.name+": "+this.message},n}i.asPromise=r(51),i.base64=r(52),i.EventEmitter=r(53),i.float=r(54),i.inquire=r(55),i.utf8=r(56),i.pool=r(57),i.LongBits=r(58),i.isNode=Boolean(void 0!==t&&t&&t.process&&t.process.versions&&t.process.versions.node),i.global=i.isNode&&t||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},i.isString=function(t){return"string"==typeof t||t instanceof String},i.isObject=function(t){return t&&"object"==typeof t},i.isset=i.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!=typeof n||0<(Array.isArray(n)?n:Object.keys(n)).length)},i.Buffer=(()=>{try{var t=i.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}})(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(t){return"number"==typeof t?i.Buffer?i._Buffer_allocUnsafe(t):new i.Array(t):i.Buffer?i._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(t){return t?i.LongBits.from(t).toHash():i.LongBits.zeroHash},i.longFromHash=function(t,e){t=i.LongBits.fromHash(t);return i.Long?i.Long.fromBits(t.lo,t.hi,e):t.toNumber(Boolean(e))},i.merge=s,i.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},i.newError=e,i.ProtocolError=e("ProtocolError"),i.oneOfGetter=function(t){for(var n={},e=0;e<t.length;++e)n[t[e]]=1;return function(){for(var t=Object.keys(this),e=t.length-1;-1<e;--e)if(1===n[t[e]]&&null!=this[t[e]])return t[e]}},i.oneOfSetter=function(n){return function(t){for(var e=0;e<n.length;++e)n[e]!==t&&delete this[n[e]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var n=i.Buffer;n?(i._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,e){return new n(t,e)},i._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}):i._Buffer_from=i._Buffer_allocUnsafe=null}}.call(this,r(21))},,,function(t,e){var n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},,function(t,e,n){n.r(e),n.d(e,"NO_EVENT",function(){return r}),n.d(e,"NOTE_OFF",function(){return c}),n.d(e,"Melody",function(){return h}),n.d(e,"MelodyRhythm",function(){return i}),n.d(e,"MelodyShape",function(){return o}),n.d(e,"MelodyRegister",function(){return l});var a=n(2),s=n(10),u=n(13);let r=0,c=1;class h{constructor(t,e,n){this.events=t,this.minPitch=e,this.maxPitch=n}static fromNoteSequence(t,e,n,i=!0,s){u.assertIsQuantizedSequence(t);let r=t.notes.sort((t,e)=>t.quantizedStartStep===e.quantizedStartStep?e.pitch-t.pitch:t.quantizedStartStep-e.quantizedStartStep),o=new Int32Array(s||t.totalQuantizedSteps),a=-1;return r.forEach(t=>{if(t.quantizedStartStep===a){if(i)return;throw new Error("`NoteSequence` is not monophonic.")}if(t.pitch<e||t.pitch>n)throw Error("`NoteSequence` has a pitch outside of the valid range: "+t.pitch);o[t.quantizedStartStep]=t.pitch-e+2,o[t.quantizedEndStep]=c,a=t.quantizedStartStep}),new h(o,e,n)}toNoteSequence(t,e){var n=u.createQuantizedNoteSequence(t,e);let i=null;for(let e=0;e<this.events.length;++e){let t=this.events[e];switch(t){case r:break;case c:i&&(i.quantizedEndStep=e,n.notes.push(i),i=null);break;default:i&&(i.quantizedEndStep=e,n.notes.push(i)),i=s.a.Note.create({pitch:t-2+this.minPitch,quantizedStartStep:e})}}return i&&(i.quantizedEndStep=this.events.length,n.notes.push(i)),n.totalQuantizedSteps=this.events.length,n}}class i{constructor(){this.depth=1}extract(e){var n=e.events.length,i=a.buffer([n,1]);for(let t=0;t<n;++t)i.set(2<=e.events[t]?1:0,t,0);return i.toTensor().as2D(n,1)}}class o{constructor(){this.depth=3}extract(t){var n,i=t.events.length,s=a.buffer([i,3]);let r=null,o=null;for(let e=0;e<i;++e)if(2<=t.events[e]){if(null!==r){0===s.get(r,0)&&0===s.get(r,1)&&0===s.get(r,2)&&(r=-1),n=t.events[e]<o?0:t.events[e]>o?2:1;for(let t=e;t>r;--t)s.set(1,t,n)}r=e,o=t.events[e]}if(r!==i-1)if(null===r||0===s.get(r,0)&&0===s.get(r,1)&&0===s.get(r,2))for(let t=0;t<i;++t)s.set(1,t,1);else for(let e=i-1;e>r;--e)for(let t=0;t<3;t++)s.set(s.get(r,t),e,t);return s.toTensor().as2D(i,3)}}class l{constructor(t){this.boundaryPitches=t,this.depth=t.length+1}meanMelodyPitch(e){let n=0,i=0,s=null;for(let t=0;t<e.events.length;++t)e.events[t]===c?s=null:2<=e.events[t]&&(s=e.minPitch+e.events[t]-2),null!==s&&(n+=s,i+=1);return i?n/i:null}extract(t){var e=t.events.length,n=this.meanMelodyPitch(t);if(null===n)return a.zeros([e,this.depth]);let i=0;for(;i<this.boundaryPitches.length&&n>=this.boundaryPitches[i];)i++;var s=a.buffer([e,this.depth]);for(let t=0;t<e;++t)s.set(1,t,i);return s.toTensor().as2D(e,this.depth)}}},,,,,,function(t,e,n){n.r(e),n.d(e,"Performance",function(){return f});var u=n(10),p=n(8),d=n(13),c=n(12);class f{constructor(t,e,n,i,s){this.events=t,this.maxShiftSteps=e,this.numVelocityBins=n,this.program=i,this.isDrum=s}static fromNoteSequence(t,n,e,i){d.assertIsQuantizedSequence(t);var s=t.notes.filter((t,e)=>void 0===i||t.instrument===i),r=s.sort((t,e)=>t.startTime===e.startTime?t.pitch-e.pitch:t.startTime-e.startTime),o=r.map((t,e)=>({step:t.quantizedStartStep,index:e,isOffset:0})),a=r.map((t,e)=>({step:t.quantizedEndStep,index:e,isOffset:1})),o=o.concat(a).sort((t,e)=>t.step===e.step?t.index===e.index?t.isOffset-e.isOffset:t.index-e.index:t.step-e.step),u=e?Math.ceil((p.MIDI_VELOCITIES-1)/e):void 0,c=[];let h=0,l=e;for(let e of o){if(e.step>h){for(;e.step>h+n;)c.push({type:"time-shift",steps:n}),h+=n;c.push({type:"time-shift",steps:e.step-h}),h=e.step}if(e.isOffset)c.push({type:"note-off",pitch:r[e.index].pitch});else{if(u){let t=Math.floor((r[e.index].velocity-p.MIN_MIDI_VELOCITY-1)/u)+1;t!==l&&(c.push({type:"velocity-change",velocityBin:t}),l=t)}c.push({type:"note-on",pitch:r[e.index].pitch})}}a=!!s.some(t=>t.isDrum)&&(!s.some(t=>!t.isDrum)||void 0),o=Array.from(new Set(s.map(t=>t.program))),s=a||1!==o.length?void 0:o[0],o=new f(c,n,e,s,a);return o.setNumSteps(t.totalQuantizedSteps),o}getNumSteps(){return this.events.filter(t=>"time-shift"===t.type).map(t=>t.steps).reduce((t,e)=>t+e,0)}setNumSteps(t){let e=this.getNumSteps();var n,i;if(e<t)for(this.events.length&&"time-shift"===(n=this.events[this.events.length-1]).type&&(i=Math.min(t-e,this.maxShiftSteps-n.steps),n.steps+=i,e+=i);e<t;)e+this.maxShiftSteps>t?(this.events.push({type:"time-shift",steps:t-e}),e=t):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),e+=this.maxShiftSteps);else if(e>t)for(;this.events.length&&e>t;){var s=this.events[this.events.length-1];"time-shift"===s.type?e-s.steps<t?(s.steps-=e-t,e=t):(this.events.pop(),e-=s.steps):this.events.pop()}}toNoteSequence(s){let t=this.numVelocityBins?Math.ceil((p.MIDI_VELOCITIES-1)/this.numVelocityBins):void 0,r=u.a.create(),o=0,e=void 0;var n,i=new Map;for(let t=p.MIN_MIDI_PITCH;t<=p.MAX_MIDI_PITCH;++t)i.set(t,[]);for(n of this.events)switch(n.type){case"note-on":i.get(n.pitch).push([o,e]);break;case"note-off":var a=i.get(n.pitch);if(a.length){let[t,e]=a.shift();o>t?r.notes.push(u.a.Note.create({pitch:n.pitch,velocity:e,instrument:s,quantizedStartStep:t,quantizedEndStep:o,program:this.program,isDrum:this.isDrum})):c.log(`Ignoring zero-length note: (pitch = ${n.pitch}, step = ${o})`,"Performance")}else c.log(`Ignoring note-off with no previous note-on:(pitch = ${n.pitch}, step = ${o})`,"Performance");break;case"time-shift":o+=n.steps;break;case"velocity-change":if(!t)throw new Error("Unexpected velocity change event: "+n);e=p.MIN_MIDI_VELOCITY+(n.velocityBin-1)*t+1;break;default:throw new Error("Unrecognized performance event: "+n)}return i.forEach((t,e)=>{for(var[n,i]of t)o>n?r.notes.push(u.a.Note.create({pitch:e,velocity:i,instrument:s,quantizedStartStep:n,quantizedEndStep:o,program:this.program,isDrum:this.isDrum})):c.log(`Ignoring zero-length note: (pitch = ${e}, step = ${o})`,"Performance")}),r.totalQuantizedSteps=o,r}}},,,,function(t,e,n){t.exports=l;var i,s=n(18),r=s.LongBits,o=s.base64,a=s.utf8;function u(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function c(){}function h(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function l(){this.len=0,this.head=new u(c,0,0),this.tail=this.head,this.states=null}function p(){return s.Buffer?function(){return(l.create=function(){return new i})()}:function(){return new l}}function d(t,e,n){e[n]=255&t}function f(t,e){this.len=t,this.next=void 0,this.val=e}function m(t,e,n){for(;t.hi;)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;127<t.lo;)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function g(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}l.create=p(),l.alloc=function(t){return new s.Array(t)},s.Array!==Array&&(l.alloc=s.pool(l.alloc,s.Array.prototype.subarray)),l.prototype._push=function(t,e,n){return this.tail=this.tail.next=new u(t,e,n),this.len+=e,this},(f.prototype=Object.create(u.prototype)).fn=function(t,e,n){for(;127<t;)e[n++]=127&t|128,t>>>=7;e[n]=t},l.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new f((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},l.prototype.int32=function(t){return t<0?this._push(m,10,r.fromNumber(t)):this.uint32(t)},l.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},l.prototype.int64=l.prototype.uint64=function(t){t=r.from(t);return this._push(m,t.length(),t)},l.prototype.sint64=function(t){t=r.from(t).zzEncode();return this._push(m,t.length(),t)},l.prototype.bool=function(t){return this._push(d,1,t?1:0)},l.prototype.sfixed32=l.prototype.fixed32=function(t){return this._push(g,4,t>>>0)},l.prototype.sfixed64=l.prototype.fixed64=function(t){t=r.from(t);return this._push(g,4,t.lo)._push(g,4,t.hi)},l.prototype.float=function(t){return this._push(s.float.writeFloatLE,4,t)},l.prototype.double=function(t){return this._push(s.float.writeDoubleLE,8,t)};var _=s.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var i=0;i<t.length;++i)e[n+i]=t[i]};l.prototype.bytes=function(t){var e,n=t.length>>>0;return n?(s.isString(t)&&(e=l.alloc(n=o.length(t)),o.decode(t,e,0),t=e),this.uint32(n)._push(_,n,t)):this._push(d,1,0)},l.prototype.string=function(t){var e=a.length(t);return e?this.uint32(e)._push(a.write,e,t):this._push(d,1,0)},l.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new u(c,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(c,0,0),this.len=0),this},l.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},l.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},l._configure=function(t){i=t,l.create=p(),i._configure()}},function(t,e,n){t.exports=u;var i,s=n(18),r=s.LongBits,o=s.utf8;function a(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function u(t){this.buf=t,this.pos=0,this.len=t.length}function c(){return s.Buffer?function(t){return(u.create=function(t){return s.Buffer.isBuffer(t)?new i(t):l(t)})(t)}:l}var h,l="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new u(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new u(t);throw Error("illegal buffer")};function p(){var t=new r(0,0),e=0;if(!(4<this.len-this.pos)){for(;e<3;++e){if(this.pos>=this.len)throw a(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,4<this.len-this.pos){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw a(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function d(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new r(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}u.create=c(),u.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,u.prototype.uint32=(h=4294967295,function(){if(h=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(h=(h|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(h=(h|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(h=(h|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(h=(h|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)||!((this.pos+=5)>this.len))return h;throw this.pos=this.len,a(this,10)}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var t=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},u.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var t=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},u.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw a(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},u.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},u.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw a(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},u._configure=function(t){i=t,u.create=c(),i._configure();var e=s.Long?"toLong":"toNumber";s.merge(u.prototype,{int64:function(){return p.call(this)[e](!1)},uint64:function(){return p.call(this)[e](!0)},sint64:function(){return p.call(this).zzDecode()[e](!1)},fixed64:function(){return f.call(this)[e](!0)},sfixed64:function(){return f.call(this)[e](!1)}})}},function(t,e,n){var i,s,r,o=n(49),a=o.Reader,u=o.Writer,c=o.util,h=o.roots.default||(o.roots.default={});function l(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function p(t){if(this.genre=[],this.composers=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function d(t){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function f(t){if(this.sections=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function m(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function g(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function _(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function y(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function v(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function b(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function S(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function w(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function x(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function T(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function A(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function k(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}function O(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}h.tensorflow=((n={}).magenta=((i={}).NoteSequence=(d.prototype.id="",d.prototype.filename="",d.prototype.referenceNumber=c.Long?c.Long.fromBits(0,0,!1):0,d.prototype.collectionName="",d.prototype.ticksPerQuarter=0,d.prototype.timeSignatures=c.emptyArray,d.prototype.keySignatures=c.emptyArray,d.prototype.tempos=c.emptyArray,d.prototype.notes=c.emptyArray,d.prototype.totalTime=0,d.prototype.totalQuantizedSteps=c.Long?c.Long.fromBits(0,0,!1):0,d.prototype.pitchBends=c.emptyArray,d.prototype.controlChanges=c.emptyArray,d.prototype.partInfos=c.emptyArray,d.prototype.sourceInfo=null,d.prototype.textAnnotations=c.emptyArray,d.prototype.sectionAnnotations=c.emptyArray,d.prototype.sectionGroups=c.emptyArray,d.prototype.quantizationInfo=null,d.prototype.subsequenceInfo=null,d.prototype.sequenceMetadata=null,d.create=function(t){return new d(t)},d.encode=function(t,e){if(e=e||u.create(),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(10).string(t.id),null!=t.filename&&t.hasOwnProperty("filename")&&e.uint32(18).string(t.filename),null!=t.collectionName&&t.hasOwnProperty("collectionName")&&e.uint32(26).string(t.collectionName),null!=t.ticksPerQuarter&&t.hasOwnProperty("ticksPerQuarter")&&e.uint32(32).int32(t.ticksPerQuarter),null!=t.timeSignatures&&t.timeSignatures.length)for(var n=0;n<t.timeSignatures.length;++n)h.tensorflow.magenta.NoteSequence.TimeSignature.encode(t.timeSignatures[n],e.uint32(42).fork()).ldelim();if(null!=t.keySignatures&&t.keySignatures.length)for(n=0;n<t.keySignatures.length;++n)h.tensorflow.magenta.NoteSequence.KeySignature.encode(t.keySignatures[n],e.uint32(50).fork()).ldelim();if(null!=t.tempos&&t.tempos.length)for(n=0;n<t.tempos.length;++n)h.tensorflow.magenta.NoteSequence.Tempo.encode(t.tempos[n],e.uint32(58).fork()).ldelim();if(null!=t.notes&&t.notes.length)for(n=0;n<t.notes.length;++n)h.tensorflow.magenta.NoteSequence.Note.encode(t.notes[n],e.uint32(66).fork()).ldelim();if(null!=t.totalTime&&t.hasOwnProperty("totalTime")&&e.uint32(73).double(t.totalTime),null!=t.pitchBends&&t.pitchBends.length)for(n=0;n<t.pitchBends.length;++n)h.tensorflow.magenta.NoteSequence.PitchBend.encode(t.pitchBends[n],e.uint32(82).fork()).ldelim();if(null!=t.controlChanges&&t.controlChanges.length)for(n=0;n<t.controlChanges.length;++n)h.tensorflow.magenta.NoteSequence.ControlChange.encode(t.controlChanges[n],e.uint32(90).fork()).ldelim();if(null!=t.partInfos&&t.partInfos.length)for(n=0;n<t.partInfos.length;++n)h.tensorflow.magenta.NoteSequence.PartInfo.encode(t.partInfos[n],e.uint32(98).fork()).ldelim();if(null!=t.sourceInfo&&t.hasOwnProperty("sourceInfo")&&h.tensorflow.magenta.NoteSequence.SourceInfo.encode(t.sourceInfo,e.uint32(106).fork()).ldelim(),null!=t.textAnnotations&&t.textAnnotations.length)for(n=0;n<t.textAnnotations.length;++n)h.tensorflow.magenta.NoteSequence.TextAnnotation.encode(t.textAnnotations[n],e.uint32(114).fork()).ldelim();if(null!=t.quantizationInfo&&t.hasOwnProperty("quantizationInfo")&&h.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(t.quantizationInfo,e.uint32(122).fork()).ldelim(),null!=t.totalQuantizedSteps&&t.hasOwnProperty("totalQuantizedSteps")&&e.uint32(128).int64(t.totalQuantizedSteps),null!=t.subsequenceInfo&&t.hasOwnProperty("subsequenceInfo")&&h.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(t.subsequenceInfo,e.uint32(138).fork()).ldelim(),null!=t.referenceNumber&&t.hasOwnProperty("referenceNumber")&&e.uint32(144).int64(t.referenceNumber),null!=t.sequenceMetadata&&t.hasOwnProperty("sequenceMetadata")&&h.tensorflow.magenta.SequenceMetadata.encode(t.sequenceMetadata,e.uint32(154).fork()).ldelim(),null!=t.sectionAnnotations&&t.sectionAnnotations.length)for(n=0;n<t.sectionAnnotations.length;++n)h.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(t.sectionAnnotations[n],e.uint32(162).fork()).ldelim();if(null!=t.sectionGroups&&t.sectionGroups.length)for(n=0;n<t.sectionGroups.length;++n)h.tensorflow.magenta.NoteSequence.SectionGroup.encode(t.sectionGroups[n],e.uint32(170).fork()).ldelim();return e},d.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},d.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.id=t.string();break;case 2:i.filename=t.string();break;case 18:i.referenceNumber=c.Long?t.int64().toNumber():t.int64();break;case 3:i.collectionName=t.string();break;case 4:i.ticksPerQuarter=t.int32();break;case 5:i.timeSignatures&&i.timeSignatures.length||(i.timeSignatures=[]),i.timeSignatures.push(h.tensorflow.magenta.NoteSequence.TimeSignature.decode(t,t.uint32()));break;case 6:i.keySignatures&&i.keySignatures.length||(i.keySignatures=[]),i.keySignatures.push(h.tensorflow.magenta.NoteSequence.KeySignature.decode(t,t.uint32()));break;case 7:i.tempos&&i.tempos.length||(i.tempos=[]),i.tempos.push(h.tensorflow.magenta.NoteSequence.Tempo.decode(t,t.uint32()));break;case 8:i.notes&&i.notes.length||(i.notes=[]),i.notes.push(h.tensorflow.magenta.NoteSequence.Note.decode(t,t.uint32()));break;case 9:i.totalTime=t.double();break;case 16:i.totalQuantizedSteps=c.Long?t.int64().toNumber():t.int64();break;case 10:i.pitchBends&&i.pitchBends.length||(i.pitchBends=[]),i.pitchBends.push(h.tensorflow.magenta.NoteSequence.PitchBend.decode(t,t.uint32()));break;case 11:i.controlChanges&&i.controlChanges.length||(i.controlChanges=[]),i.controlChanges.push(h.tensorflow.magenta.NoteSequence.ControlChange.decode(t,t.uint32()));break;case 12:i.partInfos&&i.partInfos.length||(i.partInfos=[]),i.partInfos.push(h.tensorflow.magenta.NoteSequence.PartInfo.decode(t,t.uint32()));break;case 13:i.sourceInfo=h.tensorflow.magenta.NoteSequence.SourceInfo.decode(t,t.uint32());break;case 14:i.textAnnotations&&i.textAnnotations.length||(i.textAnnotations=[]),i.textAnnotations.push(h.tensorflow.magenta.NoteSequence.TextAnnotation.decode(t,t.uint32()));break;case 20:i.sectionAnnotations&&i.sectionAnnotations.length||(i.sectionAnnotations=[]),i.sectionAnnotations.push(h.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(t,t.uint32()));break;case 21:i.sectionGroups&&i.sectionGroups.length||(i.sectionGroups=[]),i.sectionGroups.push(h.tensorflow.magenta.NoteSequence.SectionGroup.decode(t,t.uint32()));break;case 15:i.quantizationInfo=h.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(t,t.uint32());break;case 17:i.subsequenceInfo=h.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(t,t.uint32());break;case 19:i.sequenceMetadata=h.tensorflow.magenta.SequenceMetadata.decode(t,t.uint32());break;default:t.skipType(7&s)}}return i},d.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},d.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.id&&t.hasOwnProperty("id")&&!c.isString(t.id))return"id: string expected";if(null!=t.filename&&t.hasOwnProperty("filename")&&!c.isString(t.filename))return"filename: string expected";if(null!=t.referenceNumber&&t.hasOwnProperty("referenceNumber")&&!(c.isInteger(t.referenceNumber)||t.referenceNumber&&c.isInteger(t.referenceNumber.low)&&c.isInteger(t.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=t.collectionName&&t.hasOwnProperty("collectionName")&&!c.isString(t.collectionName))return"collectionName: string expected";if(null!=t.ticksPerQuarter&&t.hasOwnProperty("ticksPerQuarter")&&!c.isInteger(t.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=t.timeSignatures&&t.hasOwnProperty("timeSignatures")){if(!Array.isArray(t.timeSignatures))return"timeSignatures: array expected";for(var e=0;e<t.timeSignatures.length;++e)if(n=h.tensorflow.magenta.NoteSequence.TimeSignature.verify(t.timeSignatures[e]))return"timeSignatures."+n}if(null!=t.keySignatures&&t.hasOwnProperty("keySignatures")){if(!Array.isArray(t.keySignatures))return"keySignatures: array expected";for(e=0;e<t.keySignatures.length;++e)if(n=h.tensorflow.magenta.NoteSequence.KeySignature.verify(t.keySignatures[e]))return"keySignatures."+n}if(null!=t.tempos&&t.hasOwnProperty("tempos")){if(!Array.isArray(t.tempos))return"tempos: array expected";for(e=0;e<t.tempos.length;++e)if(n=h.tensorflow.magenta.NoteSequence.Tempo.verify(t.tempos[e]))return"tempos."+n}if(null!=t.notes&&t.hasOwnProperty("notes")){if(!Array.isArray(t.notes))return"notes: array expected";for(e=0;e<t.notes.length;++e)if(n=h.tensorflow.magenta.NoteSequence.Note.verify(t.notes[e]))return"notes."+n}if(null!=t.totalTime&&t.hasOwnProperty("totalTime")&&"number"!=typeof t.totalTime)return"totalTime: number expected";if(null!=t.totalQuantizedSteps&&t.hasOwnProperty("totalQuantizedSteps")&&!(c.isInteger(t.totalQuantizedSteps)||t.totalQuantizedSteps&&c.isInteger(t.totalQuantizedSteps.low)&&c.isInteger(t.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=t.pitchBends&&t.hasOwnProperty("pitchBends")){if(!Array.isArray(t.pitchBends))return"pitchBends: array expected";for(e=0;e<t.pitchBends.length;++e)if(n=h.tensorflow.magenta.NoteSequence.PitchBend.verify(t.pitchBends[e]))return"pitchBends."+n}if(null!=t.controlChanges&&t.hasOwnProperty("controlChanges")){if(!Array.isArray(t.controlChanges))return"controlChanges: array expected";for(e=0;e<t.controlChanges.length;++e)if(n=h.tensorflow.magenta.NoteSequence.ControlChange.verify(t.controlChanges[e]))return"controlChanges."+n}if(null!=t.partInfos&&t.hasOwnProperty("partInfos")){if(!Array.isArray(t.partInfos))return"partInfos: array expected";for(e=0;e<t.partInfos.length;++e)if(n=h.tensorflow.magenta.NoteSequence.PartInfo.verify(t.partInfos[e]))return"partInfos."+n}if(null!=t.sourceInfo&&t.hasOwnProperty("sourceInfo")&&(n=h.tensorflow.magenta.NoteSequence.SourceInfo.verify(t.sourceInfo)))return"sourceInfo."+n;if(null!=t.textAnnotations&&t.hasOwnProperty("textAnnotations")){if(!Array.isArray(t.textAnnotations))return"textAnnotations: array expected";for(e=0;e<t.textAnnotations.length;++e)if(n=h.tensorflow.magenta.NoteSequence.TextAnnotation.verify(t.textAnnotations[e]))return"textAnnotations."+n}if(null!=t.sectionAnnotations&&t.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(t.sectionAnnotations))return"sectionAnnotations: array expected";for(e=0;e<t.sectionAnnotations.length;++e)if(n=h.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(t.sectionAnnotations[e]))return"sectionAnnotations."+n}if(null!=t.sectionGroups&&t.hasOwnProperty("sectionGroups")){if(!Array.isArray(t.sectionGroups))return"sectionGroups: array expected";for(e=0;e<t.sectionGroups.length;++e){var n;if(n=h.tensorflow.magenta.NoteSequence.SectionGroup.verify(t.sectionGroups[e]))return"sectionGroups."+n}}return null!=t.quantizationInfo&&t.hasOwnProperty("quantizationInfo")&&(n=h.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(t.quantizationInfo))?"quantizationInfo."+n:null!=t.subsequenceInfo&&t.hasOwnProperty("subsequenceInfo")&&(n=h.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(t.subsequenceInfo))?"subsequenceInfo."+n:null!=t.sequenceMetadata&&t.hasOwnProperty("sequenceMetadata")&&(n=h.tensorflow.magenta.SequenceMetadata.verify(t.sequenceMetadata))?"sequenceMetadata."+n:null},d.fromObject=function(t){if(t instanceof h.tensorflow.magenta.NoteSequence)return t;var e=new h.tensorflow.magenta.NoteSequence;if(null!=t.id&&(e.id=String(t.id)),null!=t.filename&&(e.filename=String(t.filename)),null!=t.referenceNumber&&(c.Long?(e.referenceNumber=c.Long.fromValue(t.referenceNumber)).unsigned=!1:"string"==typeof t.referenceNumber?e.referenceNumber=parseInt(t.referenceNumber,10):"number"==typeof t.referenceNumber?e.referenceNumber=t.referenceNumber:"object"==typeof t.referenceNumber&&(e.referenceNumber=new c.LongBits(t.referenceNumber.low>>>0,t.referenceNumber.high>>>0).toNumber())),null!=t.collectionName&&(e.collectionName=String(t.collectionName)),null!=t.ticksPerQuarter&&(e.ticksPerQuarter=0|t.ticksPerQuarter),t.timeSignatures){if(!Array.isArray(t.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");e.timeSignatures=[];for(var n=0;n<t.timeSignatures.length;++n){if("object"!=typeof t.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");e.timeSignatures[n]=h.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(t.timeSignatures[n])}}if(t.keySignatures){if(!Array.isArray(t.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");for(e.keySignatures=[],n=0;n<t.keySignatures.length;++n){if("object"!=typeof t.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");e.keySignatures[n]=h.tensorflow.magenta.NoteSequence.KeySignature.fromObject(t.keySignatures[n])}}if(t.tempos){if(!Array.isArray(t.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");for(e.tempos=[],n=0;n<t.tempos.length;++n){if("object"!=typeof t.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");e.tempos[n]=h.tensorflow.magenta.NoteSequence.Tempo.fromObject(t.tempos[n])}}if(t.notes){if(!Array.isArray(t.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");for(e.notes=[],n=0;n<t.notes.length;++n){if("object"!=typeof t.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");e.notes[n]=h.tensorflow.magenta.NoteSequence.Note.fromObject(t.notes[n])}}if(null!=t.totalTime&&(e.totalTime=Number(t.totalTime)),null!=t.totalQuantizedSteps&&(c.Long?(e.totalQuantizedSteps=c.Long.fromValue(t.totalQuantizedSteps)).unsigned=!1:"string"==typeof t.totalQuantizedSteps?e.totalQuantizedSteps=parseInt(t.totalQuantizedSteps,10):"number"==typeof t.totalQuantizedSteps?e.totalQuantizedSteps=t.totalQuantizedSteps:"object"==typeof t.totalQuantizedSteps&&(e.totalQuantizedSteps=new c.LongBits(t.totalQuantizedSteps.low>>>0,t.totalQuantizedSteps.high>>>0).toNumber())),t.pitchBends){if(!Array.isArray(t.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");for(e.pitchBends=[],n=0;n<t.pitchBends.length;++n){if("object"!=typeof t.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");e.pitchBends[n]=h.tensorflow.magenta.NoteSequence.PitchBend.fromObject(t.pitchBends[n])}}if(t.controlChanges){if(!Array.isArray(t.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");for(e.controlChanges=[],n=0;n<t.controlChanges.length;++n){if("object"!=typeof t.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");e.controlChanges[n]=h.tensorflow.magenta.NoteSequence.ControlChange.fromObject(t.controlChanges[n])}}if(t.partInfos){if(!Array.isArray(t.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");for(e.partInfos=[],n=0;n<t.partInfos.length;++n){if("object"!=typeof t.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");e.partInfos[n]=h.tensorflow.magenta.NoteSequence.PartInfo.fromObject(t.partInfos[n])}}if(null!=t.sourceInfo){if("object"!=typeof t.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");e.sourceInfo=h.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(t.sourceInfo)}if(t.textAnnotations){if(!Array.isArray(t.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");for(e.textAnnotations=[],n=0;n<t.textAnnotations.length;++n){if("object"!=typeof t.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");e.textAnnotations[n]=h.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(t.textAnnotations[n])}}if(t.sectionAnnotations){if(!Array.isArray(t.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");for(e.sectionAnnotations=[],n=0;n<t.sectionAnnotations.length;++n){if("object"!=typeof t.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");e.sectionAnnotations[n]=h.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(t.sectionAnnotations[n])}}if(t.sectionGroups){if(!Array.isArray(t.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");for(e.sectionGroups=[],n=0;n<t.sectionGroups.length;++n){if("object"!=typeof t.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");e.sectionGroups[n]=h.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(t.sectionGroups[n])}}if(null!=t.quantizationInfo){if("object"!=typeof t.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");e.quantizationInfo=h.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(t.quantizationInfo)}if(null!=t.subsequenceInfo){if("object"!=typeof t.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");e.subsequenceInfo=h.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(t.subsequenceInfo)}if(null!=t.sequenceMetadata){if("object"!=typeof t.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");e.sequenceMetadata=h.tensorflow.magenta.SequenceMetadata.fromObject(t.sequenceMetadata)}return e},d.toObject=function(t,e){var n,i={};if(((e=e||{}).arrays||e.defaults)&&(i.timeSignatures=[],i.keySignatures=[],i.tempos=[],i.notes=[],i.pitchBends=[],i.controlChanges=[],i.partInfos=[],i.textAnnotations=[],i.sectionAnnotations=[],i.sectionGroups=[]),e.defaults&&(i.id="",i.filename="",i.collectionName="",i.ticksPerQuarter=0,i.totalTime=0,i.sourceInfo=null,i.quantizationInfo=null,c.Long?(n=new c.Long(0,0,!1),i.totalQuantizedSteps=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.totalQuantizedSteps=e.longs===String?"0":0,i.subsequenceInfo=null,c.Long?(n=new c.Long(0,0,!1),i.referenceNumber=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.referenceNumber=e.longs===String?"0":0,i.sequenceMetadata=null),null!=t.id&&t.hasOwnProperty("id")&&(i.id=t.id),null!=t.filename&&t.hasOwnProperty("filename")&&(i.filename=t.filename),null!=t.collectionName&&t.hasOwnProperty("collectionName")&&(i.collectionName=t.collectionName),null!=t.ticksPerQuarter&&t.hasOwnProperty("ticksPerQuarter")&&(i.ticksPerQuarter=t.ticksPerQuarter),t.timeSignatures&&t.timeSignatures.length){i.timeSignatures=[];for(var s=0;s<t.timeSignatures.length;++s)i.timeSignatures[s]=h.tensorflow.magenta.NoteSequence.TimeSignature.toObject(t.timeSignatures[s],e)}if(t.keySignatures&&t.keySignatures.length)for(i.keySignatures=[],s=0;s<t.keySignatures.length;++s)i.keySignatures[s]=h.tensorflow.magenta.NoteSequence.KeySignature.toObject(t.keySignatures[s],e);if(t.tempos&&t.tempos.length)for(i.tempos=[],s=0;s<t.tempos.length;++s)i.tempos[s]=h.tensorflow.magenta.NoteSequence.Tempo.toObject(t.tempos[s],e);if(t.notes&&t.notes.length)for(i.notes=[],s=0;s<t.notes.length;++s)i.notes[s]=h.tensorflow.magenta.NoteSequence.Note.toObject(t.notes[s],e);if(null!=t.totalTime&&t.hasOwnProperty("totalTime")&&(i.totalTime=e.json&&!isFinite(t.totalTime)?String(t.totalTime):t.totalTime),t.pitchBends&&t.pitchBends.length)for(i.pitchBends=[],s=0;s<t.pitchBends.length;++s)i.pitchBends[s]=h.tensorflow.magenta.NoteSequence.PitchBend.toObject(t.pitchBends[s],e);if(t.controlChanges&&t.controlChanges.length)for(i.controlChanges=[],s=0;s<t.controlChanges.length;++s)i.controlChanges[s]=h.tensorflow.magenta.NoteSequence.ControlChange.toObject(t.controlChanges[s],e);if(t.partInfos&&t.partInfos.length)for(i.partInfos=[],s=0;s<t.partInfos.length;++s)i.partInfos[s]=h.tensorflow.magenta.NoteSequence.PartInfo.toObject(t.partInfos[s],e);if(null!=t.sourceInfo&&t.hasOwnProperty("sourceInfo")&&(i.sourceInfo=h.tensorflow.magenta.NoteSequence.SourceInfo.toObject(t.sourceInfo,e)),t.textAnnotations&&t.textAnnotations.length)for(i.textAnnotations=[],s=0;s<t.textAnnotations.length;++s)i.textAnnotations[s]=h.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(t.textAnnotations[s],e);if(null!=t.quantizationInfo&&t.hasOwnProperty("quantizationInfo")&&(i.quantizationInfo=h.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(t.quantizationInfo,e)),null!=t.totalQuantizedSteps&&t.hasOwnProperty("totalQuantizedSteps")&&("number"==typeof t.totalQuantizedSteps?i.totalQuantizedSteps=e.longs===String?String(t.totalQuantizedSteps):t.totalQuantizedSteps:i.totalQuantizedSteps=e.longs===String?c.Long.prototype.toString.call(t.totalQuantizedSteps):e.longs===Number?new c.LongBits(t.totalQuantizedSteps.low>>>0,t.totalQuantizedSteps.high>>>0).toNumber():t.totalQuantizedSteps),null!=t.subsequenceInfo&&t.hasOwnProperty("subsequenceInfo")&&(i.subsequenceInfo=h.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(t.subsequenceInfo,e)),null!=t.referenceNumber&&t.hasOwnProperty("referenceNumber")&&("number"==typeof t.referenceNumber?i.referenceNumber=e.longs===String?String(t.referenceNumber):t.referenceNumber:i.referenceNumber=e.longs===String?c.Long.prototype.toString.call(t.referenceNumber):e.longs===Number?new c.LongBits(t.referenceNumber.low>>>0,t.referenceNumber.high>>>0).toNumber():t.referenceNumber),null!=t.sequenceMetadata&&t.hasOwnProperty("sequenceMetadata")&&(i.sequenceMetadata=h.tensorflow.magenta.SequenceMetadata.toObject(t.sequenceMetadata,e)),t.sectionAnnotations&&t.sectionAnnotations.length)for(i.sectionAnnotations=[],s=0;s<t.sectionAnnotations.length;++s)i.sectionAnnotations[s]=h.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(t.sectionAnnotations[s],e);if(t.sectionGroups&&t.sectionGroups.length)for(i.sectionGroups=[],s=0;s<t.sectionGroups.length;++s)i.sectionGroups[s]=h.tensorflow.magenta.NoteSequence.SectionGroup.toObject(t.sectionGroups[s],e);return i},d.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},d.Note=(O.prototype.pitch=0,O.prototype.pitchName=0,O.prototype.velocity=0,O.prototype.startTime=0,O.prototype.quantizedStartStep=c.Long?c.Long.fromBits(0,0,!1):0,O.prototype.endTime=0,O.prototype.quantizedEndStep=c.Long?c.Long.fromBits(0,0,!1):0,O.prototype.numerator=0,O.prototype.denominator=0,O.prototype.instrument=0,O.prototype.program=0,O.prototype.isDrum=!1,O.prototype.part=0,O.prototype.voice=0,O.create=function(t){return new O(t)},O.encode=function(t,e){return e=e||u.create(),null!=t.pitch&&t.hasOwnProperty("pitch")&&e.uint32(8).int32(t.pitch),null!=t.velocity&&t.hasOwnProperty("velocity")&&e.uint32(16).int32(t.velocity),null!=t.startTime&&t.hasOwnProperty("startTime")&&e.uint32(25).double(t.startTime),null!=t.endTime&&t.hasOwnProperty("endTime")&&e.uint32(33).double(t.endTime),null!=t.numerator&&t.hasOwnProperty("numerator")&&e.uint32(40).int32(t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&e.uint32(48).int32(t.denominator),null!=t.instrument&&t.hasOwnProperty("instrument")&&e.uint32(56).int32(t.instrument),null!=t.program&&t.hasOwnProperty("program")&&e.uint32(64).int32(t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&e.uint32(72).bool(t.isDrum),null!=t.part&&t.hasOwnProperty("part")&&e.uint32(80).int32(t.part),null!=t.pitchName&&t.hasOwnProperty("pitchName")&&e.uint32(88).int32(t.pitchName),null!=t.voice&&t.hasOwnProperty("voice")&&e.uint32(96).int32(t.voice),null!=t.quantizedStartStep&&t.hasOwnProperty("quantizedStartStep")&&e.uint32(104).int64(t.quantizedStartStep),null!=t.quantizedEndStep&&t.hasOwnProperty("quantizedEndStep")&&e.uint32(112).int64(t.quantizedEndStep),e},O.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},O.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.Note;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.pitch=t.int32();break;case 11:i.pitchName=t.int32();break;case 2:i.velocity=t.int32();break;case 3:i.startTime=t.double();break;case 13:i.quantizedStartStep=c.Long?t.int64().toNumber():t.int64();break;case 4:i.endTime=t.double();break;case 14:i.quantizedEndStep=c.Long?t.int64().toNumber():t.int64();break;case 5:i.numerator=t.int32();break;case 6:i.denominator=t.int32();break;case 7:i.instrument=t.int32();break;case 8:i.program=t.int32();break;case 9:i.isDrum=t.bool();break;case 10:i.part=t.int32();break;case 12:i.voice=t.int32();break;default:t.skipType(7&s)}}return i},O.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},O.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.pitch&&t.hasOwnProperty("pitch")&&!c.isInteger(t.pitch))return"pitch: integer expected";if(null!=t.pitchName&&t.hasOwnProperty("pitchName"))switch(t.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return null!=t.velocity&&t.hasOwnProperty("velocity")&&!c.isInteger(t.velocity)?"velocity: integer expected":null!=t.startTime&&t.hasOwnProperty("startTime")&&"number"!=typeof t.startTime?"startTime: number expected":null!=t.quantizedStartStep&&t.hasOwnProperty("quantizedStartStep")&&!(c.isInteger(t.quantizedStartStep)||t.quantizedStartStep&&c.isInteger(t.quantizedStartStep.low)&&c.isInteger(t.quantizedStartStep.high))?"quantizedStartStep: integer|Long expected":null!=t.endTime&&t.hasOwnProperty("endTime")&&"number"!=typeof t.endTime?"endTime: number expected":null!=t.quantizedEndStep&&t.hasOwnProperty("quantizedEndStep")&&!(c.isInteger(t.quantizedEndStep)||t.quantizedEndStep&&c.isInteger(t.quantizedEndStep.low)&&c.isInteger(t.quantizedEndStep.high))?"quantizedEndStep: integer|Long expected":null!=t.numerator&&t.hasOwnProperty("numerator")&&!c.isInteger(t.numerator)?"numerator: integer expected":null!=t.denominator&&t.hasOwnProperty("denominator")&&!c.isInteger(t.denominator)?"denominator: integer expected":null!=t.instrument&&t.hasOwnProperty("instrument")&&!c.isInteger(t.instrument)?"instrument: integer expected":null!=t.program&&t.hasOwnProperty("program")&&!c.isInteger(t.program)?"program: integer expected":null!=t.isDrum&&t.hasOwnProperty("isDrum")&&"boolean"!=typeof t.isDrum?"isDrum: boolean expected":null!=t.part&&t.hasOwnProperty("part")&&!c.isInteger(t.part)?"part: integer expected":null!=t.voice&&t.hasOwnProperty("voice")&&!c.isInteger(t.voice)?"voice: integer expected":null},O.fromObject=function(t){if(t instanceof h.tensorflow.magenta.NoteSequence.Note)return t;var e=new h.tensorflow.magenta.NoteSequence.Note;switch(null!=t.pitch&&(e.pitch=0|t.pitch),t.pitchName){case"UNKNOWN_PITCH_NAME":case 0:e.pitchName=0;break;case"F_FLAT_FLAT":case 1:e.pitchName=1;break;case"C_FLAT_FLAT":case 2:e.pitchName=2;break;case"G_FLAT_FLAT":case 3:e.pitchName=3;break;case"D_FLAT_FLAT":case 4:e.pitchName=4;break;case"A_FLAT_FLAT":case 5:e.pitchName=5;break;case"E_FLAT_FLAT":case 6:e.pitchName=6;break;case"B_FLAT_FLAT":case 7:e.pitchName=7;break;case"F_FLAT":case 8:e.pitchName=8;break;case"C_FLAT":case 9:e.pitchName=9;break;case"G_FLAT":case 10:e.pitchName=10;break;case"D_FLAT":case 11:e.pitchName=11;break;case"A_FLAT":case 12:e.pitchName=12;break;case"E_FLAT":case 13:e.pitchName=13;break;case"B_FLAT":case 14:e.pitchName=14;break;case"F":case 15:e.pitchName=15;break;case"C":case 16:e.pitchName=16;break;case"G":case 17:e.pitchName=17;break;case"D":case 18:e.pitchName=18;break;case"A":case 19:e.pitchName=19;break;case"E":case 20:e.pitchName=20;break;case"B":case 21:e.pitchName=21;break;case"F_SHARP":case 22:e.pitchName=22;break;case"C_SHARP":case 23:e.pitchName=23;break;case"G_SHARP":case 24:e.pitchName=24;break;case"D_SHARP":case 25:e.pitchName=25;break;case"A_SHARP":case 26:e.pitchName=26;break;case"E_SHARP":case 27:e.pitchName=27;break;case"B_SHARP":case 28:e.pitchName=28;break;case"F_SHARP_SHARP":case 29:e.pitchName=29;break;case"C_SHARP_SHARP":case 30:e.pitchName=30;break;case"G_SHARP_SHARP":case 31:e.pitchName=31;break;case"D_SHARP_SHARP":case 32:e.pitchName=32;break;case"A_SHARP_SHARP":case 33:e.pitchName=33;break;case"E_SHARP_SHARP":case 34:e.pitchName=34;break;case"B_SHARP_SHARP":case 35:e.pitchName=35}return null!=t.velocity&&(e.velocity=0|t.velocity),null!=t.startTime&&(e.startTime=Number(t.startTime)),null!=t.quantizedStartStep&&(c.Long?(e.quantizedStartStep=c.Long.fromValue(t.quantizedStartStep)).unsigned=!1:"string"==typeof t.quantizedStartStep?e.quantizedStartStep=parseInt(t.quantizedStartStep,10):"number"==typeof t.quantizedStartStep?e.quantizedStartStep=t.quantizedStartStep:"object"==typeof t.quantizedStartStep&&(e.quantizedStartStep=new c.LongBits(t.quantizedStartStep.low>>>0,t.quantizedStartStep.high>>>0).toNumber())),null!=t.endTime&&(e.endTime=Number(t.endTime)),null!=t.quantizedEndStep&&(c.Long?(e.quantizedEndStep=c.Long.fromValue(t.quantizedEndStep)).unsigned=!1:"string"==typeof t.quantizedEndStep?e.quantizedEndStep=parseInt(t.quantizedEndStep,10):"number"==typeof t.quantizedEndStep?e.quantizedEndStep=t.quantizedEndStep:"object"==typeof t.quantizedEndStep&&(e.quantizedEndStep=new c.LongBits(t.quantizedEndStep.low>>>0,t.quantizedEndStep.high>>>0).toNumber())),null!=t.numerator&&(e.numerator=0|t.numerator),null!=t.denominator&&(e.denominator=0|t.denominator),null!=t.instrument&&(e.instrument=0|t.instrument),null!=t.program&&(e.program=0|t.program),null!=t.isDrum&&(e.isDrum=Boolean(t.isDrum)),null!=t.part&&(e.part=0|t.part),null!=t.voice&&(e.voice=0|t.voice),e},O.toObject=function(t,e){var n,i={};return(e=e||{}).defaults&&(i.pitch=0,i.velocity=0,i.startTime=0,i.endTime=0,i.numerator=0,i.denominator=0,i.instrument=0,i.program=0,i.isDrum=!1,i.part=0,i.pitchName=e.enums===String?"UNKNOWN_PITCH_NAME":0,i.voice=0,c.Long?(n=new c.Long(0,0,!1),i.quantizedStartStep=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.quantizedStartStep=e.longs===String?"0":0,c.Long?(n=new c.Long(0,0,!1),i.quantizedEndStep=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.quantizedEndStep=e.longs===String?"0":0),null!=t.pitch&&t.hasOwnProperty("pitch")&&(i.pitch=t.pitch),null!=t.velocity&&t.hasOwnProperty("velocity")&&(i.velocity=t.velocity),null!=t.startTime&&t.hasOwnProperty("startTime")&&(i.startTime=e.json&&!isFinite(t.startTime)?String(t.startTime):t.startTime),null!=t.endTime&&t.hasOwnProperty("endTime")&&(i.endTime=e.json&&!isFinite(t.endTime)?String(t.endTime):t.endTime),null!=t.numerator&&t.hasOwnProperty("numerator")&&(i.numerator=t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&(i.denominator=t.denominator),null!=t.instrument&&t.hasOwnProperty("instrument")&&(i.instrument=t.instrument),null!=t.program&&t.hasOwnProperty("program")&&(i.program=t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&(i.isDrum=t.isDrum),null!=t.part&&t.hasOwnProperty("part")&&(i.part=t.part),null!=t.pitchName&&t.hasOwnProperty("pitchName")&&(i.pitchName=e.enums===String?h.tensorflow.magenta.NoteSequence.PitchName[t.pitchName]:t.pitchName),null!=t.voice&&t.hasOwnProperty("voice")&&(i.voice=t.voice),null!=t.quantizedStartStep&&t.hasOwnProperty("quantizedStartStep")&&("number"==typeof t.quantizedStartStep?i.quantizedStartStep=e.longs===String?String(t.quantizedStartStep):t.quantizedStartStep:i.quantizedStartStep=e.longs===String?c.Long.prototype.toString.call(t.quantizedStartStep):e.longs===Number?new c.LongBits(t.quantizedStartStep.low>>>0,t.quantizedStartStep.high>>>0).toNumber():t.quantizedStartStep),null!=t.quantizedEndStep&&t.hasOwnProperty("quantizedEndStep")&&("number"==typeof t.quantizedEndStep?i.quantizedEndStep=e.longs===String?String(t.quantizedEndStep):t.quantizedEndStep:i.quantizedEndStep=e.longs===String?c.Long.prototype.toString.call(t.quantizedEndStep):e.longs===Number?new c.LongBits(t.quantizedEndStep.low>>>0,t.quantizedEndStep.high>>>0).toNumber():t.quantizedEndStep),i},O.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},O),d.PitchName=(s={},(r=Object.create(s))[s[0]="UNKNOWN_PITCH_NAME"]=0,r[s[1]="F_FLAT_FLAT"]=1,r[s[2]="C_FLAT_FLAT"]=2,r[s[3]="G_FLAT_FLAT"]=3,r[s[4]="D_FLAT_FLAT"]=4,r[s[5]="A_FLAT_FLAT"]=5,r[s[6]="E_FLAT_FLAT"]=6,r[s[7]="B_FLAT_FLAT"]=7,r[s[8]="F_FLAT"]=8,r[s[9]="C_FLAT"]=9,r[s[10]="G_FLAT"]=10,r[s[11]="D_FLAT"]=11,r[s[12]="A_FLAT"]=12,r[s[13]="E_FLAT"]=13,r[s[14]="B_FLAT"]=14,r[s[15]="F"]=15,r[s[16]="C"]=16,r[s[17]="G"]=17,r[s[18]="D"]=18,r[s[19]="A"]=19,r[s[20]="E"]=20,r[s[21]="B"]=21,r[s[22]="F_SHARP"]=22,r[s[23]="C_SHARP"]=23,r[s[24]="G_SHARP"]=24,r[s[25]="D_SHARP"]=25,r[s[26]="A_SHARP"]=26,r[s[27]="E_SHARP"]=27,r[s[28]="B_SHARP"]=28,r[s[29]="F_SHARP_SHARP"]=29,r[s[30]="C_SHARP_SHARP"]=30,r[s[31]="G_SHARP_SHARP"]=31,r[s[32]="D_SHARP_SHARP"]=32,r[s[33]="A_SHARP_SHARP"]=33,r[s[34]="E_SHARP_SHARP"]=34,r[s[35]="B_SHARP_SHARP"]=35,r),d.TimeSignature=(k.prototype.time=0,k.prototype.numerator=0,k.prototype.denominator=0,k.create=function(t){return new k(t)},k.encode=function(t,e){return e=e||u.create(),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.numerator&&t.hasOwnProperty("numerator")&&e.uint32(16).int32(t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&e.uint32(24).int32(t.denominator),e},k.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},k.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.TimeSignature;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.time=t.double();break;case 2:i.numerator=t.int32();break;case 3:i.denominator=t.int32();break;default:t.skipType(7&s)}}return i},k.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},k.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time?"time: number expected":null!=t.numerator&&t.hasOwnProperty("numerator")&&!c.isInteger(t.numerator)?"numerator: integer expected":null!=t.denominator&&t.hasOwnProperty("denominator")&&!c.isInteger(t.denominator)?"denominator: integer expected":null},k.fromObject=function(t){var e;return t instanceof h.tensorflow.magenta.NoteSequence.TimeSignature?t:(e=new h.tensorflow.magenta.NoteSequence.TimeSignature,null!=t.time&&(e.time=Number(t.time)),null!=t.numerator&&(e.numerator=0|t.numerator),null!=t.denominator&&(e.denominator=0|t.denominator),e)},k.toObject=function(t,e){var n={};return(e=e||{}).defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.numerator&&t.hasOwnProperty("numerator")&&(n.numerator=t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&(n.denominator=t.denominator),n},k.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},k),d.KeySignature=(A.prototype.time=0,A.prototype.key=0,A.prototype.mode=0,A.create=function(t){return new A(t)},A.encode=function(t,e){return e=e||u.create(),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.key&&t.hasOwnProperty("key")&&e.uint32(16).int32(t.key),null!=t.mode&&t.hasOwnProperty("mode")&&e.uint32(24).int32(t.mode),e},A.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},A.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.KeySignature;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.time=t.double();break;case 2:i.key=t.int32();break;case 3:i.mode=t.int32();break;default:t.skipType(7&s)}}return i},A.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},A.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time)return"time: number expected";if(null!=t.key&&t.hasOwnProperty("key"))switch(t.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(null!=t.mode&&t.hasOwnProperty("mode"))switch(t.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},A.fromObject=function(t){if(t instanceof h.tensorflow.magenta.NoteSequence.KeySignature)return t;var e=new h.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=t.time&&(e.time=Number(t.time)),t.key){case"C":case 0:e.key=0;break;case"C_SHARP":case 1:e.key=1;break;case"D_FLAT":case 1:e.key=1;break;case"D":case 2:e.key=2;break;case"D_SHARP":case 3:e.key=3;break;case"E_FLAT":case 3:e.key=3;break;case"E":case 4:e.key=4;break;case"F":case 5:e.key=5;break;case"F_SHARP":case 6:e.key=6;break;case"G_FLAT":case 6:e.key=6;break;case"G":case 7:e.key=7;break;case"G_SHARP":case 8:e.key=8;break;case"A_FLAT":case 8:e.key=8;break;case"A":case 9:e.key=9;break;case"A_SHARP":case 10:e.key=10;break;case"B_FLAT":case 10:e.key=10;break;case"B":case 11:e.key=11}switch(t.mode){case"MAJOR":case 0:e.mode=0;break;case"MINOR":case 1:e.mode=1;break;case"NOT_SPECIFIED":case 2:e.mode=2;break;case"MIXOLYDIAN":case 3:e.mode=3;break;case"DORIAN":case 4:e.mode=4;break;case"PHRYGIAN":case 5:e.mode=5;break;case"LYDIAN":case 6:e.mode=6;break;case"LOCRIAN":case 7:e.mode=7}return e},A.toObject=function(t,e){var n={};return(e=e||{}).defaults&&(n.time=0,n.key=e.enums===String?"C":0,n.mode=e.enums===String?"MAJOR":0),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.key&&t.hasOwnProperty("key")&&(n.key=e.enums===String?h.tensorflow.magenta.NoteSequence.KeySignature.Key[t.key]:t.key),null!=t.mode&&t.hasOwnProperty("mode")&&(n.mode=e.enums===String?h.tensorflow.magenta.NoteSequence.KeySignature.Mode[t.mode]:t.mode),n},A.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},A.Key=(s={},(r=Object.create(s))[s[0]="C"]=0,r[s[1]="C_SHARP"]=1,r.D_FLAT=1,r[s[2]="D"]=2,r[s[3]="D_SHARP"]=3,r.E_FLAT=3,r[s[4]="E"]=4,r[s[5]="F"]=5,r[s[6]="F_SHARP"]=6,r.G_FLAT=6,r[s[7]="G"]=7,r[s[8]="G_SHARP"]=8,r.A_FLAT=8,r[s[9]="A"]=9,r[s[10]="A_SHARP"]=10,r.B_FLAT=10,r[s[11]="B"]=11,r),A.Mode=(s={},(r=Object.create(s))[s[0]="MAJOR"]=0,r[s[1]="MINOR"]=1,r[s[2]="NOT_SPECIFIED"]=2,r[s[3]="MIXOLYDIAN"]=3,r[s[4]="DORIAN"]=4,r[s[5]="PHRYGIAN"]=5,r[s[6]="LYDIAN"]=6,r[s[7]="LOCRIAN"]=7,r),A),d.Tempo=(T.prototype.time=0,T.prototype.qpm=0,T.create=function(t){return new T(t)},T.encode=function(t,e){return e=e||u.create(),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.qpm&&t.hasOwnProperty("qpm")&&e.uint32(17).double(t.qpm),e},T.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},T.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.Tempo;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.time=t.double();break;case 2:i.qpm=t.double();break;default:t.skipType(7&s)}}return i},T.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},T.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time?"time: number expected":null!=t.qpm&&t.hasOwnProperty("qpm")&&"number"!=typeof t.qpm?"qpm: number expected":null},T.fromObject=function(t){var e;return t instanceof h.tensorflow.magenta.NoteSequence.Tempo?t:(e=new h.tensorflow.magenta.NoteSequence.Tempo,null!=t.time&&(e.time=Number(t.time)),null!=t.qpm&&(e.qpm=Number(t.qpm)),e)},T.toObject=function(t,e){var n={};return(e=e||{}).defaults&&(n.time=0,n.qpm=0),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.qpm&&t.hasOwnProperty("qpm")&&(n.qpm=e.json&&!isFinite(t.qpm)?String(t.qpm):t.qpm),n},T.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},T),d.PitchBend=(x.prototype.time=0,x.prototype.bend=0,x.prototype.instrument=0,x.prototype.program=0,x.prototype.isDrum=!1,x.create=function(t){return new x(t)},x.encode=function(t,e){return e=e||u.create(),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.bend&&t.hasOwnProperty("bend")&&e.uint32(16).int32(t.bend),null!=t.instrument&&t.hasOwnProperty("instrument")&&e.uint32(24).int32(t.instrument),null!=t.program&&t.hasOwnProperty("program")&&e.uint32(32).int32(t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&e.uint32(40).bool(t.isDrum),e},x.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},x.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.PitchBend;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.time=t.double();break;case 2:i.bend=t.int32();break;case 3:i.instrument=t.int32();break;case 4:i.program=t.int32();break;case 5:i.isDrum=t.bool();break;default:t.skipType(7&s)}}return i},x.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},x.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time?"time: number expected":null!=t.bend&&t.hasOwnProperty("bend")&&!c.isInteger(t.bend)?"bend: integer expected":null!=t.instrument&&t.hasOwnProperty("instrument")&&!c.isInteger(t.instrument)?"instrument: integer expected":null!=t.program&&t.hasOwnProperty("program")&&!c.isInteger(t.program)?"program: integer expected":null!=t.isDrum&&t.hasOwnProperty("isDrum")&&"boolean"!=typeof t.isDrum?"isDrum: boolean expected":null},x.fromObject=function(t){var e;return t instanceof h.tensorflow.magenta.NoteSequence.PitchBend?t:(e=new h.tensorflow.magenta.NoteSequence.PitchBend,null!=t.time&&(e.time=Number(t.time)),null!=t.bend&&(e.bend=0|t.bend),null!=t.instrument&&(e.instrument=0|t.instrument),null!=t.program&&(e.program=0|t.program),null!=t.isDrum&&(e.isDrum=Boolean(t.isDrum)),e)},x.toObject=function(t,e){var n={};return(e=e||{}).defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.bend&&t.hasOwnProperty("bend")&&(n.bend=t.bend),null!=t.instrument&&t.hasOwnProperty("instrument")&&(n.instrument=t.instrument),null!=t.program&&t.hasOwnProperty("program")&&(n.program=t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&(n.isDrum=t.isDrum),n},x.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},x),d.ControlChange=(w.prototype.time=0,w.prototype.quantizedStep=c.Long?c.Long.fromBits(0,0,!1):0,w.prototype.controlNumber=0,w.prototype.controlValue=0,w.prototype.instrument=0,w.prototype.program=0,w.prototype.isDrum=!1,w.create=function(t){return new w(t)},w.encode=function(t,e){return e=e||u.create(),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.controlNumber&&t.hasOwnProperty("controlNumber")&&e.uint32(16).int32(t.controlNumber),null!=t.controlValue&&t.hasOwnProperty("controlValue")&&e.uint32(24).int32(t.controlValue),null!=t.instrument&&t.hasOwnProperty("instrument")&&e.uint32(32).int32(t.instrument),null!=t.program&&t.hasOwnProperty("program")&&e.uint32(40).int32(t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&e.uint32(48).bool(t.isDrum),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&e.uint32(56).int64(t.quantizedStep),e},w.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},w.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.ControlChange;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.time=t.double();break;case 7:i.quantizedStep=c.Long?t.int64().toNumber():t.int64();break;case 2:i.controlNumber=t.int32();break;case 3:i.controlValue=t.int32();break;case 4:i.instrument=t.int32();break;case 5:i.program=t.int32();break;case 6:i.isDrum=t.bool();break;default:t.skipType(7&s)}}return i},w.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},w.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time?"time: number expected":null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&!(c.isInteger(t.quantizedStep)||t.quantizedStep&&c.isInteger(t.quantizedStep.low)&&c.isInteger(t.quantizedStep.high))?"quantizedStep: integer|Long expected":null!=t.controlNumber&&t.hasOwnProperty("controlNumber")&&!c.isInteger(t.controlNumber)?"controlNumber: integer expected":null!=t.controlValue&&t.hasOwnProperty("controlValue")&&!c.isInteger(t.controlValue)?"controlValue: integer expected":null!=t.instrument&&t.hasOwnProperty("instrument")&&!c.isInteger(t.instrument)?"instrument: integer expected":null!=t.program&&t.hasOwnProperty("program")&&!c.isInteger(t.program)?"program: integer expected":null!=t.isDrum&&t.hasOwnProperty("isDrum")&&"boolean"!=typeof t.isDrum?"isDrum: boolean expected":null},w.fromObject=function(t){var e;return t instanceof h.tensorflow.magenta.NoteSequence.ControlChange?t:(e=new h.tensorflow.magenta.NoteSequence.ControlChange,null!=t.time&&(e.time=Number(t.time)),null!=t.quantizedStep&&(c.Long?(e.quantizedStep=c.Long.fromValue(t.quantizedStep)).unsigned=!1:"string"==typeof t.quantizedStep?e.quantizedStep=parseInt(t.quantizedStep,10):"number"==typeof t.quantizedStep?e.quantizedStep=t.quantizedStep:"object"==typeof t.quantizedStep&&(e.quantizedStep=new c.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber())),null!=t.controlNumber&&(e.controlNumber=0|t.controlNumber),null!=t.controlValue&&(e.controlValue=0|t.controlValue),null!=t.instrument&&(e.instrument=0|t.instrument),null!=t.program&&(e.program=0|t.program),null!=t.isDrum&&(e.isDrum=Boolean(t.isDrum)),e)},w.toObject=function(t,e){var n,i={};return(e=e||{}).defaults&&(i.time=0,i.controlNumber=0,i.controlValue=0,i.instrument=0,i.program=0,i.isDrum=!1,c.Long?(n=new c.Long(0,0,!1),i.quantizedStep=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.quantizedStep=e.longs===String?"0":0),null!=t.time&&t.hasOwnProperty("time")&&(i.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.controlNumber&&t.hasOwnProperty("controlNumber")&&(i.controlNumber=t.controlNumber),null!=t.controlValue&&t.hasOwnProperty("controlValue")&&(i.controlValue=t.controlValue),null!=t.instrument&&t.hasOwnProperty("instrument")&&(i.instrument=t.instrument),null!=t.program&&t.hasOwnProperty("program")&&(i.program=t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&(i.isDrum=t.isDrum),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&("number"==typeof t.quantizedStep?i.quantizedStep=e.longs===String?String(t.quantizedStep):t.quantizedStep:i.quantizedStep=e.longs===String?c.Long.prototype.toString.call(t.quantizedStep):e.longs===Number?new c.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber():t.quantizedStep),i},w.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},w),d.PartInfo=(S.prototype.part=0,S.prototype.name="",S.create=function(t){return new S(t)},S.encode=function(t,e){return e=e||u.create(),null!=t.part&&t.hasOwnProperty("part")&&e.uint32(8).int32(t.part),null!=t.name&&t.hasOwnProperty("name")&&e.uint32(18).string(t.name),e},S.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},S.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.PartInfo;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.part=t.int32();break;case 2:i.name=t.string();break;default:t.skipType(7&s)}}return i},S.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},S.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.part&&t.hasOwnProperty("part")&&!c.isInteger(t.part)?"part: integer expected":null!=t.name&&t.hasOwnProperty("name")&&!c.isString(t.name)?"name: string expected":null},S.fromObject=function(t){var e;return t instanceof h.tensorflow.magenta.NoteSequence.PartInfo?t:(e=new h.tensorflow.magenta.NoteSequence.PartInfo,null!=t.part&&(e.part=0|t.part),null!=t.name&&(e.name=String(t.name)),e)},S.toObject=function(t,e){var n={};return(e=e||{}).defaults&&(n.part=0,n.name=""),null!=t.part&&t.hasOwnProperty("part")&&(n.part=t.part),null!=t.name&&t.hasOwnProperty("name")&&(n.name=t.name),n},S.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},S),d.SourceInfo=(b.prototype.sourceType=0,b.prototype.encodingType=0,b.prototype.parser=0,b.create=function(t){return new b(t)},b.encode=function(t,e){return e=e||u.create(),null!=t.sourceType&&t.hasOwnProperty("sourceType")&&e.uint32(8).int32(t.sourceType),null!=t.encodingType&&t.hasOwnProperty("encodingType")&&e.uint32(16).int32(t.encodingType),null!=t.parser&&t.hasOwnProperty("parser")&&e.uint32(24).int32(t.parser),e},b.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},b.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.SourceInfo;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.sourceType=t.int32();break;case 2:i.encodingType=t.int32();break;case 3:i.parser=t.int32();break;default:t.skipType(7&s)}}return i},b.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},b.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.sourceType&&t.hasOwnProperty("sourceType"))switch(t.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(null!=t.encodingType&&t.hasOwnProperty("encodingType"))switch(t.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=t.parser&&t.hasOwnProperty("parser"))switch(t.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},b.fromObject=function(t){if(t instanceof h.tensorflow.magenta.NoteSequence.SourceInfo)return t;var e=new h.tensorflow.magenta.NoteSequence.SourceInfo;switch(t.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:e.sourceType=0;break;case"SCORE_BASED":case 1:e.sourceType=1;break;case"PERFORMANCE_BASED":case 2:e.sourceType=2}switch(t.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:e.encodingType=0;break;case"MUSIC_XML":case 1:e.encodingType=1;break;case"ABC":case 2:e.encodingType=2;break;case"MIDI":case 3:e.encodingType=3;break;case"MUSICNET":case 4:e.encodingType=4}switch(t.parser){case"UNKNOWN_PARSER":case 0:e.parser=0;break;case"MUSIC21":case 1:e.parser=1;break;case"PRETTY_MIDI":case 2:e.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:e.parser=3;break;case"MAGENTA_MUSICNET":case 4:e.parser=4;break;case"MAGENTA_ABC":case 5:e.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:e.parser=6}return e},b.toObject=function(t,e){var n={};return(e=e||{}).defaults&&(n.sourceType=e.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=e.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=e.enums===String?"UNKNOWN_PARSER":0),null!=t.sourceType&&t.hasOwnProperty("sourceType")&&(n.sourceType=e.enums===String?h.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[t.sourceType]:t.sourceType),null!=t.encodingType&&t.hasOwnProperty("encodingType")&&(n.encodingType=e.enums===String?h.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[t.encodingType]:t.encodingType),null!=t.parser&&t.hasOwnProperty("parser")&&(n.parser=e.enums===String?h.tensorflow.magenta.NoteSequence.SourceInfo.Parser[t.parser]:t.parser),n},b.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},b.SourceType=(s={},(r=Object.create(s))[s[0]="UNKNOWN_SOURCE_TYPE"]=0,r[s[1]="SCORE_BASED"]=1,r[s[2]="PERFORMANCE_BASED"]=2,r),b.EncodingType=(s={},(r=Object.create(s))[s[0]="UNKNOWN_ENCODING_TYPE"]=0,r[s[1]="MUSIC_XML"]=1,r[s[2]="ABC"]=2,r[s[3]="MIDI"]=3,r[s[4]="MUSICNET"]=4,r),b.Parser=(s={},(r=Object.create(s))[s[0]="UNKNOWN_PARSER"]=0,r[s[1]="MUSIC21"]=1,r[s[2]="PRETTY_MIDI"]=2,r[s[3]="MAGENTA_MUSIC_XML"]=3,r[s[4]="MAGENTA_MUSICNET"]=4,r[s[5]="MAGENTA_ABC"]=5,r[s[6]="TONEJS_MIDI_CONVERT"]=6,r),b),d.TextAnnotation=(v.prototype.time=0,v.prototype.quantizedStep=c.Long?c.Long.fromBits(0,0,!1):0,v.prototype.text="",v.prototype.annotationType=0,v.create=function(t){return new v(t)},v.encode=function(t,e){return e=e||u.create(),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.text&&t.hasOwnProperty("text")&&e.uint32(18).string(t.text),null!=t.annotationType&&t.hasOwnProperty("annotationType")&&e.uint32(24).int32(t.annotationType),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&e.uint32(32).int64(t.quantizedStep),e},v.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},v.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.TextAnnotation;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.time=t.double();break;case 4:i.quantizedStep=c.Long?t.int64().toNumber():t.int64();break;case 2:i.text=t.string();break;case 3:i.annotationType=t.int32();break;default:t.skipType(7&s)}}return i},v.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},v.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time)return"time: number expected";if(null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&!(c.isInteger(t.quantizedStep)||t.quantizedStep&&c.isInteger(t.quantizedStep.low)&&c.isInteger(t.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=t.text&&t.hasOwnProperty("text")&&!c.isString(t.text))return"text: string expected";if(null!=t.annotationType&&t.hasOwnProperty("annotationType"))switch(t.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:}return null},v.fromObject=function(t){if(t instanceof h.tensorflow.magenta.NoteSequence.TextAnnotation)return t;var e=new h.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=t.time&&(e.time=Number(t.time)),null!=t.quantizedStep&&(c.Long?(e.quantizedStep=c.Long.fromValue(t.quantizedStep)).unsigned=!1:"string"==typeof t.quantizedStep?e.quantizedStep=parseInt(t.quantizedStep,10):"number"==typeof t.quantizedStep?e.quantizedStep=t.quantizedStep:"object"==typeof t.quantizedStep&&(e.quantizedStep=new c.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber())),null!=t.text&&(e.text=String(t.text)),t.annotationType){case"UNKNOWN":case 0:e.annotationType=0;break;case"CHORD_SYMBOL":case 1:e.annotationType=1;break;case"BEAT":case 2:e.annotationType=2}return e},v.toObject=function(t,e){var n,i={};return(e=e||{}).defaults&&(i.time=0,i.text="",i.annotationType=e.enums===String?"UNKNOWN":0,c.Long?(n=new c.Long(0,0,!1),i.quantizedStep=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.quantizedStep=e.longs===String?"0":0),null!=t.time&&t.hasOwnProperty("time")&&(i.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.text&&t.hasOwnProperty("text")&&(i.text=t.text),null!=t.annotationType&&t.hasOwnProperty("annotationType")&&(i.annotationType=e.enums===String?h.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[t.annotationType]:t.annotationType),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&("number"==typeof t.quantizedStep?i.quantizedStep=e.longs===String?String(t.quantizedStep):t.quantizedStep:i.quantizedStep=e.longs===String?c.Long.prototype.toString.call(t.quantizedStep):e.longs===Number?new c.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber():t.quantizedStep),i},v.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},v.TextAnnotationType=(s={},(r=Object.create(s))[s[0]="UNKNOWN"]=0,r[s[1]="CHORD_SYMBOL"]=1,r[s[2]="BEAT"]=2,r),v),d.QuantizationInfo=(y.prototype.stepsPerQuarter=0,y.prototype.stepsPerSecond=0,Object.defineProperty(y.prototype,"resolution",{get:c.oneOfGetter(s=["stepsPerQuarter","stepsPerSecond"]),set:c.oneOfSetter(s)}),y.create=function(t){return new y(t)},y.encode=function(t,e){return e=e||u.create(),null!=t.stepsPerQuarter&&t.hasOwnProperty("stepsPerQuarter")&&e.uint32(8).int32(t.stepsPerQuarter),null!=t.stepsPerSecond&&t.hasOwnProperty("stepsPerSecond")&&e.uint32(16).int32(t.stepsPerSecond),e},y.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},y.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.QuantizationInfo;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.stepsPerQuarter=t.int32();break;case 2:i.stepsPerSecond=t.int32();break;default:t.skipType(7&s)}}return i},y.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},y.verify=function(t){if("object"!=typeof t||null===t)return"object expected";var e={};if(null!=t.stepsPerQuarter&&t.hasOwnProperty("stepsPerQuarter")&&(e.resolution=1,!c.isInteger(t.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=t.stepsPerSecond&&t.hasOwnProperty("stepsPerSecond")){if(1===e.resolution)return"resolution: multiple values";if(e.resolution=1,!c.isInteger(t.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},y.fromObject=function(t){var e;return t instanceof h.tensorflow.magenta.NoteSequence.QuantizationInfo?t:(e=new h.tensorflow.magenta.NoteSequence.QuantizationInfo,null!=t.stepsPerQuarter&&(e.stepsPerQuarter=0|t.stepsPerQuarter),null!=t.stepsPerSecond&&(e.stepsPerSecond=0|t.stepsPerSecond),e)},y.toObject=function(t,e){e=e||{};var n={};return null!=t.stepsPerQuarter&&t.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=t.stepsPerQuarter,e.oneofs)&&(n.resolution="stepsPerQuarter"),null!=t.stepsPerSecond&&t.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=t.stepsPerSecond,e.oneofs)&&(n.resolution="stepsPerSecond"),n},y.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},y),d.SubsequenceInfo=(_.prototype.startTimeOffset=0,_.prototype.endTimeOffset=0,_.create=function(t){return new _(t)},_.encode=function(t,e){return e=e||u.create(),null!=t.startTimeOffset&&t.hasOwnProperty("startTimeOffset")&&e.uint32(9).double(t.startTimeOffset),null!=t.endTimeOffset&&t.hasOwnProperty("endTimeOffset")&&e.uint32(17).double(t.endTimeOffset),e},_.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},_.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.SubsequenceInfo;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.startTimeOffset=t.double();break;case 2:i.endTimeOffset=t.double();break;default:t.skipType(7&s)}}return i},_.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},_.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.startTimeOffset&&t.hasOwnProperty("startTimeOffset")&&"number"!=typeof t.startTimeOffset?"startTimeOffset: number expected":null!=t.endTimeOffset&&t.hasOwnProperty("endTimeOffset")&&"number"!=typeof t.endTimeOffset?"endTimeOffset: number expected":null},_.fromObject=function(t){var e;return t instanceof h.tensorflow.magenta.NoteSequence.SubsequenceInfo?t:(e=new h.tensorflow.magenta.NoteSequence.SubsequenceInfo,null!=t.startTimeOffset&&(e.startTimeOffset=Number(t.startTimeOffset)),null!=t.endTimeOffset&&(e.endTimeOffset=Number(t.endTimeOffset)),e)},_.toObject=function(t,e){var n={};return(e=e||{}).defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=t.startTimeOffset&&t.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=e.json&&!isFinite(t.startTimeOffset)?String(t.startTimeOffset):t.startTimeOffset),null!=t.endTimeOffset&&t.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=e.json&&!isFinite(t.endTimeOffset)?String(t.endTimeOffset):t.endTimeOffset),n},_.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},_),d.SectionAnnotation=(g.prototype.time=0,g.prototype.sectionId=c.Long?c.Long.fromBits(0,0,!1):0,g.create=function(t){return new g(t)},g.encode=function(t,e){return e=e||u.create(),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.sectionId&&t.hasOwnProperty("sectionId")&&e.uint32(32).int64(t.sectionId),e},g.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},g.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.SectionAnnotation;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.time=t.double();break;case 4:i.sectionId=c.Long?t.int64().toNumber():t.int64();break;default:t.skipType(7&s)}}return i},g.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},g.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time?"time: number expected":null!=t.sectionId&&t.hasOwnProperty("sectionId")&&!(c.isInteger(t.sectionId)||t.sectionId&&c.isInteger(t.sectionId.low)&&c.isInteger(t.sectionId.high))?"sectionId: integer|Long expected":null},g.fromObject=function(t){var e;return t instanceof h.tensorflow.magenta.NoteSequence.SectionAnnotation?t:(e=new h.tensorflow.magenta.NoteSequence.SectionAnnotation,null!=t.time&&(e.time=Number(t.time)),null!=t.sectionId&&(c.Long?(e.sectionId=c.Long.fromValue(t.sectionId)).unsigned=!1:"string"==typeof t.sectionId?e.sectionId=parseInt(t.sectionId,10):"number"==typeof t.sectionId?e.sectionId=t.sectionId:"object"==typeof t.sectionId&&(e.sectionId=new c.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber())),e)},g.toObject=function(t,e){var n,i={};return(e=e||{}).defaults&&(i.time=0,c.Long?(n=new c.Long(0,0,!1),i.sectionId=e.longs===String?n.toString():e.longs===Number?n.toNumber():n):i.sectionId=e.longs===String?"0":0),null!=t.time&&t.hasOwnProperty("time")&&(i.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.sectionId&&t.hasOwnProperty("sectionId")&&("number"==typeof t.sectionId?i.sectionId=e.longs===String?String(t.sectionId):t.sectionId:i.sectionId=e.longs===String?c.Long.prototype.toString.call(t.sectionId):e.longs===Number?new c.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber():t.sectionId),i},g.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},g),d.Section=(m.prototype.sectionId=c.Long?c.Long.fromBits(0,0,!1):0,m.prototype.sectionGroup=null,Object.defineProperty(m.prototype,"sectionType",{get:c.oneOfGetter(r=["sectionId","sectionGroup"]),set:c.oneOfSetter(r)}),m.create=function(t){return new m(t)},m.encode=function(t,e){return e=e||u.create(),null!=t.sectionId&&t.hasOwnProperty("sectionId")&&e.uint32(8).int64(t.sectionId),null!=t.sectionGroup&&t.hasOwnProperty("sectionGroup")&&h.tensorflow.magenta.NoteSequence.SectionGroup.encode(t.sectionGroup,e.uint32(18).fork()).ldelim(),e},m.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},m.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.Section;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.sectionId=c.Long?t.int64().toNumber():t.int64();break;case 2:i.sectionGroup=h.tensorflow.magenta.NoteSequence.SectionGroup.decode(t,t.uint32());break;default:t.skipType(7&s)}}return i},m.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},m.verify=function(t){if("object"!=typeof t||null===t)return"object expected";var e={};if(null!=t.sectionId&&t.hasOwnProperty("sectionId")&&(e.sectionType=1,!(c.isInteger(t.sectionId)||t.sectionId&&c.isInteger(t.sectionId.low)&&c.isInteger(t.sectionId.high))))return"sectionId: integer|Long expected";if(null!=t.sectionGroup&&t.hasOwnProperty("sectionGroup")){if(1===e.sectionType)return"sectionType: multiple values";e.sectionType=1;e=h.tensorflow.magenta.NoteSequence.SectionGroup.verify(t.sectionGroup);if(e)return"sectionGroup."+e}return null},m.fromObject=function(t){if(t instanceof h.tensorflow.magenta.NoteSequence.Section)return t;var e=new h.tensorflow.magenta.NoteSequence.Section;if(null!=t.sectionId&&(c.Long?(e.sectionId=c.Long.fromValue(t.sectionId)).unsigned=!1:"string"==typeof t.sectionId?e.sectionId=parseInt(t.sectionId,10):"number"==typeof t.sectionId?e.sectionId=t.sectionId:"object"==typeof t.sectionId&&(e.sectionId=new c.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber())),null!=t.sectionGroup){if("object"!=typeof t.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");e.sectionGroup=h.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(t.sectionGroup)}return e},m.toObject=function(t,e){e=e||{};var n={};return null!=t.sectionId&&t.hasOwnProperty("sectionId")&&("number"==typeof t.sectionId?n.sectionId=e.longs===String?String(t.sectionId):t.sectionId:n.sectionId=e.longs===String?c.Long.prototype.toString.call(t.sectionId):e.longs===Number?new c.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber():t.sectionId,e.oneofs)&&(n.sectionType="sectionId"),null!=t.sectionGroup&&t.hasOwnProperty("sectionGroup")&&(n.sectionGroup=h.tensorflow.magenta.NoteSequence.SectionGroup.toObject(t.sectionGroup,e),e.oneofs)&&(n.sectionType="sectionGroup"),n},m.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},m),d.SectionGroup=(f.prototype.sections=c.emptyArray,f.prototype.numTimes=0,f.create=function(t){return new f(t)},f.encode=function(t,e){if(e=e||u.create(),null!=t.sections&&t.sections.length)for(var n=0;n<t.sections.length;++n)h.tensorflow.magenta.NoteSequence.Section.encode(t.sections[n],e.uint32(10).fork()).ldelim();return null!=t.numTimes&&t.hasOwnProperty("numTimes")&&e.uint32(16).int32(t.numTimes),e},f.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},f.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.NoteSequence.SectionGroup;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.sections&&i.sections.length||(i.sections=[]),i.sections.push(h.tensorflow.magenta.NoteSequence.Section.decode(t,t.uint32()));break;case 2:i.numTimes=t.int32();break;default:t.skipType(7&s)}}return i},f.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},f.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.sections&&t.hasOwnProperty("sections")){if(!Array.isArray(t.sections))return"sections: array expected";for(var e=0;e<t.sections.length;++e){var n=h.tensorflow.magenta.NoteSequence.Section.verify(t.sections[e]);if(n)return"sections."+n}}return null!=t.numTimes&&t.hasOwnProperty("numTimes")&&!c.isInteger(t.numTimes)?"numTimes: integer expected":null},f.fromObject=function(t){if(t instanceof h.tensorflow.magenta.NoteSequence.SectionGroup)return t;var e=new h.tensorflow.magenta.NoteSequence.SectionGroup;if(t.sections){if(!Array.isArray(t.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");e.sections=[];for(var n=0;n<t.sections.length;++n){if("object"!=typeof t.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");e.sections[n]=h.tensorflow.magenta.NoteSequence.Section.fromObject(t.sections[n])}}return null!=t.numTimes&&(e.numTimes=0|t.numTimes),e},f.toObject=function(t,e){var n={};if(((e=e||{}).arrays||e.defaults)&&(n.sections=[]),e.defaults&&(n.numTimes=0),t.sections&&t.sections.length){n.sections=[];for(var i=0;i<t.sections.length;++i)n.sections[i]=h.tensorflow.magenta.NoteSequence.Section.toObject(t.sections[i],e)}return null!=t.numTimes&&t.hasOwnProperty("numTimes")&&(n.numTimes=t.numTimes),n},f.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},f),d),i.SequenceMetadata=(p.prototype.title="",p.prototype.artist="",p.prototype.genre=c.emptyArray,p.prototype.composers=c.emptyArray,p.create=function(t){return new p(t)},p.encode=function(t,e){if(e=e||u.create(),null!=t.title&&t.hasOwnProperty("title")&&e.uint32(10).string(t.title),null!=t.artist&&t.hasOwnProperty("artist")&&e.uint32(18).string(t.artist),null!=t.genre&&t.genre.length)for(var n=0;n<t.genre.length;++n)e.uint32(26).string(t.genre[n]);if(null!=t.composers&&t.composers.length)for(n=0;n<t.composers.length;++n)e.uint32(34).string(t.composers[n]);return e},p.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},p.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.SequenceMetadata;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.title=t.string();break;case 2:i.artist=t.string();break;case 3:i.genre&&i.genre.length||(i.genre=[]),i.genre.push(t.string());break;case 4:i.composers&&i.composers.length||(i.composers=[]),i.composers.push(t.string());break;default:t.skipType(7&s)}}return i},p.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},p.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.title&&t.hasOwnProperty("title")&&!c.isString(t.title))return"title: string expected";if(null!=t.artist&&t.hasOwnProperty("artist")&&!c.isString(t.artist))return"artist: string expected";if(null!=t.genre&&t.hasOwnProperty("genre")){if(!Array.isArray(t.genre))return"genre: array expected";for(var e=0;e<t.genre.length;++e)if(!c.isString(t.genre[e]))return"genre: string[] expected"}if(null!=t.composers&&t.hasOwnProperty("composers")){if(!Array.isArray(t.composers))return"composers: array expected";for(e=0;e<t.composers.length;++e)if(!c.isString(t.composers[e]))return"composers: string[] expected"}return null},p.fromObject=function(t){if(t instanceof h.tensorflow.magenta.SequenceMetadata)return t;var e=new h.tensorflow.magenta.SequenceMetadata;if(null!=t.title&&(e.title=String(t.title)),null!=t.artist&&(e.artist=String(t.artist)),t.genre){if(!Array.isArray(t.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");e.genre=[];for(var n=0;n<t.genre.length;++n)e.genre[n]=String(t.genre[n])}if(t.composers){if(!Array.isArray(t.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");for(e.composers=[],n=0;n<t.composers.length;++n)e.composers[n]=String(t.composers[n])}return e},p.toObject=function(t,e){var n={};if(((e=e||{}).arrays||e.defaults)&&(n.genre=[],n.composers=[]),e.defaults&&(n.title="",n.artist=""),null!=t.title&&t.hasOwnProperty("title")&&(n.title=t.title),null!=t.artist&&t.hasOwnProperty("artist")&&(n.artist=t.artist),t.genre&&t.genre.length){n.genre=[];for(var i=0;i<t.genre.length;++i)n.genre[i]=t.genre[i]}if(t.composers&&t.composers.length)for(n.composers=[],i=0;i<t.composers.length;++i)n.composers[i]=t.composers[i];return n},p.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},p),i.VelocityRange=(l.prototype.min=0,l.prototype.max=0,l.create=function(t){return new l(t)},l.encode=function(t,e){return e=e||u.create(),null!=t.min&&t.hasOwnProperty("min")&&e.uint32(8).int32(t.min),null!=t.max&&t.hasOwnProperty("max")&&e.uint32(16).int32(t.max),e},l.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},l.decode=function(t,e){t instanceof a||(t=a.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new h.tensorflow.magenta.VelocityRange;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.min=t.int32();break;case 2:i.max=t.int32();break;default:t.skipType(7&s)}}return i},l.decodeDelimited=function(t){return t instanceof a||(t=new a(t)),this.decode(t,t.uint32())},l.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.min&&t.hasOwnProperty("min")&&!c.isInteger(t.min)?"min: integer expected":null!=t.max&&t.hasOwnProperty("max")&&!c.isInteger(t.max)?"max: integer expected":null},l.fromObject=function(t){var e;return t instanceof h.tensorflow.magenta.VelocityRange?t:(e=new h.tensorflow.magenta.VelocityRange,null!=t.min&&(e.min=0|t.min),null!=t.max&&(e.max=0|t.max),e)},l.toObject=function(t,e){var n={};return(e=e||{}).defaults&&(n.min=0,n.max=0),null!=t.min&&t.hasOwnProperty("min")&&(n.min=t.min),null!=t.max&&t.hasOwnProperty("max")&&(n.max=t.max),n},l.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},l),i),n),t.exports=h},function(t,e,n){n.r(e),n.d(e,"converterFromSpec",function(){return i}),n.d(e,"DataConverter",function(){return a}),n.d(e,"DrumsConverter",function(){return u}),n.d(e,"DrumRollConverter",function(){return c}),n.d(e,"DrumsOneHotConverter",function(){return l}),n.d(e,"MelodyConverter",function(){return p}),n.d(e,"MelodyRhythmConverter",function(){return _}),n.d(e,"MelodyShapeConverter",function(){return y}),n.d(e,"TrioConverter",function(){return v}),n.d(e,"TrioRhythmConverter",function(){return b}),n.d(e,"MultitrackConverter",function(){return S}),n.d(e,"GrooveConverter",function(){return w});var d=n(2),h=n(10),f=n(8),o=(n.d(e,"DEFAULT_DRUM_PITCH_CLASSES",function(){return f.DEFAULT_DRUM_PITCH_CLASSES}),n(12)),s=n(23),r=n(29),m=n(13);function i(t){switch(t.type){case"MelodyConverter":return new p(t.args);case"MelodyRhythmConverter":return new _(t.args);case"MelodyShapeConverter":return new y(t.args);case"DrumsConverter":return new u(t.args);case"DrumRollConverter":return new c(t.args);case"TrioConverter":return new v(t.args);case"TrioRhythmConverter":return new b(t.args);case"DrumsOneHotConverter":return new l(t.args);case"MultitrackConverter":return new S(t.args);case"GrooveConverter":return new w(t.args);default:throw new Error("Unknown DataConverter type: "+t)}}class a{constructor(t){this.NUM_SPLITS=0,this.SEGMENTED_BY_TRACK=!1,this.numSteps=t.numSteps,this.numSegments=t.numSegments}tensorSteps(t){return d.scalar(t.shape[0],"int32")}}class u extends a{constructor(t){super(t),this.pitchClasses=t.pitchClasses||f.DEFAULT_DRUM_PITCH_CLASSES,this.pitchToClass=new Map;for(let e=0;e<this.pitchClasses.length;++e)this.pitchClasses[e].forEach(t=>{this.pitchToClass.set(t,e)});this.depth=this.pitchClasses.length+1}toTensor(t){m.assertIsQuantizedSequence(t);let e=this.numSteps||t.totalQuantizedSteps,n=d.buffer([e,this.pitchClasses.length+1],"int32");for(let t=0;t<e;++t)n.set(1,t,-1);return t.notes.forEach(t=>{n.set(1,t.quantizedStartStep,this.pitchToClass.get(t.pitch)),n.set(0,t.quantizedStartStep,-1)}),n.toTensor()}async toNoteSequence(t,e,n){var i=m.createQuantizedNoteSequence(e,n),e=t.argMax(1),s=await e.data();e.dispose();for(let e=0;e<s.length;++e)for(let t=0;t<this.pitchClasses.length;t++)s[e]>>t&1&&i.notes.push(h.a.Note.create({pitch:this.pitchClasses[t][0],quantizedStartStep:e,quantizedEndStep:e+1,isDrum:!0}));return i.totalQuantizedSteps=s.length,i}}class c extends u{async toNoteSequence(t,e,n){var i=m.createQuantizedNoteSequence(e,n),s=await t.data();for(let n=0;n<t.shape[0];++n){let e=s.slice(n*this.pitchClasses.length,(n+1)*this.pitchClasses.length);for(let t=0;t<e.length;++t)e[t]&&i.notes.push(h.a.Note.create({pitch:this.pitchClasses[t][0],quantizedStartStep:n,quantizedEndStep:n+1,isDrum:!0}))}return i.totalQuantizedSteps=t.shape[0],i}}class l extends u{constructor(t){super(t),this.depth=Math.pow(2,this.pitchClasses.length)}toTensor(n){m.assertIsRelativeQuantizedSequence(n);let t=this.numSteps||n.totalQuantizedSteps,i=Array(t).fill(0);for(let{pitch:t,quantizedStartStep:e}of n.notes)i[e]+=Math.pow(2,this.pitchToClass.get(t));return d.tidy(()=>d.oneHot(d.tensor1d(i,"int32"),this.depth))}}class p extends a{constructor(t){super(t),this.NOTE_OFF=1,this.FIRST_PITCH=2,this.minPitch=t.minPitch,this.maxPitch=t.maxPitch,this.ignorePolyphony=t.ignorePolyphony,this.depth=t.maxPitch-t.minPitch+1+this.FIRST_PITCH}toTensor(t){let e=s.Melody.fromNoteSequence(t,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return d.tidy(()=>d.oneHot(d.tensor(e.events,[e.events.length],"int32"),this.depth))}async toNoteSequence(t,e,n){var t=t.argMax(1),i=await t.data();return t.dispose(),new s.Melody(i,this.minPitch,this.maxPitch).toNoteSequence(e,n)}}class g extends a{constructor(t,e){super(t),this.minPitch=t.minPitch,this.maxPitch=t.maxPitch,this.ignorePolyphony=t.ignorePolyphony,this.melodyControl=e,this.depth=e.depth}toTensor(t){t=s.Melody.fromNoteSequence(t,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return this.melodyControl.extract(t)}}class _ extends g{constructor(t){super(t,new s.MelodyRhythm)}async toNoteSequence(t,e,n){var i=m.createQuantizedNoteSequence(e,n),s=await t.data();for(let t=0;t<s.length;++t)s[t]&&i.notes.push(h.a.Note.create({pitch:f.DEFAULT_DRUM_PITCH_CLASSES[1][0],quantizedStartStep:t,quantizedEndStep:t+1,isDrum:!0}));return i.totalQuantizedSteps=s.length,i}}class y extends g{constructor(t){super(t,new s.MelodyShape)}async toNoteSequence(t,e,n){var i=m.createQuantizedNoteSequence(e,n),e=t.argMax(1),s=await e.data();e.dispose();let r=Math.round((this.maxPitch+this.minPitch)/2);for(let t=0;t<s.length;++t){switch(s[t]){case 0:--r<this.minPitch&&(r=this.minPitch,o.log("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"));break;case 2:(r+=1)>this.maxPitch&&(r=this.maxPitch,o.log("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"))}i.notes.push(h.a.Note.create({pitch:r,quantizedStartStep:t,quantizedEndStep:t+1}))}return i.totalQuantizedSteps=s.length,i}}class v extends a{constructor(t){super(t),this.NUM_SPLITS=3,this.MEL_PROG_RANGE=[0,31],this.BASS_PROG_RANGE=[32,39],t.melArgs.numSteps=t.numSteps,t.bassArgs.numSteps=t.numSteps,t.drumsArgs.numSteps=t.numSteps,this.melConverter=new p(t.melArgs),this.bassConverter=new p(t.bassArgs),this.drumsConverter=new l(t.drumsArgs),this.depth=this.melConverter.depth+this.bassConverter.depth+this.drumsConverter.depth}toTensor(t){m.assertIsQuantizedSequence(t);let e=m.clone(t),n=m.clone(t),i=m.clone(t);return e.notes=t.notes.filter(t=>!t.isDrum&&t.program>=this.MEL_PROG_RANGE[0]&&t.program<=this.MEL_PROG_RANGE[1]),n.notes=t.notes.filter(t=>!t.isDrum&&t.program>=this.BASS_PROG_RANGE[0]&&t.program<=this.BASS_PROG_RANGE[1]),i.notes=t.notes.filter(t=>t.isDrum),d.tidy(()=>d.concat([this.melConverter.toTensor(e),this.bassConverter.toTensor(n),this.drumsConverter.toTensor(i)],-1))}async toNoteSequence(t,e,n){var t=d.split(t,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),i=await this.melConverter.toNoteSequence(t[0],e,n),s=(i.notes.forEach(t=>{t.instrument=0,t.program=0}),await this.bassConverter.toNoteSequence(t[1],e,n)),s=(i.notes.push(...s.notes.map(t=>(t.instrument=1,t.program=this.BASS_PROG_RANGE[0],t))),await this.drumsConverter.toNoteSequence(t[2],e,n));return i.notes.push(...s.notes.map(t=>(t.instrument=2,t))),t.forEach(t=>t.dispose()),i}}class b extends a{constructor(t){super(t),this.NUM_SPLITS=3,this.trioConverter=new v(t),this.depth=3}toTensor(i){return d.tidy(()=>{var t=this.trioConverter.toTensor(i),t=d.split(t,[this.trioConverter.melConverter.depth,this.trioConverter.bassConverter.depth,this.trioConverter.drumsConverter.depth],1),e=d.argMax(t[0],1),n=d.argMax(t[1],1),t=d.argMax(t[2],1),e=d.greater(e,1),n=d.greater(n,1),t=d.greater(t,0);return d.stack([e,n,t],1)})}async toNoteSequence(t,e,n){var t=d.split(t,3,1),i=await Promise.all(t.map(t=>t.data())),s=m.createQuantizedNoteSequence(e,n);for(let t=0;t<this.numSteps;++t)i[0][t]&&s.notes.push(h.a.Note.create({pitch:72,quantizedStartStep:t,quantizedEndStep:t+1,instrument:0,program:0})),i[1][t]&&s.notes.push(h.a.Note.create({pitch:36,quantizedStartStep:t,quantizedEndStep:t+1,instrument:1,program:32})),i[2][t]&&s.notes.push(h.a.Note.create({pitch:f.DEFAULT_DRUM_PITCH_CLASSES[1][0],quantizedStartStep:t,quantizedEndStep:t+1,instrument:2,isDrum:!0}));return s.totalQuantizedSteps=this.numSteps,s}}class S extends a{constructor(t){super(t),this.SEGMENTED_BY_TRACK=!0,this.stepsPerQuarter=t.stepsPerQuarter,this.totalSteps=t.totalSteps,this.numVelocityBins=t.numVelocityBins,this.minPitch=t.minPitch||f.MIN_MIDI_PITCH,this.maxPitch=t.maxPitch||f.MAX_MIDI_PITCH,this.numPitches=this.maxPitch-this.minPitch+1,this.performanceEventDepth=2*this.numPitches+this.totalSteps+this.numVelocityBins,this.numPrograms=f.MAX_MIDI_PROGRAM-f.MIN_MIDI_PROGRAM+2,this.endToken=this.performanceEventDepth+this.numPrograms,this.depth=this.endToken+1,this.endTensor=d.tidy(()=>d.oneHot(d.tensor1d([this.endToken],"int32"),this.depth).as1D())}trackToTensor(t){let e=this.numSteps/this.numSegments,n=void 0;if(t){for(;t.events.length>e-2;)t.events.pop();(n=d.buffer([t.events.length+2],"int32")).set(this.performanceEventDepth+(t.isDrum?this.numPrograms-1:t.program),0),t.events.forEach((t,e)=>{switch(t.type){case"note-on":n.set(t.pitch-this.minPitch,e+1);break;case"note-off":n.set(this.numPitches+t.pitch-this.minPitch,e+1);break;case"time-shift":n.set(2*this.numPitches+t.steps-1,e+1);break;case"velocity-change":n.set(2*this.numPitches+this.totalSteps+t.velocityBin-1,e+1);break;default:throw new Error("Unrecognized performance event: "+t)}}),n.set(this.endToken,t.events.length+1)}else n=d.buffer([1],"int32",new Int32Array([this.endToken]));return d.tidy(()=>{var t=d.oneHot(n.toTensor(),this.depth);return t.pad([[0,e-t.shape[0]],[0,0]])})}toTensor(t){if(m.assertIsRelativeQuantizedSequence(t),t.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error(`Steps per quarter note mismatch: ${t.quantizationInfo.stepsPerQuarter} != `+this.stepsPerQuarter);let e=m.clone(t),n=(e.notes=t.notes.filter(t=>t.pitch>=this.minPitch&&t.pitch<=this.maxPitch),new Set(e.notes.map(t=>t.instrument))),i=Array.from(n).map(t=>r.Performance.fromNoteSequence(e,this.totalSteps,this.numVelocityBins,t)).sort((t,e)=>e.isDrum?-1:t.isDrum?1:t.program-e.program);for(;i.length>this.numSegments;)i.pop();for(i.forEach(t=>t.setNumSteps(this.totalSteps));i.length<this.numSegments;)i.push(void 0);return d.tidy(()=>d.concat(i.map(t=>this.trackToTensor(t)),0))}tokensToTrack(t){var e=t.indexOf(this.endToken),e=0<=e?e:t.length,t=t.slice(0,e),e=t.filter(t=>t<this.performanceEventDepth),t=t.filter(t=>t>=this.performanceEventDepth),[t,n]=t.length?t[0]-this.performanceEventDepth<this.numPrograms-1?[t[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],e=Array.from(e).map(t=>{if(t<this.numPitches)return{type:"note-on",pitch:this.minPitch+t};if(t<2*this.numPitches)return{type:"note-off",pitch:this.minPitch+t-this.numPitches};if(t<2*this.numPitches+this.totalSteps)return{type:"time-shift",steps:t-2*this.numPitches+1};if(t<2*this.numPitches+this.totalSteps+this.numVelocityBins)return{type:"velocity-change",velocityBin:t-2*this.numPitches-this.totalSteps+1};throw new Error("Invalid performance event token: "+t)});return new r.Performance(e,this.totalSteps,this.numVelocityBins,t,n)}async toNoteSequence(t,e=this.stepsPerQuarter,n){let i=m.createQuantizedNoteSequence(e,n);i.totalQuantizedSteps=this.totalSteps;e=d.tidy(()=>d.split(t.argMax(1),this.numSegments));return(await Promise.all(e.map(async t=>{var e=await t.data(),e=this.tokensToTrack(e);return t.dispose(),e}))).forEach((t,e)=>{t.setNumSteps(this.totalSteps),i.notes.push(...t.toNoteSequence(e).notes)}),i}}class w extends a{constructor(t){super(t),this.TAPIFY_CHANNEL=3,this.stepsPerQuarter=t.stepsPerQuarter||f.DEFAULT_STEPS_PER_QUARTER,this.pitchClasses=t.pitchClasses||f.DEFAULT_DRUM_PITCH_CLASSES,this.pitchToClass=new Map;for(let e=0;e<this.pitchClasses.length;++e)this.pitchClasses[e].forEach(t=>{this.pitchToClass.set(t,e)});this.humanize=t.humanize||!1,this.tapify=t.tapify||!1,this.splitInstruments=t.splitInstruments||!1,this.depth=3}toTensor(t){let e=m.isRelativeQuantizedSequence(t)?t:m.quantizeNoteSequence(t,this.stepsPerQuarter),s=this.numSteps,i=e.tempos&&e.tempos.length?e.tempos[0].qpm:f.DEFAULT_QUARTERS_PER_MINUTE,r=60/i/this.stepsPerQuarter,o=[];for(let t=0;t<s;++t)o.push(new Map);e.notes.forEach(t=>{if(this.tapify||this.pitchToClass.has(t.pitch)){var e=t.quantizedStartStep;if(e>=o.length)throw Error(`Model does not support sequences with more than ${s} steps (${s*r} seconds at qpm ${i}).`);var n=this.tapify?this.TAPIFY_CHANNEL:this.pitchToClass.get(t.pitch);(!o[e].has(n)||o[e].get(n).velocity<t.velocity)&&o[e].set(n,t)}});let a=this.pitchClasses.length,u=d.buffer([s,a]),c=d.buffer([s,a]),h=d.buffer([s,a]);for(let n=0;n<s;++n)for(let e=0;e<a;++e){let t=o[n].get(e);u.set(t?1:0,n,e),this.humanize||this.tapify||c.set(t?t.velocity/f.MAX_MIDI_VELOCITY:0,n,e),this.humanize||h.set(!t||(l=t,(p=void 0)===l.startTime)?0:(p=l.startTime,2*(l.quantizedStartStep*r-p)/r),n,e)}var l,p;return d.tidy(()=>{var t=u.toTensor(),e=c.toTensor(),n=h.toTensor(),i=this.splitInstruments?s*a:s;return d.concat([t.as2D(i,-1),e.as2D(i,-1),n.as2D(i,-1)],1)})}async toNoteSequence(t,e,n=f.DEFAULT_QUARTERS_PER_MINUTE){if(e&&e!==this.stepsPerQuarter)throw Error("`stepsPerQuarter` is set by the model.");e=this.stepsPerQuarter;let i=this.splitInstruments?t.shape[0]/this.pitchClasses.length:t.shape[0],o=60/n/this.stepsPerQuarter,a=h.a.create({totalTime:i*o,tempos:[{qpm:n}]}),s=await t.data();function u(t,e,n){return Math.min(Math.max(t,e),n)}var c=this.pitchClasses.length;for(let r=0;r<i;++r){let e=s.slice(r*c*this.depth,(r+1)*c*this.depth);for(let s=0;s<c;++s){let t=e[this.splitInstruments?s*this.depth:s],n=e[this.splitInstruments?s*this.depth+1:c+s],i=e[this.splitInstruments?s*this.depth+2:2*c+s];if(.5<t){let t=u(Math.round(n*f.MAX_MIDI_VELOCITY),f.MIN_MIDI_VELOCITY,f.MAX_MIDI_VELOCITY),e=u(i/2,-.5,.5);a.notes.push(h.a.Note.create({pitch:this.pitchClasses[s][0],startTime:(r-e)*o,endTime:(r-e+1)*o,velocity:t,isDrum:!0}))}}}return a}}},function(R,t,e){e.r(t),e.d(t,"ChordQuality",function(){return C}),e.d(t,"ChordSymbolException",function(){return I}),e.d(t,"ChordEncodingException",function(){return E}),e.d(t,"ChordSymbols",function(){return q}),e.d(t,"ChordEncoder",function(){return D}),e.d(t,"chordEncoderFromType",function(){return bt}),e.d(t,"MajorMinorChordEncoder",function(){return St}),e.d(t,"TriadChordEncoder",function(){return wt}),e.d(t,"PitchChordEncoder",function(){return xt});var n={},r=(e.r(n),e.d(n,"names",function(){return s}),e.d(n,"tokenize",function(){return a}),e.d(n,"props",function(){return l}),e.d(n,"name",function(){return L}),e.d(n,"pc",function(){return p}),e.d(n,"midi",function(){return B}),e.d(n,"midiToFreq",function(){return d}),e.d(n,"freq",function(){return U}),e.d(n,"freqToMidi",function(){return H}),e.d(n,"chroma",function(){return f}),e.d(n,"oct",function(){return W}),e.d(n,"stepToLetter",function(){return m}),e.d(n,"altToAcc",function(){return g}),e.d(n,"from",function(){return _}),e.d(n,"build",function(){return y}),e.d(n,"fromMidi",function(){return v}),e.d(n,"simplify",function(){return b}),e.d(n,"enharmonic",function(){return Y}),{}),o=(e.r(r),e.d(r,"names",function(){return pt}),e.d(r,"props",function(){return O}),e.d(r,"intervals",function(){return P}),e.d(r,"notes",function(){return ft}),e.d(r,"exists",function(){return mt}),e.d(r,"supersets",function(){return gt}),e.d(r,"subsets",function(){return _t}),e.d(r,"tokenize",function(){return M}),e(2)),i="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),s=function(e){return"string"!=typeof e?i.slice():i.filter(function(t){t=t[1]||" ";return-1!==e.indexOf(t)})},z=s(" #"),F=s(" b"),j=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function a(t){t=j.exec(t="string"!=typeof t?"":t);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}function u(t,e){return Array(e+1).join(t)}var c,V=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),h=[0,2,4,5,7,9,11],l=(void 0===c&&(c={}),function(t){return c[t]||(c[t]=""===(t=a(t))[0]||""!==t[3]?V:((n={letter:n=t[0],acc:e=t[1],octStr:t=t[2],pc:n+e,name:n+e+t,step:(n.charCodeAt(0)+3)%7,alt:"b"===e[0]?-e.length:e.length,oct:t.length?+t:null,chroma:0,midi:null,freq:null}).chroma=(h[n.step]+n.alt+120)%12,n.midi=null!==n.oct?h[n.step]+n.alt+12*(n.oct+1):null,n.freq=d(n.midi),Object.freeze(n)));var e,n}),L=function(t){return l(t).name},p=function(t){return l(t).pc},B=function(t){var e;return("number"==typeof t||"string"==typeof t)&&0<=(e=(e=l(t).midi)||0===e?e:+t)&&e<=127?e:null},d=function(t,e){return void 0===e&&(e=440),"number"==typeof t?Math.pow(2,(t-69)/12)*e:null},U=function(t){return l(t).freq||d(t)},G=Math.log(2),Q=Math.log(440),H=function(t){t=12*(Math.log(t)-Q)/G+69;return Math.round(100*t)/100},f=function(t){return l(t).chroma},W=function(t){return l(t).oct},m=function(t){return"CDEFGAB"[t]},g=function(t){return"number"!=typeof t?"":(t=t)<0?u("b",-t):u("#",t)},_=function(t,e){void 0===t&&(t={});var e=(e=void 0===e?null:e)?Object.assign({},l(e),t):t,t=e.step,n=e.alt,e=e.oct;return"number"==typeof t&&(t=m(t))?(t=t+g(n),e||0===e?t+e:t):null},y=_;function v(t,e){return void 0===e&&(e=!1),t=Math.round(t),(!0===e?z:F)[t%12]+(Math.floor(t/12)-1)}function $(t){var e,n;return null===(t=null===(t=X.exec(""+t))?null:t[1]?[t[1],t[2]]:[t[4],t[3]])||((n={num:0,q:"d",name:"",type:"M",step:0,dir:-1,simple:1,alt:0,oct:0,semitones:0,chroma:0,ic:0}).num=+t[0],n.q=t[1],n.step=J(n.num),n.type="PMMPPMM"[n.step],"M"===n.type&&"P"===n.q)?Z:(n.name=""+n.num+n.q,n.dir=n.num<0?-1:1,n.simple=8===n.num||-8===n.num?n.num:n.dir*(n.step+1),n.alt=(t=n.type,"M"===(e=n.q)&&"M"===t||"P"===e&&"P"===t?0:"m"===e&&"M"===t?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?"P"===t?-e.length:-e.length-1:null),n.oct=Math.floor((Math.abs(n.num)-1)/7),n.semitones=n.dir*(S[n.step]+n.alt+12*n.oct),n.chroma=(n.dir*(S[n.step]+n.alt)%12+12)%12,Object.freeze(n))}var b=function(t,e){void 0===e&&(e=!0);var t=l(t),n=t.alt,i=t.chroma,t=t.midi;return null===i?null:(e=!1===e?n<0:0<n,null===t?p(v(i,e)):v(t,e))},Y=function(t){return b(t,!1)},X=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),S=[0,2,4,5,7,9,11],Z=("1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null,oct:null})),J=function(t){return(Math.abs(t)-1)%7},K={};function tt(t){return"string"!=typeof t?Z:K[t]||(K[t]=$(t))}"P m M m M P d P m M m M".split(" ");function et(r){return void 0===o&&(o={}),function(t){return o[t]||(o[t]=null===(t=r(t)).name?null:(e=t.step,n=t.alt,i=t.oct,void 0===(t=t.dir)&&(t=1),s=nt[e]+7*n,null===i?[t*s]:[t*s,t*(i-it[e]-4*n)]));var e,n,i,s};var o}var nt=[0,2,4,-1,1,3,5],it=nt.map(function(t){return Math.floor(7*t/12)}),st=[3,0,4,1,5,2,6],rt=function(t,e,n){var i=st[(i=(t+1)%7)<0?7+i:i],t=Math.floor((t+1)/7);return void 0===e?{step:i,alt:t,dir:n}:{step:i,alt:t,oct:e+4*t+it[i],dir:n}},ot=et(l),at=et(tt);function ut(e,t){var n;return 1===arguments.length?function(t){return ut(e,t)}:(n=ot(e),t=at(t),null===n||null===t?null:(n=1===n.length?[n[0]+t[0]]:[n[0]+t[0],n[1]+t[1]],y(rt(n[0],n[1]))))}var t=e(64),w=e(65),ct=function(t){return f(t)||tt(t).chroma||0},x=function(t){return parseInt(T(t),2)};function T(t){var e;return ht.test(t)?t:Array.isArray(t)?(e=[0,0,0,0,0,0,0,0,0,0,0,0],t.map(ct).forEach(function(t){e[t]=1}),e.join("")):""}var ht=/^[01]{12}$/;"1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");function lt(s){function r(t,e,n){i[t]=e,o[n]=o[n]||[],o[n].push(t)}function t(t){return i[t]}var e=Object.keys(s).sort(),i=[],o=[],n=(e.forEach(function(t){var e=s[t][0].split(" "),n=s[t][1],i=T(e);r(t,e,i),n&&n.forEach(function(t){return r(t,e,i)})}),Object.keys(i).sort());return t.names=function(t){return("string"==typeof t?o[t]||[]:!0===t?n:e).slice()},t}var A,t=lt(t),k=lt(w),pt=(Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null}),t.names,k.names),dt=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),O=(void 0===A&&(A={}),function(t){return A[t]||(A[t]=(e=k(t=t))?((t={intervals:e,name:t}).chroma=T(e),t.setnum=parseInt(t.chroma,2),t.names=k.names(t.chroma),t):dt);var e}),P=function(t){return O(M(t)[1]).intervals};function ft(t,e){return(e?O(e):(t=(e=M(t))[0],O(e[1]))).intervals.map(ut(t))}var mt=function(t){return void 0!==k(M(t)[1])},gt=function(t){var e;return P(t).length?(e=function t(e,n){return 1<arguments.length?t(e)(n):(e=x(e),function(t){return(t=x(t))!==e&&(t|e)===t})}(P(t)),k.names().filter(function(t){return e(k(t))})):[]},_t=function(t){var e=function t(e,n){return 1<arguments.length?t(e)(n):(e=x(e),function(t){return(t=x(t))!==e&&(t&e)===t})}(P(t));return k.names().filter(function(t){return e(k(t))})},yt=/^(6|64|7|9|11|13)$/;function M(t){var e=a(t);return""===e[0]?["",t]:"A"===e[0]&&"ug"===e[3]?["","aug"]:yt.test(e[2])?[e[0]+e[1],e[2]+e[3]]:[e[0]+e[1]+e[2],e[3]]}var C,N=e(8);let vt=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];(w=C=C||{})[w.Major=0]="Major",w[w.Minor=1]="Minor",w[w.Augmented=2]="Augmented",w[w.Diminished=3]="Diminished",w[w.Other=4]="Other";class I extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class E extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class q{static pitches(t){if(r.tokenize(t)[0]&&r.exists(t))return r.notes(t).map(n.chroma);throw new I("Unrecognized chord symbol: "+t)}static root(t){var e=r.tokenize(t)[0];if(e)return n.chroma(e);throw new I("Chord symbol has unknown root: "+t)}static quality(t){if(!r.exists(t))throw new I("Unrecognized chord symbol: "+t);let e=r.intervals(t),n=vt.map(t=>t.every(t=>e.includes(t))),i=n.indexOf(!0),s=n.lastIndexOf(!0);return 0<=i&&i===s?i:C.Other}}class D{encodeProgression(t,e){let n=t.map(t=>this.encode(t)),i=Array.from(Array(e).keys()).map(t=>Math.floor(t*n.length/e));return o.stack(i.map(t=>n[t]))}}function bt(t){switch(t){case"MajorMinorChordEncoder":return new St;case"TriadChordEncoder":return new wt;case"PitchChordEncoder":return new xt;default:throw new Error("Unknown chord encoder type: "+t)}}class St extends D{constructor(){super(...arguments),this.depth=1+2*N.NUM_PITCH_CLASSES}index(t){if(t===N.NO_CHORD)return 0;var e=q.root(t),e=1+q.quality(t)*N.NUM_PITCH_CLASSES+e;if(e>=this.depth)throw new E("Chord is neither major nor minor: "+t);return e}encode(t){return o.tidy(()=>o.oneHot(o.tensor1d([this.index(t)],"int32"),this.depth).as1D())}}class wt extends D{constructor(){super(...arguments),this.depth=1+4*N.NUM_PITCH_CLASSES}index(t){if(t===N.NO_CHORD)return 0;var e=q.root(t),e=1+q.quality(t)*N.NUM_PITCH_CLASSES+e;if(e>=this.depth)throw new E("Chord is not a standard triad: "+t);return e}encode(t){return o.tidy(()=>o.oneHot(o.tensor1d([this.index(t)],"int32"),this.depth).as1D())}}class xt extends D{constructor(){super(...arguments),this.depth=1+3*N.NUM_PITCH_CLASSES}encode(r){return o.tidy(()=>{if(r===N.NO_CHORD)return o.oneHot(o.tensor1d([0],"int32"),this.depth).as1D();let t=q.root(r),e=o.oneHot(o.tensor1d([t],"int32"),N.NUM_PITCH_CLASSES).as1D(),n=o.buffer([N.NUM_PITCH_CLASSES]);q.pitches(r).forEach(t=>n.set(1,t));var i=n.toTensor().as1D(),s=e;return o.concat1d([o.tensor1d([0]),e,i,s])})}}},,,,,,,,,,,function(t,e,n){n.r(e),n.d(e,"auxiliaryInputFromSpec",function(){return s}),n.d(e,"AuxiliaryInput",function(){return r}),n.d(e,"BinaryCounter",function(){return o});var i=n(2);function s(t){if("BinaryCounter"!==t.type)throw new Error("Unknown auxiliary input: "+t);return new o(t.args)}class r{constructor(t){this.depth=t}}class o extends r{constructor(t){super(t.numBits)}getTensors(t){var n=i.buffer([t,this.depth]);for(let e=0;e<t;++e)for(let t=0;t<this.depth;++t)n.set(Math.floor((e+1)/Math.pow(2,t))%2?1:-1,e,t);return n.toTensor().as2D(t,this.depth)}}},function(t,e,n){t.exports=n(50)},function(t,e,n){var i=e;function s(){i.util._configure(),i.Writer._configure(i.BufferWriter),i.Reader._configure(i.BufferReader)}i.build="minimal",i.Writer=n(33),i.BufferWriter=n(59),i.Reader=n(34),i.BufferReader=n(60),i.util=n(18),i.rpc=n(61),i.roots=n(63),i.configure=s,s()},function(t,e,n){t.exports=function(t,e){for(var n=new Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,s){n[r]=function(t){if(o)if(o=!1,t)s(t);else{for(var e=new Array(arguments.length-1),n=0;n<e.length;)e[n++]=arguments[n];i.apply(null,e)}};try{t.apply(e||null,n)}catch(t){o&&(o=!1,s(t))}})}},function(t,e,n){e.length=function(t){var e=t.length;if(!e)return 0;for(var n=0;1<--e%4&&"="===t.charAt(e);)++n;return Math.ceil(3*t.length)/4-n};for(var c=new Array(64),u=new Array(123),i=0;i<64;)u[c[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;e.encode=function(t,e,n){for(var i,s=null,r=[],o=0,a=0;e<n;){var u=t[e++];switch(a){case 0:r[o++]=c[u>>2],i=(3&u)<<4,a=1;break;case 1:r[o++]=c[i|u>>4],i=(15&u)<<2,a=2;break;case 2:r[o++]=c[i|u>>6],r[o++]=c[63&u],a=0}8191<o&&((s=s||[]).push(String.fromCharCode.apply(String,r)),o=0)}return a&&(r[o++]=c[i],r[o++]=61,1===a)&&(r[o++]=61),s?(o&&s.push(String.fromCharCode.apply(String,r.slice(0,o))),s.join("")):String.fromCharCode.apply(String,r.slice(0,o))},e.decode=function(t,e,n){for(var i,s=n,r=0,o=0;o<t.length;){var a=t.charCodeAt(o++);if(61===a&&1<r)break;if(void 0===(a=u[a]))throw Error("invalid encoding");switch(r){case 0:i=a,r=1;break;case 1:e[n++]=i<<2|(48&a)>>4,i=a,r=2;break;case 2:e[n++]=(15&i)<<4|(60&a)>>2,i=a,r=3;break;case 3:e[n++]=(3&i)<<6|a,r=0}}if(1===r)throw Error("invalid encoding");return n-s},e.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},function(t,e,n){function i(){this._listeners={}}(t.exports=i).prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},i.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var n=this._listeners[t],i=0;i<n.length;)n[i].fn===e?n.splice(i,1):++i;return this},i.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<e.length;)e[i].fn.apply(e[i++].ctx,n)}return this}},function(t,e,n){function i(t){return"undefined"!=typeof Float32Array?(c=new Float32Array([-0]),h=new Uint8Array(c.buffer),l=128===h[3],t.writeFloatLE=l?f:m,t.writeFloatBE=l?m:f,t.readFloatLE=l?g:_,t.readFloatBE=l?_:g):(t.writeFloatLE=p.bind(null,y),t.writeFloatBE=p.bind(null,v),t.readFloatLE=d.bind(null,b),t.readFloatBE=d.bind(null,S)),"undefined"!=typeof Float64Array?(a=new Float64Array([-0]),u=new Uint8Array(a.buffer),l=128===u[7],t.writeDoubleLE=l?i:s,t.writeDoubleBE=l?s:i,t.readDoubleLE=l?r:o,t.readDoubleBE=l?o:r):(t.writeDoubleLE=e.bind(null,y,0,4),t.writeDoubleBE=e.bind(null,v,4,0),t.readDoubleLE=n.bind(null,b,0,4),t.readDoubleBE=n.bind(null,S,4,0)),t;function e(t,e,n,i,s,r){var o,a,u=i<0?1:0;0===(i=u?-i:i)?(t(0,s,r+e),t(0<1/i?0:2147483648,s,r+n)):isNaN(i)?(t(0,s,r+e),t(2146959360,s,r+n)):17976931348623157e292<i?(t(0,s,r+e),t((u<<31|2146435072)>>>0,s,r+n)):i<22250738585072014e-324?(t((o=i/5e-324)>>>0,s,r+e),t((u<<31|o/4294967296)>>>0,s,r+n)):(1024===(a=Math.floor(Math.log(i)/Math.LN2))&&(a=1023),t(4503599627370496*(o=i*Math.pow(2,-a))>>>0,s,r+e),t((u<<31|a+1023<<20|1048576*o&1048575)>>>0,s,r+n))}function n(t,e,n,i,s){e=t(i,s+e),t=t(i,s+n),i=2*(t>>31)+1,s=t>>>20&2047,n=4294967296*(1048575&t)+e;return 2047==s?n?NaN:1/0*i:0==s?5e-324*i*n:i*Math.pow(2,s-1075)*(n+4503599627370496)}function i(t,e,n){a[0]=t,e[n]=u[0],e[n+1]=u[1],e[n+2]=u[2],e[n+3]=u[3],e[n+4]=u[4],e[n+5]=u[5],e[n+6]=u[6],e[n+7]=u[7]}function s(t,e,n){a[0]=t,e[n]=u[7],e[n+1]=u[6],e[n+2]=u[5],e[n+3]=u[4],e[n+4]=u[3],e[n+5]=u[2],e[n+6]=u[1],e[n+7]=u[0]}function r(t,e){return u[0]=t[e],u[1]=t[e+1],u[2]=t[e+2],u[3]=t[e+3],u[4]=t[e+4],u[5]=t[e+5],u[6]=t[e+6],u[7]=t[e+7],a[0]}function o(t,e){return u[7]=t[e],u[6]=t[e+1],u[5]=t[e+2],u[4]=t[e+3],u[3]=t[e+4],u[2]=t[e+5],u[1]=t[e+6],u[0]=t[e+7],a[0]}var a,u,c,h,l;function p(t,e,n,i){var s=e<0?1:0;0===(e=s?-e:e)?t(0<1/e?0:2147483648,n,i):isNaN(e)?t(2143289344,n,i):t(34028234663852886e22<e?(s<<31|2139095040)>>>0:e<11754943508222875e-54?(s<<31|Math.round(e/1401298464324817e-60))>>>0:(s<<31|(t=Math.floor(Math.log(e)/Math.LN2))+127<<23|8388607&Math.round(e*Math.pow(2,-t)*8388608))>>>0,n,i)}function d(t,e,n){t=t(e,n),e=2*(t>>31)+1,n=t>>>23&255,t&=8388607;return 255==n?t?NaN:1/0*e:0==n?1401298464324817e-60*e*t:e*Math.pow(2,n-150)*(8388608+t)}function f(t,e,n){c[0]=t,e[n]=h[0],e[n+1]=h[1],e[n+2]=h[2],e[n+3]=h[3]}function m(t,e,n){c[0]=t,e[n]=h[3],e[n+1]=h[2],e[n+2]=h[1],e[n+3]=h[0]}function g(t,e){return h[0]=t[e],h[1]=t[e+1],h[2]=t[e+2],h[3]=t[e+3],c[0]}function _(t,e){return h[3]=t[e],h[2]=t[e+1],h[1]=t[e+2],h[0]=t[e+3],c[0]}}function y(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function v(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function b(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function S(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}t.exports=i(i)},function(module,exports,__webpack_require__){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},function(t,e,n){e.length=function(t){for(var e,n=0,i=0;i<t.length;++i)(e=t.charCodeAt(i))<128?n+=1:e<2048?n+=2:55296==(64512&e)&&56320==(64512&t.charCodeAt(i+1))?(++i,n+=4):n+=3;return n},e.read=function(t,e,n){if(n-e<1)return"";for(var i,s=null,r=[],o=0;e<n;)(i=t[e++])<128?r[o++]=i:191<i&&i<224?r[o++]=(31&i)<<6|63&t[e++]:239<i&&i<365?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,r[o++]=55296+(i>>10),r[o++]=56320+(1023&i)):r[o++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],8191<o&&((s=s||[]).push(String.fromCharCode.apply(String,r)),o=0);return s?(o&&s.push(String.fromCharCode.apply(String,r.slice(0,o))),s.join("")):String.fromCharCode.apply(String,r.slice(0,o))},e.write=function(t,e,n){for(var i,s,r=n,o=0;o<t.length;++o)(i=t.charCodeAt(o))<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&56320==(64512&(s=t.charCodeAt(o+1)))?(++o,e[n++]=(i=65536+((1023&i)<<10)+(1023&s))>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128);return n-r}},function(t,e,n){t.exports=function(e,n,t){var i=t||8192,s=i>>>1,r=null,o=i;return function(t){if(t<1||s<t)return e(t);i<o+t&&(r=e(i),o=0);t=n.call(r,o,o+=t);return 7&o&&(o=1+(7|o)),t}}},function(t,e,n){t.exports=s;var i=n(18);function s(t,e){this.lo=t>>>0,this.hi=e>>>0}var r=s.zero=new s(0,0),o=(r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1},s.zeroHash="\0\0\0\0\0\0\0\0",s.fromNumber=function(t){var e,n;return 0===t?r:(n=(t=(e=t<0)?-t:t)>>>0,t=(t-n)/4294967296>>>0,e&&(t=~t>>>0,n=~n>>>0,4294967295<++n)&&(n=0,4294967295<++t)&&(t=0),new s(n,t))},s.from=function(t){if("number"==typeof t)return s.fromNumber(t);if(i.isString(t)){if(!i.Long)return s.fromNumber(parseInt(t,10));t=i.Long.fromString(t)}return t.low||t.high?new s(t.low>>>0,t.high>>>0):r},s.prototype.toNumber=function(t){var e;return!t&&this.hi>>>31?(t=1+~this.lo>>>0,e=~this.hi>>>0,-(t+4294967296*(e=t?e:e+1>>>0))):this.lo+4294967296*this.hi},s.prototype.toLong=function(t){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}},String.prototype.charCodeAt);s.fromHash=function(t){return"\0\0\0\0\0\0\0\0"===t?r:new s((o.call(t,0)|o.call(t,1)<<8|o.call(t,2)<<16|o.call(t,3)<<24)>>>0,(o.call(t,4)|o.call(t,5)<<8|o.call(t,6)<<16|o.call(t,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},s.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},s.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0==n?0==e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}},function(t,e,n){t.exports=r;var i=n(33),s=((r.prototype=Object.create(i.prototype)).constructor=r,n(18));function r(){i.call(this)}function o(t,e,n){t.length<40?s.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}r._configure=function(){r.alloc=s._Buffer_allocUnsafe,r.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var i=0;i<t.length;)e[n++]=t[i++]}},r.prototype.bytes=function(t){var e=(t=s.isString(t)?s._Buffer_from(t,"base64"):t).length>>>0;return this.uint32(e),e&&this._push(r.writeBytesBuffer,e,t),this},r.prototype.string=function(t){var e=s.Buffer.byteLength(t);return this.uint32(e),e&&this._push(o,e,t),this},r._configure()},function(t,e,n){t.exports=r;var i=n(34),s=((r.prototype=Object.create(i.prototype)).constructor=r,n(18));function r(t){i.call(this,t)}r._configure=function(){s.Buffer&&(r.prototype._slice=s.Buffer.prototype.slice)},r.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},r._configure()},function(t,e,n){e.Service=n(62)},function(t,e,n){t.exports=i;var a=n(18);function i(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");a.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}((i.prototype=Object.create(a.EventEmitter.prototype)).constructor=i).prototype.rpcCall=function t(n,e,i,s,r){if(!s)throw TypeError("request must be specified");var o=this;if(!r)return a.asPromise(t,o,n,e,i,s);if(o.rpcImpl)try{return o.rpcImpl(n,e[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(t,e){if(t)return o.emit("error",t,n),r(t);if(null!==e){if(!(e instanceof i))try{e=i[o.responseDelimited?"decodeDelimited":"decode"](e)}catch(t){return o.emit("error",t,n),r(t)}return o.emit("data",e,n),r(null,e)}o.end(!0)})}catch(t){o.emit("error",t,n),setTimeout(function(){r(t)},0)}else setTimeout(function(){r(Error("already ended"))},0)},i.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(t,e,n){t.exports={}},function(t){t.exports=JSON.parse('{"chromatic":["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],"lydian":["1P 2M 3M 4A 5P 6M 7M"],"major":["1P 2M 3M 4P 5P 6M 7M",["ionian"]],"mixolydian":["1P 2M 3M 4P 5P 6M 7m",["dominant"]],"dorian":["1P 2M 3m 4P 5P 6M 7m"],"aeolian":["1P 2M 3m 4P 5P 6m 7m",["minor"]],"phrygian":["1P 2m 3m 4P 5P 6m 7m"],"locrian":["1P 2m 3m 4P 5d 6m 7m"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m",["half-diminished"]],"altered":["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"phrygian dominant":["1P 2m 3M 4P 5P 6m 7m",["spanish","phrygian major"]],"half-whole diminished":["1P 2m 3m 3M 4A 5P 6M 7m",["dominant diminished"]],"diminished":["1P 2M 3m 4P 5d 6m 6M 7M",["whole-half diminished"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],"iwato":["1P 2m 4P 5d 7m"],"hirajoshi":["1P 2M 3m 5P 6m"],"kumoijoshi":["1P 2m 4P 5P 6m"],"pelog":["1P 2m 3m 5P 6m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],"prometheus":["1P 2M 3M 4A 6M 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],"ritusen":["1P 2M 4P 5P 6M"],"scriabin":["1P 2m 3M 5P 6M"],"piongio":["1P 2M 4P 5P 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],"augmented":["1P 2A 3M 5P 5A 7M"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],"neopolitan":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],"egyptian":["1P 2M 4P 5P 7m"],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],"oriental":["1P 2m 3M 4P 5d 6M 7m"],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],"flamenco":["1P 2m 3m 3M 4A 5P 7m"],"balinese":["1P 2m 3m 4P 5P 6m 7M"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],"persian":["1P 2m 3M 4P 5d 6m 7M"],"bebop":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],"enigmatic":["1P 2m 3M 5d 6m 7m 7M"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],"ichikosucho":["1P 2M 3M 4P 5d 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}')},function(t){t.exports=JSON.parse('{"4":["1P 4P 7m 10m",["quartal"]],"5":["1P 5P"],"7":["1P 3M 5P 7m",["Dominant","Dom"]],"9":["1P 3M 5P 7m 9M",["79"]],"11":["1P 5P 7m 9M 11P"],"13":["1P 3M 5P 7m 9M 13M",["13_"]],"64":["5P 8P 10M"],"M":["1P 3M 5P",["Major",""]],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],"M13":["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],"M6":["1P 3M 5P 13M",["6"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],"M69":["1P 3M 5P 6M 9M",["69"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],"M7add13":["1P 3M 5P 6M 7M 9M"],"M7b5":["1P 3M 5d 7M"],"M7b6":["1P 3M 6m 7M"],"M7b9":["1P 3M 5P 7M 9m"],"M7sus4":["1P 4P 5P 7M"],"M9":["1P 3M 5P 7M 9M",["maj9","Maj9"]],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],"M9b5":["1P 3M 5d 7M 9M"],"M9sus4":["1P 4P 5P 7M 9M"],"Madd9":["1P 3M 5P 9M",["2","add9","add2"]],"Maj7":["1P 3M 5P 7M",["maj7","M7"]],"Mb5":["1P 3M 5d"],"Mb6":["1P 3M 13m"],"Msus2":["1P 2M 5P",["add9no3","sus2"]],"Msus4":["1P 4P 5P",["sus","sus4"]],"Maddb9":["1P 3M 5P 9m"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],"m":["1P 3m 5P"],"m#5":["1P 3m 5A",["m+","mb6"]],"m11":["1P 3m 5P 7m 9M 11P",["_11"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],"m11b5":["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],"m13":["1P 3m 5P 7m 9M 11P 13M",["_13"]],"m6":["1P 3m 4P 5P 13M",["_6"]],"m69":["1P 3m 5P 6M 9M",["_69"]],"m7":["1P 3m 5P 7m",["minor7","_","_7"]],"m7#5":["1P 3m 6m 7m"],"m7add11":["1P 3m 5P 7m 11P",["m7add4"]],"m7b5":["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],"m9":["1P 3m 5P 7m 9M",["_9"]],"m9#5":["1P 3m 6m 7m 9M"],"m9b5":["1P 3m 7m 12d 2M",["h9","-9b5"]],"mMaj7":["1P 3m 5P 7M",["mM7","_M7"]],"mMaj7b6":["1P 3m 5P 6m 7M",["mM7b6"]],"mM9":["1P 3m 5P 7M 9M",["mMaj9","-M9"]],"mM9b6":["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],"mb6M7":["1P 3m 6m 7M"],"mb6b9":["1P 3m 6m 9m"],"o":["1P 3m 5d",["mb5","dim"]],"o7":["1P 3m 5d 13M",["diminished","m6b5","dim7"]],"o7M7":["1P 3m 5d 6M 7M"],"oM7":["1P 3m 5d 7M"],"sus24":["1P 2M 4P 5P",["sus4add9"]],"+add#9":["1P 3M 5A 9A"],"madd4":["1P 3m 4P 5P"],"madd9":["1P 3m 5P 9M"]}')},function(t,n,e){Object.defineProperty(n,"__esModule",{value:!0});var s=e(80),i=new WeakMap,e=(n.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"],r.prototype.update=function(){var i=this,s=0,r=0;this.tempos.sort(function(t,e){return t.ticks-e.ticks}),this.tempos.forEach(function(t,e){var e=(0<e?i.tempos[e-1]:i.tempos[0]).bpm,n=t.ticks/i.ppq-r;t.time=60/e*n+s,s=t.time,r+=n}),this.timeSignatures.sort(function(t,e){return t.ticks-e.ticks}),this.timeSignatures.forEach(function(t,e){var e=0<e?i.timeSignatures[e-1]:i.timeSignatures[0],n=(t.ticks-e.ticks)/i.ppq/e.timeSignature[0]/(e.timeSignature[1]/4);e.measures=e.measures||0,t.measures=n+e.measures})},r.prototype.ticksToSeconds=function(t){var e,n,i=s.search(this.tempos,t);return-1!==i?(e=(i=this.tempos[i]).time,n=(t-i.ticks)/this.ppq,e+60/i.bpm*n):t/this.ppq*.5},r.prototype.ticksToMeasures=function(t){var e,n=s.search(this.timeSignatures,t);return-1!==n?(e=(t-(n=this.timeSignatures[n]).ticks)/this.ppq,n.measures+e/(n.timeSignature[0]/n.timeSignature[1])/4):t/this.ppq/4},Object.defineProperty(r.prototype,"ppq",{get:function(){return i.get(this)},enumerable:!0,configurable:!0}),r.prototype.secondsToTicks=function(t){var e,n=s.search(this.tempos,t,"time");return-1!==n?(e=(t-(n=this.tempos[n]).time)/(60/n.bpm),Math.round(n.ticks+e*this.ppq)):Math.round(t/.5*this.ppq)},r.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(t){return{bpm:t.bpm,ticks:t.ticks}}),timeSignatures:this.timeSignatures}},r.prototype.fromJSON=function(t){this.name=t.name,this.tempos=t.tempos.map(function(t){return Object.assign({},t)}),this.timeSignatures=t.timeSignatures.map(function(t){return Object.assign({},t)}),this.keySignatures=t.keySignatures.map(function(t){return Object.assign({},t)}),this.meta=t.meta.map(function(t){return Object.assign({},t)}),i.set(this,t.ppq),this.update()},r.prototype.setTempo=function(t){this.tempos=[{bpm:t,ticks:0}],this.update()},r);function r(t){var e=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",i.set(this,480),t&&(i.set(this,t.header.ticksPerBeat),t.tracks.forEach(function(t){return t.forEach(function(t){t.meta&&("timeSignature"===t.type?e.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?e.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type&&e.keySignatures.push({key:n.keySignatureKeys[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}))})}),t.tracks[0].forEach(function(t){t.meta&&("trackName"===t.type?e.name=t.text:"text"!==t.type&&"cuePoint"!==t.type&&"marker"!==t.type&&"lyrics"!==t.type||e.meta.push({text:t.text,ticks:t.absoluteTime,type:t.type}))}),this.update())}n.Header=e},function(t,e,n){var i=this&&this.__awaiter||function(t,o,a,u){return new(a=a||Promise)(function(n,e){function i(t){try{r(u.next(t))}catch(t){e(t)}}function s(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(i,s)}r((u=u.apply(t,o||[])).next())})},s=this&&this.__generator||function(i,s){var r,o,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(n){return function(t){var e=[n,t];if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!((a=0<(a=u.trys).length&&a[a.length-1])||6!==e[0]&&2!==e[0])){u=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3]))u.label=e[1];else if(6===e[0]&&u.label<a[1])u.label=a[1],a=e;else{if(!(a&&u.label<a[2])){a[2]&&u.ops.pop(),u.trys.pop();continue}u.label=a[2],u.ops.push(e)}}e=s.call(i,u)}catch(t){e=[6,t],o=0}finally{r=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},r=(Object.defineProperty(e,"__esModule",{value:!0}),n(79)),o=n(174),a=n(66),u=n(81);function c(t){var e=this,n=null;t&&(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(n=r.parseMidi(t)).tracks.forEach(function(t){var e=0;t.forEach(function(t){e+=t.deltaTime,t.absoluteTime=e})}),n.tracks=(t=>{for(var e=[],n=0;n<t.length;n++)for(var i=e.length,s=new Map,r=Array(16).fill(0),o=0,a=t[n];o<a.length;o++){var u=a[o],c=i,h=u.channel;void 0!==h&&("programChange"===u.type&&(r[h]=u.programNumber),h=r[h]+" "+h,s.has(h)?c=s.get(h):(c=i+s.size,s.set(h,c))),e[c]||e.push([]),e[c].push(u)}return e})(n.tracks)),this.header=new a.Header(n),this.tracks=[],t&&(this.tracks=n.tracks.map(function(t){return new u.Track(t,e.header)}),1===n.header.format)&&0===this.tracks[0].duration&&this.tracks.shift()}c.fromUrl=function(n){return i(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,fetch(n)];case 1:return(e=t.sent()).ok?[4,e.arrayBuffer()]:[3,3];case 2:return[2,new c(t.sent())];case 3:throw new Error("could not load "+n)}})})},Object.defineProperty(c.prototype,"name",{get:function(){return this.header.name},set:function(t){this.header.name=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"duration",{get:function(){var t=this.tracks.map(function(t){return t.duration});return Math.max.apply(Math,t)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"durationTicks",{get:function(){var t=this.tracks.map(function(t){return t.durationTicks});return Math.max.apply(Math,t)},enumerable:!0,configurable:!0}),c.prototype.addTrack=function(){var t=new u.Track(void 0,this.header);return this.tracks.push(t),t},c.prototype.toArray=function(){return o.encode(this)},c.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(t){return t.toJSON()})}},c.prototype.fromJSON=function(t){var n=this;this.header=new a.Header,this.header.fromJSON(t.header),this.tracks=t.tracks.map(function(t){var e=new u.Track(void 0,n.header);return e.fromJSON(t),e})},c.prototype.clone=function(){var t=new c;return t.fromJSON(this.toJSON()),t},e.Midi=c;var h=n(81),h=(e.Track=h.Track,n(66));e.Header=h.Header},,,,,,function(R,t,e){e.r(t),e.d(t,"aux_inputs",function(){return n}),e.d(t,"chords",function(){return i}),e.d(t,"constants",function(){return a}),e.d(t,"data",function(){return s}),e.d(t,"logging",function(){return u}),e.d(t,"melodies",function(){return r}),e.d(t,"performance",function(){return o}),e.d(t,"sequences",function(){return c}),e.d(t,"MetronomeCallbackObject",function(){return l}),e.d(t,"Metronome",function(){return p}),e.d(t,"MidiConversionError",function(){return g}),e.d(t,"midiToSequenceProto",function(){return _}),e.d(t,"sequenceProtoToMidi",function(){return y}),e.d(t,"urlToBlob",function(){return v}),e.d(t,"blobToNoteSequence",function(){return b}),e.d(t,"urlToNoteSequence",function(){return S}),e.d(t,"BasePlayerCallback",function(){return A}),e.d(t,"BasePlayer",function(){return k}),e.d(t,"Player",function(){return P}),e.d(t,"SoundFontPlayer",function(){return M}),e.d(t,"PlayerWithClick",function(){return C}),e.d(t,"MIDIPlayer",function(){return N}),e.d(t,"BaseRecorderCallback",function(){return z}),e.d(t,"Recorder",function(){return F}),e.d(t,"BaseVisualizer",function(){return E}),e.d(t,"PianoRollCanvasVisualizer",function(){return q}),e.d(t,"Visualizer",function(){return V}),e.d(t,"BaseSVGVisualizer",function(){return D}),e.d(t,"PianoRollSVGVisualizer",function(){return L}),e.d(t,"WaterfallSVGVisualizer",function(){return B}),e.d(t,"ScrollType",function(){return I}),e.d(t,"StaffSVGVisualizer",function(){return U});var n=e(48),i=e(37),a=e(8),s=e(36),u=e(12),r=e(23),o=e(29),c=e(13),h=e(9);class l{}class p{constructor(t,e=1){this.clicksPerQuarter=1,this.muted=!1,this.loClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.loClickNote="c5",this.hiClickNote="g5",this.ticking=!1,this.startedAt=null,this.step=-1,this.reset(),this.callbackObject=t,this.clicksPerQuarter=e}isTicking(){return this.ticking}getStartedAt(){return this.startedAt}getOffsetTime(){return h.immediate()-this.startedAt}start(t=120){this.reset(),this.ticking=!0,this.callbackObject.click||(this.callbackObject.click=()=>{}),this.callbackObject.quarter||(this.callbackObject.quarter=()=>{}),this.callbackObject.bar||(this.callbackObject.bar=()=>{});let r=0,o=4*this.clicksPerQuarter;h.Transport.scheduleRepeat(t=>{this.startedAt||(this.startedAt=t);var e=t-this.startedAt,n=(this.step++,this.step%o),i=Math.floor(n/this.clicksPerQuarter),s=n%this.clicksPerQuarter;this.callbackObject.click(e,n),0==s&&this.callbackObject.quarter(e,i),this.muted||(0==n?this.hiClick.triggerAttack(this.hiClickNote,t,.1):this.loClick.triggerAttack(this.loClickNote,t,.1)),0==n&&(this.callbackObject.bar(e,r),r++)},o+"n"),h.Transport.bpm.value=t,h.Transport.start()}stop(){this.ticking=!1,h.Transport.cancel(),h.Transport.stop()}reset(){this.muted=!1,this.ticking=!1,this.step=-1,this.startedAt=null}}var d=e(67),f=e(15),m=e(10);class g extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}function _(t){let e=new d.Midi(t),i=m.a.create();i.ticksPerQuarter=e.header.ppq,i.sourceInfo=m.a.SourceInfo.create({parser:m.a.SourceInfo.Parser.TONEJS_MIDI_CONVERT,encodingType:m.a.SourceInfo.EncodingType.MIDI});for(let t of e.header.timeSignatures)i.timeSignatures.push(m.a.TimeSignature.create({time:e.header.ticksToSeconds(t.ticks),numerator:t.timeSignature[0],denominator:t.timeSignature[1]}));i.timeSignatures.length||i.timeSignatures.push(m.a.TimeSignature.create({time:0,numerator:4,denominator:4}));for(let t of e.header.tempos)i.tempos.push(m.a.Tempo.create({time:t.time,qpm:t.bpm}));let s=-1;for(let n of e.tracks){0<n.notes.length&&(s+=1);for(let t of n.notes){var r=t.time,o=r+t.duration;i.notes.push(m.a.Note.create({instrument:s,program:n.instrument.number,startTime:r,endTime:o,pitch:t.midi,velocity:Math.floor(t.velocity*a.MIDI_VELOCITIES),isDrum:n.instrument.percussion})),o>i.totalTime&&(i.totalTime=o)}let t=Object.values(n.controlChanges),e=[].concat.apply([],t);for(let t of e)i.controlChanges.push(m.a.ControlChange.create({time:t.time,controlNumber:t.number,controlValue:Math.floor(t.value*(a.MIDI_VELOCITIES-1)),instrument:s,program:n.instrument.number,isDrum:n.instrument.percussion}))}return i}function y(e){c.isQuantizedSequence(e)&&(e=c.unquantizeSequence(e));let s=new d.Midi,n=(s.fromJSON({header:{name:"",ppq:e.ticksPerQuarter||a.DEFAULT_TICKS_PER_QUARTER,tempos:[],timeSignatures:[],keySignatures:[],meta:[]},tracks:[]}),Array.from(e.tempos||[]));0===n.length&&n.push({time:0,qpm:a.DEFAULT_QUARTERS_PER_MINUTE}),n.sort((t,e)=>t.time-e.time);for(let t of n)s.header.tempos.push({ticks:s.header.secondsToTicks(t.time),bpm:t.qpm}),s.header.update();if(e.timeSignatures&&0!==e.timeSignatures.length)for(let t of e.timeSignatures)s.header.timeSignatures.push({ticks:s.header.secondsToTicks(t.time),timeSignature:[t.numerator,t.denominator]});else s.header.timeSignatures.push({ticks:0,timeSignature:[4,4]});s.header.update();var r=new Map;for(let s of e.notes){let t=s.instrument||0,e=void 0===s.program?a.DEFAULT_PROGRAM:s.program,n=!!s.isDrum,i=JSON.stringify([t,e,n]);r.has(i)||r.set(i,{notes:[],controlChanges:[]}),r.get(i).notes.push(s)}for(let s of e.controlChanges){let t=s.instrument||0,e=void 0===s.program?a.DEFAULT_PROGRAM:s.program,n=!!s.isDrum,i=JSON.stringify([t,e,n]);r.has(i)||r.set(i,{notes:[],controlChanges:[]}),r.get(i).controlChanges.push(s)}return r.forEach((n,t)=>{var[t,e]=JSON.parse(t).slice(1),i=s.addTrack();i.channel=e?a.DRUM_CHANNEL:a.NON_DRUM_CHANNELS[(s.tracks.length-1)%a.NON_DRUM_CHANNELS.length],i.instrument.number=t;for(let e of n.notes){let t=void 0===e.velocity?a.DEFAULT_VELOCITY:e.velocity;i.addNote({midi:e.pitch,time:e.startTime,duration:e.endTime-e.startTime,velocity:(t+1)/a.MIDI_VELOCITIES})}for(let t of n.controlChanges)i.addCC({number:t.controlNumber,value:t.controlValue,time:t.time})}),s.toArray()}function v(t){return new Promise((e,n)=>{Object(f.a)(t).then(t=>t.blob()).then(t=>{e(t)}).catch(t=>n(t))})}function b(t){return new Promise((e,n)=>{let i=new FileReader;i.onload=t=>{try{let t=_(i.result);e(t)}catch(t){n(t)}},i.onerror=t=>n(t),i.readAsArrayBuffer(t)})}function S(t){return v(t).then(b)}class w{constructor(t){this.FADE_SECONDS=.1,this.baseURL=t,this.buffers=new h.ToneAudioBuffers,this.sourceMap=new Map,this.initialized=!1}async initialize(){await Object(f.a)(this.baseURL+"/instrument.json").then(t=>t.json()).then(t=>{this.name=t.name,this.minPitch=t.minPitch,this.maxPitch=t.maxPitch,this.durationSeconds=t.durationSeconds,this.releaseSeconds=t.releaseSeconds,this.percussive=t.percussive,this.velocities=t.velocities,this.initialized=!0})}sampleInfoToName(t){return this.velocities?`p${t.pitch}_v`+t.velocity:"p"+t.pitch}sampleNameToURL(t){return this.baseURL+`/${t}.mp3`}nearestVelocity(n){if(!this.velocities)return n;n=n||a.DEFAULT_VELOCITY;let i=void 0,s=a.MIDI_VELOCITIES;return this.velocities.forEach(t=>{var e=Math.abs(t-n);e<s&&(i=t,s=e)}),i}async loadSamples(t){this.initialized||await this.initialize();t=t.filter(t=>!(t.pitch<this.minPitch||t.pitch>this.maxPitch)||(u.log(`Pitch ${t.pitch} is outside the valid range for ${this.name}, ignoring.`,"SoundFont"),!1)).map(t=>this.sampleInfoToName({pitch:t.pitch,velocity:this.nearestVelocity(t.velocity)})),t=Array.from(new Set(t)).filter(t=>!this.buffers.has(t)).map(t=>({name:t,url:this.sampleNameToURL(t)}));0<t.length&&(t.forEach(t=>this.buffers.add(t.name,t.url)),await h.loaded(),u.log(`Loaded samples for ${this.name}.`,"SoundFont"))}playNote(t,e,n,i,s){e=this.getBuffer(t,e);if(e){i>this.durationSeconds&&u.log(`Requested note duration longer than sample duration: ${i} > `+this.durationSeconds,"SoundFont");var r=new h.ToneBufferSource({url:e,fadeOut:this.FADE_SECONDS}).connect(s);if(r.start(n,0,void 0,1),!this.percussive&&i<this.durationSeconds){let t=new h.ToneBufferSource({url:e,fadeOut:this.FADE_SECONDS}).connect(s);r.stop(n+i+this.FADE_SECONDS),t.start(n+i,this.durationSeconds,void 0,1)}}}playNoteDown(t,e,n){var e=this.getBuffer(t,e);e&&((e=new h.ToneBufferSource(e).connect(n)).start(0,0,void 0,1),this.sourceMap.has(t)&&this.sourceMap.get(t).stop(h.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.set(t,e))}playNoteUp(t,e,n){this.sourceMap.has(t)&&(e=this.getBuffer(t,e))&&(new h.ToneBufferSource({url:e,fadeOut:this.FADE_SECONDS}).connect(n).start(0,this.durationSeconds,void 0,1),this.sourceMap.get(t).stop(h.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.delete(t))}getBuffer(t,e){if(!this.initialized)throw new Error("Instrument is not initialized.");if(!(t<this.minPitch||t>this.maxPitch)){e=this.sampleInfoToName({pitch:t,velocity:this.nearestVelocity(e)});if(!this.buffers.has(e))throw new Error(`Buffer not found for ${this.name}: `+e);var n=this.buffers.get(e);if(n.loaded)return n;throw new Error(`Buffer not loaded for ${this.name}: `+e)}u.log(`Pitch ${t} is outside the valid range for ${this.name} (${this.minPitch}-${this.maxPitch})`,"SoundFont")}}class x{constructor(t){this.baseURL=t,this.instruments=new Map,this.initialized=!1}async initialize(){await Object(f.a)(this.baseURL+"/soundfont.json").then(t=>t.json()).then(t=>{for(var e in this.name=t.name,t.instruments){var n=this.baseURL+"/"+t.instruments[e];this.instruments.set("drums"===e?"drums":+e,new w(n))}this.initialized=!0})}async loadSamples(t){this.initialized||await this.initialize();let i=new Map;t.forEach(t=>{t.isDrum=t.isDrum||!1,t.program=t.program||0;var e=t.isDrum?"drums":t.program,n={pitch:t.pitch,velocity:t.velocity};i.has(e)?i.get(e).push(n):this.instruments.has(e)?i.set(e,[n]):u.log(`No instrument in ${this.name} for: program=${t.program}, isDrum=`+t.isDrum,"SoundFont")}),await Promise.all(Array.from(i.keys()).map(t=>this.instruments.get(t).loadSamples(i.get(t))))}playNote(t,e,n,i,s=0,r=!1,o){var a=r?"drums":s;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(a)?this.instruments.get(a).playNote(t,e,n,i,o):u.log(`No instrument in ${this.name} for: program=${s}, isDrum=`+r,"SoundFont")}playNoteDown(t,e,n=0,i=!1,s){var r=i?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(r)?this.instruments.get(r).playNoteDown(t,e,s):u.log(`No instrument in ${this.name} for: program=${n}, isDrum=`+i,"SoundFont")}playNoteUp(t,e,n=0,i=!1,s){var r=i?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(r)?this.instruments.get(r).playNoteUp(t,e,s):u.log(`No instrument in ${this.name} for: program=${n}, isDrum=`+i,"SoundFont")}}function T(t,e){return t.quantizedStartStep<e.quantizedStartStep||!(t.quantizedStartStep>e.quantizedStartStep)&&t.pitch<e.pitch?-1:1}class A{}class k{constructor(t=!1,e){this.playClick=t,this.callbackObject=e,this.desiredQPM=void 0}setTempo(t){this.desiredQPM=t,"started"===h.Transport.state&&(h.Transport.bpm.value=t)}makeClickSequence(t){let n=c.clone(t),e=n.notes.map(t=>t.quantizedEndStep),i=Math.max(...e);for(let e=0;e<i;e+=4){let t={pitch:e%16==0?a.LO_CLICK_PITCH:a.HI_CLICK_PITCH,quantizedStartStep:e,isDrum:!0,quantizedEndStep:e+1};n.notes.push(t)}return n.notes.sort(T),n}resumeContext(){h.context.resume()}start(e,t,n=0){if("started"===this.getPlayState())throw new Error("Cannot start playback; player is already playing.");if("paused"===this.getPlayState())throw new Error("Cannot `start()` a paused player; use `resume()`.");if("stopped"!==h.Transport.state)throw new Error("Cannot start playback while `Tone.Transport` is in use.");this.resumeContext();var i=c.isQuantizedSequence(e);if(this.playClick&&i&&(e=this.makeClickSequence(e)),t?h.Transport.bpm.value=t:e.tempos&&0<e.tempos.length&&0<e.tempos[0].qpm?h.Transport.bpm.value=e.tempos[0].qpm:h.Transport.bpm.value=a.DEFAULT_QUARTERS_PER_MINUTE,i)e=c.unquantizeSequence(e,t);else if(t)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");let s=new h.Part((t,e)=>{this.currentPart===s&&(this.playNote(t,e),this.callbackObject)&&h.Draw.schedule(()=>{this.callbackObject.run(e,t)},t)},e.notes.map(t=>[t.startTime,t]));return this.currentPart=s,this.desiredQPM&&(h.Transport.bpm.value=this.desiredQPM),this.currentPart.start(void 0,n),"started"!==h.Transport.state&&h.Transport.start(),new Promise(t=>{this.scheduledStop=h.Transport.schedule(()=>{this.stop(),t(),this.callbackObject&&this.callbackObject.stop()},"+"+e.totalTime)})}stop(){this.isPlaying()&&(this.currentPart.stop(),h.Transport.stop(),this.currentPart=null),h.Transport.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0}pause(){if(!this.isPlaying())throw new Error("Cannot pause playback while the player is stopped.");h.Transport.pause()}resume(){if("paused"!==this.getPlayState())throw new Error(`Cannot resume playback while "${this.getPlayState()}".`);h.Transport.start()}seekTo(t){if(!this.isPlaying())throw new Error("Cannot seek while the player is stopped.");h.Transport.seconds=t}isPlaying(){return!!this.currentPart}getPlayState(){return this.isPlaying()?h.Transport.state:"stopped"}}class O{constructor(){this.DRUM_PITCH_TO_CLASS=new Map,this.kick=(new h.MembraneSynth).toDestination(),this.tomLow=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomMid=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomHigh=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.closedHihat=new h.MetalSynth({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.openHihat=new h.MetalSynth({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.ride=(new h.MetalSynth).toDestination(),this.crash=new h.MetalSynth({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toDestination(),this.snare=new h.NoiseSynth({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toDestination(),this.loClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.pitchPlayers=[(t,e=1)=>this.kick.triggerAttackRelease("C2","8n",t,e),(t,e=1)=>this.snare.triggerAttackRelease("16n",t,e),(t,e=1)=>this.closedHihat.triggerAttack(t,.3,e),(t,e=1)=>this.openHihat.triggerAttack(t,.3,e),(t,e=.5)=>this.tomLow.triggerAttack("G3",t,e),(t,e=.5)=>this.tomMid.triggerAttack("C4",t,e),(t,e=.5)=>this.tomHigh.triggerAttack("F4",t,e),(t,e=1)=>this.crash.triggerAttack(t,1,e),(t,e=1)=>this.ride.triggerAttack(t,.5,e),(t,e=.5)=>this.loClick.triggerAttack("G5",t,e),(t,e=.5)=>this.hiClick.triggerAttack("C6",t,e)];for(let e=0;e<a.DEFAULT_DRUM_PITCH_CLASSES.length;++e)a.DEFAULT_DRUM_PITCH_CLASSES[e].forEach(t=>{this.DRUM_PITCH_TO_CLASS.set(t,e)});this.DRUM_PITCH_TO_CLASS.set(a.LO_CLICK_PITCH,a.LO_CLICK_CLASS),this.DRUM_PITCH_TO_CLASS.set(a.HI_CLICK_PITCH,a.HI_CLICK_CLASS)}static getInstance(){return O.instance||(O.instance=new O),O.instance}playNote(t,e,n){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(t)](e,n)}}class P extends k{constructor(){super(...arguments),this.drumKit=O.getInstance(),this.bassSynth=new h.Synth({volume:5,oscillator:{type:"triangle"}}).toDestination(),this.polySynth=(new h.PolySynth).toDestination()}playNote(t,e){var n,i,s=e.hasOwnProperty("velocity")?e.velocity/a.MAX_MIDI_VELOCITY:void 0;e.isDrum?this.drumKit.playNote(e.pitch,t,s):(n=h.Frequency(e.pitch,"midi").toFrequency(),i=e.endTime-e.startTime,this.getSynth(e.instrument,e.program).triggerAttackRelease(n,i,t,s))}getSynth(t,e){return void 0!==e&&32<=e&&e<=39?this.bassSynth:this.polySynth}}P.tone=h;class M extends k{constructor(t,e=h.Master,n,i,s){super(!1,s),this.soundFont=new x(t),this.output=e,this.programOutputs=n,this.drumOutputs=i}async loadSamples(t){await this.soundFont.loadSamples(t.notes.map(t=>({pitch:t.pitch,velocity:t.velocity,program:t.program||0,isDrum:t.isDrum||!1})))}async loadAllSamples(n=0,i=!1){var s=m.a.create(),t=i?a.MIN_DRUM_PITCH:a.MIN_PIANO_PITCH,r=i?a.MAX_DRUM_PITCH:a.MAX_PIANO_PITCH;for(let e=t;e<=r;e++)for(let t=a.MIN_MIDI_VELOCITY;t<a.MAX_MIDI_VELOCITY;t++)s.notes.push({pitch:e,velocity:t,program:n,isDrum:i});return this.loadSamples(s)}resumeContext(){h.context.resume()}start(t,e,n=0){return this.resumeContext(),this.loadSamples(t).then(()=>super.start(t,e,n))}playNote(t,e){this.soundFont.playNote(e.pitch,e.velocity,t,e.endTime-e.startTime,e.program,e.isDrum,this.getAudioNodeOutput(e))}playNoteDown(t){this.soundFont.playNoteDown(t.pitch,t.velocity,t.program,t.isDrum,this.getAudioNodeOutput(t))}playNoteUp(t){this.soundFont.playNoteUp(t.pitch,t.velocity,t.program,t.isDrum,this.getAudioNodeOutput(t))}getAudioNodeOutput(t){let e=this.output;return this.programOutputs&&!t.isDrum?this.programOutputs.has(t.program)&&(e=this.programOutputs.get(t.program)):this.drumOutputs&&t.isDrum&&this.drumOutputs.has(t.pitch)&&(e=this.drumOutputs.get(t.pitch)),e}}class C extends P{constructor(t){super(!0,t)}}class N extends k{constructor(t){super(!1,t),this.outputs=[],this.outputChannel=0,this.availableOutputs=[],this.NOTE_ON=144,this.NOTE_OFF=128}async requestMIDIAccess(){return navigator.requestMIDIAccess?new Promise((t,e)=>{navigator.requestMIDIAccess().then(e=>{e.addEventListener("statechange",t=>this.initOutputs(e)),t(this.initOutputs(e))},t=>console.log("Something went wrong",e(t)))}):null}initOutputs(t){var e=t.outputs.values();for(let t=e.next();t&&!t.done;t=e.next())this.availableOutputs.push(t.value);return this.availableOutputs}playNote(t,e){var n=e.velocity||100,i=1e3*(e.endTime-e.startTime),s=[this.NOTE_ON+this.outputChannel,e.pitch,n],r=[this.NOTE_OFF+this.outputChannel,e.pitch,n],o=this.outputs||this.availableOutputs;for(let t=0;t<o.length;t++)this.sendMessageToOutput(o[t],s),this.sendMessageToOutput(o[t],r,f.d.now()+i)}sendMessageToOutput(t,e,n){t&&t.send(e,n)}playNoteDown(t){var e=[this.NOTE_ON,t.pitch,t.velocity],n=this.outputs||this.availableOutputs;for(let t=0;t<n.length;t++)this.sendMessageToOutput(n[t],e)}playNoteUp(e){var n=[this.NOTE_OFF,e.pitch,e.velocity],i=this.outputs||this.availableOutputs;for(let t=0;t<i.length;t++)this.sendMessageToOutput(i[t],n,e.endTime-e.startTime)}}class z{}class F{constructor(t={},e){this.notes=[],this.midiInputs=[],this.loClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.config={playClick:t.playClick,qpm:t.qpm||a.DEFAULT_QUARTERS_PER_MINUTE,playCountIn:t.playCountIn,startRecordingAtFirstNote:t.startRecordingAtFirstNote||!1},this.callbackObject=e,this.recording=!1,this.onNotes=new Map}async initialize(){await navigator.requestMIDIAccess().then(t=>this.midiReady(t),t=>console.log("Something went wrong",t))}midiReady(t){u.log("Initialized Recorder","Recorder");var e=t.inputs.values();for(let t=e.next();t&&!t.done;t=e.next())this.midiInputs.push(t.value)}isRecording(){return this.recording}setTempo(t){this.config.qpm=t,"started"===h.Transport.state&&(h.Transport.bpm.value=t)}enablePlayClick(t){this.config.playClick=t}enablePlayCountIn(t){this.config.playCountIn=t}initClickLoop(){let e=0;this.clickLoop=new h.Loop(t=>{e%4==0?this.loClick.triggerAttack("G5",t):this.hiClick.triggerAttack("C6",t),e++,this.config.playCountIn&&4===e&&(h.Transport.stop(),this.clickLoop.stop())},"4n")}getMIDIInputs(){return this.midiInputs}start(t){var e=t||this.midiInputs;for(let t of e)t.onmidimessage=t=>{this.midiMessageReceived(t)};if(this.config.playClick||this.config.playCountIn?(this.initClickLoop(),h.Transport.bpm.value=this.config.qpm,h.Transport.start(),this.clickLoop.start()):this.clickLoop=null,this.recording=!0,this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,!this.startRecordingAtFirstNote){let t=Date.now();this.firstNoteTimestamp=t}}stop(){this.recording=!1;let n=Date.now();this.onNotes.forEach((t,e)=>{this.noteOff(e,n)});for(let t of this.midiInputs)t.onmidimessage=null;return this.clickLoop&&(h.Transport.stop(),this.clickLoop.stop()),0===this.notes.length?null:this.getNoteSequence()}getNoteSequence(){return 0===this.notes.length?null:m.a.create({notes:this.notes,totalTime:this.notes[this.notes.length-1].endTime})}reset(){var t=this.stop();return this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,t}midiMessageReceived(t){var e,n,i,s;this.recording&&(e=(void 0!==t.timeStamp&&0!==t.timeStamp?t.timeStamp:f.d.now())+f.d.timing.navigationStart,void 0===this.firstNoteTimestamp&&(this.firstNoteTimestamp=e),n=t.data[0]>>4,i=t.data[1],s=2<t.data.length?t.data[2]:1,t=t.srcElement,8==n||9==n&&0===s?(this.callbackObject&&this.callbackObject.noteOff&&this.callbackObject.noteOff(i,s,t),this.noteOff(i,e),this.callbackObject&&this.callbackObject.run&&this.callbackObject.run(this.getNoteSequence())):9==n&&(this.callbackObject&&this.callbackObject.noteOn&&this.callbackObject.noteOn(i,s,t),this.noteOn(i,s,e)))}noteOn(t,e,n){var i=new m.a.Note;i.pitch=t,i.startTime=(n-this.firstNoteTimestamp)/1e3,i.velocity=e,this.onNotes.set(t,i)}noteOff(t,e){var n=this.onNotes.get(t);n&&(n.endTime=(e-this.firstNoteTimestamp)/1e3,this.notes.push(n)),this.onNotes.delete(t)}}var I,j=e(83);class E{constructor(t,e={}){var n=c.isQuantizedSequence(t),i=t.tempos&&0<t.tempos.length?t.tempos[0].qpm:void 0,n=(this.noteSequence=n?c.unquantizeSequence(t,i):t,this.config={noteHeight:e.noteHeight||6,noteSpacing:e.noteSpacing||1,pixelsPerTimeStep:e.pixelsPerTimeStep||30,noteRGB:e.noteRGB||"8, 41, 64",activeNoteRGB:e.activeNoteRGB||"240, 84, 119",minPitch:e.minPitch,maxPitch:e.maxPitch},this.getSize());this.width=n.width,this.height=n.height}updateMinMaxPitches(t=!1){if(!this.config.minPitch||!this.config.maxPitch){void 0===this.config.minPitch&&(this.config.minPitch=a.MAX_MIDI_PITCH),void 0===this.config.maxPitch&&(this.config.maxPitch=a.MIN_MIDI_PITCH);for(let t of this.noteSequence.notes)this.config.minPitch=Math.min(t.pitch,this.config.minPitch),this.config.maxPitch=Math.max(t.pitch,this.config.maxPitch);t||(this.config.minPitch-=2,this.config.maxPitch+=2)}}getSize(){this.updateMinMaxPitches();var t=(this.config.maxPitch-this.config.minPitch)*this.config.noteHeight,e=this.noteSequence.totalTime;if(e)return{width:e*this.config.pixelsPerTimeStep,height:t};throw new Error("The sequence you are using with the visualizer does not have a totalQuantizedSteps or totalTime field set, so the visualizer can't be horizontally sized correctly.")}getNotePosition(t,e){var n=this.getNoteEndTime(t)-this.getNoteStartTime(t),i=this.getNoteStartTime(t)*this.config.pixelsPerTimeStep,n=Math.max(this.config.pixelsPerTimeStep*n-this.config.noteSpacing,1);return{x:i,y:this.height-(t.pitch-this.config.minPitch)*this.config.noteHeight,w:n,h:this.config.noteHeight}}scrollIntoViewIfNeeded(t,e){if(t&&this.parentElement){let t=this.parentElement.getBoundingClientRect().width;e>this.parentElement.scrollLeft+t&&(this.parentElement.scrollLeft=e-20)}}getNoteStartTime(t){return Math.round(1e8*t.startTime)/1e8}getNoteEndTime(t){return Math.round(1e8*t.endTime)/1e8}isPaintingActiveNote(t,e){var n=this.getNoteStartTime(t)===this.getNoteStartTime(e),t=this.getNoteStartTime(t)<=this.getNoteStartTime(e)&&this.getNoteEndTime(t)>=this.getNoteEndTime(e);return n||t}}class q extends E{constructor(t,e,n={}){super(t,n),this.ctx=e.getContext("2d"),this.parentElement=e.parentElement;t=window.devicePixelRatio||1;this.ctx&&(this.ctx.canvas.width=t*this.width,this.ctx.canvas.height=t*this.height,e.style.width=this.width+"px",e.style.height=this.height+"px",this.ctx.scale(t,t)),this.redraw()}redraw(e,t){let n;this.clear();for(let t=0;t<this.noteSequence.notes.length;t++){var i=this.noteSequence.notes[t],s=this.getNotePosition(i,t),r=i.velocity?i.velocity/100+.2:1,o=e&&this.isPaintingActiveNote(i,e),r=`rgba(${o?this.config.activeNoteRGB:this.config.noteRGB},
  ${r})`;this.redrawNote(s.x,s.y,s.w,s.h,r),o&&i===e&&(n=s.x)}return this.scrollIntoViewIfNeeded(t,n),n}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}clearActiveNotes(){this.redraw()}redrawNote(t,e,n,i,s){this.ctx.fillStyle=s,this.ctx.fillRect(Math.round(t),Math.round(e),Math.round(n),Math.round(i))}}class V extends q{constructor(t,e,n={}){super(t,e,n),u.log("mm.Visualizer is deprecated, and will be removed in a future          version. Please use mm.PianoRollCanvasVisualizer instead","mm.Visualizer",5)}}class D extends E{constructor(t,e={}){super(t,e),this.drawn=!1}redraw(e,t){if(this.drawn||this.draw(),!e)return null;let n;this.unfillActiveRect(this.svg);for(let t=0;t<this.noteSequence.notes.length;t++){var i,s=this.noteSequence.notes[t];e&&this.isPaintingActiveNote(s,e)&&(i=this.svg.querySelector(`rect[data-index="${t}"]`),this.fillActiveRect(i,s),s===e)&&(n=parseFloat(i.getAttribute("x")))}return this.scrollIntoViewIfNeeded(t,n),n}fillActiveRect(t,e){t.setAttribute("fill",this.getNoteFillColor(e,!0)),t.classList.add("active")}unfillActiveRect(t){var e=t.querySelectorAll("rect.active");for(let t=0;t<e.length;++t){var n=e[t],i=this.getNoteFillColor(this.noteSequence.notes[parseInt(n.getAttribute("data-index"),10)],!1);n.setAttribute("fill",i),n.classList.remove("active")}}draw(){for(let t=0;t<this.noteSequence.notes.length;t++){var e=this.noteSequence.notes[t],n=this.getNotePosition(e,t),i=this.getNoteFillColor(e,!1),s=[["index",t],["instrument",e.instrument],["program",e.program],["isDrum",!0===e.isDrum],["pitch",e.pitch]],e=[["--midi-velocity",String(void 0!==e.velocity?e.velocity:127)]];this.drawNote(n.x,n.y,n.w,n.h,i,s,e)}this.drawn=!0}getNoteFillColor(t,e){t=t.velocity?t.velocity/100+.2:1;return`rgba(${e?this.config.activeNoteRGB:this.config.noteRGB},
  ${t})`}drawNote(t,e,i,s,r,o,a){if(this.svg){let n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.classList.add("note"),n.setAttribute("fill",r),n.setAttribute("x",""+Math.round(t)),n.setAttribute("y",""+Math.round(e)),n.setAttribute("width",""+Math.round(i)),n.setAttribute("height",""+Math.round(s)),o.forEach(([t,e])=>{void 0!==e&&(n.dataset[t]=""+e)}),a.forEach(([t,e])=>{n.style.setProperty(t,e)}),this.svg.appendChild(n)}}clear(){this.svg.innerHTML="",this.drawn=!1}clearActiveNotes(){this.unfillActiveRect(this.svg)}}class L extends D{constructor(t,e,n={}){if(super(t,n),!(e instanceof SVGSVGElement))throw new Error("This visualizer requires an <svg> element to display the visualization");this.svg=e,this.parentElement=e.parentElement;t=this.getSize();this.width=t.width,this.height=t.height,this.svg.style.width=this.width+"px",this.svg.style.height=this.height+"px",this.clear(),this.draw()}}class B extends D{constructor(t,e,n={}){if(super(t,n),this.NOTES_PER_OCTAVE=12,this.WHITE_NOTES_PER_OCTAVE=7,this.LOW_C=24,this.firstDrawnOctave=0,this.lastDrawnOctave=6,!(e instanceof HTMLDivElement))throw new Error("This visualizer requires a <div> element to display the visualization");this.config.whiteNoteWidth=n.whiteNoteWidth||20,this.config.blackNoteWidth=n.blackNoteWidth||2*this.config.whiteNoteWidth/3,this.config.whiteNoteHeight=n.whiteNoteHeight||70,this.config.blackNoteHeight=n.blackNoteHeight||140/3,this.config.showOnlyOctavesUsed=n.showOnlyOctavesUsed,this.setupDOM(e);t=this.getSize();this.width=t.width,this.height=t.height,this.svg.style.width=this.width+"px",this.svg.style.height=this.height+"px",this.svgPiano.style.width=this.width+"px",this.svgPiano.style.height=this.config.whiteNoteHeight+"px",this.parentElement.style.width=this.width+this.config.whiteNoteWidth+"px",this.parentElement.scrollTop=this.parentElement.scrollHeight,this.clear(),this.drawPiano(),this.draw()}setupDOM(t){this.parentElement=document.createElement("div"),this.parentElement.classList.add("waterfall-notes-container");var e=Math.max(t.getBoundingClientRect().height,720);this.parentElement.style.paddingTop=e-this.config.whiteNoteHeight+"px",this.parentElement.style.height=e-this.config.whiteNoteHeight+"px",this.parentElement.style.boxSizing="border-box",this.parentElement.style.overflowX="hidden",this.parentElement.style.overflowY="auto",this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgPiano=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.classList.add("waterfall-notes"),this.svgPiano.classList.add("waterfall-piano"),this.parentElement.appendChild(this.svg),t.innerHTML="",t.appendChild(this.parentElement),t.appendChild(this.svgPiano)}redraw(e,t){if(this.drawn||this.draw(),e){this.clearActiveNotes(),this.parentElement.style.paddingTop=this.parentElement.style.height;for(let t=0;t<this.noteSequence.notes.length;t++){var n=this.noteSequence.notes[t];if(e&&this.isPaintingActiveNote(n,e)){var i=this.svg.querySelector(`rect[data-index="${t}"]`),s=(this.fillActiveRect(i,n),this.svgPiano.querySelector(`rect[data-pitch="${n.pitch}"]`));if(this.fillActiveRect(s,n),n===e){let t=parseFloat(i.getAttribute("y")),e=parseFloat(i.getAttribute("height"));return t<this.parentElement.scrollTop-e&&(this.parentElement.scrollTop=t+e),t}}}}return null}getSize(){this.updateMinMaxPitches(!0);let t=52;if(this.config.showOnlyOctavesUsed){let e=!1,n=!1;for(let t=1;t<7;t++){var i=this.LOW_C+this.NOTES_PER_OCTAVE*t;!e&&i>this.config.minPitch&&(this.firstDrawnOctave=t-1,e=!0),!n&&i>this.config.maxPitch&&(this.lastDrawnOctave=t-1,n=!0)}t=(this.lastDrawnOctave-this.firstDrawnOctave+1)*this.WHITE_NOTES_PER_OCTAVE}var e=t*this.config.whiteNoteWidth,n=this.noteSequence.totalTime;if(n)return{width:e,height:Math.max(n*this.config.pixelsPerTimeStep,1)};throw new Error("The sequence you are using with the visualizer does not have a totalQuantizedSteps or totalTime field set, so the visualizer can't be horizontally sized correctly.")}getNotePosition(t,e){var n,i,s=this.svgPiano.querySelector(`rect[data-pitch="${t.pitch}"]`);return s?(i=this.getNoteEndTime(t)-this.getNoteStartTime(t),n=Number(s.getAttribute("x")),s=Number(s.getAttribute("width")),i=Math.max(this.config.pixelsPerTimeStep*i-this.config.noteSpacing,1),{x:n,y:this.height-this.getNoteStartTime(t)*this.config.pixelsPerTimeStep-i,w:s,h:i}):null}drawPiano(){this.svgPiano.innerHTML="";var e=this.config.whiteNoteWidth-this.config.blackNoteWidth/2,n=[1,3,6,8,10];let i=0,s=0;this.config.showOnlyOctavesUsed?s=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C:(s=this.LOW_C-3,this.drawWhiteKey(s,i),this.drawWhiteKey(s+2,this.config.whiteNoteWidth),s+=3,i=2*this.config.whiteNoteWidth);for(let t=this.firstDrawnOctave;t<=this.lastDrawnOctave;t++)for(let t=0;t<this.NOTES_PER_OCTAVE;t++)-1===n.indexOf(t)&&(this.drawWhiteKey(s,i),i+=this.config.whiteNoteWidth),s++;i=this.config.showOnlyOctavesUsed?(s=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C,-this.config.whiteNoteWidth):(this.drawWhiteKey(s,i),s=this.LOW_C-3,this.drawBlackKey(s+1,e),s+=3,this.config.whiteNoteWidth);for(let t=this.firstDrawnOctave;t<=this.lastDrawnOctave;t++)for(let t=0;t<this.NOTES_PER_OCTAVE;t++)-1!==n.indexOf(t)?this.drawBlackKey(s,i+e):i+=this.config.whiteNoteWidth,s++}drawWhiteKey(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.dataset.pitch=String(t),n.setAttribute("x",String(e)),n.setAttribute("y","0"),n.setAttribute("width",String(this.config.whiteNoteWidth)),n.setAttribute("height",String(this.config.whiteNoteHeight)),n.setAttribute("fill","white"),n.setAttribute("original-fill","white"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","3px"),n.classList.add("white"),this.svgPiano.appendChild(n),n}drawBlackKey(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.dataset.pitch=String(t),n.setAttribute("x",String(e)),n.setAttribute("y","0"),n.setAttribute("width",String(this.config.blackNoteWidth)),n.setAttribute("height",String(this.config.blackNoteHeight)),n.setAttribute("fill","black"),n.setAttribute("original-fill","black"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","3px"),n.classList.add("black"),this.svgPiano.appendChild(n),n}clearActiveNotes(){super.unfillActiveRect(this.svg);var e=this.svgPiano.querySelectorAll("rect.active");for(let t=0;t<e.length;++t){var n=e[t];n.setAttribute("fill",n.getAttribute("original-fill")),n.classList.remove("active")}}}(t=I=I||{})[t.PAGE=0]="PAGE",t[t.NOTE=1]="NOTE",t[t.BAR=2]="BAR";class U extends E{constructor(t,e,n={}){super(t,n),(void 0===n.pixelsPerTimeStep||n.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0),this.instruments=n.instruments||[],this.render=new j.StaffSVGRender(this.getScoreInfo(t),{noteHeight:this.config.noteHeight,noteSpacing:this.config.noteSpacing,pixelsPerTimeStep:this.config.pixelsPerTimeStep,noteRGB:this.config.noteRGB,activeNoteRGB:this.config.activeNoteRGB,defaultKey:n.defaultKey||0,scrollType:n.scrollType||I.PAGE},e),this.drawnNotes=t.notes.length,this.clear(),this.redraw()}clear(){this.render.clear()}redraw(t,e){this.drawnNotes!==this.noteSequence.notes.length&&(this.render.scoreInfo=this.getScoreInfo(this.noteSequence));t=t?this.getNoteInfo(t):void 0;return this.render.redraw(t,e)}isNoteInInstruments(t){return void 0===t.instrument||0===this.instruments.length||0<=this.instruments.indexOf(t.instrument)}timeToQuarters(t){t=t*this.noteSequence.tempos[0].qpm/60;return Math.round(16*t)/16}getNoteInfo(t){var e=this.timeToQuarters(t.startTime);return{start:e,length:this.timeToQuarters(t.endTime)-e,pitch:t.pitch,intensity:t.velocity}}getScoreInfo(t){let e=[];return t.notes.forEach(t=>{this.isNoteInInstruments(t)&&e.push(this.getNoteInfo(t))}),{notes:e,tempos:t.tempos?t.tempos.map(t=>({start:this.timeToQuarters(t.time),qpm:t.qpm})):[],keySignatures:t.keySignatures?t.keySignatures.map(t=>({start:this.timeToQuarters(t.time),key:t.key})):[],timeSignatures:t.timeSignatures?t.timeSignatures.map(t=>({start:this.timeToQuarters(t.time),numerator:t.numerator,denominator:t.denominator})):[]}}clearActiveNotes(){this.redraw()}}},,,,,,function(t,e,n){e.parseMidi=n(172),e.writeMidi=n(173)},function(t,e,n){function i(t,e,n){void 0===n&&(n="ticks");var i=0,s=t.length,r=s;if(0<s&&t[s-1][n]<=e)return s-1;for(;i<r;){var o=Math.floor(i+(r-i)/2),a=t[o],u=t[o+1];if(a[n]===e){for(var c=o;c<t.length;c++)t[c][n]===e&&(o=c);return o}if(a[n]<e&&u[n]>e)return o;e<a[n]?r=o:a[n]<e&&(i=o+1)}return-1}Object.defineProperty(e,"__esModule",{value:!0}),e.search=i,e.insert=function(t,e,n){void 0===n&&(n="ticks"),t.length?(n=i(t,e[n],n),t.splice(n+1,0,e)):t.push(e)}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(80),s=n(82),o=n(176),r=n(177),a=n(178),u=n(180),c=new WeakMap;function h(t,e){var n=this;if(this.name="",this.notes=[],this.controlChanges=o.createControlChanges(),this.pitchBends=[],c.set(this,e),t&&(e=t.find(function(t){return"trackName"===t.type}),this.name=e?e.text:""),this.instrument=new a.Instrument(t,this),this.channel=0,t){for(var i=t.filter(function(t){return"noteOn"===t.type}),s=t.filter(function(t){return"noteOff"===t.type}),r=this;i.length;)(()=>{var e=i.shift(),t=(r.channel=e.channel,s.findIndex(function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime}));-1!==t&&(t=s.splice(t,1)[0],r.addNote({durationTicks:t.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:t.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127}))})();t.filter(function(t){return"controller"===t.type}).forEach(function(t){n.addCC({number:t.controllerType,ticks:t.absoluteTime,value:t.value/127})}),t.filter(function(t){return"pitchBend"===t.type}).forEach(function(t){n.addPitchBend({ticks:t.absoluteTime,value:t.value/Math.pow(2,13)})})}}h.prototype.addNote=function(t){var e=c.get(this),e=new u.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},e);return Object.assign(e,t),i.insert(this.notes,e,"ticks"),this},h.prototype.addCC=function(t){var e=c.get(this),e=new s.ControlChange({controllerType:t.number},e);return delete t.number,Object.assign(e,t),Array.isArray(this.controlChanges[e.number])||(this.controlChanges[e.number]=[]),i.insert(this.controlChanges[e.number],e,"ticks"),this},h.prototype.addPitchBend=function(t){var e=c.get(this),e=new r.PitchBend({},e);return Object.assign(e,t),i.insert(this.pitchBends,e,"ticks"),this},Object.defineProperty(h.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,e=0;e<this.notes.length-1;e++){var n=this.notes[e].time+this.notes[e].duration;t<n&&(t=n)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,e=0;e<this.notes.length-1;e++){var n=this.notes[e].ticks+this.notes[e].durationTicks;t<n&&(t=n)}return t},enumerable:!0,configurable:!0}),h.prototype.fromJSON=function(t){var e,n=this;for(e in this.name=t.name,this.channel=t.channel,this.instrument=new a.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),t.controlChanges)t.controlChanges[e]&&t.controlChanges[e].forEach(function(t){n.addCC({number:t.number,ticks:t.ticks,value:t.value})});t.notes.forEach(function(t){n.addNote({durationTicks:t.durationTicks,midi:t.midi,ticks:t.ticks,velocity:t.velocity})})},h.prototype.toJSON=function(){for(var t={},e=0;e<127;e++)this.controlChanges.hasOwnProperty(e)&&(t[e]=this.controlChanges[e].map(function(t){return t.toJSON()}));return{channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map(function(t){return t.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(t){return t.toJSON()})}},e.Track=h},function(t,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},n.controlChangeIds=Object.keys(n.controlChangeNames).reduce(function(t,e){return t[n.controlChangeNames[e]]=e,t},{});var i=new WeakMap,s=new WeakMap;function r(t,e){i.set(this,e),s.set(this,t.controllerType),this.ticks=t.absoluteTime,this.value=t.value}Object.defineProperty(r.prototype,"number",{get:function(){return s.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return n.controlChangeNames[this.number]||null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"time",{get:function(){return i.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=i.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},n.ControlChange=r},function(t,e,n){function s(t){var e;return(r[t]||(e=r[t]={i:t,l:!1,exports:{}},i[t].call(e.exports,e,e.exports,s),e.l=!0,e)).exports}var i,r;self,t.exports=(i=[function(t,e,n){n.r(e),n.d(e,"SVGNS",function(){return c}),n.d(e,"drawSVGPath",function(){return i}),n.d(e,"drawSVGText",function(){return s}),n.d(e,"createSVGGroupChild",function(){return r}),n.d(e,"setFade",function(){return o});let c="http://www.w3.org/2000/svg";function i(t,e,n,i,s,r,o=1){var a=document.createElementNS(c,"path");return a.setAttributeNS(null,"d",e),a.setAttributeNS(null,"transform",`translate(${n}, ${i}) scale(${s}, ${r})`),a.setAttributeNS(null,"opacity",""+o),t.appendChild(a),a}function s(t,e,n,i,s,r=!1,o=1,a=1){var u=document.createElementNS(c,"text"),s=(u.setAttributeNS(null,"font-family","Times"),u.setAttributeNS(null,"font-size",s),r&&u.setAttributeNS(null,"font-weight","bold"),u.setAttributeNS(null,"transform",`translate(${n}, ${i}) scale(${o}, ${a})`),document.createTextNode(e));return u.appendChild(s),t.appendChild(u),u}function r(t,e){var n=document.createElementNS(c,"g");return n.setAttribute("data-id",e),t.appendChild(n),n}function o(t,e=!1,n=1,i=0){let s=t.querySelector("animate");if(!s){(s=document.createElementNS(c,"animate")).setAttributeNS(null,"attributeName","opacity"),s.setAttributeNS(null,"dur","4s"),s.setAttributeNS(null,"fill","freeze"),s.setAttributeNS(null,"keyTimes","0; 0.25; 0.5; 0.75; 1");let t=(n+3*i)/4;s.setAttributeNS(null,"values",`${n}; ${t}; ${i}; ${t}; `+n)}return e?s.setAttributeNS(null,"repeatCount","indefinite"):s.setAttributeNS(null,"repeatCount","1"),t.appendChild(s),t}},function(t,e,n){n.r(e),n.d(e,"PATH_SCALE",function(){return i}),n.d(e,"staffLinePath",function(){return r}),n.d(e,"extraLinePath",function(){return o}),n.d(e,"barPath",function(){return a}),n.d(e,"stemPath",function(){return u}),n.d(e,"singleFlagPath",function(){return c}),n.d(e,"multiFlagPath",function(){return h}),n.d(e,"tiePath",function(){return l}),n.d(e,"dotPath",function(){return p}),n.d(e,"NOTE_PATHS",function(){return d}),n.d(e,"REST_PATHS",function(){return f}),n.d(e,"CLEF_PATHS",function(){return m}),n.d(e,"ACCIDENTAL_PATHS",function(){return g});let i=100,s="M 0,10 C 0,-15 35,-50 80,-50 110,-50 125,-35 125,-10 \n125,15 90,50 45,50 15,50 0,35 0,10 Z",r="m 0,0 h 100",o="m -25,0 h 175",a="m 0,-200 v 400",u="m 0,0 v 100 h 15 v -100 z",c="M0,0 h 12 c 7,100 175,156 62,314 79,-177 -49,\n-193 -61,-200 l -13,-5 z",h="m 0,0 h 10 c 6,72 173,64 84,227 44,-120 -44,\n-123 -94,-167 z",l="M 0,25 C 10,46 30,67 50,67 69,67 90,47 100,25 94,\n65 73,89 50,89 26,89 5,63 0,25 Z",p="M 5 -20 a 20 20 0 1 0 0.00001 0 z",d={4:{path:"m 0,0 c 0,-37 49,-51 79,-51 31,0 83,13 83,51 0,39 \n-55,51 -84,51 C 49,51 0,37 0,0 Z m 111,31 c 13,-19 0,-58 -22,-68 -33,-15 \n-53,10 -39,49 9,27 48,39 61,19 z",width:150,stemVSteps:0,stemAnchor:0,flags:0},2:{path:"m 0,10 c 0,-25 35,-60 80,-60 15,0 45,4 45,40 C 125,16 \n89,50 45,50 17,50 0,36 0,10 Z m 71,7 c 17,-11 45,-34 38,-45 -7,-10 -39,1 \n-57,12 -19,11 -42,31 -36,42 6,10 37,2 55,-9 z",width:125,stemVSteps:7,stemAnchor:-10,flags:0},1:{path:s,width:125,stemVSteps:7,stemAnchor:-10,flags:0},.5:{path:s,width:125,stemVSteps:7,stemAnchor:-10,flags:1},.25:{path:s,width:125,stemVSteps:9,stemAnchor:-10,flags:2},.125:{path:s,width:125,stemVSteps:11,stemAnchor:-10,flags:3},.0625:{path:s,width:125,stemVSteps:13,stemAnchor:-10,flags:4}},f={4:"m 0,-50 h 125 v -50 H 0 Z",2:"M 0,0 H 125 V -50 H 0 Z",1:"m 0,-25 c 39,-39 37,-75 8,-120 l 6,-5 61,103 C \n40,-13 31,4 73,71 l -5,5 C 14,52 16,125 67,144 l -4,6 C -37,102 -1,22 59,60 Z",.5:"m 52,-47 c 26,-2 42,-21 48,-42 l 12,4 L 64,83 52,79 \n88,-49 c 0,0 -17,22 -57,22 -16,0 -31,-13 -31,-27 0,-18 10,-31 27,-31 17,0 \n33,15 25,38 z",.25:"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \n31,27 40,0 57,-22 57,-22 l -36,128 12,4 77,-270 z",.125:"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \n31,27 40,0 57,-22 57,-22 L 68,20 C 61,37 46,51 24,52 32,29 16,14 -1,14 c \n-17,0 -27,13 -27,31 0,14 15,27 31,27 38,0 55,-20 57,-22 l -36,128 12,4 \n105,-369 z",.0625:"m 158,-292 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -17,61 \nv 0 c -6,21 -22,40 -48,42 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 \n15,27 31,27 40,0 57,-22 57,-22 l -20,69 c -7,18 -22,33 -45,35 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 L 68,20 C \n61,37 46,51 24,52 32,29 16,14 -1,14 c -17,0 -27,13 -27,31 0,14 15,27 31,27 \n38,0 55,-20 57,-22 l -36,128 12,4 134,-469 z"},m={50:{path:"m 101,-199 c -49,0 -100,28 -100,83 0,39 58,57 82,26 15,-20 \n-4,-47 -32,-47 -23,1 -25,0 -25,-8 0,-22 40,-46 71,-41 91,16 67,208 -105,302 \n75,-27 198,-94 211,-201 6,-66 -42,-114 -102,-114 z m 143,33 c -13,0 -23,11 \n-23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 z m 2,83 c \n-13,0 -23,11 -23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 \nz",upper:-4,lower:3},71:{path:"M 139,48 C 102,57 76,120 131,151 41,128 64,24 129,2 L \n117,-57 C -32,47 26,217 166,182 Z m 12,-1 27,131 C 242,153 216,46 151,47 \nZ m -35,-177 c 34,-23 82,-117 50,-140 -23,-17 -71,33 -50,140 z m -10,10 c \n-23,-77 -20,-200 48,-213 19,-4 89,171 -26,266 l 13,66 c 120,-6 137,155 \n39,191 l 12,58 c 30,131 -137,145 -138,47 0,-29 37,-59 63,-37 21,18 25,71 \n-25,70 32,42 103,0 91,-65 L 167,193 C 56,232 -112,63 106,-120 Z",upper:-7,lower:8}},g=[null,"m -49,-121 v 52 l -29,9 v -48 h -8 v 51 l -20,6 v 29 l \n20,-6 v 70 l -20,6 v 30 l 20,-6 v 51 h 8 V 69 l 30,-8 v 50 h 8 V 58 l 20,-6 \nV 23 l -20,6 v -71 l 20,-6 v -29 l -20,6 v -50 z m 1,82 v 71 l -29,9 v -71 z","M -106,-166 V 67 c 52,-42 85,-56 85,-94 0,-47 -46,-51 \n-73,-22 v -117 z m 31,120 c 20,0 42,46 -20,91 V -7 c 0,-28 10,-39 20,-39 z","m -81,-58 v -48 H -92 V 73 l 60,-13 v 50 h 11 V -72 Z m \n50,24 v 58 l -50,11 v -58 z"]},function(t,e,n){n.r(e),n.d(e,"MIN_RESOLUTION",function(){return i}),n.d(e,"STEM_WIDTH",function(){return s}),n.d(e,"LINE_STROKE",function(){return r}),n.d(e,"COMPACT_SPACING",function(){return o});let i=.0625,s=15,r=1,o=150},function(t,e,n){n.r(e),n.d(e,"MAX_QUARTER_DIVISION",function(){return i}),n.d(e,"ScrollType",function(){return a}),n.d(e,"StaffSVGRender",function(){return s});var a,p=n(2),d=n(0),f=n(1);let r=[{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,0,1,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,0,3,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,2,0,0,2,0,2,0,0,3]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-7],accidental:[3,0,3,0,3,0,0,3,0,3,0,0]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,2,0,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,3,0,0]}],c=[{accidental:1,pitches:[]},{accidental:2,pitches:[70,75,68,73,66]},{accidental:1,pitches:[78,73]},{accidental:2,pitches:[70,75,68]},{accidental:1,pitches:[78,73,80,75]},{accidental:2,pitches:[70]},{accidental:2,pitches:[70,75,68,73,66,71]},{accidental:1,pitches:[78]},{accidental:2,pitches:[70,75,68,73]},{accidental:1,pitches:[78,73,80]},{accidental:2,pitches:[70,75]},{accidental:1,pitches:[78,73,80,75,70]}],i=16;(e=a=a||{})[e.PAGE=0]="PAGE",e[e.NOTE=1]="NOTE",e[e.BAR=2]="BAR";class s{constructor(t,e,n){this.handleScrollEvent=t=>{this.lastKnownScrollLeft=this.parentElement.scrollLeft,this.ticking||window.requestAnimationFrame(()=>{this.changeAndDrawSignaturesIfNeeded(this.lastKnownScrollLeft),this.ticking=!1}),this.ticking=!0},this.scoreInfo=t,this.config={noteHeight:e.noteHeight||6,noteSpacing:e.noteSpacing||1,pixelsPerTimeStep:e.pixelsPerTimeStep||30,noteRGB:e.noteRGB||"8, 41, 64",activeNoteRGB:e.activeNoteRGB||"240, 84, 119"},this.div=n,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.key=e.defaultKey||0,this.scrollType=e.scrollType||a.PAGE,this.scale=this.config.noteHeight/f.PATH_SCALE,(void 0===e.pixelsPerTimeStep||e.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0,this.config.noteSpacing=p.COMPACT_SPACING*this.scale),this.clear(),this.redraw()}clear(){for(;this.div.lastChild;)this.div.removeChild(this.div.lastChild);this.div.style.overflow="visible",this.div.style.position="relative",this.overlaySVG=document.createElementNS(d.SVGNS,"svg"),this.overlaySVG.style.position="absolute",this.div.appendChild(this.overlaySVG),this.overlayG=Object(d.createSVGGroupChild)(this.overlaySVG,"overlay"),this.signaturesBlinking=!1,this.signaturesQuarters=0,this.parentElement=document.createElement("div"),this.parentElement.style.overflow="auto",this.div.appendChild(this.parentElement),this.ticking=!1,this.lastKnownScrollLeft=0,this.parentElement.addEventListener("scroll",this.handleScrollEvent),this.staffSVG=document.createElementNS(d.SVGNS,"svg"),this.parentElement.appendChild(this.staffSVG),this.staffG=Object(d.createSVGGroupChild)(this.staffSVG,"staff"),this.linesG=Object(d.createSVGGroupChild)(this.staffSVG,"lines"),this.setStroke(this.linesG),this.staffG.appendChild(this.linesG),this.musicG=Object(d.createSVGGroupChild)(this.staffSVG,"music"),this.setFill(this.musicG),this.setStroke(this.musicG,0),this.staffG.appendChild(this.musicG),this.signaturesG=Object(d.createSVGGroupChild)(this.staffSVG,"signatures"),this.staffG.appendChild(this.signaturesG);let e=0,n=0;this.scoreInfo.notes.forEach(t=>{e+=t.pitch,++n});var t=e/n;this.clef=t<60?50:71,this.signaturesList=[{x:0,q:0}],this.signatureCurrent=0,this.signatureNext=0,this.changeKeySignatureIfNeeded(0),this.changeTimeSignatureIfNeeded(0),this.vStepSize=this.config.noteHeight/2,this.hStepSize=this.config.pixelsPerTimeStep,this.staffOffset=0,this.height=0,this.width=0,this.musicBlockMap=new Map,this.playingNotes=[],this.lastBar=0,this.barAccidentals={},this.lastQ=-1}isPaintingActiveNote(t,e){var n=t.start===e.start,t=t.start<=e.start&&t.start+t.length>=e.start+e.length;return n||t}redraw(n,t){let i=-1,r=0===this.config.pixelsPerTimeStep;if(n){let e=[];this.playingNotes.forEach(t=>{this.isPaintingActiveNote(t,n)?e.push(t):this.highlightElement(this.getGroup(t),!1)}),this.playingNotes=e;var s,o=this.getGroup(n);o&&(this.playingNotes.push(n),this.highlightElement(o,!0),i=o.getBoundingClientRect().left-this.staffSVG.getBoundingClientRect().left,s=n.start,o=o.getAttribute("data-is-bar-beginning"),this.scrollType===a.BAR&&!o||this.scrollIntoViewIfNeeded(t,i),!r)&&this.signaturesBlinking&&s>=this.signaturesQuarters&&(this.signaturesBlinking=!1,Object(d.setFade)(this.overlayG,this.signaturesBlinking))}else{this.setDetails();let t=-1===this.lastQ,n=0,i=0,e=(t?(i=this.drawSignatures(this.overlayG,n,!0,!0,!0),r&&(this.width=0,i+=this.config.noteSpacing),i+=this.drawRests(this.initialRest,n+i)):n=this.width,this.musicBlockMap.forEach((t,e)=>{r||(n=this.quartersToTime(e)*this.hStepSize),e>this.lastQ?(i+=this.drawMusicBlock(t,n+i),this.lastQ=e):e===this.lastQ&&(i+=this.drawRests(t,n+i))}),this.staffSVG.getBoundingClientRect()),s=this.musicG.getBoundingClientRect();if(this.updateVerticalBoundaries(s.top-e.top,s.bottom-e.top),r)this.width+=i;else{let t=this.musicBlockMap.get(this.lastQ),e=this.quartersToTime(this.lastQ+t.notes[0].length);this.width=e*this.config.pixelsPerTimeStep}this.staffSVG.setAttributeNS(null,"width",""+this.width),this.redrawStaff(this.linesG,0,this.width)}return i}drawMusicBlock(r,o){var i=r.notes[0].start;let a=this.drawBarIfNeeded(i,o),u=(a+=this.drawSignaturesIfNeeded(i,o+a),0);for(let t=4;t>=p.MIN_RESOLUTION&&!u;t/=2)t<=r.notes[0].length&&(u=t);if(0===u){let t=0===r.notes[0].length?"[infinite]":""+4/r.notes[0].length;console.warn(" StaffRender ","background:orange; color:white",`StaffRender does not handle notes shorther than 1/${4/p.MIN_RESOLUTION}th, and this score tries to draw a 1/${t}th. Shortest possible note will be drawn instead.`),u=p.MIN_RESOLUTION}let c=f.NOTE_PATHS[u],s;if(c.stemAnchor&&(s=Object(d.createSVGGroupChild)(this.musicG,"stem")),r.notes.forEach(e=>{var n=e.vSteps*this.vStepSize,i=2*(0<e.vSteps?Math.floor(e.vSteps/2):Math.ceil(e.vSteps/2)),s=0<e.vSteps?-2:2;for(let t=i;4<Math.abs(t);t+=s)Object(d.drawSVGPath)(this.linesG,f.extraLinePath,o+a,t*this.vStepSize,this.scale,1);if(e.g=e.tiedFrom?e.tiedFrom.g:Object(d.createSVGGroupChild)(this.musicG,e.start+"-"+e.pitch),r.isBarBeginning&&e.g.setAttribute("data-is-bar-beginning","true"),e.tiedFrom){let t=o+a-e.tiedFrom.xHeadRight;Object(d.drawSVGPath)(e.g,f.tiePath,e.tiedFrom.xHeadRight,n,t/f.PATH_SCALE,this.scale*(e.vSteps<0?-1:1),e.opacity)}Object(d.drawSVGPath)(e.g,c.path,o+a,n,this.scale,this.scale,e.opacity),e.xHeadRight=o+a+c.width*this.scale,1.5*u<=e.length&&Object(d.drawSVGPath)(e.g,f.dotPath,o+a+c.width*this.scale+this.vStepSize/2,n-this.vStepSize/2,this.scale,this.scale,e.opacity),0!==e.accidental&&Object(d.drawSVGPath)(e.g,f.ACCIDENTAL_PATHS[e.accidental],o+a,n,this.scale,this.scale,e.opacity)}),c.stemAnchor){let t,e,n=o+a;var i=c.stemAnchor*this.scale,h=r.minVStep+r.maxVStep<0,l=2<c.flags?2*(c.flags-2):0;if(e=h?(t=r.maxVStep*this.vStepSize-i,(r.minVStep+7+l)*this.vStepSize):(n+=(c.width-p.STEM_WIDTH)*this.scale,t=r.minVStep*this.vStepSize+i,(r.maxVStep-7-l)*this.vStepSize),Object(d.drawSVGPath)(s,f.stemPath,n,t,this.scale,(e-t)/f.PATH_SCALE),1===c.flags)Object(d.drawSVGPath)(s,f.singleFlagPath,n,e,this.scale,this.scale*(h?-1:1),1);else if(1<c.flags)for(let t=0;t<c.flags;++t)Object(d.drawSVGPath)(s,f.multiFlagPath,n,e,this.scale,this.scale*(h?-1:1),1),e+=(h?-2:2)*this.vStepSize}return 0===this.config.pixelsPerTimeStep&&(a+=c.width*this.scale,s&&(a+=s.getBoundingClientRect().width),a+=this.config.noteSpacing),a+=this.drawRests(r,o+a)}drawBarIfNeeded(t,e){let n=0;var i=this.lastBar+this.getBarLength();return 0!==t&&i<=t&&(0<this.config.pixelsPerTimeStep?e-=this.config.noteSpacing:n=this.config.noteSpacing,Object(d.drawSVGPath)(this.linesG,f.barPath,e,0,1,this.scale),this.lastBar=i),n}drawRests(t,r){let o=0,a=t.restToNextLength;if(a){0<this.config.pixelsPerTimeStep&&(r+=this.quartersToTime(t.notes[0].length)*this.hStepSize);let e=t.notes[0].start+t.notes[0].length,n=0;t=this.lastBar+this.getBarLength()-e;let i;for(a>t&&(n=a-t,a=t),i=4;i>this.getBarLength()&&i>=p.MIN_RESOLUTION;i/=2);let s=i;for(;(a||n)&&s>=p.MIN_RESOLUTION;){if(s<=a){o=(o+=this.drawBarIfNeeded(e,r+o))+this.drawSignaturesIfNeeded(e,r+o);let t=Object(d.drawSVGPath)(this.musicG,f.REST_PATHS[s],r+o,0,this.scale,this.scale);0<this.config.pixelsPerTimeStep?r+=this.quartersToTime(s)*this.hStepSize:o=(o+=t.getBoundingClientRect().width)+this.config.noteSpacing,e+=s,a-=s}if(n&&a<=0){let t=this.getBarLength();for(n>t?(a=t,n-=t):(a=n,n=0),i=4;i>this.getBarLength()&&i>=p.MIN_RESOLUTION;i/=2);s=i}a<s&&(s/=2)}}return o}redrawStaff(t,e,n){let i=t.querySelector('g[data-id="staff-five-lines"]');if(i)i.setAttributeNS(null,"transform",`scale(${n/f.PATH_SCALE}, 1)`);else{i=Object(d.createSVGGroupChild)(t,"staff-five-lines");for(let t=-4;t<=4;t+=2)Object(d.drawSVGPath)(i,f.staffLinePath,e,0+t*this.vStepSize,n/f.PATH_SCALE,1)}return i}clearSignatureOverlay(){for(;this.overlayG.lastChild;)this.overlayG.removeChild(this.overlayG.lastChild)}drawSignaturesIfNeeded(t,e){let n=0;var i,s=this.changeKeySignatureIfNeeded(t),r=this.changeTimeSignatureIfNeeded(t);return(s||r)&&(i=p.COMPACT_SPACING*this.scale*(0<this.config.pixelsPerTimeStep?3:2),this.signaturesList.push({x:e-i,q:t}),null===this.signatureNext&&(this.signatureNext=e),i=0<t?Object(d.createSVGGroupChild)(this.signaturesG,"signatures"):this.overlayG,n+=this.drawSignatures(i,e+n,!1,s,r)),0===this.config.pixelsPerTimeStep?n:0}drawSignatures(i,s,t,e,n){var r=p.COMPACT_SPACING*this.scale;let o,a=r;var u=i===this.overlayG||0<this.config.pixelsPerTimeStep;if(u){(o=document.createElementNS(d.SVGNS,"rect")).setAttributeNS(null,"x",""+s),o.setAttributeNS(null,"y","0"),o.setAttributeNS(null,"width","1"),o.setAttributeNS(null,"height","1"),o.setAttribute("data-id","background"),i.appendChild(o);let t=document.defaultView.getComputedStyle(this.div.parentElement);o.setAttributeNS(null,"fill",t.getPropertyValue("background-color"))}if(t){let t=Object(d.drawSVGPath)(i,f.CLEF_PATHS[this.clef].path,s+a,0,this.scale,this.scale);this.setFill(t),a+=3*r}if(e){let e=c[this.key].accidental,n=71===this.clef?0:14;c[this.key].pitches.forEach(t=>{t=this.getPitchDetails(t).vSteps,t=Object(d.drawSVGPath)(i,f.ACCIDENTAL_PATHS[e],s+a,(n+t)*this.vStepSize,this.scale,this.scale);this.setFill(t),a+=t.getBoundingClientRect().width})}if(n){let t=Object(d.createSVGGroupChild)(i,"time-key"),e=2.85*this.config.noteHeight+"px";Object(d.drawSVGText)(t,""+this.timeSignatureNumerator,s+a,-.5,e,!0),Object(d.drawSVGText)(t,""+this.timeSignatureDenominator,s+a,4*this.vStepSize-.5,e,!0),this.setFill(t),a+=t.getBoundingClientRect().width+r}t=this.redrawStaff(i,s,a),this.setStroke(t),e=this.div.getBoundingClientRect(),n=i.getBoundingClientRect();if(this.updateVerticalBoundaries(n.top-e.top,n.bottom-e.top),u&&(o.setAttributeNS(null,"y",""+-this.staffOffset),o.setAttributeNS(null,"height",""+this.height),o.setAttributeNS(null,"width",""+a)),i===this.overlayG){this.overlaySVG.setAttributeNS(null,"width",""+(a+5));for(let e=0;e<5;++e){let t=Object(d.drawSVGPath)(i,f.stemPath,a+e,e*e-this.staffOffset,1/p.STEM_WIDTH,(this.height-2*e*e)/f.PATH_SCALE,(e-5)*(e-5)*2/f.PATH_SCALE);this.setFill(t)}}if(0<this.config.pixelsPerTimeStep){let t=0===this.signaturesQuarters;return t&&(this.signaturesQuarters=this.timeToQuarters(a/this.hStepSize)),(t||0<s)&&(this.signaturesBlinking=!0,Object(d.setFade)(i,this.signaturesBlinking)),0}return a}changeKeySignatureIfNeeded(n){if(this.scoreInfo.keySignatures){let e=this.key;for(let t=0;t<this.scoreInfo.keySignatures.length&&this.scoreInfo.keySignatures[t].start<=n;++t)e=this.scoreInfo.keySignatures[t].key;if(e!==this.key)return this.key=e,!0}return!1}changeTimeSignatureIfNeeded(i){if(this.scoreInfo.timeSignatures){let e=this.timeSignatureNumerator,n=this.timeSignatureDenominator;for(let t=0;t<this.scoreInfo.timeSignatures.length&&this.scoreInfo.timeSignatures[t].start<=i;++t)e=this.scoreInfo.timeSignatures[t].numerator,n=this.scoreInfo.timeSignatures[t].denominator;if(e!==this.timeSignatureNumerator||n!==this.timeSignatureDenominator)return this.timeSignatureNumerator=e,this.timeSignatureDenominator=n,!0}return!1}changeAndDrawSignaturesIfNeeded(e){let i;if(e<this.signatureCurrent||null!==this.signatureNext&&this.signatureNext<=e){i=this.signaturesList[0].q,this.signatureNext=null;for(let t=0;t<this.signaturesList.length;++t){if(e<this.signaturesList[t].x){this.signatureNext=this.signaturesList[t].x;break}this.signatureCurrent=this.signaturesList[t].x,i=this.signaturesList[t].q}}if(void 0!==i){let t=this.key,e=this.timeSignatureNumerator,n=this.timeSignatureDenominator;this.changeKeySignatureIfNeeded(i),this.changeTimeSignatureIfNeeded(i),this.clearSignatureOverlay(),this.drawSignatures(this.overlayG,0,!0,!0,!0),this.key=t,this.timeSignatureNumerator=e,this.timeSignatureDenominator=n}0<this.config.pixelsPerTimeStep&&0===e&&(this.signatureNext=0,this.signaturesBlinking=!0,Object(d.setFade)(this.overlayG,this.signaturesBlinking))}getBarLength(){return 4*this.timeSignatureNumerator/this.timeSignatureDenominator}scrollIntoViewIfNeeded(t,e){if(t)if(this.scrollType===a.PAGE){let t=this.parentElement.getBoundingClientRect().width;e>this.parentElement.scrollLeft+t&&(this.parentElement.scrollLeft=e-20)}else{let t=this.parentElement.getBoundingClientRect().width;this.parentElement.scrollLeft=e-.5*t}}updateVerticalBoundaries(e,t){let i=0;if(e<0){this.staffOffset-=e;let t=`translate(0, ${this.staffOffset})`;this.overlayG.setAttributeNS(null,"transform",t),this.staffG.setAttributeNS(null,"transform",t),i=this.height-e}if((i=Math.max(i,t-e))>this.height){this.height=i,this.overlaySVG.setAttributeNS(null,"height",""+this.height),this.staffSVG.setAttributeNS(null,"height",""+this.height);let n=this.div.querySelectorAll('rect[data-id="background"]');for(let e=0;e<n.length;++e){let t=n[e];t.setAttributeNS(null,"y",""+-this.staffOffset),t.setAttributeNS(null,"height",""+this.height)}}}setFill(t,e=!1){t.setAttributeNS(null,"fill",this.getColor(e))}setStroke(t,e=p.LINE_STROKE,n=!1){t.setAttributeNS(null,"stroke",this.getColor(n)),t.setAttributeNS(null,"stroke-width",""+e)}getColor(t){return`rgb(${t?this.config.activeNoteRGB:this.config.noteRGB})`}getOpacity(t){return t?t/127*.8+.2:1}getGroup(t){var e=t.start;return this.staffSVG.querySelector(`g[data-id="${e}-${t.pitch}"]`)}highlightElement(t,e){t.setAttribute("fill",this.getColor(e)),t.setAttribute("stroke",this.getColor(e))}getBarBeginnings(){var e=new Set;let n=0;this.scoreInfo.notes.forEach(t=>{t.start+t.length>n&&(n=t.start+t.length)});var i=this.scoreInfo.timeSignatures?this.scoreInfo.timeSignatures.slice(0):[{start:0,numerator:4,denominator:4}];i.sort((t,e)=>t.start-e.start);let s=0;for(let t=0;t<i.length;++t)for(var r=t===i.length-1?n:i[t].start,o=4*i[t].numerator/i[t].denominator;s<r;s+=o)e.add(s);return e}quartersToTime(t){return t/this.scoreInfo.tempos[0].qpm*60}timeToQuarters(t){return t*this.scoreInfo.tempos[0].qpm/60}setDetails(){let i=new Map,t=this.getBarBeginnings(),e=new Set(t);this.scoreInfo.notes.slice().sort((t,e)=>t.start-e.start).forEach(t=>{t=this.getQNote(t);e.add(t.start),e.add(t.start+t.length),i.has(t.start)?i.get(t.start).push(t):i.set(t.start,[t])}),Array.from(e).sort((t,e)=>t-e).forEach(e=>{let n=[];i.forEach(t=>{t.forEach(t=>{t=this.splitQNote(t,e);t&&n.push(t)})}),n.forEach(t=>{i.has(t.start)?i.get(t.start).push(t):i.set(t.start,[t])})}),i=new Map(Array.from(i).sort((t,e)=>t[0]-e[0]));var n=this.key;let s=null,r=0,o=t[Symbol.iterator](),a=o.next();i.forEach((t,e)=>{let n={maxVStep:Number.MAX_SAFE_INTEGER,minVStep:Number.MIN_SAFE_INTEGER,restToNextLength:0,isBarBeginning:!1,notes:[]};this.changeKeySignatureIfNeeded(e);var i=a.value+this.getBarLength();!a.done&&i<=e&&(a=o.next(),this.barAccidentals={},n.isBarBeginning=!0),t.forEach(t=>{this.analyzePitch(t,e),n.minVStep=Math.max(t.vSteps,n.minVStep),n.maxVStep=Math.min(t.vSteps,n.maxVStep),n.notes.push(t)}),s&&(s.restToNextLength=e-r),this.musicBlockMap.set(e,n),s=n,r=e+n.notes[0].length}),this.initialRest={maxVStep:0,minVStep:0,restToNextLength:this.musicBlockMap.values().next().value.notes[0].start,isBarBeginning:!0,notes:[{start:0,length:0,vSteps:0,accidental:0,opacity:0,pitch:0,xHeadRight:0}]},this.key=n}getQNote(t){return{start:t.start,length:t.length,vSteps:0,accidental:0,opacity:this.getOpacity(t.intensity),pitch:t.pitch,xHeadRight:0}}splitQNote(t,e){var n=t.start+t.length-e;return t.start<e&&0<n?(t.length-=n,{start:e,length:n,vSteps:t.vSteps,accidental:t.accidental,opacity:t.opacity,pitch:t.pitch,xHeadRight:0,tiedFrom:t}):null}analyzePitch(t,e){var n=this.getPitchDetails(t.pitch);n.vSteps in this.barAccidentals?n.accidental===this.barAccidentals[n.vSteps]?n.accidental=0:(3===this.barAccidentals[n.vSteps]?n.accidental=n.keyAccidental:0===n.accidental&&(n.accidental=3),this.barAccidentals[n.vSteps]=n.accidental):(t.tiedFrom&&(n.accidental=0),this.barAccidentals[n.vSteps]=n.accidental),t.vSteps=n.vSteps,t.accidental=n.accidental}getPitchDetails(t){var t=t-60,e=Math.floor(t/12),t=t-12*e,n=r[this.key].steps[t],i=71===this.clef?6:-6,s=1===c[this.key].accidental?69+(3+t)%12:64+(8+t)%12;return{vSteps:i-7*e+n,accidental:r[this.key].accidental[t],keyAccidental:-1<c[this.key].pitches.indexOf(s)?c[this.key].accidental:0}}}},function(t,e,n){n.r(e);var i=n(3);n.d(e,"MAX_QUARTER_DIVISION",function(){return i.MAX_QUARTER_DIVISION}),n.d(e,"ScrollType",function(){return i.ScrollType}),n.d(e,"StaffSVGRender",function(){return i.StaffSVGRender})}],r={},s.m=i,s.c=r,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=4))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){function a(t){for(var u,c=new h(t),e=[];!c.eof();){var n=(()=>{var t,e={},n=(e.deltaTime=c.readVarInt(),c.readUInt8());if(240==(240&n)){if(255!==n){if(240==n)return e.type="sysEx",s=c.readVarInt(),e.data=c.readBytes(s),e;if(247==n)return e.type="endSysEx",s=c.readVarInt(),e.data=c.readBytes(s),e;throw"Unrecognised MIDI event type byte: "+n}e.meta=!0;var i=c.readUInt8(),s=c.readVarInt();switch(i){case 0:if(e.type="sequenceNumber",2!==s)throw"Expected length for sequenceNumber event is 2, got "+s;return e.number=c.readUInt16(),e;case 1:return e.type="text",e.text=c.readString(s),e;case 2:return e.type="copyrightNotice",e.text=c.readString(s),e;case 3:return e.type="trackName",e.text=c.readString(s),e;case 4:return e.type="instrumentName",e.text=c.readString(s),e;case 5:return e.type="lyrics",e.text=c.readString(s),e;case 6:return e.type="marker",e.text=c.readString(s),e;case 7:return e.type="cuePoint",e.text=c.readString(s),e;case 32:if(e.type="channelPrefix",1!=s)throw"Expected length for channelPrefix event is 1, got "+s;return e.channel=c.readUInt8(),e;case 33:if(e.type="portPrefix",1!=s)throw"Expected length for portPrefix event is 1, got "+s;return e.port=c.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=s)throw"Expected length for endOfTrack event is 0, got "+s;return e;case 81:if(e.type="setTempo",3!=s)throw"Expected length for setTempo event is 3, got "+s;return e.microsecondsPerBeat=c.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=s)throw"Expected length for smpteOffset event is 5, got "+s;var r=c.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&r],e.hour=31&r,e.min=c.readUInt8(),e.sec=c.readUInt8(),e.frame=c.readUInt8(),e.subFrame=c.readUInt8(),e;case 88:if(e.type="timeSignature",4!=s)throw"Expected length for timeSignature event is 4, got "+s;return e.numerator=c.readUInt8(),e.denominator=1<<c.readUInt8(),e.metronome=c.readUInt8(),e.thirtyseconds=c.readUInt8(),e;case 89:if(e.type="keySignature",2!=s)throw"Expected length for keySignature event is 2, got "+s;return e.key=c.readInt8(),e.scale=c.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=c.readBytes(s),e;default:return e.type="unknownMeta",e.data=c.readBytes(s),e.metatypeByte=i,e}}else{if(0==(128&n)){if(null===u)throw"Running status byte encountered before status byte";t=n,n=u,e.running=!0}else t=c.readUInt8(),u=n;var o=n>>4;switch(e.channel=15&n,o){case 8:return e.type="noteOff",e.noteNumber=t,e.velocity=c.readUInt8(),e;case 9:var a=c.readUInt8();return e.type=0===a?"noteOff":"noteOn",e.noteNumber=t,0===(e.velocity=a)&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=t,e.amount=c.readUInt8(),e;case 11:return e.type="controller",e.controllerType=t,e.value=c.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=t,e;case 13:return e.type="channelAftertouch",e.amount=t,e;case 14:return e.type="pitchBend",e.value=t+(c.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+o}}})();e.push(n)}return e}function h(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}h.prototype.eof=function(){return this.pos>=this.bufferLen},h.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t},h.prototype.readInt8=function(){var t=this.readUInt8();return 128&t?t-256:t},h.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},h.prototype.readInt16=function(){var t=this.readUInt16();return 32768&t?t-65536:t},h.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},h.prototype.readInt24=function(){var t=this.readUInt24();return 8388608&t?t-16777216:t},h.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},h.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e},h.prototype.readString=function(t){t=this.readBytes(t);return String.fromCharCode.apply(null,t)},h.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(!(128&e))return t+e;t=t+(127&e)<<7}return t},h.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32();return{id:t,length:e,data:this.readBytes(e)}},t.exports=function(t){var e=new h(t),t=e.readChunk();if("MThd"!=t.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+t.id+"'";t=new h(t.data),n={format:t.readUInt16(),numTracks:t.readUInt16()},32768&(t=t.readUInt16())?(n.framesPerSecond=256-(t>>8),n.ticksPerFrame=255&t):n.ticksPerBeat=t;for(var n,i=n,s=[],r=0;!e.eof()&&r<i.numTracks;r++){var o=e.readChunk();if("MTrk"!=o.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+o.id+"'";o=a(o.data);s.push(o)}return{header:i,tracks:s}}},function(t,e){function h(t,e,n){for(var i=new l,s=e.length,r=null,o=0;o<s;o++)!1!==n.running&&(n.running||e[o].running)||(r=null),r=((t,e,n,i)=>{var s=e.type,r=e.deltaTime,o=e.text||"",a=e.data||[],u=null;switch(t.writeVarInt(r),s){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(o.length),t.writeString(o);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(o.length),t.writeString(o);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(o.length),t.writeString(o);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(o.length),t.writeString(o);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(o.length),t.writeString(o);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(o.length),t.writeString(o);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(o.length),t.writeString(o);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c=31&e.hour|{24:0,25:32,29:64,30:96}[e.frameRate];t.writeUInt8(c),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);c=255&Math.floor(Math.log(e.denominator)/Math.LN2);t.writeUInt8(c),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(a.length),t.writeBytes(a);break;case"unknownMeta":null!=e.metatypeByte&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(a.length),t.writeBytes(a));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(a.length),t.writeBytes(a);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(a.length),t.writeBytes(a);break;case"noteOff":(u=(!1!==i&&e.byte9||i&&0==e.velocity?144:128)|e.channel)!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":(u=144|e.channel)!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":(u=160|e.channel)!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":(u=176|e.channel)!==n&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":(u=192|e.channel)!==n&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":(u=208|e.channel)!==n&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":(u=224|e.channel)!==n&&t.writeUInt8(u);var c=8192+e.value,h=127&c,c=c>>7&127;t.writeUInt8(h),t.writeUInt8(c);break;default:throw"Unrecognized event type: "+s}return u})(i,e[o],r,n.useByte9ForNoteOff);t.writeChunk("MTrk",i.buffer)}function l(){this.buffer=[]}l.prototype.writeInt8=l.prototype.writeUInt8=function(t){this.buffer.push(255&t)},l.prototype.writeInt16=l.prototype.writeUInt16=function(t){var e=255&t;this.writeUInt8(t>>8&255),this.writeUInt8(e)},l.prototype.writeInt24=l.prototype.writeUInt24=function(t){var e=t>>8&255,n=255&t;this.writeUInt8(t>>16&255),this.writeUInt8(e),this.writeUInt8(n)},l.prototype.writeInt32=l.prototype.writeUInt32=function(t){var e=t>>16&255,n=t>>8&255,i=255&t;this.writeUInt8(t>>24&255),this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(i)},l.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))},l.prototype.writeString=function(t){for(var e=t.length,n=[],i=0;i<e;i++)n.push(t.codePointAt(i));this.writeBytes(n)},l.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(127&e),e>>=7;e;)n.push(127&e|128),e>>=7;this.writeBytes(n.reverse())}},l.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)},t.exports=function(t,e){if("object"!=typeof t)throw"Invalid MIDI data";e=e||{};var n,i,s,r,o=t.header||{},a=t.tracks||[],u=a.length,c=new l;for(t=c,i=u,s=null==o.format?1:o.format,r=128,o.timeDivision?r=o.timeDivision:o.ticksPerFrame&&o.framesPerSecond?r=-(255&o.framesPerSecond)<<8|255&o.ticksPerFrame:o.ticksPerBeat&&(r=32767&o.ticksPerBeat),(o=new l).writeUInt16(s),o.writeUInt16(i),o.writeUInt16(r),t.writeChunk("MThd",o.buffer),n=0;n<u;n++)h(c,a[n],e);return c.buffer}},function(t,e,n){var s=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var i=Array(t),s=0,e=0;e<n;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,s++)i[s]=r[o];return i},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},r=(Object.defineProperty(e,"__esModule",{value:!0}),n(79)),o=n(66),a=i(n(175));function u(n){return a.default(n.notes.map(function(t){return t=t,e=n.channel,[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(127*t.velocity)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(127*t.noteOffVelocity)}];var e}))}e.encode=function(t){t={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:s([s([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(t){return t=t,e=o.keySignatureKeys.indexOf(t.key),{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:"major"===t.scale?0:1,type:"keySignature"};var e}),t.header.meta.map(function(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}),t.header.tempos.map(function(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}),t.header.timeSignatures.map(function(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}))],t.tracks.map(function(t){return s([{absoluteTime:0,deltaTime:0,meta:!0,text:t.name,type:"trackName"},{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}],u(t),(n=>{for(var i=[],t=0;t<127;t++)n.controlChanges.hasOwnProperty(t)&&n.controlChanges[t].forEach(function(t){var e;i.push((e=n.channel,{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:t.value}))});return i})(t),(i=[],(n=t).pitchBends.forEach(function(t){var e;i.push((e=n.channel,{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}))}),i));var n,i}))};return t.tracks=t.tracks.map(function(t){t=t.sort(function(t,e){return t.absoluteTime-e.absoluteTime});var e=0;return t.forEach(function(t){t.deltaTime=t.absoluteTime-e,e=t.absoluteTime,delete t.absoluteTime}),t.push({deltaTime:0,meta:!0,type:"endOfTrack"}),t}),new Uint8Array(r.writeMidi(t))}},function(t,e,n){function i(t){return function t(e,n){for(var i=0;i<e.length;i++){var s=e[i];Array.isArray(s)?t(s,n):n.push(s)}return n}(t,[])}function s(t,e){if("number"!=typeof e)throw new TypeError("Expected the depth to be a number");return function t(e,n,i){i--;for(var s=0;s<e.length;s++){var r=e[s];-1<i&&Array.isArray(r)?t(r,n,i):n.push(r)}return n}(t,[],e)}t.exports=function(t){if(Array.isArray(t))return i(t);throw new TypeError("Expected value to be an array")},t.exports.from=i,t.exports.depth=function(t,e){if(Array.isArray(t))return s(t,e);throw new TypeError("Expected value to be an array")},t.exports.fromDepth=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(82);e.createControlChanges=function(){return new Proxy({},{get:function(t,e){return t[e]||(i.controlChangeIds.hasOwnProperty(e)?t[i.controlChangeIds[e]]:void 0)},set:function(t,e,n){return i.controlChangeIds.hasOwnProperty(e)?t[i.controlChangeIds[e]]=n:t[e]=n,!0}})}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=new WeakMap;function s(t,e){i.set(this,e),this.ticks=t.absoluteTime,this.value=t.value}Object.defineProperty(s.prototype,"time",{get:function(){return i.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=i.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!0,configurable:!0}),s.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e.PitchBend=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(179),s=new WeakMap,n=(Object.defineProperty(r.prototype,"name",{get:function(){return(this.percussion?i.DrumKitByPatchID:i.instrumentByPatchID)[this.number]},set:function(t){t=i.instrumentByPatchID.indexOf(t);-1!==t&&(this.number=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"family",{get:function(){return this.percussion?"drums":i.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"percussion",{get:function(){return 9===s.get(this).channel},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},r.prototype.fromJSON=function(t){this.number=t.number},r);function r(t,e){this.number=0,s.set(this,e),this.number=0,t&&(e=t.find(function(t){return"programChange"===t.type}))&&(this.number=e.programNumber)}e.Instrument=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],e.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],e.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},function(t,e,n){function i(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}Object.defineProperty(e,"__esModule",{value:!0});s=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,r={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};var s,r,o=new WeakMap,a=(Object.defineProperty(u.prototype,"name",{get:function(){return t=this.midi,e=Math.floor(t/12)-1,i(t)+e.toString();var t,e},set:function(t){var e;this.midi=(t=t,t=s.exec(t),e=t[1],t=t[2],r[e.toLowerCase()]+12*(parseInt(t,10)+1))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){t-=this.octave;this.midi+=12*t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"pitch",{get:function(){return i(this.midi)},set:function(t){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(t)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"duration",{get:function(){var t=o.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){t=o.get(this).secondsToTicks(this.time+t);this.durationTicks=t-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"time",{get:function(){return o.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=o.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"bars",{get:function(){return o.get(this).ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),u.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},u);function u(t,e,n){o.set(this,n),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=e.velocity,this.ticks=t.ticks,this.durationTicks=e.ticks-t.ticks}e.Note=a}])});